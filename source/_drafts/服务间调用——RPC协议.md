---
title: 服务间调用——RPC协议
tags:
---

在微服务架构中，服务之间进行通信是一项基本需求。RPC（Remote Procedure Call）调用是一种在服务之间进行通讯的流行方式，它允许一个服务直接调用另一个服务的方法，就像是本地方法调用一样。
### 1. 常用解决方案
以下是几种流行的微服务之间RPC调用的解决方案：

1. **gRPC**：
    - **由谷歌开发**，是一个高性能、开源和通用的RPC框架，基于HTTP/2协议传输，支持多种编程语言。
    - **优点**：支持跨语言调用、高性能、基于ProtoBuf（Protocol Buffers，谷歌开发的一种数据交换格式）实现高效的数据序列化。
    - **使用场景**：适合于需要高性能、强类型接口的分布式系统。

2. **Apache Thrift**：
    - **由Facebook开发，后捐赠给Apache**，是一个跨语言的服务开发框架，支持RPC调用。
    - **优点**：支持多种编程语言，通过定义一个统一的接口描述语言(IDL)来生成对应语言的代码，简化开发过程。
    - **使用场景**：当需要支持多种编程语言，并且希望有一个统一接口定义时使用。

3. **JSON-RPC和XML-RPC**：
    - **基于文本的RPC协议**，JSON-RPC使用JSON格式传输数据，而XML-RPC使用XML格式。
    - **优点**：易于理解和实现，JSON-RPC尤其适用于Web应用。
    - **使用场景**：当开发简单的服务或者不需要高性能的通信时，这些轻量级的协议是不错的选择。

4. **RESTful API调用**：
    - 虽然不是传统意义上的RPC，但在微服务架构中REST API广泛用于服务之间的通信。
    - **优点**：基于HTTP标准，易于理解和使用，可以使用标准的HTTP客户端进行调用。
    - **使用场景**：当服务之间主要进行CRUD（创建、读取、更新和删除）操作时，RESTful API是一个自然且简单的选择。

5. **Dubbo**：
    - **是一个由阿里巴巴开发的高性能、轻量级的开源Java RPC框架**。
    - **优点**：提供了丰富的服务治理特性，如负载均衡、容错等，并且易于集成到Spring框架。
    - **使用场景**：适用于JVM生态系统中，需要高性能RPC调用且对服务治理有一定要求的场景。

选择哪种RPC框架，取决于你的具体需求，比如支持的编程语言、性能需求、生态系统兼容性等因素。各种RPC框架各有优缺点，重要的是根据你的应用场景选择最合适的框架。

### 2. 对比 RestFul API 与 JSON-RPC
其中，我们常用的Spring cloud openFeign是建立在 RESTful API 调用之上的一个声明式的Web服务客户端。相比于JSON-RPC，虽然它们都可以通过HTTP进行交互，但在设计理念、消息格式以及使用场景上存在明显差异：
#### 1. 设计理念

- **JSON-RPC**：是一种无状态的、轻量级的远程过程调用（RPC）协议。它依赖于固定的请求响应模式，通过特定的数据格式（JSON）发送请求，明确指定要调用的方法以及传递的参数，不尝试去描述或限制应用程序的结构。
    
- **RESTful API**：基于REpresentational State Transfer（表现层状态转换）的架构风格，更注重资源（如对象、文件等）的状态和表现形式，以及这些资源状态之间的转换。通常使用HTTP方法（如GET、POST、PUT、DELETE等）表示操作。

#### 2. 消息格式

- **JSON-RPC**：请求和响应都必须是JSON格式，具有固定的结构，例如包含`method`和`params`字段来指定调用的方法和传递的参数。
    
- **RESTful API**：虽然RESTful API可以使用JSON作为数据交换格式，但它本身并不限制消息格式，也可以使用XML、YAML等。RESTful请求通常通过HTTP路径和方法指定要操作的资源和操作类型。

#### 3. 使用场景

- **JSON-RPC**：由于其设计上的简洁和高效，通常适合于需要快速、轻量级通信的内部服务调用，例如微服务之间的通信，或者客户端与后端服务的通信，特别是当API的消费者和提供者都可以协商使用固定契约时。
    
- **RESTful API**：更适合于构建符合网络标准的、松散耦合的Web服务，尤其是当需要明确表示资源以及资源之间关系的公共API和外部系统集成时。

#### 4. 状态性

- **JSON-RPC**：是无状态的，每次调用之间不保持任何状态。
    
- **RESTful API**：也是无状态的，但它利用HTTP协议的无状态性构建RESTful服务。尽管如此，RESTful API设计中的资源表示（如资源URL）能够隐含地保持应用状态，这也是REST中的“状态转换”概念。

#### 5. 标准方法和操作

- **JSON-RPC**：不定义任何特定的方法，用户自定义方法名称和参数。
    
- **RESTful API**：利用HTTP标准方法（GET、POST、PUT、DELETE等）来实现对资源的操作。

总的来说，JSON-RPC和RESTful API各有优势，适合不同的场景。JSON-RPC的使用简单直接，适合于需要高性能和简化协议的内部服务通信；而RESTful API则更适合构建可扩展的、易于外部访问和集成的Web服务。选择哪种技术，取决于具体的项目需求和环境约束。

### 3. JSON-RPC 常见开源工具
1. **jackson-jr/json-rpc**：这是一个Java库，利用Jackson jr库来快速实现JSON-RPC的客户端和服务端。Jackson是在Java领域广泛使用的JSON处理库，`jackson-jr`是它的“轻量化”版本。

2. **jsonrpc4j**：这是一个基于Java的库，允许你通过使用代理模式以及注解轻松地在Java应用程序中创建JSON-RPC服务。它可以运行在任何Servlet容器内，或通过Spring框架进行配置。

3. **tinyrpc**：一个轻量级的Python JSON-RPC库，支持创建JSON-RPC的服务端和客户端。它支持多种传输方式（例如HTTP、ZMQ等），并且易于扩展。

4. **json-rpc-go**：一个Go语言实现的JSON-RPC 2.0库，支持服务端和客户端。它简单易用，能够快速在Go项目中实现JSON-RPC通信。

5. **jayson**：Jayson是一个Node.js库，支持JSON-RPC 2.0客户端和服务端的实现。它提供了灵活的服务器和客户端API，可以轻松集成到Node.js的应用程序中。

6. **jsonrpc**：一个轻量级的Rust库，用于构建JSON-RPC的客户端和服务端。它提供了完整的JSON-RPC 2.0支持，并且易于与Rust项目集成。

这些库和工具覆盖了多种编程语言，使得在不同的开发环境中实现JSON-RPC变得更加简单。选择哪个工具取决于你的具体需求以及所使用的语言和技术栈。
