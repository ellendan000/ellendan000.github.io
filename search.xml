<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ä½¿ç”¨ Prefect æ­å»ºæ•°æ®ç®¡é“è‡ªåŠ¨æ›´æ–°HuggingFace Datasets</title>
      <link href="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/"/>
      <url>/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å‰è¨€">ä¸€ã€å‰è¨€</h2><p>è¿‘æœŸåœ¨é‡åŒ–åˆ†æ Demo ä¸­ï¼Œä¸€ç›´ä½¿ç”¨&nbsp;<code>ellendan/a-share-21</code>&nbsp;è¿™ä¸€çŸ­æœŸå‰å¤æƒä»·æ ¼æ•°æ®é›†ï¼Œè€Œæ—§æ•°æ®é›†&nbsp;<code>ellendan/a-share-prices</code>&nbsp;åˆ™é•¿æœŸæœªæ›´æ–°ã€‚<br><code>ellendan/a-share-prices</code>&nbsp;æ•°æ®é›†çš„æ—¶é—´è·¨åº¦è¾ƒå¤§ï¼ˆè‡ª 2005 å¹´è‡³ä»Šï¼‰ï¼ŒåŸæœ¬ä¸ºæœºå™¨å­¦ä¹ æ¨¡å‹æä¾›ï¼Œä½†è¿‘æœŸæ•°æ®æ›´æ–°å‡ ä¹åœæ»ã€‚<br>è¿™ä¸¤å¤©åš AI workflow çš„æ—¶å€™ï¼Œçªç„¶æƒ³çœ‹çœ‹æœ‰æ²¡æœ‰ç™½å«–åœ°èµ„æº â€”â€” ç»™è¿™ä¸ªæ•°æ®é›†æŒ‚ä¸€æ¡æ•°æ®æµæ°´çº¿ï¼Œè®©å®ƒè‡ªå·±å®šæœŸæ›´æ–°ã€‚æœ€åé€‰æ‹©äº† <a href="https://www.prefect.io/">Prefect</a>ã€‚</p><p>é€‰ä¸­ Prefect è€ƒè™‘è¿™å‡ ç‚¹ï¼š</p><ul><li>å¯¹ Python æ”¯æŒåº¦é«˜ï¼Œç›¸æ¯”ä¸€äº›æ•°æ®å¹³å°çš„ DSL æˆ–è€… UI æ‹–æ‹‰æ‹½çš„å¼€å‘æ–¹å¼ï¼Œè‡ªç”±åº¦æ›´é«˜ã€‚</li><li>æœ‰ç™½å«–çš„ Cloud èµ„æºå¯ç”¨ã€‚</li><li>å¯é›†æˆå¤§é‡é€šç”¨ç ”å‘å¹³å°ï¼ˆæˆ‘è¿™é‡Œä¸»è¦ä½¿ç”¨äº†Github Actionã€HuggingFace Datasetsï¼‰ã€‚</li><li>å­¦ä¹ æ›²çº¿ä½ï¼Œå·¥å…·è½»é‡çº§ã€‚</li></ul><h2 id="äºŒã€æ•°æ®æµæ°´çº¿çš„æ¶æ„è®¾è®¡">äºŒã€æ•°æ®æµæ°´çº¿çš„æ¶æ„è®¾è®¡</h2><pre class="mermaid">---title: éƒ¨ç½²æ¶æ„---flowchart LR    subgraph CICD["CI/CD"]        github["Github Repository"]    end    subgraph Prefect["Prefect Cloud"]        prefect[["Prefect Server"]]        worker[["Prefect Workers"]]    end    subgraph datasource["æºæ•°æ®"]        ts["Tushare"]    end    subgraph target_datasource["ç›®æ ‡å­˜å‚¨"]        hf["HuggingFace Datasets"]    end    CICD --&gt; |Github Action|prefect    prefect --&gt; |è°ƒåº¦å’Œç›‘æ§|worker    worker -.-&gt; |API GET|datasource    worker --&gt; |æ•°æ®ä¸Šä¼ |hf</pre><p>æ¶æ„ä¸­æ¶‰åŠåˆ°çš„ç»„ä»¶å’Œå¹³å°åŒ…æ‹¬ï¼šGithubã€Prefect cloudã€Tushare(å›½å†…ä¸€ä¸ªé‡åŒ–æ•°æ®å¹³å°ï¼Œæä¾›æºæ•°æ® API)ã€HuggingFace Datasetsã€‚<br>Prefect cloud æä¾›çš„ç»„ä»¶åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼ˆå¯ç±»æ¯”Kubernetes master å’Œ Nodeï¼‰ï¼š</p><ul><li>æ§åˆ¶é¢æ¿å±‚ï¼ŒåŒ…æ‹¬éƒ¨ç½²ã€è°ƒåº¦å·¥ä½œèŠ‚ç‚¹å’Œç›‘æ§ã€‚</li><li>å·¥ä½œèŠ‚ç‚¹ã€‚å¯é€‰ä¸¤å¤§ç±»å‹ï¼š<ol><li>Prefect cloud å†…ç½®çš„ï¼ˆPrefect managedï¼‰</li><li>å¤–éƒ¨é›†æˆï¼ˆç¬¬ä¸‰æ–¹å¹³å°æˆ–è€…æœ¬åœ°éƒ¨ç½²çš„ï¼‰ã€‚å…¶ä¸­åˆåˆ†ä¸ºä¸¤ç±»ï¼š</li></ol><ul><li>pull ç±»ï¼Œéœ€è¦è‡ªç»´æŠ¤ containerã€‚</li><li>push ç±»ï¼Œserverlessã€‚</li></ul></li></ul><p>ä¸ºäº†ç™½å«– Prefect cloud çš„èµ„æºï¼Œæˆ‘è‡ªç„¶æ˜¯é€‰æ‹©äº† Prefect managedã€‚Free tier æä¾›ä¸€ä¸ª vCPU core 2 çš„å…±äº«è®¡ç®—èµ„æºï¼Œé…é¢æ˜¯ 10 hours per monthã€‚</p><pre class="mermaid">---title: æ–¹æ¡ˆè®¾è®¡ï¼ˆå…¨é‡åŒæ­¥éƒ¨åˆ†ï¼‰---flowchart LR    subgraph Workers["Worker Node"]        direction LR        FLOW[[å…¨é‡æ—¥çº¿æ•°æ®æµ]]        TASK1[["Task 1: æ¸…ç©ºä¸´æ—¶ç›®å½•"]]        TASK2[["Task 2: è·å–æœ€æ–°è‚¡ç¥¨åˆ—è¡¨"]]        TASK3[["Task 3: ä¸‹è½½æ—¥çº¿æ•°æ®"]]        TASK4[["Task 4: ä¸Šä¼ åˆ°æ•°æ®é›†"]]        Loop    end    FLOW --&gt; TASK1 &amp; TASK2 &amp; TASK3 &amp; TASK4    TASK3 --- Loop    subgraph Loop["Loop: è‚¡ç¥¨åˆ—è¡¨"]        direction TB        TASK3A[[Nested Task 1: æ—¥Kçº¿æ•°æ®]]        TASK3B[[Nested Task 2: æ¶¨è·Œåœä»·æ ¼]]        TASK3C[[Nested Task 3: æ¯æ—¥æŒ‡æ ‡å€¼]]        TASK3D[[Nested Task 4: æ•°æ®è½¬æ¢ä¸å­˜å‚¨CSV]]    end    TASK3A --&gt; TASK3B --&gt; TASK3C --&gt; TASK3D</pre><p>åœ¨æ–¹æ¡ˆè®¾è®¡æ–¹é¢ï¼šåˆ†ä¸ºäº†<code>å…¨é‡æ›´æ–°</code>å’Œ<code>å¢é‡æ›´æ–°</code>ä¸¤éƒ¨åˆ†ï¼Œè„šæœ¬ä¸Šå¯¹åº”äº†ä¸¤æ¡æ•°æ®å·¥ä½œæµã€‚<br>å› ä¸ºå…¨é‡æ›´æ–°è€—æ—¶é•¿ï¼Œä¸”èŠ±è´¹å¤§é‡ Tier è®¡ç®—æ—¶é—´ï¼Œåœ¨å®Œæˆé¦–æ¬¡å…¨é‡æ›´æ–°åï¼Œæ¯å¤©ä»…è¿è¡Œå¢é‡æ›´æ–°å³å¯ã€‚<strong>åŒæ—¶ï¼Œèƒ½ä½¿ç”¨å¢é‡æ›´æ–°çš„æ–¹å¼æ›´å–å†³äº â€”â€” è¿™ä¸ªæ•°æ®é›†æ˜¯ä¸å¤æƒä»·æ ¼ï¼Œå¦‚æœæ˜¯å‰å¤æƒï¼Œå°±å¿…é¡»æ¯æ¬¡é‡æ–°è¿ç®—ã€ä¸èƒ½ä½¿ç”¨å¢é‡æ›´æ–°äº†ã€‚</strong><br>ä»å¤§é¢—ç²’æ­¥éª¤ç»´åº¦ä¸Šï¼Œå…¨é‡å’Œå¢é‡çœ‹èµ·æ¥æ²¡æœ‰å¤ªå¤§å·®å¼‚ï¼Œä½†è½å®åˆ°å®ç°ä¸Šï¼Œå…¶å®å¢é‡æ›´æ–°éœ€è¦åŒ¹é…ä¸åŒçš„ APIsã€è€ƒè™‘çš„æƒ…å†µä¹Ÿæ›´å¤æ‚ï¼Œä½†è¿™é‡Œä¸å†èµ˜è¿°äº†ï¼Œè¯¦æƒ…è§ä»£ç è„šæœ¬ã€‚</p><p><code>Task2</code>ã€<code>Task3</code>ã€<code>Nested Task1-3</code> çš„ä½œç”¨å’Œè®¾è®¡ï¼Œæ˜¯è€ƒè™‘åˆ°æºæ•°æ®ç«¯ Tushare APIs çš„æ•°æ®ç»´åº¦å’Œå†…å®¹ï¼Œæœ€å¤§ç¨‹åº¦åœ°è¿˜åŸå’Œæ‹¼æ¥å‡º<code>ellendan/a-share-prices</code>æ•°æ®é›†åŸæœ‰çš„æ•°æ®å­—æ®µã€‚æ—§æ•°æ®æºå¯¹ Data Pipeline æ–¹å¼å¹¶ä¸å‹å¥½ï¼Œå› æ­¤åˆ‡æ¢æˆ Tushareã€‚</p><h2 id="ä¸‰ã€æ“ä½œæ­¥éª¤">ä¸‰ã€æ“ä½œæ­¥éª¤</h2><h3 id="1-å®‰è£…å¼€å‘ç¯å¢ƒ">1. å®‰è£…å¼€å‘ç¯å¢ƒ</h3><h4 id="1-1-å®‰è£…-Prefect-server">1.1 å®‰è£… Prefect server</h4><p>æœ¬åœ°å®‰è£… Prefect å¼€å‘ç¯å¢ƒéå¸¸ç®€å•ï¼Œä½¿ç”¨ pipenv (æˆ–è€… pip) å®‰è£… Prefect åº“ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pipenv <span class="token function">install</span> prefect<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åï¼Œè¿è¡Œå‘½ä»¤å¯åŠ¨ prefect serverï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pipenv run prefect server start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ—¶å€™ï¼Œç»ˆç«¯å‘½ä»¤è¡Œå°±ä¼šæ˜¾ç¤ºæœåŠ¡å™¨å¯åŠ¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> ___ ___ ___ ___ ___ ___ _____<span class="token operator">|</span> _ <span class="token punctuation">\</span> _ <span class="token punctuation">\</span> __<span class="token operator">|</span> __<span class="token operator">|</span> __/ __<span class="token operator">|</span>_   _<span class="token operator">|</span><span class="token operator">|</span>  _/   / _<span class="token operator">||</span> _<span class="token operator">||</span> _<span class="token operator">|</span> <span class="token punctuation">(</span>__  <span class="token operator">|</span> <span class="token operator">|</span><span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>___<span class="token punctuation">\</span>___<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>Configure Prefect to communicate with the server with:    prefect config <span class="token builtin class-name">set</span> <span class="token assign-left variable">PREFECT_API_URL</span><span class="token operator">=</span>http://127.0.0.1:4200/apiView the API reference documentation at http://127.0.0.1:4200/docsCheck out the dashboard at http://127.0.0.1:4200<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼Œè¿™å¯åŠ¨çš„æ˜¯æ§åˆ¶é¢æ¿å±‚ï¼Œç±»ä¼¼äº Kubernetes api-serveræ‰€åœ¨çš„ master èŠ‚ç‚¹ï¼Œå®ƒä¸»è¦ç”¨æ¥æ¥æ”¶ prefect å‘½ä»¤è¯·æ±‚ã€ç›‘æ§å’Œæ‰§è¡Œè°ƒåº¦ã€‚<br>ä½¿ç”¨<code>http://127.0.0.1:4200</code>ï¼Œå¯ä»¥è®¿é—® UIç•Œé¢ï¼š<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/dashboard.png" alt="Prefect Dashboard"></p><h3 id="2-Flow-å¼€å‘">2. Flow å¼€å‘</h3><p>è„šæœ¬ä»£ç åœ¨ github ä¸Šï¼Œ<a href="https://github.com/ellendan000/a-share-data-pipeline.git">Github ä»“åº“åœ°å€</a>ã€‚<br>ä½¿ç”¨è£…é¥°å™¨ <code>@flow</code> å’Œ <code>@task</code> æ ‡è®°å¯¹åº”å‡½æ•°å³å¯ã€‚</p><h4 id="2-1-å…¨é‡æ›´æ–°">2.1 å…¨é‡æ›´æ–°</h4><pre class="line-numbers language-Python" data-language="Python"><div class="caption"><span>market/non_fq_daily_kline.py</span></div><code class="language-Python">from pathlib import Pathfrom datetime import datetime, timedeltaimport shutilfrom huggingface_hub import HfApifrom pandas import DataFrame, Seriesimport tushare as tsimport pandas as pdfrom prefect import flow, taskfrom prefect.blocks.system import Secretfrom prefect.cache_policies import INPUTSfrom prefect.concurrency.sync import rate_limitLOCAL_FILE_PATH = "data/non_fq_daily_klines.csv"tushare_secret_block = Secret.load("tushare-token")ts.set_token(tushare_secret_block.get())@taskdef setup_data_dir() -&gt; None:    """Task 1: è®¾ç½®æ•°æ®ç›®å½•"""    parent_folder = Path(LOCAL_FILE_PATH).parent    if parent_folder.exists():        shutil.rmtree(parent_folder, ignore_errors=True)    parent_folder.mkdir(parents=True, exist_ok=True)@task(    retries=3,    cache_policy=INPUTS,    cache_expiration=timedelta(hours=1))def fetch_stock_list() -&gt; DataFrame:    """Task 2: è·å–æœ€æ–°çš„ä¸»æ¿è‚¡ç¥¨æ¸…å•"""    df = ts.pro_api().stock_basic(        exchange='SSE,SZSE',        fields=[            'ts_code',            'name',            'area',            'industry',            'market',            'exchange',            'list_date'        ])    return df[df['market'] == 'ä¸»æ¿']@taskdef fetch_all_stock_daily_price(stock_list: DataFrame, start_date: str, end_date: str) -&gt; str:    """Task 3: æŠ“å–æ‰€æœ‰è‚¡ç¥¨çš„éå¤æƒæ—¥çº¿æ•°æ®"""    for idx, (_, row) in enumerate(stock_list.iterrows()):        print(            f"æ­£åœ¨è·å– {row['ts_code']} çš„æ—¥çº¿æ•°æ®ï¼Œæ•´ä½“è¿›åº¦ {idx+1}/{stock_list.shape[0]}")        kline_df = fetch_daily_price(row, start_date, end_date)        append_to_csv(kline_df, LOCAL_FILE_PATH)    return LOCAL_FILE_PATH@task(retries=3)def fetch_daily_kline(ts_code: str, start_date: str, end_date: str) -&gt; DataFrame:    df = ts.pro_api().daily(ts_code=ts_code, start_date=start_date, end_date=end_date)    df = df.reset_index()    df = df.set_index(['ts_code', 'trade_date'])    return df[['open', 'high', 'low', 'close', 'pre_close', 'pct_chg', 'vol', 'amount']]@task(retries=3)def fetch_limit_price(ts_code: str, start_date: str, end_date: str) -&gt; DataFrame:    df = ts.pro_api().stk_limit(ts_code=ts_code, start_date=start_date, end_date=end_date)    df = df.reset_index()    df = df.set_index(['ts_code', 'trade_date'])    return df[['up_limit', 'down_limit']]@task(retries=3)def fetch_daily_index(ts_code: str, start_date: str, end_date: str) -&gt; DataFrame:    df = ts.pro_api().daily_basic(ts_code=ts_code,                                  start_date=start_date, end_date=end_date)    df = df.reset_index()    df = df.set_index(['ts_code', 'trade_date'])    return df[['turnover_rate', 'turnover_rate_f', 'volume_ratio', 'pe', 'pe_ttm', 'pb', 'ps', 'ps_ttm', 'dv_ratio', 'dv_ttm', 'total_share', 'float_share', 'free_share', 'total_mv', 'circ_mv']]@taskdef fetch_daily_price(stock_series: Series, start_date: str, end_date: str) -&gt; DataFrame:    """NestedTask 3.1: ä»æ•°æ®æºè·å–å•åªè‚¡ç¥¨çš„å†å²æ—¥çº¿æ•°æ®"""    rate_limit("tushare-daily-api")    ts_code = stock_series['ts_code']    kline_df = fetch_daily_kline.submit(        ts_code=ts_code, start_date=start_date, end_date=end_date)    limit_df = fetch_limit_price.submit(        ts_code=ts_code, start_date=start_date, end_date=end_date)    index_df = fetch_daily_index.submit(        ts_code=ts_code, start_date=start_date, end_date=end_date)    kline_df, limit_df, index_df = kline_df.result(), limit_df.result(), index_df.result()    merged_df = pd.concat([kline_df, limit_df, index_df], axis=1)    stock_info_df = stock_series.to_frame().transpose()    stock_info_df['list_date'] = pd.to_datetime(stock_info_df['list_date'])    stock_info_df.set_index('ts_code', inplace=True)    merged_df = merged_df.join(stock_info_df, on='ts_code')    merged_df.dropna(subset=['close'], inplace=True)    return merged_df@taskdef append_to_csv(stock_df: DataFrame, file_path: str) -&gt; None:    """NestedTask 3.2: å†™å…¥ csv"""    stock_df.rename(columns={        'pre_close': 'prev_close',        'pct_chg': 'quote_rate',        'vol': 'volume',        'amount': 'turnover',        'up_limit': 'high_limit',        'down_limit': 'low_limit',    }, inplace=True)    stock_df.index = pd.MultiIndex.from_arrays([        stock_df.index.get_level_values(level=0),        pd.to_datetime(stock_df.index.get_level_values(level=1))    ], names=['code', 'date'])    first_write = not Path(file_path).exists()    stock_df.to_csv(        file_path,        mode='w' if first_write else 'a',        header=first_write,        index=True    )@taskdef upload_to_hf_datasets(file_path: str, end_date: str, huggingface_repo_name: str, repo_file_name: str) -&gt; None:    """Task 4: ä¸Šä¼ åˆ° Hugging Face Datasets"""    print("ä¸Šä¼ åˆ° Hugging Face Datasets")    hf_api = HfApi(token=Secret.load("hf-token").get())    hf_api.upload_file(        path_or_fileobj=file_path,        path_in_repo=repo_file_name,        repo_type="dataset",        repo_id=huggingface_repo_name    )        _last_update_date_file_name = ".last_update_date"    with open(_last_update_date_file_name, "w") as f:        f.write(end_date)    hf_api.upload_file(        path_or_fileobj=_last_update_date_file_name,        path_in_repo=_last_update_date_file_name,        repo_id=huggingface_repo_name,        repo_type="dataset"    )@flow(log_prints=True)def fetch_non_fq_daily_kline(huggingface_repo_name: str,                              repo_file_name: str,                             start_date: str="20050101",                             end_date: str="") -&gt; None:    """Flow: æŠ“å–éå¤æƒæ—¥çº¿æ•°æ®"""    if end_date == "":        end_date = datetime.now().strftime("%Y%m%d")            setup_data_dir()    stock_list = fetch_stock_list()    print(f"ä¸»æ¿è‚¡ç¥¨æ•°é‡: {stock_list.shape[0]}")    local_temp_file = fetch_all_stock_daily_price(        stock_list, start_date, end_date)    upload_to_hf_datasets(local_temp_file, end_date, huggingface_repo_name, repo_file_name)# Run the flowif __name__ == "__main__":    fetch_non_fq_daily_kline(        end_date="20250401",        huggingface_repo_name="ellendan/a-share-prices",         repo_file_name="all-prices.csv")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é¢å¤–æ³¨æ„çš„æœ‰ä¸¤ç‚¹ï¼š</strong></p><ul><li>ç§˜é’¥ã€å‡­è¯ã€Token ç­‰éƒ½ä¸è¦å†™åœ¨ä»£ç åº“ä¸­ï¼ŒåŠ¡å¿…ä¿å­˜åœ¨ Secrets ä¿ç®¡åº“ä¸­ã€‚Prefect æ”¯æŒ AWSã€Azure ç­‰ç¬¬ä¸‰æ–¹ä¿ç®¡åº“ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†å†…ç½®çš„ Secrets ä¿ç®¡åŠŸèƒ½ã€‚</li><li>æµé‡é™åˆ¶ï¼ŒPrefect ä¸ä»…æä¾›äº†æ”¯æŒæ™®é€šä¸²è¡Œä»»åŠ¡ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¹¶å‘ä»»åŠ¡å’Œæµé‡æ§åˆ¶ã€‚</li><li>æ¨¡å—<code>__main__</code>å—å†…çš„è¿™ç§ç›´æ¥è°ƒç”¨ flow å‡½æ•°çš„æ–¹å¼ï¼Œä»…ä½¿ç”¨äº debugï¼Œå¯ä»¥åœ¨ Dashboard ä¸ŠæŸ¥çœ‹åˆ° run çš„æƒ…å†µï¼Œä½†å¹¶ä¸ä¼šå°† flow å‘å¸ƒåˆ° Prefect Server â€”â€” ä¸ä¼šç”Ÿæˆ Deploymentã€‚</li></ul><h4 id="2-2-é…ç½®-Tushare-API-token-å’Œ-HuggingFace-Access-token">2.2 é…ç½® Tushare API token å’Œ HuggingFace Access token</h4><p>æ‰“å¼€ Dashboard ç•Œé¢ä¸­çš„ <strong>Blocks</strong> èœå•ã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/block-config.png" alt="æ‰“å¼€ Block è®¾ç½®"><br>é€‰æ‹©åˆ›å»º <strong>Secret Type Block</strong>ã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/secret-block.png" alt="é€‰æ‹© Secret ç±»å‹ Block"></p><p>æ–°å»ºä¸€æ¡ Secret Block ä¿å­˜å¥½ tushare API tokenã€‚ç›¸åŒçš„æ–¹å¼å†ä¿å­˜ä¸€æ¬¡ HuggingFace Access Tokenã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/create-secret.png" alt="ä¿å­˜ Tushare token"><br>ä»£ç ä¸­ä½¿ç”¨ Secret çš„æ–¹å¼ï¼š</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">from prefect.blocks.system import Secrettushare_secret_block = Secret.load("tushare-token")api_token = tushare_secret_block.get()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-3-é…ç½®-Concurrency-limit">2.3 é…ç½® Concurrency limit</h4><p>åƒä¸Šæ¸¸æºæ•°æ®ç«¯ï¼Œå¯¹è®¿é—®é¢‘ç‡æœ‰é™åˆ¶çš„ï¼Œæ¯”å¦‚æˆ‘çš„ Tushare è´¦å·è®¿é—® API çš„é¢‘ç‡é™åˆ¶æ˜¯ 200æ¬¡/åˆ†é’Ÿã€‚å¯ä»¥ä½¿ç”¨ Prefect çš„ Concurrent limit æ¥å¯¹ä»»åŠ¡è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/rate-limit.png" alt="é…ç½® Concurrent limit"><br><a href="https://docs.prefect.io/v3/develop/global-concurrency-limits">å®˜æ–¹Concurrency limitsè¯¦ç»†å‚æ•°è¯´æ˜</a>.<br>ä»£ç ä¸­ä½¿ç”¨ limit çš„æ–¹å¼ï¼š</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">from prefect.concurrency.sync import rate_limit@taskdef fetch_daily_price(stock_series: Series, start_date: str, end_date: str) -&gt; DataFrame:    """NestedTask 3.1: ä»æ•°æ®æºè·å–å•åªè‚¡ç¥¨çš„å†å²æ—¥çº¿æ•°æ®"""    rate_limit("tushare-daily-api")    â€¦â€¦â€¦â€¦<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨éœ€è¦é™é€Ÿçš„ task å‡½æ•°å†…ï¼Œç›´æ¥ä½¿ç”¨ rate_limit æ–¹æ³•å®Œæˆåˆ‡é¢æ§åˆ¶ã€‚</p><h4 id="2-4-è¿è¡Œè°ƒè¯•">2.4 è¿è¡Œè°ƒè¯•</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨å½“å‰ shell æ˜¾å¼æ¿€æ´» virtualenv</span>pipenv shell<span class="token comment"># è®¾ç½®éœ€è¦è¿æ¥çš„ Prefect serverï¼Œè°ƒè¯•ä¸­å¯ä»¥è§‚å¯Ÿæ—¥å¿—å’Œç›‘æ§</span>prefect config <span class="token builtin class-name">set</span> <span class="token assign-left variable">PREFECT_API_URL</span><span class="token operator">=</span><span class="token string">"http://127.0.0.1:4200/api"</span><span class="token comment"># è¿è¡Œè°ƒè¯•</span>python market/non_fq_daily_kline.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘½ä»¤è¡Œæ§åˆ¶å°å¯ä»¥çœ‹åˆ°åå°æ—¥å¿—ï¼ŒåŒæ—¶æ—¥å¿—ä¹Ÿä¼šä¸ŠæŠ¥ç»™ Prefect Serverã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/task-log.png" alt="Runs logs"></p><p>ç›¸åŒçš„æ–¹å¼ï¼Œå®Œæˆ<a href="https://github.com/ellendan000/a-share-data-pipeline/blob/main/market/delta_non_fq_daily_kline.py"><strong>å¢é‡æ›´æ–°</strong>çš„æ•°æ®å·¥ä½œæµè„šæœ¬</a>ï¼Œæœ¬åœ°éƒ½è¿è¡Œè°ƒè¯•é€šè¿‡ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è€ƒè™‘éƒ¨ç½²äº†ã€‚</p><h3 id="3-éƒ¨ç½²åˆ°-Prefect-Cloud">3. éƒ¨ç½²åˆ° Prefect Cloud</h3><h4 id="3-1-æ³¨å†Œ-Prefect-Cloud">3.1 æ³¨å†Œ Prefect Cloud</h4><p>è®¿é—® <a href="https://app.prefect.cloud/auth/sign-in">Prefect Cloud åœ°å€</a>ã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/prefect-cloud-signup.png" alt="å…è´¹æ³¨å†Œ Prefect Cloud"><br>Prefect Cloud æ³¨å†Œäº†ä¹‹åï¼ŒFree Tire è¢«é™åˆ¶åªèƒ½ç”¨æœ‰ä¸€ä¸ª workspaceï¼ˆdefaultï¼‰ï¼Œä½†æ¯ä¸ªæœˆæœ‰ä¸€å®šçš„å…è´¹è®¡ç®—é…é¢ã€‚</p><h4 id="3-2-åˆ›å»º-Work-Pool">3.2 åˆ›å»º Work Pool</h4><p>Prefect Cloud æœ¬èº«å°±æ˜¯æ§åˆ¶é¢æ¿å±‚ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºè‡ªå·±çš„ Worker èŠ‚ç‚¹å°±å¥½äº†ã€‚<br>ä½¿ç”¨ Dashboard UI ç•Œé¢ç‚¹å‡»åˆ›å»º Work Poolã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/create-work-pool.png" alt="å‡†å¤‡åˆ›å»ºWork Pool"><br><strong>ç¬¬ä¸€æ­¥ï¼Œé€‰æ‹© Work pool ç±»å‹ã€‚</strong><br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/prefect-managed-type.png" alt="æƒ³è¦ä½¿ç”¨å…è´¹èµ„æºï¼Œé€‰æ‹© Prefect managed ç±»å‹"><br><strong>ç¬¬äºŒæ­¥ï¼Œå¡«å†™åŸºæœ¬ä¿¡æ¯ã€‚</strong><br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/work-pool-basic.png" alt="åˆ›å»ºçš„åŸºæœ¬ä¿¡æ¯"><br><strong>ç¬¬ä¸‰æ­¥ï¼Œå®šåˆ¶é…ç½®ä¿¡æ¯ã€‚</strong><br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/work-pool-configuration.png" alt="å®šåˆ¶ Worker çš„é…ç½®"><br><strong>æ³¨æ„é»„æ¡†çš„ä¸¤é¡¹ï¼š</strong></p><ul><li>python è„šæœ¬é‡Œéœ€è¦ä½¿ç”¨çš„åº“ã€‚<br>å¦‚æœæˆ‘ä»¬é€‰æ‹©çš„ Work Pool æ˜¯å®¹å™¨æ–¹å¼çš„è¯ï¼Œå°±ä¸éœ€è¦è¿™ä¹ˆéº»çƒ¦åœ°é…ç½®äº†ï¼Œç›´æ¥åœ¨ Dockerfile é‡Œé¢æ‰“åŒ…å°±å¥½ã€‚ä½†è¿™é‡Œæ˜¯ Prefect managed æ–¹å¼ï¼Œå°±éœ€è¦è¿›è¡Œå‚æ•°é…ç½®äº†ã€‚</li><li>Job è¶…æ—¶æ—¶é—´ï¼Œå³ Flow çš„è¿è¡Œè¶…æ—¶æ—¶é—´ã€‚é»˜è®¤æ˜¯ 600 ç§’ï¼Œå¦‚æœè¶…æ—¶æœªè·‘å®Œçš„è¯ï¼ŒPrefect Cloud ä¼šå¼ºè¡Œç»ˆæ­¢ã€‚<br>ç”±äºæˆ‘ä»¬è¿™é‡Œçš„å…¨é‡è„šæœ¬è¿è¡Œæ—¶é—´é•¿ï¼Œå› æ­¤æˆ‘å°†è¶…æ—¶æ—¶é—´è®¾ç½®ä¸ºäº† 7200 ç§’ã€‚</li></ul><p><strong>åˆ›å»ºæˆåŠŸåçœ‹æ•ˆæœï¼Œwork pool å·²ç»åˆ›å»ºæˆåŠŸï¼Œå¹¶ä¸” readyã€‚</strong><br>é»„æ¡†éƒ¨åˆ†å¯ä»¥çœ‹åˆ° Free Tire çš„å…è´¹é…é¢ï¼šæ¯ 30 å¤© 10 ä¸ªè¿ç®—å°æ—¶ã€‚</p><h4 id="3-3-é…ç½®-Secret-Blocks-å’Œ-Concurrent-Limit"><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/quota.png" alt="å…è´¹é…é¢">3.3 é…ç½® Secret Blocks å’Œ Concurrent Limit</h4><p>ä½¿ç”¨ä¸Šé¢ç« èŠ‚ 2.2 å’Œ 2.3 ç›¸åŒçš„æ–¹å¼åœ¨ Prefect Cloud è¿›è¡Œé…ç½®ã€‚</p><h4 id="3-4-ç»™-Github-Repo-æ–°å»º-Actions">3.4 ç»™ Github Repo æ–°å»º Actions</h4><p>åœ¨ git æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºGithub action flowï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>a-share-data-pipeline/.github/workflows/deploy-prefect-flow.yaml</span></div><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy Prefect flow<span class="token key atrule">on</span><span class="token punctuation">:</span>  <span class="token key atrule">push</span><span class="token punctuation">:</span>    <span class="token key atrule">branches</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> main<span class="token key atrule">jobs</span><span class="token punctuation">:</span>  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest    <span class="token key atrule">steps</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v4      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup Python        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>python@v5        <span class="token key atrule">with</span><span class="token punctuation">:</span>          <span class="token key atrule">python-version</span><span class="token punctuation">:</span> <span class="token string">"3.11"</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Prefect Deploy        <span class="token key atrule">env</span><span class="token punctuation">:</span>          <span class="token key atrule">PREFECT_API_KEY</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.PREFECT_API_KEY <span class="token punctuation">}</span><span class="token punctuation">}</span>          <span class="token key atrule">PREFECT_API_URL</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.PREFECT_API_URL <span class="token punctuation">}</span><span class="token punctuation">}</span>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">          pip install pipenv          pipenv sync          pipenv run prefect deploy --all</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç‰¹æ®Šç‚¹è¯´æ˜ï¼š</p><ul><li><code>step: Prefect Deploy</code>ï¼Œè¿æ¥ Prefect Cloud éƒ¨ç½²çš„æ­¥éª¤ã€‚</li><li><code>PREFECT_API_KEY</code> å’Œ <code>PREFECT_API_URL</code>ï¼Œä½¿ç”¨ Github repository ä¸­è®¾ç½®çš„ Secrets æ¥è®¾ç½®ç¯å¢ƒå˜é‡ã€‚<br>PREFECT_API_URL æ ¼å¼æ˜¯ï¼š<code>https://api.prefect.cloud/api/accounts/[ACCOUNT-ID]/workspaces/[WORKSPACE-ID]</code>ã€‚è¯»å–æ–¹å¼è§<a href="https://docs.prefect.io/v3/manage/cloud/connect-to-cloud#manually-configure-prefect-api-settings">manually-configure-prefect-api-settings</a>ã€‚</li><li>Git Action è¿è¡Œå‘½ä»¤ï¼šå…ˆå®‰è£…ä¾èµ–ï¼Œç„¶åè§¦å‘ prefect è¿›è¡Œéƒ¨ç½²ï¼š<code>pipenv run prefect deploy --all</code>ã€‚<br>çœŸæ­£éœ€è¦éƒ¨ç½²çš„å·¥ä½œæµï¼Œä¼šåœ¨ <strong>prefect.yaml</strong> æ–‡ä»¶ä¸­å®šä¹‰ã€‚</li></ul><h4 id="3-5-ä½¿ç”¨-yaml-æ–‡ä»¶å®šä¹‰-prefect-éƒ¨ç½²è¿‡ç¨‹å’Œç»†èŠ‚">3.5 ä½¿ç”¨ yaml æ–‡ä»¶å®šä¹‰ prefect éƒ¨ç½²è¿‡ç¨‹å’Œç»†èŠ‚</h4><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>a-share-data-pipeline/prefect.yaml</span></div><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> cicd<span class="token punctuation">-</span>deployment<span class="token key atrule">prefect-version</span><span class="token punctuation">:</span> 3.0.0<span class="token key atrule">pull</span><span class="token punctuation">:</span><span class="token punctuation">-</span> <span class="token key atrule">prefect.deployments.steps.git_clone</span><span class="token punctuation">:</span>    <span class="token key atrule">repository</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/ellendan000/a<span class="token punctuation">-</span>share<span class="token punctuation">-</span>data<span class="token punctuation">-</span>pipeline.git    <span class="token key atrule">branch</span><span class="token punctuation">:</span> main<span class="token key atrule">deployments</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> non<span class="token punctuation">-</span>fq<span class="token punctuation">-</span>daily<span class="token punctuation">-</span>kline    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> market/non_fq_daily_kline.py<span class="token punctuation">:</span>fetch_non_fq_daily_kline    <span class="token key atrule">work_pool</span><span class="token punctuation">:</span>      <span class="token key atrule">name</span><span class="token punctuation">:</span> remote<span class="token punctuation">-</span>work<span class="token punctuation">-</span>pool    <span class="token key atrule">parameters</span><span class="token punctuation">:</span>      <span class="token key atrule">huggingface_repo_name</span><span class="token punctuation">:</span> ellendan/a<span class="token punctuation">-</span>share<span class="token punctuation">-</span>prices      <span class="token key atrule">repo_file_name</span><span class="token punctuation">:</span> all<span class="token punctuation">-</span>prices.csv  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> trade<span class="token punctuation">-</span>calendar    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> market/trade_calendar.py<span class="token punctuation">:</span>fetch_trade_calendar_flow    <span class="token key atrule">work_pool</span><span class="token punctuation">:</span>      <span class="token key atrule">name</span><span class="token punctuation">:</span> remote<span class="token punctuation">-</span>work<span class="token punctuation">-</span>pool  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> delta<span class="token punctuation">-</span>non<span class="token punctuation">-</span>fq<span class="token punctuation">-</span>daily<span class="token punctuation">-</span>kline    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> market/delta_non_fq_daily_kline.py<span class="token punctuation">:</span>fetch_delta_non_fq_daily_kline    <span class="token key atrule">work_pool</span><span class="token punctuation">:</span>      <span class="token key atrule">name</span><span class="token punctuation">:</span> remote<span class="token punctuation">-</span>work<span class="token punctuation">-</span>pool    <span class="token key atrule">parameters</span><span class="token punctuation">:</span>      <span class="token key atrule">huggingface_repo_name</span><span class="token punctuation">:</span> ellendan/a<span class="token punctuation">-</span>share<span class="token punctuation">-</span>prices      <span class="token key atrule">repo_file_name</span><span class="token punctuation">:</span> all<span class="token punctuation">-</span>prices.csv    <span class="token key atrule">schedule</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">cron</span><span class="token punctuation">:</span> 0 0 21 <span class="token punctuation">?</span> * MON<span class="token punctuation">-</span>FRI        <span class="token key atrule">timezone</span><span class="token punctuation">:</span> Asia/Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://docs.prefect.io/v3/deploy/infrastructure-concepts/prefect-yaml">yaml deployment é…ç½®çš„å®˜æ–¹è¯´æ˜</a>ã€‚<br>è¯´æ˜ï¼š</p><ul><li>ä½¿ç”¨ process ç±»å‹çš„ workerï¼Œä¸éœ€è¦build imageï¼Œå› æ­¤ä¸éœ€è¦é…ç½® build action å’Œ push actionã€‚åªéœ€è¦é…ç½® pull action å³å¯ã€‚</li><li>deployments é¡¹ç”¨æ¥å®šä¹‰å…·ä½“çš„æ•°æ®å·¥ä½œæµçš„éƒ¨ç½²æ–¹å¼ã€‚å…¶ä¸­<code>delta-non-fq-daily-kline</code>ä½¿ç”¨ schedule cron çš„æ–¹å¼å®šæ—¶è°ƒåº¦è¿è¡Œï¼š+8æ—¶åŒºçš„æ¯ä¸ªå·¥ä½œæ—¥æ™šä¸Š21ç‚¹ã€‚</li></ul><h4 id="3-6-æäº¤-python-ä»£ç åˆ°-Github-repo">3.6  æäº¤ python ä»£ç åˆ° Github repo</h4><p>å°†ä¹‹å‰è°ƒè¯•å¥½çš„ prefect flow python æ–‡ä»¶æäº¤åˆ° Github repoï¼ˆmain branchï¼‰ï¼Œå³ä¼šè§¦å‘CD å¯¹ Prefect è¿›è¡ŒæŒç»­éƒ¨ç½²å’Œæ›´æ–°ã€‚<br>å½“ Github Action éƒ¨ç½²æˆåŠŸåï¼Œå¯ä»¥åœ¨ Prefect Cloud ä¸Šçœ‹åˆ°å·²ç»éƒ¨ç½²æˆåŠŸçš„å·¥ä½œæµ Deploymentsã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/deployments.png" alt="Deployments"></p><h4 id="3-7-æ‰‹åŠ¨è§¦å‘å…¨é‡åŒæ­¥">3.7 æ‰‹åŠ¨è§¦å‘å…¨é‡åŒæ­¥</h4><p><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/entire-sync.png" alt="å…¨é‡åŒæ­¥"><br>å…¨é‡åŒæ­¥ï¼Œå¯¹äºæ¯ä¸ªç›®æ ‡æ•°æ®é›†ç†è®ºä¸Šåªéœ€æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰‹åŠ¨ç‚¹å‡»è¿è¡Œå³å¯ã€‚<br><img src="/2025/04/03/shi-yong-prefect-da-jian-shu-ju-guan-dao-zi-dong-geng-xin-huggingface-datasets/entire-quick-run.png" alt="Quick run input dialog"><br>ç‚¹å¼€ <strong>Quick run</strong> åï¼Œå¼¹å‡º Input dialogï¼Œé»˜è®¤å‚æ•°å€¼å·²ç»åœ¨åˆ›å»º Deployments æ—¶å†™å…¥ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ Flow è¿è¡Œæ—¶çš„å…¥å‚ã€‚</p><h4 id="3-8-è¿è¡Œå¢é‡åŒæ­¥">3.8 è¿è¡Œå¢é‡åŒæ­¥</h4><p>åœ¨å…¨é‡åŒæ­¥å®Œæˆåï¼Œç­‰å¾…åç»­ç¬¬ä¸€ä¸ªå·¥ä½œæ—¥çš„æ™šä¸Š21ç‚¹ï¼ŒPrefect cloud ä¼šæŒ‰ cron é…ç½®è‡ªåŠ¨è¿è¡Œå¢é‡åŒæ­¥ã€‚</p><h2 id="å››ã€æ•ˆæœ">å››ã€æ•ˆæœ</h2><ol><li><a href="https://huggingface.co/datasets/ellendan/a-share-prices">ellendan/a-share-prices</a>æ•°æ®é›†æ”¯æŒæ•°æ®å·¥ä½œæµè‡ªåŠ¨æ›´æ–°ï¼Œå½“å‰å·²ç»æ›´æ–°åˆ°äº†2025å¹´4æœˆ3æ—¥ã€‚</li><li>æ•°æ®é›†çš„æ•°æ®æ¥æºåˆ‡æ¢åˆ°äº†æ”¯æŒ API æ–¹å¼çš„æ–°æ•°æ®æº Tushareï¼Œå°½é‡è¿˜åŸåŸæ•°æ®é›†çš„å­—æ®µï¼Œä½†æœ‰ä¸‰ä¸ªå­—æ®µå–æ¶ˆæä¾›ï¼š<code>is_st</code>ã€<code>avg_price</code>å’Œ<code>is_paused</code>ã€‚è¯¦æƒ…è§æ•°æ®é›†çš„ READMEï¼ŒREADMEå·²ç»æ›´æ–°ã€‚</li><li>æ•°æ®é›†çš„æœ€è¿‘ä¸€æ¬¡æ›´æ–°æ—¶é—´ä¼šå†™å…¥æ•°æ®é›†çš„<code>.last_updated_date</code>æ–‡ä»¶ï¼Œå¯è‡ªä¸»æŸ¥çœ‹ã€‚</li><li><strong>å…¨é‡æ›´æ–°</strong>åå åŠ <strong>å¢é‡æ›´æ–°</strong>ï¼Œä¼šè®©æ•°æ®é›†ä¸èƒ½å†æŒ‰ç…§ <code>date</code> å­—æ®µé¡ºåºæ’åˆ—ï¼Œå› æ­¤åŠ è½½æ•°æ®é›†ä¹‹åï¼Œå¿…é¡»æ‰‹åŠ¨æ’ä¸‹åºï¼Œæ‰èƒ½ä¿æŒåŸæœ‰è„šæœ¬çš„æ•ˆæœã€‚ï¼ˆ<a href="https://huggingface.co/spaces/ellendan/a-share-demo/blob/main/a_share/demo.py">ellendan/a-share-demo é¦–é¡µçš„è¿æ¿æ•°æ®åˆ†å¸ƒ</a> ä»£ç å·²ä¿®æ”¹ã€‚ï¼‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é‡åŒ–åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨10åˆ†é’Ÿå­¦ä¼šä¸€ä¸ªé‡åŒ–å›æµ‹å¼•æ“ â€”â€” Backtesting</title>
      <link href="/2025/03/26/yong-10-fen-zhong-xue-hui-yi-ge-liang-hua-hui-ce-yin-qing-backtesting/"/>
      <url>/2025/03/26/yong-10-fen-zhong-xue-hui-yi-ge-liang-hua-hui-ce-yin-qing-backtesting/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å¼•è¨€">ä¸€ã€å¼•è¨€</h2><p>åœ¨å…ˆå‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦è¿ç”¨ Pandas è¿›è¡Œæ•°æ®é‡åŒ–åˆ†æï¼Œè¯¥å·¥å…·åœ¨æ•°æ®ç»Ÿè®¡ã€ç‰¹å¾å·¥ç¨‹ã€æ•°æ®æ¸…æ´—ä¸é¢„å¤„ç†ç­‰ç¯èŠ‚å‘æŒ¥ç€æ ¸å¿ƒä½œç”¨ã€‚</p><p>ç„¶è€Œå¯¹äºè‚¡ç¥¨é‡åŒ–åˆ†æè€Œè¨€ï¼Œå•çº¯ä¾èµ– Pandas éš¾ä»¥æ”¯æ’‘ç³»ç»ŸåŒ–äº¤æ˜“ä½“ç³»çš„æ„å»ºã€‚èµ„æ·±äº¤æ˜“è€…å¸¸è¯´çš„"ç³»ç»Ÿæ€§"ä¸"çºªå¾‹æ€§"ï¼Œæœ¬è´¨ä¸ŠæŒ‡å‘ä¸€ä¸ªå®Œæ•´äº¤æ˜“ç³»ç»Ÿï¼ˆæ³¨æ„ï¼šä¸æ˜¯ç‰¹æŒ‡è½¯ä»¶ç¨‹åºï¼‰çš„æ­å»ºã€‚ä¸€ä¸ªæˆç†Ÿçš„äº¤æ˜“ç³»ç»Ÿåº”å½“åŒ…å«ä»¥ä¸‹æ ¸å¿ƒè¦ç´ ï¼š</p><pre class="mermaid">flowchart LR;    A(["æ„å»ºäº¤æ˜“ç³»ç»Ÿçš„è¦ç´ "])    A --- B[["æŠ•èµ„æ ‡çš„"]]    B -.- B1[\"é€‰æ‹©å“ªäº›æ ‡çš„è¿›è¡ŒæŠ•èµ„ï¼Ÿ"\]    A --- C[["ä»“ä½ç®¡ç†"]]    C -.- C1[\"èµ„é‡‘åˆ†é…æ¯”ä¾‹ä¸é£é™©ç®¡ç†"\]    A --- D[["å…¥åœºæ—¶æœº"]]    D -.- D1[\"ä½•æ—¶å»ºç«‹ä»“ä½ï¼Ÿ"\]    A --- E[["æ­¢æŸæœºåˆ¶"]]    E -.- E1[\"ä½•æ—¶å¹³ä»“æ­¢æŸï¼Ÿ"\]    A --- F[["é€€å‡ºç­–ç•¥"]]    F -.- F1[\"ä½•æ—¶æ­¢ç›ˆç¦»åœºï¼Ÿ"\]    A --- G[["æ“ä½œæˆ˜æœ¯"]]    G -.- G1[\"æŒä»“æœŸé—´çš„å…·ä½“æ“ä½œè§„èŒƒ"\]</pre><p>è¿™å…­å¤§ç»´åº¦çš„å†³ç­–é€»è¾‘ï¼Œæœ¬è´¨ä¸Šéƒ½éœ€è¦åŸºäºå†å²è§„å¾‹çš„æç‚¼ä¸æœªæ¥è¶‹åŠ¿çš„æ¦‚ç‡åˆ¤æ–­ã€‚ä½†ä¾èµ–ä¸»è§‚ç»éªŒæ„å»ºçš„äº¤æ˜“ç³»ç»Ÿå¾€å¾€å­˜åœ¨ä¸‰å¤§ç»“æ„æ€§ç¼ºé™·ï¼š</p><ol><li>â€‹<strong>å¹¸å­˜è€…åå·®</strong>ï¼šè¿‡åº¦èšç„¦æˆåŠŸæ ·æœ¬ï¼Œå¿½è§†æ²‰é»˜çš„å¤±è´¥æ•°æ®ã€‚</li><li>â€‹<strong>é€»è¾‘æ¼æ´</strong>ï¼šå¿½ç•¥äº¤æ˜“æ‘©æ“¦ï¼ˆæ‰‹ç»­è´¹ã€æ»‘ç‚¹ï¼‰ã€æµåŠ¨æ€§é™åˆ¶ç­‰ç°å®çº¦æŸæ¡ä»¶ã€‚</li><li>â€‹<strong>æ—¶ç©ºé”™ä½</strong>ï¼šå†å²è§„å¾‹å¯èƒ½å› å¸‚åœºçš„æ¼”å˜è€Œå¤±æ•ˆã€‚</li></ol><p>æ­£æ˜¯è¿™äº›å®¢è§‚å­˜åœ¨çš„è®¤çŸ¥å±€é™ï¼Œå‡¸æ˜¾äº†é‡åŒ–å›æµ‹å¼•æ“çš„æ ¸å¿ƒä»·å€¼â€”â€”é€šè¿‡ä¸¥è°¨çš„æ•°å­¦æ¨¡å‹ä¸å†å²æ•°æ®éªŒè¯ï¼Œå°†æ¨¡ç³Šçš„äº¤æ˜“ç›´è§‰è½¬åŒ–ä¸ºå¯éªŒè¯çš„æ¦‚ç‡ä¼˜åŠ¿ï¼Œæœ€ç»ˆå®ç°æŠ•èµ„å†³ç­–çš„ç§‘å­¦åŒ–ä¸ç³»ç»ŸåŒ–ã€‚</p><p>ä¼ ç»Ÿé‡åŒ–å›æµ‹æ¡†æ¶å¦‚ Ziplineã€Backtraderã€PyAlgoTrade ç­‰ï¼Œè™½ç„¶åœ¨åŠŸèƒ½å®Œå¤‡æ€§ä¸Šå…·æœ‰ä¼˜åŠ¿ï¼Œä½†æ™®éå­˜åœ¨ä¾èµ–é¡¹å¤æ‚ã€å­¦ä¹ æ›²çº¿é™¡å³­ç­‰é—®é¢˜ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™äº›æ¡†æ¶çš„æœ€æ–°ç»´æŠ¤æ—¶é—´éƒ½è‡³å°‘åœ¨ä¸¤å¹´å‰ã€‚å¯¹äºå¸Œæœ›å¿«é€ŸæŒæ¡äº¤æ˜“ç³»ç»Ÿæ ¸å¿ƒæ¦‚å¿µçš„å¼€å‘è€…è€Œè¨€ï¼Œè¿™äº›æ¡†æ¶å¹¶éç†æƒ³é€‰æ‹©ã€‚</p><p>æœ¬æ–‡é‡ç‚¹æ¨ä»‹ Backtesting è¿™ä¸€è½»é‡çº§å›æµ‹æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºé¢å‘å¯¹è±¡çš„è®¾è®¡ç†å¿µå’Œæç®€ä¸»ä¹‰æ¶æ„ã€‚è¯¥æ¡†æ¶ä¸ä»…æä¾›é€»è¾‘æ¸…æ™°çš„ç­–ç•¥å¼€å‘æ¥å£ï¼Œè¿˜å†…ç½®äº†å¯è§†åŒ–åˆ†ææ¨¡å—ï¼Œå¤§å¹…é™ä½äº†ç­–ç•¥éªŒè¯çš„å¤æ‚åº¦ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå…¶åœ¨é«˜çº§åŠŸèƒ½å±‚é¢å­˜åœ¨å±€é™ï¼Œä¾‹å¦‚åŠ¨æ€é€‰è‚¡ã€å¤šèµ„äº§ç»„åˆç®¡ç†ã€å®ç›˜å¯¹æ¥ç­‰å¤æ‚åŠŸèƒ½å°šæœªå®ç°ã€‚</p><p>æ€»ä½“è€Œè¨€ï¼Œè¯¥æ¡†æ¶å‡­å€Ÿå…¶ä½å­¦ä¹ é—¨æ§›å’Œå¹³ç¼“çš„å­¦ä¹ æ›²çº¿ï¼Œç‰¹åˆ«é€‚åˆä½œä¸ºäº¤æ˜“ç³»ç»Ÿå¼€å‘çš„å…¥é—¨å·¥å…·ã€‚å¯¹äºåˆæ¬¡æ¥è§¦é‡åŒ–äº¤æ˜“çš„å¼€å‘è€…ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæ­å»ºä»ç­–ç•¥æ„æ€åˆ°å›æµ‹éªŒè¯çš„å®Œæ•´è®¤çŸ¥é—­ç¯ã€‚</p><h2 id="äºŒã€Backtesting-çš„æ¶æ„">äºŒã€Backtesting çš„æ¶æ„</h2><p>é˜…è¯» Backtesting çš„<a href="https://kernc.github.io/backtesting.py/doc/backtesting/backtesting.html">å®˜æ–¹ API æ–‡æ¡£</a>ï¼Œå°±ä¼šå‘ç° Backtesting æä¾›äº†5å¤§ç±»å¯¹è±¡ã€‚</p><pre class="mermaid">--- title: Backtesting.py API---classDiagram direction LRclass Backtest {        - DataFrame data        - Strategy strategy        - float cash        - float commission        - ... params        + run(...)        + optimize(...)        + plot(...)    }    class Strategy {        &lt;&lt; Abstract &gt;&gt;        + init()        + next()    }    class Order {        - float size            - float limit        - float sl        - float tp        + cancel()    }    class Trade {        - float entry_price        - float exit_price        - int size        - datetime entry_time        - datetime exit_time        - float pl        - float pl_pct        - float sl        - float tp        - float value        + close()    }    class Position {        - float size        - float pl        - float pl_pct        + close()    }        Backtest "1" *--&gt; "1" Strategy    Strategy .. Order : creates    Strategy "1" *--&gt; "1" Position    Position "1" *--&gt; "*" Trade    Order "*" .. "*" Trade : open or close</pre><div class="note info"><p>ä¸Šå›¾æ˜¯ç®€ç•¥çš„ç”»æ³•ï¼ŒBacktesting æºä»£ç ä¸­å®é™…ä¸Šç”¨äº†ä¸€äº›ä¸­é—´ç±»ï¼Œä½†ä¸ºäº†æ›´å¥½ç†è§£æ¦‚å¿µï¼Œæˆ‘å°†å…¶åœ¨å›¾ä¸Šçœç•¥ã€‚</p></div><ul><li><strong>Backtest</strong> ç±»æ˜¯æ ¸å¿ƒå®¹å™¨ï¼Œä¹Ÿæ˜¯ Portalï¼Œè´Ÿè´£ç»„è£…å„ç»„ä»¶å’Œå‚æ•°ã€‚å®ƒæœ‰ä¸‰å¤§å‡½æ•°ï¼š<ul><li><code>run()</code> è¿è¡Œå›æµ‹ã€‚</li><li><code>plot()</code> å°†å›æµ‹ç»“æœå¯è§†åŒ–ã€‚</li><li><code>optimize()</code> è‡ªåŠ¨ä¼˜åŒ– Strategy å‚æ•°ã€‚</li></ul></li><li><strong>Strategy</strong> ç±»æ˜¯ç”¨æˆ·éœ€è¦å®šåˆ¶çš„ä¸»è¦ç±»ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å®šåˆ¶è‡ªå·±çš„ä»“ä½ç®¡ç†ã€å…¥åœºæ—¶æœºã€æ­¢æŸæœºåˆ¶ã€é€€å‡ºç­–ç•¥ä»¥åŠæ“ä½œæˆ˜æœ¯ã€‚å®ƒæœ‰ä¸¤å¤§å‡½æ•°ï¼š<ul><li><code>init()</code> åˆå§‹åŒ–å‡½æ•°ã€‚è·å–ç”¨æˆ·æ³¨å…¥çš„è‚¡ç¥¨æ—¶åºæ•°æ®ï¼Œè®¡ç®—å‡ºå‚ä¸ç­–ç•¥é‡ä»·ç›¸å…³çš„æŒ‡æ ‡ã€‚</li><li><code>next()</code> ä¸ºæ—¶é—´é©±åŠ¨å‡½æ•°ã€‚å¦‚æœç”¨æˆ·æ³¨å…¥çš„æ˜¯æ—¥çº¿æ•°æ®ï¼Œåœ¨æ—¶é—´é‡æ”¾æ—¶ï¼Œæ¯ä¸€æ—¥æ‰§è¡Œä¸€æ¬¡ï¼›å¦‚æœæ³¨å…¥çš„æ˜¯åˆ†æ—¶æ•°æ®ï¼Œåˆ™æ¯ä¸€æ¡åˆ†æ—¶è®°å½•æ‰§è¡Œä¸€æ¬¡ã€‚<br>next() æ˜¯å®šåˆ¶ç”¨æˆ·ç­–ç•¥çš„é›†ä¸­ä½ç½®ã€‚</li></ul></li><li><strong>Position</strong> ç±»æ˜¯ä»“ä½ï¼Œä¸»è¦å¯¹äº¤æ˜“æ€»é‡å’Œç›ˆäºè¿›è¡Œç›‘æ§ï¼Œä»¥åŠæ‰§è¡Œå¹³ä»“æ“ä½œã€‚</li><li><strong>Order</strong> ç±»ï¼Œç”¨æˆ·åœ¨ Strategy ç±»ä¸­è¿›è¡Œçš„æ¯ä¸€æ¬¡ä¹°å–ã€æ­¢ç›ˆæ­¢æŸç­‰æ“ä½œï¼Œéƒ½ä¼šç”Ÿæˆå¯¹åº”çš„è®¢å•ã€‚å½“è®¢å•è¢«åˆ¤å®šæœ‰æ•ˆã€å¹¶è¢«æˆäº¤æ—¶ï¼Œä¼šå°†ç»“æœæ˜ å°„æˆ Trade å¯¹è±¡ã€‚å‡½æ•°ï¼š<ul><li><code>cancel()</code> å½“è®¢å•æ²¡æœ‰è¢«æˆäº¤æ—¶ï¼Œå¯ä»¥æ‰§è¡Œå–æ¶ˆæ“ä½œã€‚ä¸»è¦ç”¨äºé™ä»·è®¢å•ã€‚</li></ul></li><li><strong>Trade</strong> ç±»ï¼Œåªæœ‰è¢«æˆäº¤çš„è®¢å•ï¼Œæ‰è¢«æ˜ å°„æˆäº¤æ˜“ã€‚ ä¸€æ¡äº¤æ˜“ï¼Œç®¡ç†ç€ä»ä¹°å…¥åˆ°å¹³ä»“é€€å‡ºæ•´ä¸ªå‘¨æœŸæ®µçš„è®°å½•ã€‚<ul><li><code>close()</code> å¹³ä»“æ“ä½œã€‚Trade æä¾›å¹³ä»“å‡½æ•°ï¼Œå½“ Position å¯¹è±¡è¿›è¡Œå¹³ä»“æ—¶ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯è°ƒç”¨çš„æ‰€æœ‰æ´»è·ƒçŠ¶æ€çš„ Trade å¯¹è±¡çš„ close() å‡½æ•°ã€‚<br>é™¤äº†å¹³ä»“è¿™ä¸ªåŠ¨ä½œä¹‹å¤–ï¼Œæ‰€æœ‰çš„äº¤æ˜“æ“ä½œï¼Œéƒ½éœ€è¦é€šè¿‡ Order å¯¹è±¡æ¥ä¼ è¾¾æ‰§è¡Œã€‚</li></ul></li></ul><p>é€šè¿‡ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ Backtesting å›æµ‹å¼•æ“ï¼Œç”¨æˆ·çš„ä¸»è¦ä»£ç å·¥ä½œå°±æ˜¯å®šåˆ¶<strong>Strategy</strong>ç±»ã€‚<br><strong>æ³¨æ„ï¼š</strong> ä»‹ç» Strategy ç±»æ—¶ï¼Œæˆ‘æ²¡æœ‰æåˆ°æŠ•èµ„æ ‡çš„çš„é€‰æ‹©ç­–ç•¥ã€‚æ˜¯çš„ï¼ŒBacktesting ç›®å‰ä¸æ”¯æŒç­–ç•¥åŠ¨æ€é€‰è‚¡ã€‚</p><pre class="mermaid">--- title: Backtesting æ‰§è¡Œæ—¶åºconfig:---sequenceDiagram    actor User    participant Backtest    participant Strategy    participant Order    participant Position    participant Trade    User -&gt;&gt; Backtest: åˆå§‹åŒ–(æ•°æ®, ç­–ç•¥)    User -&gt;&gt; Backtest: run()    loop æ¯æ ¹Kçº¿        Backtest -&gt;&gt; Strategy: next()        Strategy -&gt;&gt; Backtest: è°ƒç”¨ buy()/sell()        Backtest -&gt;&gt; Order: åˆ›å»ºè®¢å•ï¼ˆæ£€æŸ¥èµ„é‡‘ï¼‰        alt è®¢å•æœ‰æ•ˆ            Order -&gt;&gt; Trade: ç”Ÿæˆäº¤æ˜“è®°å½•            Backtest -&gt;&gt; Position: æ›´æ–°ä»“ä½            Backtest -&gt;&gt; Backtest: è®¡ç®—æƒç›Šæ›²çº¿        else è®¢å•æ— æ•ˆ            Note over Order: è®¢å•è‡ªåŠ¨å–æ¶ˆï¼Œä»€ä¹ˆéƒ½ä¸å‘ç”Ÿ        end    end    Backtest -&gt;&gt; User: è¿”å›ç»Ÿè®¡ç»“æœï¼ˆå«Tradesåˆ—è¡¨ï¼‰</pre><h2 id="ä¸‰ã€ä»£ç æ“ä½œ">ä¸‰ã€ä»£ç æ“ä½œ</h2><h3 id="1-ä¾èµ–åº“">1. ä¾èµ–åº“</h3><ul><li>Pandas ï¼ˆç”¨æ¥åŠ è½½æ•°æ®æºï¼‰</li><li>TA-Libï¼ˆç”¨æ¥è®¡ç®—æŒ‡æ ‡ï¼‰</li><li>backtesting</li></ul><p>è¿™æ¬¡æŒ‡æ ‡çš„è®¡ç®—ï¼Œæˆ‘ä»¬ä½¿ç”¨TA-Libåº“ï¼ŒTA-Lib çš„åº•å±‚æ˜¯ C/C++ åº“ï¼Œåœ¨ Python pip å®‰è£…ä¹‹å‰ï¼Œéœ€è¦å®‰è£… C/C++ TA-Lib åº“ã€‚<br>å¦‚æœæ˜¯ macOSï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> ta-libpip <span class="token function">install</span> ta-lib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Linux / Windows åˆ™è§<a href="https://github.com/ta-lib/ta-lib-python?tab=readme-ov-file#dependencies">å®˜æ–¹readme</a>ã€‚</p><p>Demo çš„ä»£ç åº“ä¾ç„¶æ˜¯åœ¨ä¹‹å‰çš„ HuggingFace Demo Space ä¸­ï¼Œ<a href="https://huggingface.co/spaces/ellendan/a-share-demo/tree/main/a_share/ipynb/backtesting_py">è„šæœ¬åœ°å€</a>ã€‚</p><div class="note warning"><p>æ³¨æ„ï¼š<br>Demo åº“ä¸­çš„ <code>requirements.txt</code> ä¼šåœ¨ HuggingFaceè‡ªåŠ¨éƒ¨ç½²ï¼Œä½†ç¬”è€…çš„ HuggingFaceè´¦å·æ˜¯ Free levelï¼Œä¸èƒ½ SSH åˆ° Space Environment å»å®‰è£… TA-Lib C/C++åº“ï¼Œå› æ­¤ requirements.txt ä¹‹åä¸ä¼šå†æ›´æ–°ã€‚</p><p>ä¸‹è½½äº† Demo åº“çš„å°ä¼™ä¼´ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ requirements.txt å®‰è£…ä¾èµ–ï¼Œè¯·ä½¿ç”¨<code>local-requirements.txt</code>ã€‚<br>å¦å¤–ï¼Œæ¯”è¾ƒä¹ æƒ¯ NPM ä½¿ç”¨å§¿åŠ¿çš„å°ä¼™ä¼´ï¼Œç¬”è€…è¿˜æ˜¯æ›´æ¨èä½¿ç”¨ pipenvã€‚åªéœ€è¦ä½¿ç”¨å‘½ä»¤<code>pip install pipenv</code>å³å¯å®‰è£… pipenvï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨ pipenv æ¥ä»£æ›¿ pip å·¥ä½œäº†ã€‚<br><a href="https://github.com/pypa/pipenv">Pipenv å®˜æ–¹æ–‡æ¡£æˆ³è¿™é‡ŒğŸ‘ˆ</a></p></div><h3 id="2-åŠ è½½è‚¡ç¥¨æ•°æ®">2. åŠ è½½è‚¡ç¥¨æ•°æ®</h3><p>æ•°æ®é›†åœ¨çº¿ä¸Šè€ä½ç½®ï¼š<a href="https://huggingface.co/datasets/ellendan/a-share-21/blob/main/all-prices-with-values-250303.csv">HuggingFace dataset ellendan/a-share-21</a>ã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token comment"># ä»æœ¬åœ° CSV æ–‡ä»¶åŠ è½½è‚¡ç¥¨æ•°æ®</span>data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'../../../dataset/all-prices-with-values-250303.csv'</span><span class="token punctuation">,</span>parse_dates<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># æŒ‰ backtesting çš„æ ¼å¼ï¼Œç¡®ä¿æ•°æ®åˆ—åæ­£ç¡®</span>data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token string">'volume'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>data<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'open'</span><span class="token punctuation">:</span> <span class="token string">'Open'</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">:</span> <span class="token string">'High'</span><span class="token punctuation">,</span> <span class="token string">'low'</span><span class="token punctuation">:</span> <span class="token string">'Low'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">:</span> <span class="token string">'Close'</span><span class="token punctuation">,</span> <span class="token string">'volume'</span><span class="token punctuation">:</span> <span class="token string">'Volume'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¡†æ¶å¯¹è‚¡ç¥¨æ•°æ®çš„æ”¯æŒï¼Œé›†ä¸­åœ¨é‡å’Œä»·ä¸¤æ–¹é¢ï¼Œå³ <code>OHLCï¼ˆOpen/High/Low/Closeï¼‰</code> å’Œ <code>Volume</code>ã€‚</p><h3 id="3-å®ç°-Strategy-ç±»">3. å®ç° Strategy ç±»</h3><h4 id="3-1-init-å‡½æ•°">3.1 init() å‡½æ•°</h4><p>æˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„ç­–ç•¥ç›®æ ‡ï¼š</p><ul><li>ä½¿ç”¨ MA5 é«˜äº MA20 è¿›è¡Œå¸‚åœºè¡Œæƒ…é€‰æ‹©</li><li>ä½¿ç”¨ KD é‡‘å‰è¿›è¡Œæ‹©æ—¶ä¹°å…¥ï¼ŒKD æ­»å‰å–å‡º</li><li>ä½¿ç”¨ ATR è¿›è¡Œä»“ä½ç®¡ç†å’Œæ­¢æŸæŒ‡å¯¼</li></ul><p>å› æ­¤ï¼Œéœ€è¦åœ¨ init() å‡½æ•°ä¸­å¯¹æ¶‰åŠåˆ°çš„æŒ‡æ ‡è¿›è¡Œæ‰¹é‡è®¡ç®—ï¼Œä»¥æä¾›ç»™ next()å‡½æ•°ä½¿ç”¨ã€‚</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">import talib as tafrom backtesting import Strategyfrom backtesting.lib import crossover, crossclass KDJCross(Strategy):    # å‡çº¿å‚æ•°    n1 = 5    n2 = 20        # ä»“ä½ç®¡ç†å‚æ•°    risk_percent = 0.10 # é£é™©æ•å£ä¸ºè´¦æˆ·çš„10%    # æ­¢æŸå‚æ•°    stop_loss_atr_multiple = 3 # ATRçš„å€æ•°ä½œä¸ºæ­¢æŸè·ç¦»    trailing_stop_loss = 1 # æ˜¯å¦å¯ç”¨è¿½è¸ªæ­¢æŸ    atr_period = 14 # ATRè®¡ç®—å‘¨æœŸdef init(self):    # è®¡ç®—KDJæŒ‡æ ‡çš„KJ    self.k, self.d = self.I(ta.STOCH, high=self.data.High, low=self.data.Low, close=self.data.Close, fastk_period=9, slowk_period=3, slowk_matype=1, slowd_period=3, slowd_matype=1)        self.sma1 = self.I(ta.SMA, self.data.Close, timeperiod=self.n1)    self.sma2 = self.I(ta.SMA, self.data.Close, timeperiod=self.n2)        # è®¡ç®—ATR (Average True Range)    self.atr = self.I(ta.ATR, self.data.High, self.data.Low, self.data.Close, timeperiod=self.atr_period)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-2-next-å‡½æ•°">3.2 next() å‡½æ•°</h4><p>è¿™é‡Œä½¿ç”¨äº†æœ€ç®€å•çš„å•æ¬¡è¿›åœº/å•æ¬¡å¹³ä»“çš„ç­–ç•¥ï¼Œå¦‚æœæƒ³åˆ†æ‰¹è¿›åœºå’Œé€€å‡ºï¼Œä¹Ÿå¯è‡ªè¡Œå®šåˆ¶ã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">next</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    current_price <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Close<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token comment"># å¦‚æœçŸ­æœŸå‡çº¿åœ¨é•¿æœŸå‡çº¿ä¹‹ä¸Š + KDé‡‘å‰ + Dåœ¨50ä¹‹ä¸‹ï¼Œä¹°å…¥</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>sma1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>sma2<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> crossover<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">,</span> self<span class="token punctuation">.</span>d<span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>d<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">50</span> <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>position<span class="token punctuation">:</span>        <span class="token comment"># è®¡ç®—ä»“ä½å¤§å°</span>        position_size <span class="token operator">=</span> self<span class="token punctuation">.</span>_position_size<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># è®¡ç®—æ­¢æŸä»·æ ¼</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>atr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>            _stop_price <span class="token operator">=</span> stop_loss_price<span class="token punctuation">(</span>current_price<span class="token punctuation">,</span> self<span class="token punctuation">.</span>atr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>stop_loss_atr_multiple<span class="token punctuation">)</span>        <span class="token comment"># ä¸‹å¸¦æœ‰æ­¢æŸçš„å¸‚ä»·è®¢å•</span>        self<span class="token punctuation">.</span>buy<span class="token punctuation">(</span>size<span class="token operator">=</span>position_size<span class="token punctuation">,</span> sl<span class="token operator">=</span>_stop_price<span class="token punctuation">,</span> tag<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'sl: </span><span class="token interpolation"><span class="token punctuation">{</span>_stop_price<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>        <span class="token comment"># é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœæŒä»“ï¼Œä¸”KDæ­»å‰ + Dåœ¨50ä¹‹ä¸Šï¼Œå–å‡ºï¼ˆå¹³ä»“ï¼‰</span>    <span class="token keyword">elif</span> self<span class="token punctuation">.</span>position <span class="token keyword">and</span> cross<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">,</span> self<span class="token punctuation">.</span>d<span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>d<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">50</span><span class="token punctuation">:</span>         self<span class="token punctuation">.</span>position<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># æ›´æ–°è¿½è¸ªæ­¢æŸï¼Œç”¨ä»¥é”ä½ç›ˆåˆ©</span>    <span class="token keyword">elif</span> self<span class="token punctuation">.</span>trailing_stop_loss <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>position<span class="token punctuation">:</span>        <span class="token comment"># è®¡ç®—æ–°çš„æ­¢æŸä»·æ ¼</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>atr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>            new_stop <span class="token operator">=</span> stop_loss_price<span class="token punctuation">(</span>current_price<span class="token punctuation">,</span> self<span class="token punctuation">.</span>atr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>stop_loss_atr_multiple<span class="token punctuation">)</span>            <span class="token comment"># å¦‚æœæ–°çš„æ­¢æŸä»·æ ¼é«˜äºå½“å‰æ­¢æŸä»·æ ¼ï¼Œåˆ™æ›´æ–°æ­¢æŸä»·æ ¼ï¼ˆåªä¸Šç§»ï¼Œä¸ä¸‹ç§»ï¼‰</span>            <span class="token keyword">if</span> new_stop <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>trades<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sl<span class="token punctuation">:</span>                self<span class="token punctuation">.</span>trades<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sl <span class="token operator">=</span> new_stop<span class="token keyword">def</span> <span class="token function">_position_size</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""è®¡ç®—å¤´å¯¸å¤§å°ï¼ŒåŸºäºé£é™©ç®¡ç†åŸåˆ™"""</span>    <span class="token comment"># è·å–å½“å‰ä»·æ ¼å’ŒATR</span>    current_price <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Close<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>    current_atr <span class="token operator">=</span> self<span class="token punctuation">.</span>atr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token comment"># å¦‚æœATRæ•°æ®ä¸è¶³ï¼Œä½¿ç”¨é»˜è®¤å€¼</span>    <span class="token keyword">if</span> current_atr <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">100</span> <span class="token comment"># é»˜è®¤è´­ä¹°100è‚¡ï¼Œå³1æ‰‹</span>        <span class="token comment"># è®¡ç®—æ­¢æŸè·ç¦»ï¼ˆä»¥ATRçš„å€æ•°è¡¨ç¤ºï¼‰</span>    stop_distance <span class="token operator">=</span> current_atr <span class="token operator">*</span> self<span class="token punctuation">.</span>stop_loss_atr_multiple    <span class="token comment"># æ ¹æ®è´¦æˆ·é£é™©æ¯”ä¾‹è®¡ç®—å¤´å¯¸è§„æ¨¡</span>    <span class="token comment"># é£é™©é‡‘é¢ = è´¦æˆ·ä»·å€¼ * é£é™©æ¯”ä¾‹</span>    risk_amount <span class="token operator">=</span> self<span class="token punctuation">.</span>equity <span class="token operator">*</span> self<span class="token punctuation">.</span>risk_percent        <span class="token comment"># ä»“ä½å¤§å° = é£é™©é‡‘é¢ / æ­¢æŸè·ç¦»</span>    position_size <span class="token operator">=</span> risk_amount <span class="token operator">/</span> stop_distance    <span class="token comment"># æœ€å¤§ä»“ä½å¤§å° = è´¦æˆ·ä»·å€¼ / å½“å‰ä»·æ ¼</span>    max_size <span class="token operator">=</span> self<span class="token punctuation">.</span>equity <span class="token operator">*</span> <span class="token number">0.99</span> <span class="token operator">/</span> current_price    <span class="token comment"># è¿”å›åˆé€‚çš„ä»“ä½å¤§å°ï¼ˆè¾ƒå°çš„é‚£ä¸ªå€¼ï¼‰</span>    position_size <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>position_size<span class="token punctuation">,</span> max_size<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>position_size <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>next() å‡½æ•°ä¸€å…±æœ‰ä¸‰ä¸ªåˆ†æ”¯ï¼š</p><ul><li><strong>ä¹°å…¥ã€‚</strong> åœ¨ ma5 è¿è¡Œåœ¨ ma20 ä¹‹ä¸Šæ—¶ï¼Œåªè¦ KD é‡‘å‰ï¼ˆåŒæ—¶ D åœ¨ 50ä¹‹ä¸‹ï¼‰ï¼Œåˆ™å»ºä»“ã€‚</li><li><strong>å–å‡ºã€‚</strong> æ’é™¤æ‰ä¹°å…¥çš„æ¡ä»¶ä¹‹åï¼Œåªè¦ KD å‡ºç°äº¤å‰ï¼ˆåŒæ—¶ D åœ¨ 50ä¹‹ä¸Šï¼‰ï¼Œåˆ™å¹³ä»“ã€‚</li><li><strong>è·Ÿè¸ªæ­¢æŸã€‚</strong> åœ¨æ”¶ç›Šä¸Šå‡æ—¶ï¼Œè°ƒæ•´æ­¢æŸä»·ï¼Œç”¨äºé”ä½ç›ˆåˆ©ã€‚</li></ul><p>åœ¨ä¹°å…¥æ—¶ï¼Œè°ƒç”¨äº†<code>buy()</code>å‡½æ•°ï¼š</p><ul><li><code>slï¼ˆstop-loss priceï¼‰</code>: è®¾å®šåˆå§‹æ­¢æŸä»·ã€‚<br>å½“æ­¢æŸä»·å®šçš„å¤ªè¿œæ—¶ï¼Œä¼šé€ æˆè¿‡å¤šäºæŸï¼›å®šçš„å¤ªè¿‘æ—¶ï¼Œåˆä¼šé€ æˆåœ¨éœ‡è¡ä¸­è¿‡æ—©å‡ºå±€ã€‚<br>å› æ­¤ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨ã€Šæµ·é¾Ÿäº¤æ˜“æ³•åˆ™ã€‹ä¸­æåˆ°çš„ATRï¼ˆçœŸå®æ³¢åŠ¨å‡å€¼ï¼Œå•ä½æ˜¯è´§å¸å•ä½ï¿¥/$ç­‰ï¼‰ï¼Œä½¿ç”¨ ATR ä½œä¸ºå‚ç…§æ ‡å‡†è®¾ç½® 2å€ ATR ä¸ºæ­¢æŸä»·ã€‚</li><li><code>size</code>ï¼šè®¾å®šä¹°å¤šå°‘è‚¡ã€‚<br>è™½ç„¶è®¾å®šäº†æ­¢æŸä»·æ§åˆ¶äº†éƒ¨åˆ†é£é™©ï¼Œä½†å¦‚æœä»“ä½è¿‡é‡ï¼Œä»ç„¶å¯èƒ½è®©è´¦æˆ·äºæŸè¶…å‡ºæˆ‘ä»¬çš„æœŸæœ›ã€‚å› æ­¤ï¼Œéœ€è¦è®¡ç®—ä»“ä½ï¼Œä»è€Œè®©é£é™©å¹…åº¦æ§åˆ¶åœ¨æœŸæœ›çš„èŒƒå›´å†…ã€‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>æœ€å¤§äºæŸé‡‘é¢</mtext><mo>=</mo><mtext>ï¼ˆä¹°å…¥ä»·</mtext><mo>âˆ’</mo><mtext>åˆå§‹æ­¢æŸä»·ï¼‰</mtext><mo>Ã—</mo><mtext>ä»“ä½ï¼ˆè‚¡æ•°ï¼‰</mtext></mrow><annotation encoding="application/x-tex">æœ€å¤§äºæŸé‡‘é¢ = ï¼ˆä¹°å…¥ä»· - åˆå§‹æ­¢æŸä»·ï¼‰ \times ä»“ä½ï¼ˆè‚¡æ•°ï¼‰</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">æœ€å¤§äºæŸé‡‘é¢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">ï¼ˆä¹°å…¥ä»·</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">åˆå§‹æ­¢æŸä»·ï¼‰</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">ä»“ä½ï¼ˆè‚¡æ•°ï¼‰</span></span></span></span><br>å½“ç„¶ï¼Œä¹Ÿæœ‰äººä¼šæ‹…å¿ƒä»“ä½è¿‡å°ï¼Œé€ æˆç›ˆåˆ©å˜å°‘ã€‚é£é™©å’Œç›ˆåˆ©ä¸­å¦‚ä½•å–å¾—å¹³è¡¡ï¼Œæœ¬èº«å°±æ˜¯ä¸€ç§è€ƒé‡å’Œå–èˆ â€”â€” å¯ä»¥é€‰æ‹©åŠ å¤§ä»“ä½ï¼ŒåŒæ—¶æœ€å¤§çš„äºæŸé‡‘é¢çš„ä¸Šé™å¿…ç„¶ä¹Ÿä¼šå‡é«˜ã€‚<br>æœ¬ä¾‹å­ä¸­è®¾å®šçš„è´¦æˆ·é£é™©æ•å£ä¸º10%ï¼Œå³åªèƒ½æ¥å—è´¦æˆ·ä»·å€¼å‡ºç° -10% çš„äºæŸã€‚å›ºå®šäº†è´¦æˆ·é£é™©æ•å£å’Œåˆå§‹æ­¢æŸä»·ï¼Œè‡ªç„¶å°±å¯ä»¥è®¡ç®—å‡ºä»“ä½ä¹°å¤šå°‘è‚¡äº†ã€‚ä»£ç ä¸­ç”±å‡½æ•°<code>_position_size()</code>å®ç°ã€‚<br>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šè´¦æˆ·é£é™©æ•å£æ˜¯ 10%ï¼Œä½†æ˜¯æƒ³ä¹°ä¸€åªè‚¡ç¥¨çš„ 2ATR ~= 15% è‚¡ä»·å¹…åº¦ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯æ­¢æŸçš„æ—¶å€™äºæŸçš„é‡‘é¢æ˜¯åœ¨è´¦æˆ·çš„ 10% ä¹‹å†…å‘¢ï¼Ÿé‚£è‡ªç„¶æ˜¯è½»ä»“å•¦ã€‚</li></ul><h3 id="4-å®ä¾‹åŒ–-Backtest-å®¹å™¨">4. å®ä¾‹åŒ– Backtest å®¹å™¨</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> backtesting<span class="token keyword">from</span> kdj_strategy <span class="token keyword">import</span> KDJCross<span class="token punctuation">,</span> commissionselected_stock_data <span class="token operator">=</span> data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'002483.SZ'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">400</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment"># åˆ›å»ºå›æµ‹å®ä¾‹</span>bt <span class="token operator">=</span> backtesting<span class="token punctuation">.</span>Backtest<span class="token punctuation">(</span>selected_stock_data<span class="token punctuation">,</span> KDJCross<span class="token punctuation">,</span> cash<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> commission<span class="token operator">=</span>commission<span class="token punctuation">,</span> trade_on_close<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment"># è¿è¡Œå›æµ‹</span>stats <span class="token operator">=</span> bt<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># è¾“å‡ºå›æµ‹ç»“æœ</span><span class="token keyword">print</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token comment"># ç»˜åˆ¶å›æµ‹ç»“æœ</span>bt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‰é¢ä»‹ç»è¿‡ï¼šBacktesting æ²¡æœ‰ç­–ç•¥çš„åŠ¨æ€é€‰è‚¡ç»„ä»¶ã€‚åœ¨ Backtest åˆå§‹åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡å‚æ•°é™æ€ç»‘å®šäº†å…·ä½“è¢«å›æµ‹çš„è‚¡ç¥¨æ ‡çš„ã€‚</p><ul><li><code>selected_stock_data</code>ï¼Œå›æµ‹ä½¿ç”¨çš„æŸåªè‚¡ç¥¨çš„ OHLCV æ•°æ®ã€‚</li><li><code>KDJCross</code>ï¼Œç”¨æˆ·å®ç°çš„ç­–ç•¥ç±»ã€‚</li><li><code>cash</code>ï¼Œå›æµ‹çš„åˆå§‹ç°é‡‘é¢ã€‚</li><li><code>commission</code>ï¼Œä½£é‡‘ã€‚<br><strong>æ³¨æ„</strong>ï¼Œè¿™é‡Œçš„ä½£é‡‘ä¸Aè‚¡çš„ä¹ æƒ¯ä¸åŒã€‚Aè‚¡ï¼Œæ˜¯æŒ‰æ¯ç¬”è®¢å•çš„æ€»é‡‘é¢è¿›è¡Œæ¯”ä¾‹æ”¶å–ï¼›Backtesting è¿™é‡Œçš„ä½£é‡‘ï¼Œæ˜¯æŒ‰æ ‡çš„æ¯ä¸€ä¸ªå•ä½è¿›è¡Œæ¯”ä¾‹æ”¶è´¹çš„ã€‚å› æ­¤ï¼Œåƒä¸‡ä¸è¦åœ¨è¿™é‡Œå†™ .00025 è¿™æ ·çš„æµ®ç‚¹æ•°ï¼Œä¸ç„¶ä¼šæŒ‰æ¯è‚¡æ”¶ä½£é‡‘ï¼Œé€ æˆä¹°ä»·é‡‘é¢é”™è¯¯ã€å¤§é‡è®¢å•æ— æ³•æˆäº¤ã€‚<br>demo æºä»£ç ä¸­çš„ <code>commission()</code> æä¾›äº†ç®€å•çš„å°†Aè‚¡ä½£é‡‘è½¬æ¢æˆæ¯è‚¡ä½£é‡‘çš„è®¡ç®—ã€‚</li><li><code>trade_on_close</code>ï¼Œæ—¶é—´é©±åŠ¨æ—¶ï¼Œå¸‚ä»·è®¢å•æ˜¯å¦æŒ‰å½“å¤©çš„æ”¶ç›˜ä»·è¿›è¡Œæˆäº¤ã€‚Trueï¼ŒæŒ‰å½“å¤©æ”¶ç›˜ä»·ï¼›Falseï¼ŒæŒ‰ç¬¬äºŒå¤©çš„å¼€ç›˜ä»·ã€‚</li></ul><h3 id="5-æ‰§è¡Œå›æµ‹">5. æ‰§è¡Œå›æµ‹</h3><h4 id="5-1-å›æµ‹ç»“æœæ¦‚è¦">5.1 å›æµ‹ç»“æœæ¦‚è¦</h4><p>è°ƒç”¨<code>Backtest.run()</code>ï¼Œè¿è¡Œå›æµ‹ï¼Œç„¶åæ‰“å°ç»“æœã€‚<br>ä¸‹é¢æ˜¯æ‰“å°çš„å›æµ‹ Summaryï¼š</p><pre class="line-numbers language-none"><code class="language-none">Start                     2023-07-06 00:00:00End                       2025-03-03 00:00:00Duration                    606 days 00:00:00Exposure Time [%]                         7.0Equity Final [$]                  12920.97943Equity Peak [$]                    13150.9817Commissions [$]                       0.02057Return [%]                           29.20979Buy &amp; Hold Return [%]                14.49275Return (Ann.) [%]                    17.52117Volatility (Ann.) [%]                12.01635CAGR [%]                              11.2452Sharpe Ratio                          1.45811Sortino Ratio                         5.04565Calmar Ratio                          4.34312Alpha [%]                            28.20636Beta                                  0.06924Max. Drawdown [%]                    -4.03423Avg. Drawdown [%]                    -1.83829Max. Drawdown Duration      196 days 00:00:00Avg. Drawdown Duration       86 days 00:00:00# Trades                                    4Win Rate [%]                             50.0Best Trade [%]                       27.25118Worst Trade [%]                      -1.54185Avg. Trade [%]                        6.98771Max. Trade Duration          19 days 00:00:00Avg. Trade Duration          11 days 00:00:00Profit Factor                        11.33606Expectancy [%]                        7.59186SQN                                   1.16059Kelly Criterion                       0.45683_strategy                            KDJCross_equity_curve                             ..._trades                      Size  EntryBa...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ° Duration 606 å¤©ï¼ˆè¿™é‡Œæ˜¯è‡ªç„¶æ—¥ï¼‰ï¼Œå®é™…äº¤æ˜“æ—¥åº”è¯¥æ˜¯ 400 å¤©ã€‚<br>è´¦æˆ·æŒä»“çš„æ—¶é—´æ˜¯ 606 x 0.07 å¤©ï¼Œæœ€åçš„æ”¶ç›Šæ˜¯ 2920 å…ƒï¼Œæ›¾ç»æœ€é«˜æ”¶ç›Šæ˜¯ 3150 å…ƒã€‚<br>æœ€ç»ˆæ”¶ç›Šç‡æ˜¯ 29%ï¼Œæœ€å¤§å›æ’¤æ˜¯ -4.03%ã€‚äº¤æ˜“é¢‘ç‡ä½ï¼Œä»…æœ‰4æ¬¡ï¼Œèƒœç‡ 50%ã€‚<br>å…·ä½“çš„å…¶ä»–é¡¹å«ä¹‰ï¼Œå¯ä»¥è‡ªè¡Œé—® DeepSeekã€‚</p><h4 id="5-2-ç»“æœå›¾å½¢å¯è§†åŒ–">5.2 ç»“æœå›¾å½¢å¯è§†åŒ–</h4><p>è°ƒç”¨<code>Backtest.plot()</code>ï¼Œæ˜¾ç¤ºå¯è§†åŒ–å›¾è¡¨ã€‚<br><img src="/2025/03/26/yong-10-fen-zhong-xue-hui-yi-ge-liang-hua-hui-ce-yin-qing-backtesting/plot.png" alt="ç»“æœå¯è§†åŒ–"><br>è¯´æ˜ï¼Œé»˜è®¤ä»ä¸Šåˆ°ä¸‹æ˜¾ç¤º5éƒ¨åˆ†ï¼š</p><ul><li><code>Equity</code>ï¼šè´¦æˆ·èµ„äº§æ€»å€¼ã€‚</li><li><code>Profit / Loss</code>ï¼šç›ˆåˆ©æˆ–äºæŸçš„äº¤æ˜“ç»“ç®—ç‚¹ã€‚</li><li><code>OHLC</code>ï¼šèœ¡çƒ›å›¾ã€‚<strong>æ³¨æ„</strong>ï¼Œè¿™é‡Œæ˜¯æŒ‰å›½å¤–çš„ä¹ æƒ¯ï¼šä¸Šæ¶¨æ˜¯ç»¿æŸ±ï¼Œä¸‹è·Œæ˜¯çº¢æŸ±ã€‚ç›®å‰å¥½åƒæ²¡æœ‰è®¾ç½®å¯ä»¥ä¿®æ”¹ã€‚</li><li><code>Volume</code>ï¼šäº¤æ˜“é‡æŸ±å›¾ã€‚</li><li><code>å¤šæŒ‡æ ‡å›¾</code>ï¼šé™¤äº† MA  ç­‰éœ€è¦æ”¾åœ¨èœ¡çƒ›å›¾ä¸Šä¸€èµ·çœ‹çš„æŒ‡æ ‡ä¹‹å¤–ï¼Œå…¶ä»–æŒ‡æ ‡ä¼šåœ¨æœ€ä¸‹æ–¹å¦å¤–ç»˜åˆ¶ã€‚æ¯”å¦‚è¿™é‡Œçš„ KDã€ATRã€‚</li></ul><p>åŒæ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯äº¤äº’çš„å›¾è¡¨ã€‚å¦‚æœåœ¨ Jupyter Notebook ä¸­æ˜¾ç¤ºçš„æ•ˆæœä¸å¥½ï¼Œå¯ä»¥è°ƒç”¨ä»£ç å…³é—­ â€”â€” è¿™æ · Backtesting ä¼šç”Ÿæˆä¸€ä¸ª html ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">backtesting<span class="token punctuation">.</span>set_bokeh_output<span class="token punctuation">(</span>notebook<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="5-3-æ•°æ®å…·ä½“çš„äº¤æ˜“æ˜ç»†">5.3 æ•°æ®å…·ä½“çš„äº¤æ˜“æ˜ç»†</h4><p>è·å–å›æµ‹ç»“æœå¥æŸ„ä¸­çš„<code>_trades</code>å±æ€§ï¼ˆ<code>stats['_trades']</code>ï¼‰ï¼Œæ‰“å°äº¤æ˜“æ˜ç»†ã€‚<br><img src="/2025/03/26/yong-10-fen-zhong-xue-hui-yi-ge-liang-hua-hui-ce-yin-qing-backtesting/trades.png" alt="äº¤æ˜“æ˜ç»†"><br>æ¯ä¸€æ¡äº¤æ˜“ä¸Šçš„å›ºå®šå±æ€§æœ‰ï¼š</p><ul><li><code>size</code>: ä»“ä½è‚¡æ•°ã€‚</li><li><code>EntryBar</code>ï¼šå»ºä»“çš„ bar ç´¢å¼•ã€‚å°±æ˜¯ DataFrame æŒ‰æ—¶é—´æ’åºåçš„è‡ªç„¶ç´¢å¼•å€¼ã€‚</li><li><code>ExitBar</code>ï¼šé€€å‡ºçš„ bar ç´¢å¼•ã€‚</li><li><code>EntryPrice</code>: å»ºä»“æ—¶çš„è‚¡ä»·ã€‚</li><li><code>ExitPrice</code>ï¼šé€€å‡ºæ—¶çš„è‚¡ä»·ã€‚</li><li><code>SL</code>ï¼š æ­¢æŸä»·ã€‚</li><li><code>TP</code>ï¼šæ­¢ç›ˆä»·ã€‚</li><li><code>PnL</code>ï¼šç›ˆåˆ©é‡‘é¢ã€‚</li><li><code>ReturnPct</code>ï¼šç›ˆåˆ©ç‡ã€‚</li><li><code>EntryTime</code>: å»ºä»“æ—¶é—´ã€‚</li><li><code>ExitTime</code>ï¼šé€€å‡ºæ—¶é—´ã€‚</li><li><code>Duration</code>ï¼šæŒè‚¡å¸‚åœºã€‚</li><li><code>Tag</code>ï¼šä» Order å¯¹è±¡é‚£é‡Œç»§æ‰¿æ¥çš„æ ‡è®°å­—ç¬¦ä¸²ã€‚<br>æˆ‘è¿™é‡Œç”¨äºè®°å½•åˆå§‹æ­¢æŸä»·ï¼Œç”±äº Backtesting æ²¡æœ‰ç›´è§‚çš„æ ‡è®°æ¥åŒºåˆ† Trade çš„é€€å‡ºåŸå› ã€‚å› æ­¤ï¼Œå½“æˆ‘å‘ç° Trade çš„é€€å‡ºä»·ç­‰äº Tag é‡Œçš„ sl å€¼æ—¶ï¼Œå°±å¯ä»¥çŸ¥é“æ­¤æ¬¡äº¤æ˜“æ˜¯è·Œç ´åˆå§‹æ­¢æŸä»·è€Œé€€å‡ºçš„ã€‚</li></ul><p>æ¯æ¡äº¤æ˜“ä¸Šå…¶å®è¿˜æœ‰éå›ºå®šçš„å±æ€§ï¼šä¸»è¦æ˜¯å»ºä»“å’Œé€€å‡ºæ—¶çš„å„ä¸ªæŒ‡æ ‡å€¼ã€‚</p><h3 id="6-æ‰§è¡Œå‚æ•°ä¼˜åŒ–">6. æ‰§è¡Œå‚æ•°ä¼˜åŒ–</h3><p>å‰é¢è¿›è¡Œå›æµ‹æ—¶ï¼Œç­–ç•¥ KDJCross ä¸­çš„æˆå‘˜å‚æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„é™æ€æŒ‡å®šçš„æ–¹å¼ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å‡çº¿å‚æ•°</span>n1 <span class="token operator">=</span> <span class="token number">5</span>n2 <span class="token operator">=</span> <span class="token number">20</span><span class="token comment"># ä»“ä½ç®¡ç†å‚æ•°</span>risk_percent <span class="token operator">=</span> <span class="token number">0.10</span> <span class="token comment"># é£é™©æ•å£ä¸ºè´¦æˆ·çš„10%</span><span class="token comment"># æ­¢æŸå‚æ•°</span>stop_loss_atr_multiple <span class="token operator">=</span> <span class="token number">3</span> <span class="token comment"># ATRçš„å€æ•°ä½œä¸ºæ­¢æŸè·ç¦»</span>trailing_stop_loss <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment"># æ˜¯å¦å¯ç”¨è¿½è¸ªæ­¢æŸ</span>atr_period <span class="token operator">=</span> <span class="token number">14</span> <span class="token comment"># ATRè®¡ç®—å‘¨æœŸ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™äº›å‚æ•°å¯èƒ½æ˜¯æŒ‰ä¸»è§‚æˆ–è€…æ˜¯å†å²ç»éªŒé€‰æ‹©çš„ï¼Œæœ‰æ²¡æœ‰å¯èƒ½æœ‰æ›´åˆé€‚çš„å‚æ•°ï¼Ÿæ¯”å¦‚ï¼šçŸ­æœŸå‡çº¿é€‰æ‹©3æ—¥ã€10æ—¥ï¼Œé•¿æœŸå‡çº¿é€‰ 30æ—¥ã€60æ—¥ç­‰ã€‚<br>å¦‚æœä¸€æ¬¡æ¬¡åœ°å»æ”¹ä»£ç æµ‹è¯•ï¼Œé‚£å¤ªè´¹äº‹äº†ï¼ŒBacktesting æä¾›äº†å‚æ•°çš„è‡ªåŠ¨ä¼˜åŒ–å·¥å…·ã€‚<br>è°ƒç”¨ä»£ç ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">stats <span class="token operator">=</span> bt<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span>n1<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    n2<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    stop_loss_atr_multiple<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    trailing_stop_loss<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    maximize<span class="token operator">=</span><span class="token string">'Equity Final [$]'</span><span class="token punctuation">,</span>                    constraint<span class="token operator">=</span><span class="token keyword">lambda</span> param<span class="token punctuation">:</span> param<span class="token punctuation">.</span>n1 <span class="token operator">&lt;</span> param<span class="token punctuation">.</span>n2<span class="token punctuation">)</span>display<span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®© Backtesting è‡ªåŠ¨è¿›è¡Œå‚æ•°èŒƒå›´çš„ç»„åˆï¼š</p><ul><li>å°†æƒ³è¦ç»„åˆä¼˜åŒ–çš„å‚æ•°è¿›è¡ŒèŒƒå›´å½•å…¥ï¼š<ul><li>çŸ­æœŸå‡çº¿å‘¨æœŸ n1ï¼Œä» 2 åˆ° 21 çš„èŒƒå›´ï¼Œæ­¥é•¿å– 1</li><li>çŸ­æœŸå‡çº¿å‘¨æœŸ n2ï¼Œä» 5 åˆ° 101 çš„èŒƒå›´ï¼Œæ­¥é•¿å– 5</li><li>ATR æ­¢æŸå€æ•° stop_loss_atr_multipleï¼Œä» 1 åˆ° 11ï¼Œæ­¥é•¿å– 1</li><li>æ˜¯å¦å¼€å¯è·Ÿè¸ªæ­¢æŸ trailing_stop_lossï¼Œå– 0 æˆ– 1</li></ul></li><li>ä»¥æœ€ç»ˆå›æŠ¥æœ€å¤§åŒ–ï¼ˆEquity Finalï¼‰ä¸ºä¼˜åŒ–ç›®æ ‡</li><li>çº¦æŸï¼šn1 å¿…é¡»å°äº n2</li></ul><p>æ‰“å°ä¼˜åŒ–åçš„æœ€ä¼˜å›æµ‹ Summaryï¼š</p><pre class="line-numbers language-none"><code class="language-none">Start                     2023-07-06 00:00:00End                       2025-03-03 00:00:00Duration                    606 days 00:00:00Exposure Time [%]                        9.75Equity Final [$]                  13715.97563Equity Peak [$]                   13715.97782Commissions [$]                       0.02437Return [%]                           37.15976Buy &amp; Hold Return [%]                18.79699Return (Ann.) [%]                    22.02613Volatility (Ann.) [%]                13.88604CAGR [%]                             14.04193Sharpe Ratio                          1.58621Sortino Ratio                         4.83448Calmar Ratio                          4.96974Alpha [%]                            35.57097Beta                                  0.08452Max. Drawdown [%]                    -4.43205Avg. Drawdown [%]                    -1.81923Max. Drawdown Duration      196 days 00:00:00Avg. Drawdown Duration       65 days 00:00:00# Trades                                    5Win Rate [%]                             60.0Best Trade [%]                       27.25118Worst Trade [%]                      -1.54185Avg. Trade [%]                        6.76572Max. Trade Duration          19 days 00:00:00Avg. Trade Duration          12 days 00:00:00Profit Factor                        13.33821Expectancy [%]                        7.24996SQN                                   1.52366Kelly Criterion                       0.55754_strategy                 KDJCross(n1=3,n2..._equity_curve                             ..._trades                      Size  EntryBa...dtype: object<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å›æŠ¥ç‡ä» 29% æå‡åˆ°äº† 37%ã€‚</p><p>è¾“å‡ºä¼˜åŒ–åçš„å‚æ•°å€¼ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># æ‰“å°ä¼˜åŒ–åçš„ç­–ç•¥å‚æ•°</span>stats<span class="token punctuation">.</span>_strategy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ˜¾ç¤ºï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;Strategy KDJCross(n1=3,n2=25,stop_loss_atr_multiple=2,trailing_stop_loss=0)&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€ä¼˜å‚æ•°ç»“æœï¼š</p><ul><li>çŸ­æœŸå‡çº¿ 3</li><li>é•¿æœŸå‡çº¿ 25</li><li>ATRæ­¢æŸå€æ•° 2</li><li>ä¸å¼€å¯è·Ÿè¸ªæ­¢æŸ</li></ul><div class="note info"><p><strong>ç‰¹åˆ«æ³¨æ„</strong>ï¼šè¿™åªæ˜¯åœ¨ä¸€åªè‚¡ç¥¨ä¸Šã€æŸä¸€æ®µå†å²äº¤æ˜“å‘¨æœŸå†…ï¼Œå›æµ‹çš„æœ€ä¼˜å‚æ•°ã€‚å¦‚ä½•åˆ©ç”¨å’Œå†æ¬¡éªŒè¯ç­–ç•¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼Œéœ€è¦åœ¨ä¸åŒçš„è‚¡ç¥¨ä¸Šå›æµ‹è¿›è¡Œæ¨ªå‘å¯¹æ¯”ï¼ŒåŒæ—¶ä¹Ÿåœ¨å•åªè‚¡ç¥¨çš„ä¸åŒäº¤æ˜“å‘¨æœŸå›æµ‹è¿›è¡Œçºµå‘å¯¹æ¯”ã€‚  ä»è€Œé¿å…è¿‡æ‹Ÿåˆã€ç­–ç•¥æ— æ³•æ³›åŒ–ä½¿ç”¨çš„é—®é¢˜ã€‚</p></div><h2 id="å››-ç»“æŸ">å››. ç»“æŸ</h2><p>è¿™æ¬¡ä»‹ç»äº†Backtesting è¿™ä¸ªå›æµ‹å¼•æ“ï¼Œé™¤äº†äº†è§£å¿…è¦çš„æŠ€æœ¯å·¥å…·ä»¥å¤–ï¼Œæ›´é‡è¦çš„æ˜¯ï¼š</p><ul><li>é€šè¿‡å·¥å…·äº†è§£èƒŒåçš„æ€ç»´ä½“ç³»ã€é€»è¾‘å’ŒçŸ¥è¯†</li><li>å·¥å…·æ˜¯ä¸ºäº†ä¸šåŠ¡å’Œéœ€æ±‚æœåŠ¡çš„ï¼Œåªæœ‰èƒ½è¾¾æˆæœ€ç»ˆçš„ç›®æ ‡ï¼Œæ‰æ˜¯æœ‰ç”¨å’Œåˆé€‚çš„å·¥å…·</li><li>ä¸è¦è¿‡äºæ²‰è¿·å·¥å…·çš„å¤æ‚æ€§ï¼Œè¿™ä¸–ä¸Šå§‹ç»ˆæœ‰å­¦ä¸å®Œçš„å·¥å…·</li></ul><p>è¿™ç¯‡åšå®¢å†™çš„æœ‰ç‚¹è¿‡äºé•¿äº†ã€‚å¦‚æœæœ‰å°ä¼™ä¼´åæ§½ â€”â€” è¿™å“ªé‡Œå¯èƒ½ 10åˆ†é’Ÿä¹‹å†…å­¦ä¼šï¼Ÿä½†è¿™çš„ç¡®æ˜¯é—¨æ§›ç‰¹åˆ«ä½çš„å›æµ‹å¼•æ“äº†ï¼šP<br>å¦‚æœå¯¹ä¸šåŠ¡å’Œæ¦‚å¿µè¿˜ä¸ç†Ÿæ‚‰ï¼Œæ¨èé˜…è¯»ã€Šæµ·é¾Ÿäº¤æ˜“æ³•åˆ™ã€‹å…¥é—¨ï¼ŒåŠ æ²¹å“¦~</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é‡åŒ–åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pandas+InterpretMLåˆ†æé«˜æ¢æ‰‹åçš„ä¸Šæ¶¨è¶‹åŠ¿å»¶ç»­æˆåŠŸç‡</title>
      <link href="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/"/>
      <url>/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å¼•è¨€">ä¸€ã€å¼•è¨€</h2><p>æœ€è¿‘æœ‰å°ä¼™ä¼´ç•™è¨€ï¼Œåœ¨é‡åŒ–ç­–ç•¥ç ”ç©¶ä¸­æœ‰ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ç°è±¡ï¼šéƒ¨åˆ†ç‰¹å¾æŒ‡æ ‡åœ¨æ•´ä½“ç»Ÿè®¡å±‚é¢è¡¨ç°å¹³å¹³ï¼Œä½†é€šè¿‡æ•°æ®åˆ†æ®µå¤„ç†åå¯å‘ˆç°æ˜¾è‘—æå‡çš„æœ‰æ•ˆæ€§åŒºé—´ã€‚<br>ä»Šå¤©æˆ‘ä»¬å°±ä»¥â€œé«˜æ¢æ‰‹ç‡â€ä¸ºåœºæ™¯æ¥çœ‹ä¸€ä¸‹ï¼š</p><ol><li>è¶‹åŠ¿å»¶ç»­æ€§ï¼šåœ¨ä¸Šæ¶¨çš„è¶‹åŠ¿ä¸­ï¼Œå¦‚æœå½“æ—¥å‡ºç°é«˜æ¢æ‰‹ç‡ï¼Œç¬¬äºŒå¤©ä¾ç„¶èƒ½ä¿æŒè¾ƒå¤§æ¶¨å¹…çš„è‚¡ç¥¨æ•°é‡æœ‰å¤šå°‘ï¼Ÿ</li><li>å¤åˆå› å­æœ‰æ•ˆæ€§ï¼šå½“æ—¥é™¤äº†é«˜æ¢æ‰‹ç‡ä¹‹å¤–ï¼Œè¿˜æœ‰å“ªäº›å…·æœ‰ååŒå¢å¼ºæ•ˆåº”çš„æŠ€æœ¯ç‰¹å¾ï¼Ÿä»è¿‘æœŸå†å²æ•°æ®æ¥çœ‹ï¼Œè¿™äº›ç‰¹å¾çš„é˜ˆå€¼æ˜¯å¤šå°‘ï¼Ÿ</li><li>å·¥å…·çš„ä½¿ç”¨ï¼šæ”¯æŒç‰¹å¾åˆ†æ®µåˆ†æçš„å·¥å…· â€”â€” Pandas.cut å’Œ InterpretML.</li></ol><p>ã€æ¦‚å¿µå˜æ¸…ã€‘ è‚¡ç¥¨æ¢æ‰‹ç‡ï¼ŒæŒ‡ç‰¹å®šå‘¨æœŸå†…æˆäº¤é‡å æµé€šè‚¡æœ¬çš„æ¯”ä¾‹ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>æ¢æ‰‹ç‡</mtext><mo>=</mo><mfrac><mtext>æˆäº¤é‡</mtext><mtext>æµé€šè‚¡æœ¬</mtext></mfrac><mo>Ã—</mo><mn>100</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">æ¢æ‰‹ç‡ =  \frac{æˆäº¤é‡}{æµé€šè‚¡æœ¬}  \times 100\% </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">æ¢æ‰‹ç‡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">æµé€šè‚¡æœ¬</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">æˆäº¤é‡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">100%</span></span></span></span></span></p><p>é«˜æ¢æ‰‹ç‡é€šå¸¸è¢«è§†ä¸ºå¸‚åœºæ´»è·ƒåº¦çš„æŒ‡æ ‡ï¼Œä½†å…¶èƒŒåçš„åŸå› å’Œå½±å“å› ç´ å¤æ‚å¤šæ ·ï¼Œå¯èƒ½ç”±å¤šç§å› ç´ å¼•èµ·ï¼Œå¦‚å¸‚åœºçƒ­ç‚¹ã€åˆ©å¥½æ¶ˆæ¯ã€ä¸»åŠ›èµ„é‡‘æ“ä½œç­‰ã€‚</p><div class="note info"><p>ã€æ–¹æ³•è®ºè­¦ç¤ºã€‘ å¿…é¡»æ˜ç¡®æŒ‡å‡ºï¼šæŠ€æœ¯åˆ†ææœ¬è´¨æ˜¯é€šè¿‡ç»Ÿè®¡è§„å¾‹æ­ç¤ºç‰¹å¾ç›¸å…³æ€§ï¼Œè€Œéå»ºç«‹å› æœæ¨è®ºã€‚<br>å½“æˆ‘ä»¬åšé‡åŒ–åˆ†ææ—¶ï¼Œåº”å§‹ç»ˆè°¨è®°ä»¥ä¸‹åŸåˆ™ï¼š</p><ol><li>æ•°æ®é©±åŠ¨ï¼šåŸºäºå†å²åˆ†å¸ƒè§„å¾‹æ„å»ºæ¦‚ç‡æ¨¡å‹ã€‚</li><li>é£é™©æç¤ºï¼šä»»ä½•ç»Ÿè®¡æ˜¾è‘—åŒºé—´å‡å­˜åœ¨å¤±æ•ˆæ¦‚ç‡ã€‚</li><li>åŠ¨æ€æ ¡éªŒï¼šå»ºç«‹å­£åº¦å‚æ•°æ ¡å‡†æœºåˆ¶åº”å¯¹å¸‚åœºé£æ ¼çš„åˆ‡æ¢ã€‚</li></ol></div><h2 id="äºŒã€æœ¬æ–‡æ•°æ®èŒƒå›´å®šä¹‰">äºŒã€æœ¬æ–‡æ•°æ®èŒƒå›´å®šä¹‰</h2><h3 id="1-é«˜æ¢æ‰‹ç‡">1. é«˜æ¢æ‰‹ç‡</h3><p>æ¢æ‰‹ç‡çš„å®šä¹‰æ˜¯ï¼š<code>æˆäº¤é‡(Volume) / æµé€šè‚¡æœ¬(float_share)</code>ã€‚<br>é‚£ä¹ˆï¼Œå¦‚ä½•å®šä¹‰è¿™ä¸ªæ¯”ä¾‹çš„é«˜ä½ï¼Ÿ</p><p>åœ¨æœ¬ç¯‡åšå®¢ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘æš‚æ—¶å°†<code>é«˜æ¢æ‰‹ç‡</code>çš„èŒƒå›´åœˆå®šä¸ºï¼š<br><strong>â€œ<br>æ¢æ‰‹ç‡(turnover_rate)æ¥è¿‘è¯¥è‚¡ç¥¨å†å²æœ€å¤§æ¢æ‰‹ç‡ï¼ˆhistory_max_turnover_rateï¼‰,<br>ä¸”è‡ªç”±æµé€šè‚¡æ¢æ‰‹ç‡(turnover_rate_f) å¤§äº20%ã€‚<br>â€</strong></p><p>å­—æ®µè§£é‡Šï¼š</p><ul><li>è‚¡æœ¬ï¼Œåˆ†ä¸ºæ€»è‚¡æœ¬(total_share)ã€æµé€šè‚¡æœ¬(float_share) å’Œ è‡ªç”±æµé€šè‚¡æœ¬ï¼ˆfree_shareï¼‰ã€‚<br>åœ¨æœ€æ–°æ›´æ–°çš„æ•°æ®é›†ï¼ˆdatasetï¼‰ä¸­ï¼Œè¿™ 3 ä¸ªå­—æ®µçš„æ•°æ®éƒ½ä¼šæä¾›ã€‚<br>æ‰€è°“â€è‡ªç”±æµé€šè‚¡æœ¬â€œï¼Œæ˜¯æŒ‡æ‰£é™¤äº†åå¤§æµé€šè‚¡ä¸œã€æŒè‚¡5%ä»¥ä¸Šç­‰ï¼ˆå‡æŒæ—¶å¿…é¡»å‘å…¬å‘Šï¼‰è‚¡æœ¬ä¹‹åï¼Œå‰©ä¸‹çš„éƒ¨åˆ†â€æµé€šè‚¡æœ¬â€œã€‚</li><li>è‡ªç”±æµé€šè‚¡æ¢æ‰‹ç‡ï¼ˆturnover_rate_fï¼‰ï¼Œå³ <code>volume / free_share</code>ï¼Œåœ¨æ•°æ®é›†ä¸­ä¹Ÿä¼šç›´æ¥æä¾› turnover_rate_f å€¼ã€‚</li></ul><h3 id="2-åˆ†ç±»æ ‡ç­¾">2. åˆ†ç±»æ ‡ç­¾</h3><p>å½“åœˆå®šäº†å†å²æ•°æ®ä¸­å‡ºç°â€é«˜æ¢æ‰‹ç‡â€œçš„è‚¡ç¥¨ä¹‹åï¼Œæˆ‘ä»¬å¯¹è¿™äº›è‚¡ç¥¨è¿›è¡Œæ‰“æ ‡åˆ†ç±»ï¼š<br><strong>â€œ<br>å‡ºç°é«˜æ¢æ‰‹çš„ç¬¬äºŒå¤© â€”â€” æ”¶ç›˜ä»·æ˜¯å¦æ¶¨å¹… 5% ä»¥ä¸Šï¼Ÿ<br>â€</strong></p><p>æ˜¯ï¼Œåˆ™æ ‡è®°ä¸ºæ­£ç±»ï¼ˆå€¼ä¸º1ï¼‰; å¦ï¼Œæ˜¯è´Ÿç±»ï¼ˆå€¼ä¸º0ï¼‰ã€‚<br>å³å¸¸è¯´çš„äºŒåˆ†ç±»ã€‚</p><div class="note info"><p>éœ€è¦æŸ¥çœ‹ä¸åŒå®šä¹‰èŒƒå›´çš„å°ä¼™ä¼´ï¼Œå¯ä»¥å…‹éš† <a href="https://huggingface.co/spaces/ellendan/a-share-demo/blob/main/a_share/ipynb/high_turnover_rate.ipynb">huggingFace Demo è„šæœ¬</a>ï¼Œåœ¨æœ¬åœ°ä¿®æ”¹æ¡ä»¶è¿è¡Œã€‚</p></div><p>ä¸‹é¢å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Pandas å’Œ InterpretML ç­‰å·¥å…·è¿›è¡Œæ•°æ®ç»Ÿè®¡å’Œç‰¹å¾åˆ†æã€‚<br>æƒ³å…ˆçœ‹ç»“è®ºçš„å°ä¼™ä¼´ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è·³åˆ°æœ€åä¸€ç« ã€‚</p><h2 id="ä¸‰ã€ä»£ç æ“ä½œ">ä¸‰ã€ä»£ç æ“ä½œ</h2><h3 id="1-HuggingFace-æ•°æ®é›†">1. HuggingFace æ•°æ®é›†</h3><p>è¿™æ¬¡ä¾ç„¶ä½¿ç”¨ <a href="https://huggingface.co/datasets/ellendan/a-share-21">HuggingFace dataset ellendan/a-share-21</a>ï¼Œå…·ä½“ä¸º<code>all-prices-with-values-250303.csv</code>æ–‡ä»¶ã€‚<br>250303 è¿™æ¬¡æ›´æ–°ï¼Œé™¤äº†ä»¥å‰çš„æ—¥çº¿ä»·æ ¼å­—æ®µå¤–ï¼Œå¢æ·»äº†ä»¥ä¸‹å…³é”®å­—æ®µï¼š</p><ul><li><code>total_share</code>ï¼Œæ€»è‚¡æœ¬ã€‚</li><li><code>float_share</code>ï¼Œ æµé€šè‚¡æœ¬ã€‚</li><li><code>free_share</code>ï¼Œè‡ªç”±æµé€šè‚¡æœ¬ã€‚</li><li><code>total_mv</code>ï¼Œæ€»å¸‚å€¼ï¼Œå•ä½ä¸‡å…ƒã€‚</li><li><code>circ_mv</code>ï¼Œæµé€šå¸‚å€¼ï¼Œå•ä½ä¸‡å…ƒã€‚</li><li><code>turnover_rate_f</code>ï¼Œè‡ªç”±æµé€šè‚¡æ¢æ‰‹ç‡ï¼Œå•ä½%ã€‚</li><li><code>exchange</code>ï¼Œäº¤æ˜“æ‰€ã€‚<code>SSE</code> æ˜¯ä¸Šäº¤æ‰€ï¼›<code>SZSE</code> æ˜¯æ·±äº¤æ‰€ã€‚</li><li><code>market</code>, å¸‚åœºç±»åˆ« ã€‚<code>ä¸»æ¿</code> / <code>åˆ›ä¸šæ¿</code> / <code>ç§‘åˆ›æ¿</code> / <code>CDR</code>ã€‚</li></ul><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">import pandas as pdfrom stock_pandas import StockDataFramepd.options.display.max_columns = None# éœ€è¦ä» HuggingFace dataset ä¸Šæ‰‹åŠ¨ä¸‹è½½çš„ csv æ–‡ä»¶æ”¾åœ¨æœ¬åœ°ã€‚æœ¬ä»£ç åº“çš„ dataset ç›®å½•å·²ç»åŠ å…¥äº†.gitignoreï¼Œä¸ä¼šå°†æ•°æ®é›†æäº¤åˆ°ä»£ç åº“ã€‚data_path = '../../dataset/all-prices-with-values-250303.csv'prices_df = pd.read_csv(data_path, index_col=['code', 'date'])prices_df.tail()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-æ•°æ®å¤„ç†">2. æ•°æ®å¤„ç†</h3><p>åœ¨è¿›è¡Œåˆ†æä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç‰¹å¾è¿›è¡Œå¤„ç†ã€‚<br>è¿™é‡Œè·Ÿä»¥å‰ä¸€æ ·ï¼Œä¸»è¦ä½¿ç”¨ Pandas å’Œ stock-pandas å·¥å…·æ¥å®Œæˆã€‚<br>è¯¦æƒ…è§æºä»£ç è„šæœ¬ï¼Œ<a href="https://huggingface.co/spaces/ellendan/a-share-demo/blob/main/a_share/ipynb/high_turnover_rate.ipynb">è„šæœ¬åœ°å€</a>ã€‚<br>ä»¥ä¸‹æ˜¯æ•°æ®å¤„ç†çš„ä»£ç ç‰‡æ®µæˆªå›¾ï¼š<br><img src="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/calculate-features.png" alt="æ•°æ®å¤„ç†"><br><strong>è¯´æ˜ï¼š</strong></p><ol><li>æ•°æ®é›†ä¸­åŒ…æ‹¬äº†ä¸Šäº¤æ‰€å’Œæ·±äº¤æ‰€æ‰€æœ‰çš„è‚¡ç¥¨ã€‚<br>å› æ­¤ï¼Œåœ¨å¤„ç†ç‰¹å¾æ—¶ï¼Œä¸€å®šè¦è®°å¾—æŒ‰è‚¡ç¥¨ä»£ç åˆ†ç»„è¿›è¡Œå¤„ç†ã€‚ä¸ç„¶ï¼Œåƒ expanding()ã€rolling()ã€diff() ç­‰è·¨è®°å½•è¡Œçš„å¤šè¡Œè¿ç®—ï¼Œä¼šç®—é”™ã€‚</li><li><code>(source_data_frame['is_st'] == 0) &amp; (source_data_frame['market'] == 'ä¸»æ¿')</code><ul><li>æ•°æ®é›†å·²ç»æ·»åŠ äº†<code>market</code>å­—æ®µï¼Œå¯ä»¥ç›´æ¥æ’é™¤æ‰ ST è‚¡ç¥¨ï¼ˆæ¶¨åœé™ä»· 5%ï¼‰å’Œéä¸»æ¿ï¼ˆæ¶¨åœé™ä»· 20%ï¼‰çš„è‚¡ç¥¨ã€‚</li></ul></li><li>å‡†å¤‡å¥½ç”¨æ¥è¿‡æ»¤è‚¡ç¥¨èŒƒå›´çš„æ¡ä»¶ç‰¹å¾ã€‚<br>è™½ç„¶è¿™äº›ç‰¹å¾ä¹Ÿå¯ä»¥ç”¨æ¥åšåˆ†æ®µåˆ†æï¼Œä½†éœ€è¦æ³¨æ„ â€”â€” åœ¨å®ƒè¢«ä½œä¸ºæ¡ä»¶ä¹‹åï¼Œåˆ†æ®µèŒƒå›´ä¼šç¼ºå¤±ä¸€éƒ¨åˆ†åŒºé—´ã€‚<ul><li><code>bullish</code>ï¼Œå½“æ—¥çƒ›çº¿å›¾æ˜¯å¦æ˜¯çº¢æŸ±ã€‚</li><li><code>pre_trend_up</code>ï¼Œæœ€è¿‘20æ—¥çš„è¶‹åŠ¿ï¼šæ˜¯å¦ä»·æ ¼ä¸Šæ¶¨10%ã€‚</li><li><code>high_limit_count</code>, æœ€è¿‘10æ—¥çš„æ¶¨åœæ¿æ•°é‡ã€‚</li><li><code>turnover_rate</code>, æ¢æ‰‹ç‡ã€‚</li><li><code>turnover_rate_f</code>ï¼Œè‡ªç”±æµé€šè‚¡æ¢æ‰‹ç‡ã€‚</li><li><code>history_max_turnover_rate</code>, å½“å¤©ä¹‹å‰(åŒ…æ‹¬å½“å¤©)å‡ºç°è¿‡çš„å†å²æœ€å¤§æ¢æ‰‹ç‡ã€‚</li><li><code>history_turnover_rate_f</code>ï¼Œå†å²æœ€å¤§æ¢æ‰‹ç‡é‚£å¤©çš„è‡ªç”±æµé€šè‚¡æ¢æ‰‹ç‡ã€‚</li><li><code>not_break_ceiling</code>ï¼Œå¼€ç›˜ä»·éæ¶¨åœä»·ï¼Œç”¨æ¥å»æ‰ç ´æ¿è‚¡çš„æç«¯æ•°æ®ã€‚</li></ul></li><li>åˆ†ç±»æ ‡ç­¾ï¼š<code>((stock_df['change:close'] &gt;= 0.05) * 1).shift(-1)</code>ï¼Œç¬¬äºŒå¤©æ”¶ç›˜æ—¶æ˜¯å¦è¾¾åˆ°æ¶¨å¹… 5% ä»¥ä¸Šã€‚</li><li>æƒ³è¦è¿›è¡Œåˆ†æ®µæŸ¥æ¢çš„ç‰¹å¾ã€‚<ul><li><code>circ_mv</code>ï¼Œæµé€šå¸‚å€¼ï¼Œæºæ•°æ®é›†å•ä½æ˜¯<code>ä¸‡å…ƒ</code>ï¼Œè¿™é‡Œæ¢ç®—æˆ<code>äº¿å…ƒ</code>ã€‚</li><li><code>turnover</code>, æˆäº¤é¢ï¼Œæºæ•°æ®é›†å•ä½æ˜¯<code>å…ƒ</code>ï¼Œè¿™é‡Œæ¢ç®—æˆ<code>äº¿å…ƒ</code>ã€‚</li><li><code>norm_quote_rate</code>ï¼Œå½’ä¸€åŒ–åçš„æ¶¨è·Œå¹…ã€‚<br>ç”±äºè‚¡ç¥¨ä»·æ ¼çš„å˜åŠ¨å¯¹åº”åˆ°æ¶¨è·Œå¹…æ—¶ï¼Œæ¶‰åŠåˆ°å°æ•°å››èˆäº”å…¥çš„é—®é¢˜ï¼Œå› æ­¤æ¶¨è·Œåœçš„å¹…åº¦å¹¶ä¸æ˜¯æ ‡å‡†çš„ Â± 10%ã€‚ä¸ºäº†é¿å…æ•°å€¼è¶…è¿‡ 10% çš„è¿™æ ·çš„å°åå·®ï¼Œè¿™é‡Œå°†ä»·æ ¼å¯¹ç…§åˆ°å„ä¸ªè‚¡ç¥¨æ¶¨è·Œåœä»·æ ¼åŒºé—´è¿›è¡Œæ•°å€¼å½’ä¸€åŒ–ï¼Œè®©æ¶¨è·Œå¹…æ§åˆ¶åœ¨ Â± 1 èŒƒå›´å†…ã€‚</li><li><code>dde_l</code>ï¼Œå¤§å•å‡€æˆäº¤é¢ï¼Œå•ä½å…ƒï¼ˆæ•°æ®æ¥æºåŒèŠ±é¡ºï¼‰ã€‚åŒ…æ‹¬ç‰¹å¤§å•+å¤§å•ï¼šå•ç¬”æˆäº¤é‡&gt;60000è‚¡ï¼Œæˆ–è€…å•ç¬”æˆäº¤é‡‘é¢&gt;30ä¸‡ã€‚</li><li><code>net_flow_rate</code>ï¼Œå¤§å•å‡€æµå…¥ç‡ï¼Œå•ä½ %ï¼ˆæ•°æ®æ¥æºåŒèŠ±é¡ºï¼‰ï¼Œ<code>dde_l / turnover</code>ã€‚</li></ul></li></ol><h3 id="3-æŒ‰æ¡ä»¶è¿›è¡Œæ•°æ®æ•´ä½“ç»Ÿè®¡">3. æŒ‰æ¡ä»¶è¿›è¡Œæ•°æ®æ•´ä½“ç»Ÿè®¡</h3><p>åˆ©ç”¨å‰é¢å‡†å¤‡å¥½çš„ condition éƒ¨åˆ†çš„ç‰¹å¾å­—æ®µï¼Œæˆ‘ä»¬å¯¹è‚¡ç¥¨æ•°æ®èŒƒå›´è¿›è¡Œç­›é€‰ã€‚<br>é™¤äº†<code>é«˜æ¢æ‰‹ç‡</code>æ¡ä»¶ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ·»åŠ â€è¿‘20æ—¥ä»·æ ¼è¶‹åŠ¿ä¸Šæ¶¨â€œã€â€å½“æ—¥æ”¶çº¢â€œã€â€éç ´æ¿â€œè¿™äº›é™å®šæ¡ä»¶ã€‚<br>æœ€åç»Ÿè®¡åœˆå®šçš„æ•°æ®ä¸­ï¼Œæ­£ç±»å æ€»æ•°é‡çš„æ¯”ç‡ã€‚<br>ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python"># æ¢æ‰‹ç‡æ¥è¿‘å†å²æœ€é«˜æ¢æ‰‹ç‡ï¼Œä¸”æ¢æ‰‹é‡å è‡ªç”±æµé€šç›˜çš„æ¯”ä¾‹ &gt;= 20%_high_turnover_rate_condition = (_post_df['turnover_rate'] &gt;=(_post_df['history_max_turnover_rate'] * 0.8)) &amp; (_post_df['turnover_rate_f'] &gt;= 20)_filtered_df = _post_df[(_post_df['pre_trend_up'] &gt; 0)                &amp; (_post_df['not_break_ceiling'] &gt; 0) # éç ´æ¿                &amp; (_post_df['bullish'] &gt; 0) # çœ‹æ¶¨                &amp; _high_turnover_rate_condition]print(f"æ»¡è¶³æ¡ä»¶çš„æ€»æ•°æ®é‡ï¼š{_filtered_df.shape[0]}")print(f"å…¶ä¸­è¾¾æˆç›®æ ‡çš„æ•°é‡ï¼š{_filtered_df[_filtered_df['target'] &gt; 0].shape[0]}")ratio = round(_filtered_df[_filtered_df['target'] &gt; 0].shape[0] / _filtered_df.shape[0], 2)print(f"å¹³å‡æˆåŠŸç‡ï¼š{ratio}, å³ {ratio*100}%")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œåæ˜¾ç¤ºï¼š</p><pre class="line-numbers language-Text" data-language="Text"><code class="language-Text">æ»¡è¶³æ¡ä»¶çš„æ€»æ•°æ®é‡ï¼š5130 å…¶ä¸­è¾¾æˆç›®æ ‡çš„æ•°é‡ï¼š1173 å¹³å‡æˆåŠŸç‡ï¼š0.23, å³ 23.0%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯ï¼ŒæŒ‰é€‰è‚¡æ¡ä»¶ç­›é€‰å‡ºäº† 5130 æ¬¡è‚¡ç¥¨æ•°é‡ï¼Œå…¶ä¸­è¾¾æˆç¬¬äºŒæ—¥æ¶¨å¹… &gt;= 5% çš„è‚¡ç¥¨ä¸€å…±æ˜¯ 1173 æ¬¡ï¼Œ** æ•´ä½“ç»Ÿè®¡çš„æˆåŠŸç‡æ˜¯ 23 %**ã€‚</p><h3 id="4-æ¢æŸ¥ç‰¹å¾å†…å„åˆ†æ®µçš„æ•°æ®åˆ†å¸ƒ">4. æ¢æŸ¥ç‰¹å¾å†…å„åˆ†æ®µçš„æ•°æ®åˆ†å¸ƒ</h3><h4 id="4-1-ä½¿ç”¨-pandas-cut-è¿›è¡Œåˆ†æ®µç»Ÿè®¡">4.1 ä½¿ç”¨ pandas cut è¿›è¡Œåˆ†æ®µç»Ÿè®¡</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬åªä½¿ç”¨ pandasï¼Œä¸ä½¿ç”¨å…¶ä»–å·¥å…·å¯¹ç‰¹å¾è¿›è¡Œåˆ†æ®µæŸ¥çœ‹ï¼Œå…³é”®å‡½æ•° pandas.cut (æœ‰éœ€è¦çš„ä¹Ÿå¯ä»¥è¯•è¯• pandas.qcut å‡½æ•°)ã€‚</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">import pandas as pdfeature_names = ['turnover_rate', 'turnover_rate_f', 'circ_mv', 'turnover', 'norm_quote_rate', 'dde_l', 'net_flow_rate', 'high_limit_count']_bin_filtered_df = _filtered_df.copy()results = []for feature in feature_names:    _bin_filtered_df[f'{feature}_bin'] = pd.cut(_bin_filtered_df[feature], bins=10, precision=0)    # ç»Ÿè®¡æ¯ä¸ªåˆ†æ®µçš„æ ·æœ¬æ•°å’Œæ­£ç±»å æ¯”    grouped = _bin_filtered_df.groupby(f'{feature}_bin', observed=True)['target'].agg(    total='count',    positive_rate=lambda x: round(x.mean(), 2),).reset_index()    grouped = grouped.dropna()    display(grouped)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¯´æ˜ï¼š</strong></p><ul><li><code>cut()</code>å‡½æ•°ï¼ŒæŒ‰ä¸€ç»´æ•°ç»„çš„ min ~ max å€¼åŒºé—´å°†æ•°ç»„åˆ†éš”æˆ <code>bins</code>å‚æ•°ï¼ˆè¿™é‡Œæ˜¯10ï¼‰ä¸ªåŒºé—´æ ¼å­ã€‚</li><li>æˆ‘ä»¬å°†éœ€è¦åˆ†æçš„æ‰€æœ‰è‚¡ç¥¨æ•°æ®ï¼ˆ5130æ¡ï¼‰ï¼Œæ”¾å…¥å„ä¸ªç‰¹å¾åˆ†æ®µåŒºé—´è¿›è¡Œæ•°é‡ç»Ÿè®¡<code>count</code>(æ€»æ•°)ã€<code>positive_rate</code>(æ­£ç±»çš„å æ¯”ï¼Œå› ä¸ºæ­£ç±»çš„å€¼ä¸º1ï¼Œè´Ÿç±»ä¸º0ï¼Œå› æ­¤æ±‚å¹³å‡å€¼mean()æ­£å¥½å°±æ˜¯å æ¯”å€¼)ã€‚</li></ul><p>è¿è¡Œç»“æœï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/cuts.png" alt="pandas cut()ç»“æœ"><br><strong>è¯´æ˜ï¼š</strong></p><ul><li>ä»ä»¥ä¸Š8ä¸ªç‰¹å¾çš„æ•°å€¼ç­‰åŒºé—´åˆ†æ®µç»Ÿè®¡æ¥çœ‹ï¼Œçš„ç¡®æœ‰ä¸€äº›ç‰¹å¾åŒºé—´çš„ positive_rate &gt; 0.23ï¼ˆæ•´ä½“æ•°æ®çš„æ­£ç±»å æ¯”ï¼‰ã€‚<br>å¯ä»¥å…³æ³¨ä¸€ä¸‹è¿™äº›åˆ†æ®µåŒºé—´ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„è¯¥åŒºé—´çš„<code>total</code>å€¼ï¼Œè¿‡å°çš„åŸºæ•°é€ æˆçš„ positive_rate çš„æå‡å¯èƒ½å…·æœ‰å¶ç„¶æ€§ã€‚æ’é™¤æ‰ä¸€äº›è¿‡å°æ•°æ®æƒé‡çš„åŒºé—´å¤–ï¼š<ul><li><code>turnover_rate_f &gt; 41%</code>åŒºé—´ï¼Œæ­£ç±»å æ¯”é«˜äºå¹³å‡å€¼ã€‚</li><li><code>norm_quote_rate &gt; 0.8</code>åŒºé—´ï¼Œæ­£ç±»å æ¯” 30%ã€‚</li><li><code>high_limit_count &gt; 2</code>åŒºé—´ï¼Œæ­£ç±»å æ¯”è‡³å°‘é«˜äº 27%ã€‚</li></ul></li><li>ä¸€äº›ç‰¹å¾åŒºé—´æ•°æ®è¿‡äºé›†ä¸­ï¼Œæ¯”å¦‚<code>circ_mv_bin</code>ç­‰äº<code>(3, 180)</code>è¿™ä¸ªåŒºé—´å æ®äº† 92% ä»¥ä¸Šçš„æ•°æ®ï¼Œåªæ˜¯ç­‰åŒºé—´çš„ cut() å¾ˆéš¾è§‚å¯Ÿåˆ°è¯¥ç‰¹å¾çš„ç»†èŠ‚ç‰¹æ€§ã€‚</li></ul><h4 id="4-2-ä½¿ç”¨-matplotlib-è¿›è¡Œäº¤å‰åˆ†æ®µåˆ†æ">4.2 ä½¿ç”¨ matplotlib è¿›è¡Œäº¤å‰åˆ†æ®µåˆ†æ</h4><p>Pandas cut åªèƒ½æŸ¥çœ‹åˆ°å•ä¸€ç‰¹å¾åˆ†æ®µçš„ç‰¹å¾åˆ†å¸ƒï¼Œå¦‚æœæƒ³è¦çœ‹äº¤å‰ç‰¹å¾ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿ<br>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆç”¨ matplotlib çƒ­åŠ›å›¾å¯¹ä¸€ç»„äº¤å‰ç‰¹æ€§è¿›è¡Œåˆ†æ®µå¯è§†åŒ– â€”â€” æ¢æ‰‹ç‡ï¼ˆæ¨ªè½´ï¼‰ + æµé€šå¸‚å€¼ï¼ˆçºµè½´ï¼‰ã€‚</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">import numpy as npimport matplotlib.pyplot as plt# è®¾ç½®å­—ä½“ï¼Œè®© matplotlib å›¾ç‰‡å¯ä»¥æ˜¾ç¤ºä¸­æ–‡plt.rcParams['font.sans-serif'] = ['Songti SC']plt.rcParams['axes.unicode_minus'] = Falsedef plot_heatmap_with_ratio(_df, vertical_step=20):â€¦â€¦â€¦â€¦ï¼ˆè§æºæ–‡ä»¶è„šæœ¬ï¼‰â€¦â€¦â€¦â€¦_circ_mv_segment_1 = _filtered_df[_filtered_df['circ_mv'] &lt; 300]_circ_mv_segment_2 = _filtered_df[_filtered_df['circ_mv'] &gt;= 300]plot_heatmap_with_ratio(_circ_mv_segment_1)plot_heatmap_with_ratio(_circ_mv_segment_2, vertical_step=300)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>é€šè¿‡å‰é¢ cut åˆ†æ®µå¯çŸ¥ï¼šcirc_mvï¼ˆæµé€šå¸‚å€¼ï¼‰æ•°å€¼èŒƒå›´è·¨åº¦å¤§ï¼Œä»3äº¿~1800äº¿ï¼ŒåŒæ—¶æ•°æ®ä¸»è¦é›†ä¸­åœ¨ç¬¬ä¸€ä¸ªåŒºé—´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°† circ_mv åˆ†æˆä¸¤ä¸ªå¤§çš„åŒºé—´å„ç»˜åˆ¶ä¸€å¥—çƒ­åŠ›å›¾ â€”â€” å°äº300äº¿å…ƒå’Œå¤§äº300äº¿å…ƒã€‚</li></ul><p>ç»˜å›¾ç»“æœï¼š<br><img src="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/interaction-1.png" alt="æµé€šå¸‚å€¼<300äº¿"><br><img src="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/interaction-2.png" alt="æµé€šå¸‚å€¼>=300äº¿"><br><strong>è¯´æ˜ï¼š</strong></p><ul><li>æ¯å¥—å›¾æœ‰ä¸‰å¼ å­å›¾ï¼šï¼ˆå·¦ï¼‰æ­£ç±»çš„æ•°æ®åˆ†å¸ƒï¼Œï¼ˆä¸­ï¼‰è´Ÿç±»çš„æ•°æ®åˆ†å¸ƒï¼Œï¼ˆå³ï¼‰æ­£ç±»å æ¯”ã€‚<br>ä¸å·¦å­å›¾ã€ä¸­å­å›¾ä¸åŒçš„ç‚¹ï¼šåœ¨ï¼ˆå³ï¼‰å­å›¾ä¸­ï¼Œæ²¡æœ‰æ•°æ®çš„æ …æ ¼æ˜¾ç¤ºâ€ç°è‰²â€œï¼Œåªæœ‰è´Ÿç±»çš„æ …æ ¼æ˜¾ç¤ºâ€è“è‰²â€œï¼Œå…¶ä»–æœ‰æ­£ç±»åˆ†å¸ƒçš„æ …æ ¼æ˜¾ç¤ºâ€çº¢è‰²â€œï¼Œæ•°æ®è¶Šå¤§ï¼Œé¢œè‰²è¶Šæ·±ã€‚</li><li>è™½ç„¶ä»å·¦å­å›¾å’Œä¸­å­å›¾ä¸­å‘ç°ï¼Œæ•°æ®é›†ä¸­åœ¨ï¼š20äº¿ &lt; circ_mv &lt; 100äº¿ å’Œ  10% &lt; turnover_rate &lt; 40% ä¹‹é—´ã€‚ä½†é€šè¿‡å³å­å›¾å‘ç°ï¼Œåœ¨è¿™ä¸ªåŒºé—´çš„æ­£ç±»å æ¯”å¹¶æ²¡æœ‰å¤ªæ˜¾è‘—çš„æå‡ã€‚</li></ul><h4 id="4-3-ä½¿ç”¨-InterpretML-å¯¹ç‰¹å¾è¿›è¡Œè§£é‡Šæ€§åˆ†æ">4.3 ä½¿ç”¨ InterpretML å¯¹ç‰¹å¾è¿›è¡Œè§£é‡Šæ€§åˆ†æ</h4><p>å¦‚æœæ¯ä¸ªå•ä¸€ç‰¹å¾å’Œäº¤å‰ç‰¹å¾ï¼Œéƒ½ä½¿ç”¨ä¸Šé¢ä¸¤ç§æ–¹å¼æ‰‹åŠ¨å¯è§†åŒ–ï¼Œæ•ˆç‡ä¼šéå¸¸çš„ä½ã€‚<br>å› æ­¤ï¼Œè¿™é‡Œå€ŸåŠ© InterpretML å¯¹å„ç‰¹å¾åˆ†æ®µè¿›è¡Œè§£é‡Šã€‚</p><blockquote><p>InterpretML æ˜¯å¾®è½¯å¼€æºçš„ä¸€æ¬¾ä¸“æ³¨äºæœºå™¨å­¦ä¹ æ¨¡å‹å¯è§£é‡Šæ€§çš„ Python å·¥å…·åº“ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·ç†è§£å’Œè§£é‡Šæ¨¡å‹çš„å†³ç­–é€»è¾‘ã€‚å®ƒæä¾›ä¸¤ç±»æ ¸å¿ƒåŠŸèƒ½ï¼š</p><ol><li><strong>æ¨¡å‹æ— å…³è§£é‡Š</strong>ï¼šæ”¯æŒå¯¹å„ç±»é»‘ç®±æ¨¡å‹ï¼ˆå¦‚ç¥ç»ç½‘ç»œã€é›†æˆæ¨¡å‹ï¼‰è¿›è¡Œå…¨å±€ç‰¹å¾é‡è¦æ€§åˆ†æï¼ˆå¦‚ SHAP æ–¹æ³•ï¼‰å’Œå±€éƒ¨é¢„æµ‹è§£é‡Šï¼ˆå¦‚ LIME æŠ€æœ¯ï¼‰ï¼Œæ­ç¤ºæ¨¡å‹æ•´ä½“è§„å¾‹åŠå•ä¸ªæ ·æœ¬çš„å†³ç­–ä¾æ®ï¼›</li><li><strong>æ˜ç®±æ¨¡å‹æ„å»º</strong>ï¼šå†…ç½®å¯è§£é‡Šçš„æ¨¡å‹ï¼ˆå¦‚å¯è§£é‡Šæå‡æœº EBMï¼‰ï¼Œåœ¨ä¿è¯é«˜ç²¾åº¦çš„åŒæ—¶ç›´æ¥è¾“å‡ºæ¸…æ™°çš„è§„åˆ™ï¼Œä¾‹å¦‚ç‰¹å¾åˆ†ç®±å¯¹ç»“æœçš„å½±å“ã€‚å…¶å¯è§†åŒ–å·¥å…·ç›´è§‚å±•ç¤ºåˆ†æç»“æœï¼Œé€‚ç”¨äºåŒ»ç–—ã€é‡‘èç­‰é«˜ä¿¡ä»»åº¦éœ€æ±‚åœºæ™¯ï¼ŒåŠ©åŠ›æ¨¡å‹è°ƒè¯•ã€åˆè§„å®¡æŸ¥åŠå†³ç­–é€æ˜åº¦æå‡ã€‚</li></ol></blockquote><p>ä¸‹é¢ä½¿ç”¨çš„å°±æ˜¯æ˜ç®±æ¨¡å‹ EBMï¼Œå¯¹æ•°æ®ç‰¹å¾è¿›è¡Œåˆ†æ®µè§„åˆ™è§£é‡Šã€‚<br>ä»£ç è°ƒç”¨éå¸¸ç®€å•ï¼š</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">from interpret.glassbox import ExplainableBoostingClassifierfrom sklearn.metrics import roc_auc_scorefrom interpret import showX, y = _filtered_df[feature_names].to_numpy(), _filtered_df['target'].to_numpy()ebm = ExplainableBoostingClassifier(feature_names)ebm.fit(X, y)# ä½¿ç”¨ ROC-AUC ç®€å•è¿›è¡Œè¯„ä¼°auc = roc_auc_score(y, ebm.predict_proba(X)[:, 1])print("AUC: {:.3f}".format(auc))ebm_global = ebm.explain_global()show(ebm_global)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>ä½¿ç”¨ ROC-AUC è¿›è¡Œç®€å•è¯„ä¼°ã€‚å¦‚æœè¯¥å€¼ &lt;= 0.5ï¼ŒåŸºæœ¬ç­‰äºéšæœºçŒœæµ‹ï¼Œæ¨¡å‹æ²¡å­¦åˆ°ä»»ä½•ä¸œè¥¿ã€‚ROC-AUC è¶Šå¤§è¶Šå¥½ï¼Œæœ€å¤§å€¼ä¸º 1ã€‚</li><li>è°ƒç”¨ interpret.show()å‡½æ•°ä¼šåœ¨ Jupyter Notebook ä¸Šè‡ªåŠ¨ç»˜åˆ¶å‡ºå¯äº¤äº’çš„å¯è§†åŒ–å›¾è¡¨ã€‚</li></ul><p><strong>æ€»ä½“ç»“æœ:</strong><br><img src="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/interpert-summary.png" alt="å„ç‰¹å¾é’ˆå¯¹æ•´ä½“æ•°æ®çš„åŠ æƒå¹³å‡åˆ†æ’è¡Œ"><br><strong>è¯´æ˜ï¼š</strong></p><ul><li>ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å…¨å±€æ ·æœ¬æ•°æ®çš„åŠ æƒå¹³å‡çš„æƒ…å†µä¸‹ï¼Œè´¡çŒ®åº¦æœ€é«˜çš„ï¼ˆå¯¹æ­£ç¡®åˆ¤å®šäºŒåˆ†ç±»çš„è´¡çŒ®ï¼Œä¹Ÿå«ç‰¹å¾é‡è¦æ€§ï¼‰ï¼Œæ˜¯å•ä¸€ç‰¹å¾çš„<code>norm_quote_rate</code>å’Œ<code>high_limit_count</code>ã€‚</li><li>å›¾ä¸Šæ˜¾ç¤ºä¸¤ç‰¹å¾äº¤å‰ï¼Œå…¨å±€è¯„åˆ†æœ€é«˜çš„æ˜¯ <code>circ_mv</code>å’Œ <code>norm_quote_rate</code> çš„äº¤å‰ï¼Œå…·ä½“çš„å±€éƒ¨åˆ†ç®±è´¡çŒ®ï¼Œéœ€è¦é€‰è¿›å»çœ‹ interaction å›¾ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒExplainableBoostingClassifier æ¨¡å‹æœ€å¤šåªè¿›è¡Œä¸¤ä¸ªç‰¹å¾çš„äº¤å‰ï¼Œå¦‚æœæœŸæœ›ä¸‰ä¸ªç‰¹å¾ä»¥ä¸Šçš„äº¤å‰ï¼Œéœ€è¦ä»£ç æ˜¾å¼æŒ‡å®šã€‚</li><li>é»˜è®¤æ˜¾ç¤ºé‡è¦æ€§å‰ 90% æ’åçš„ç‰¹å¾ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹çš„ç‰¹å¾æ²¡æœ‰æ˜¾ç¤ºåœ¨ Summary ç›´æ–¹å›¾å†…ï¼Œåˆ™è¯´æ˜è¯¥ç‰¹å¾çš„é‡è¦æ€§è¯„åˆ†æ¯”æœ€åä¸€åè¿˜è¦ä½ã€‚</li></ul><p><strong>åˆ†æ®µï¼ˆåˆ†ç®±ï¼‰ç»“æœï¼š</strong><br><img src="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/norm-quote-rate.png" alt="norm_quote_rate åˆ†æ®µçš„è´¡çŒ®åº¦"><br><strong>è¯´æ˜ï¼š</strong></p><ul><li>ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®å¤§å¤šé›†ä¸­åœ¨ <code>norm_quote_rate &gt; 0.9</code>è¿™ä¸ªåŒºé—´ï¼Œä½† 0.9 ~ 1.0 è¿™ä¸ªåŒºé—´çš„åå·®ç‰¹åˆ«å¤§ã€‚</li><li>åªæœ‰å½“ norm_quote_rate == 1.0 æ—¶ï¼Œå¯¹äºæ­£ç±»çš„é¢„æµ‹æ‰æœ‰è¾ƒå¤§çš„è´¡çŒ®åº¦ã€‚</li><li>0.9 &lt; norm_quote_rate &lt; 0.98 è¿™ä¸ªåŒºé—´ï¼Œscore æ¥è¿‘äº0ï¼Œå¯¹äºåˆ†ç±»é¢„æµ‹å‡ ä¹æ²¡æœ‰è´¡çŒ®ã€‚</li><li>0.98 &lt;  norm_quote_rate &lt; 1.0 è¿™ä¸ªåŒºé—´ï¼Œscore å°äº0ï¼Œå¯¹äºè´Ÿç±»çš„é¢„æµ‹æœ‰ä¸€å®šä½œç”¨ã€‚<br>ä¸ªäººçœ‹æ³•ï¼ŒçŒœæƒ³èƒŒåçš„é€»è¾‘çš„ â€”â€” é«˜æ¢æ‰‹çš„æƒ…å†µä¸‹ï¼Œæ¶¨åœä¼šå¤§æ¦‚ç‡æå‡ç¬¬äºŒå¤©ç»§ç»­å¤§å¹…ä¸Šæ¶¨çš„ä¿¡å¿ƒï¼Œè€Œå°æ¿å¤±è´¥ï¼Œä¼šé™ä½ç¬¬äºŒå¤©ç»§ç»­å¤§å¹…ä¸Šæ¶¨çš„å‡ ç‡ã€‚</li></ul><p><img src="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/high_limit_count.png" alt="high_limit_count åˆ†æ®µçš„è´¡çŒ®åº¦"><br><strong>è¯´æ˜ï¼š</strong></p><ul><li>åœ¨ high_limit_count &gt;=3 ä¹‹åçš„åŒºé—´ï¼Œéšç€æ¶¨åœæ¿æ•°é‡çš„å¢åŠ ï¼Œé€æ¸å¢å¤§æ­£ç±»åˆ¤å®šçš„æ¦‚ç‡ã€‚</li><li>åœ¨ high_limit_count &lt; 3 çš„åŒºé—´ï¼ŒåŸºæœ¬åªä¼šåŠ å¤§è´Ÿç±»çš„åˆ¤å®šæ¦‚ç‡ã€‚</li><li>å› æ­¤ï¼Œå½“ä¸€åªè‚¡ç¥¨<code>è¿‘10æ—¥æ¶¨åœæ¿çš„æ•°é‡å¤§äº3</code>çš„æ­£ç±»æ¦‚ç‡å¤§äºå¦ä¸€åªè‚¡ç¥¨<code>è¿‘åæ—¥æ¶¨åœæ¿çš„æ•°é‡å°äº3</code>ä¸ºæ­£ç±»çš„æ¦‚ç‡ã€‚</li></ul><p><img src="/2025/03/10/shi-yong-pandas-interpretml-dui-gao-huan-shou-de-gu-piao-jin-xing-te-zheng-fen-duan-fen-xi/turnover_rate&amp;high_limit_count.png" alt="turnover_rate &amp; high_limit_count äº¤å‰ç‰¹å¾"><br><strong>è¯´æ˜ï¼š</strong></p><ul><li>åŒç‰¹å¾äº¤å‰ï¼Œå¯è§†åŒ–å›¾è¡¨å°±æ˜¯çƒ­åŠ›å›¾ã€‚Z è½´å€¼ä¸º Scoreï¼Œé€šè¿‡é«˜äº®åº¦çš„çƒ­åŠ›å—å¯è§‚å¯Ÿåˆ°è´¡çŒ®åº¦é«˜çš„åŒºåŸŸã€‚æ¯”å¦‚ï¼Œä¸Šå›¾ä¸­å·¦ä¸Šè§’è“è‰²æ¡†çš„åŒºåŸŸï¼Œå¯¹æ­£ç±»çš„åˆ¤å®šè´¡çŒ®åº¦å¾ˆé«˜ã€‚</li><li>ç‰¹å¾äº¤å‰é¡µé¢ä¸ä¼šæ˜¾ç¤ºå„ç‰¹å¾çš„æ ·æœ¬æ•°æ®æƒé‡ã€‚æŸ¥çœ‹æ ·æœ¬æ•°é‡åˆ†å¸ƒï¼Œè¿˜æ˜¯éœ€è¦å»å•ç‰¹å¾å±€éƒ¨å›¾æŸ¥çœ‹ã€‚</li></ul><div class="note info"><p>è¿™é‡Œåªç®€å•åˆ—ä¸¾äº†3ä¸ªå±€éƒ¨å±•å¼€å›¾ï¼Œæƒ³è¦çœ‹åˆ°æ‰€æœ‰ç‰¹å¾åˆ†æ®µè´¡çŒ®è¡¨ç°çš„ï¼Œå¯ clone è„šæœ¬åˆ°æœ¬åœ°è‡ªè¡Œè¿è¡Œã€‚</p></div><h3 id="5-æ·»åŠ æ¶¨åœä½œä¸ºé€‰è‚¡æ¡ä»¶è¿›è¡ŒéªŒè¯">5. æ·»åŠ æ¶¨åœä½œä¸ºé€‰è‚¡æ¡ä»¶è¿›è¡ŒéªŒè¯</h3><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">_checked_filtered_df = _post_df[(_post_df['pre_trend_up'] &gt; 0)    &amp; (_post_df['not_break_ceiling'] &gt; 0)    &amp; (_post_df['bullish'] &gt; 0)    &amp; (_post_df['norm_quote_rate'] &gt;= 0.9) # æ·»åŠ æ¡ä»¶    &amp; (_post_df['high_limit_count'] &gt;= 3) # æ·»åŠ æ¡ä»¶    &amp; _high_turnover_rate_condition]print(f"æ»¡è¶³æ¡ä»¶çš„æ€»æ•°æ®é‡ï¼š{_checked_filtered_df.shape[0]}")print(f"å…¶ä¸­è¾¾æˆç›®æ ‡çš„æ•°é‡ï¼š{_checked_filtered_df[_checked_filtered_df['target'] &gt; 0].shape[0]}")ratio = round(_checked_filtered_df[_checked_filtered_df['target'] &gt; 0].shape[0] / _checked_filtered_df.shape[0], 2)print(f"å¹³å‡æˆåŠŸç‡ï¼š{ratio}, å³ {format(ratio * 100, '.2f')}%")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å°ç»“æœï¼š</p><pre class="line-numbers language-Text" data-language="Text"><code class="language-Text">æ»¡è¶³æ¡ä»¶çš„æ€»æ•°æ®é‡ï¼š1283 å…¶ä¸­è¾¾æˆç›®æ ‡çš„æ•°é‡ï¼š456 å¹³å‡æˆåŠŸç‡ï¼š0.36, å³ 36.00%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„ï¼š</strong><br>è™½ç„¶ç†è®ºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¡ä»¶æé«˜åˆ°<code>high_limit_count &gt;= 9</code>ï¼Œè¿™æ—¶æ­£ç¡®ç‡ä¼šä» 23% æå‡åˆ°äº† 56%ï¼Œä½†â€10å¤©å†…æ¶¨åœæ¿9æ¬¡ä»¥ä¸Šâ€æœ¬èº«å°±æ˜¯ä¸€æ¡éå¸¸æç«¯æ¦‚ç‡çš„æƒ…å†µï¼Œè¿‘ 400 ä¸ªäº¤æ˜“æ—¥ä¹Ÿä»…æœ‰ 27 æ¡è‚¡ç¥¨æ•°æ®æ»¡è¶³æ¡ä»¶ã€‚å› æ­¤ï¼Œç¼ºå°‘æ•°æ®å»éªŒè¯ â€”â€” è¿™ä¸ªæ•ˆæœæœ€å¥½çš„ç‰¹å¾é˜ˆå€¼æ˜¯å¶ç„¶çš„ï¼Œè¿˜æ˜¯å¿…ç„¶çš„ï¼Ÿ<br>å°±åƒæˆ‘ä»¬å¦‚æœä½¿ç”¨ <code>high_limit_count &gt; 9</code> ä¸” <code>10 &lt; turnover_rate &lt; 15</code> ä½œä¸ºæ·»åŠ æ¡ä»¶çš„è¯ï¼ˆä¸Šé¢ turnover_rate &amp; high_limit_count å›¾ä¸­è“è‰²æ¡†ä¸­é«˜äº®çš„éƒ¨åˆ†ï¼‰ï¼ŒæˆåŠŸç‡å¯ä»¥è¾¾åˆ° 100%ï¼Œä½†æ•°æ®æ ·æœ¬å´åªæœ‰2æ¡ã€‚<br>æ‰€ä»¥ï¼Œä¸€äº›å°æ ·æœ¬åŒºé—´çš„æ•°æ®æ¨è®ºï¼Œèƒ½å¦ç‹¬ç«‹åœ°æ‹¿æ¥é¢„æµ‹æœªæ¥æ•°æ®ï¼Œåªèƒ½å„äººè§ä»è§æ™ºäº†ã€‚</p><h2 id="å››ã€ç»“è®º">å››ã€ç»“è®º</h2><ul><li><strong>ä¸šåŠ¡åœºæ™¯æ–¹é¢ï¼š</strong><ol><li>ä»è¿‘æœŸ400ä¸ªäº¤æ˜“æ—¥æ•°æ®æ¥çœ‹ï¼Œä¸Šå‡è¶‹åŠ¿ä¸­å‡ºç°é«˜æ¢æ‰‹ç‡çš„è‚¡ç¥¨æœ‰ 5130 æ¬¡ï¼Œå…¶ä¸­ç¬¬äºŒæ—¥ç»§ç»­å¢é•¿ 5% ä»¥ä¸Šçš„æœ‰ 1173 æ¬¡ï¼Œ<strong>æ•´ä½“ç»Ÿè®¡çš„å æ¯”æ˜¯ 23%</strong>ã€‚</li><li>é«˜æ¢æ‰‹ç‡å½“æ—¥ï¼Œå¦‚æœå¢åŠ <code>å½“æ—¥æ”¶ç›˜æ¶¨åœ</code>ã€<code>è¿‘10æ—¥æœ‰æ¶¨åœæ¿3æ¬¡ä»¥ä¸Šçš„</code>è¿™ä¸¤ä¸ªç‰¹å¾åŒºé—´æ¡ä»¶ï¼Œå¯ä»¥æå‡ç¬¬äºŒæ—¥æ¶¨å¹… 5% ä»¥ä¸Šçš„åˆ¤å®šæ¦‚ç‡ã€‚<strong>å æ¯”æœ€å°‘æå‡åˆ° 36%ã€‚</strong></li></ol></li><li><strong>ç‰¹å¾åˆ†æ®µæŠ€æœ¯ï¼š</strong> ç®€å•çš„åˆ†æ®µå¯ä»¥ä½¿ç”¨ Pandas å’Œ Matplotlibï¼Œæƒ³è¦å…¨å±€åˆ†æ®µè§£é‡Šåˆ™æ›´å»ºè®®ä½¿ç”¨ InterpretML è¿™æ ·çš„å·¥å…·ã€‚</li></ul><p><strong>æ³¨æ„ï¼šä»¥ä¸Šä¸šåŠ¡ç»“è®ºéƒ½åŸºäºæ–‡ç« å¼€å¤´çš„æ•°æ®èŒƒå›´å®šä¹‰ï¼Œæƒ³è¦æ¢ç´¢ä¸åŒå®šä¹‰æ¡ä»¶çš„å°ä¼™ä¼´ï¼Œè¯·åŠ¨æ‰‹å…‹éš†ä»£ç åº“ï¼Œæœ¬åœ°ä¿®æ”¹è¿è¡ŒåæŸ¥çœ‹ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Pandas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é‡åŒ–åˆ†æ </tag>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Python stock-pandasåº“è¿›è¡ŒMACD/KDJåŒå› å­çš„æµ‹ç®—</title>
      <link href="/2025/02/11/shi-yong-python-stock-pandas-ku-jin-xing-macd-kdj-shuang-yin-zi-de-ce-suan/"/>
      <url>/2025/02/11/shi-yong-python-stock-pandas-ku-jin-xing-macd-kdj-shuang-yin-zi-de-ce-suan/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨è¿‡è‚¡ç¥¨ç†è´¢ App çš„å°ä¼™ä¼´ä»¬éƒ½ä¼šå‘ç°ï¼Œåœ¨å¸‚åœºè¡Œæƒ…è¶‹åŠ¿å›¾ä¸­ä¼šå……æ–¥ç€å¤§é‡çš„æŠ€æœ¯æŒ‡æ ‡å€¼ï¼Œæ¯”å¦‚ MAã€MACDã€KDJ ç­‰ç­‰ï¼Œè€Œæˆ‘ä¹‹å‰çš„ Pandas å®è·µä¸­ä½¿ç”¨çš„æ•°æ®éƒ½æ˜¯æ—¥çº¿åŸå§‹æ•°æ®ã€‚<br>é‚£ä¹ˆï¼Œå¦‚ä½•è·å¾—æ¯æ—¥çš„æŠ€æœ¯æŒ‡æ ‡å‘¢ï¼Ÿéå¸¸ç®€å•ï¼Œä»æ—¥çº¿åŸå§‹æ•°æ®è¿›è¡Œè®¡ç®—ã€‚</p><p>ç®€å•ä¸€ç‚¹çš„ MA æŒ‡æ ‡ï¼Œ æ¯”å¦‚<code>MA3</code>ï¼šè¿‘3å¤©â€œæ”¶ç›˜ä»·â€çš„ç®€å•å¹³å‡æ•°ï¼Œ<code>MA5</code> è¿‘5å¤©ï¼Œ<code>MA10</code> è¿‘åå¤©ï¼Œä»¥æ­¤ç±»æ¨ã€‚  ä½¿ç”¨ Pandasï¼Œå¯ä»¥å¾ˆç®€å•åœ°ä¸€è¡Œä»£ç  <code>df['close'].rolling(5).mean()</code> å¿«é€Ÿå®ç°ã€‚<br>ä½†æŠ€æœ¯æŒ‡æ ‡ä¼—å¤šï¼Œä¹Ÿæœ‰ä¸å°‘å¦‚ MACD è¿™æ ·ç¨å«Œå¤æ‚çš„æŒ‡æ ‡ï¼Œè‹¥æ˜¯é è‡ªå·±æ…¢æ…¢å†™ä»£ç ã€é€ è½®å­ï¼Œå°±æœ‰äº›å¤šä½™äº†ã€‚</p><p>Python ä¸­æœ‰ä¸€äº›è‚¡ç¥¨æŒ‡æ ‡çš„å¼€æºåº“ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ TA-Libã€stock-pandas ç­‰ã€‚</p><ul><li><a href="https://ta-lib.org/">TA-Lib</a>ï¼ŒçŸ¥åå¼€æºåº“ï¼Œæä¾› 200 å¤šä¸ªä¸“ä¸šé‡‘èæŠ€æœ¯æŒ‡æ ‡çš„è®¡ç®—ã€‚</li><li><a href="https://github.com/kaelzhang/stock-pandas">stock-pandas</a>ï¼Œæ•°æ®ç»“æ„æ˜¯å¯¹ Pandas DataFrame çš„ç»§æ‰¿å’Œæ‰©å±•ï¼Œå¯ä»¥ä½¿ç”¨ç®€æ˜“çš„æŒ‡ä»¤è¡¨è¾¾å¼å¿«é€Ÿç”ŸæˆæŒ‡æ ‡å’ŒæŠ€æœ¯åˆ†æã€‚</li></ul><p>æœ¬æ–‡ä½¿ç”¨çš„å°±æ˜¯ stock-pandas åº“ï¼Œå½“ä¸éœ€è¦ä½¿ç”¨ TA-lib 200å¤šä¸ªä¼—å¤šæŒ‡æ ‡æ—¶ï¼Œstock-pandas çš„ç¼–ç é£æ ¼å’ŒæŒ‡ä»¤è¡¨è¾¾å¼ä¼šæ›´å— Pandas ä½¿ç”¨è€…çš„é’çã€‚</p><div class="note info"><p>æœ¬æ–‡æˆ‘ä»¥æœ€å¸¸è§çš„ MACDã€KDJ åŒæŒ‡æ ‡ä¸ºä¾‹å­ï¼Œä½¿ç”¨ Pandas åˆ†æåœ¨è¿‘æœŸæ•°æ®ä¸­ MACD + KDJ åŒé‡‘å‰ç­–ç•¥çš„å‡†ç¡®åº¦ã€‚<br>Pandas ä»£ç åœ°å€ä¾ç„¶æ˜¯åœ¨ HuggingFace ä¸Šçš„ a-share-demo åº“ä¸­<a href="https://huggingface.co/spaces/ellendan/a-share-demo/blob/main/a_share/ipynb/MACD_KDJ.ipynb">è„šæœ¬åœ°å€</a>ã€‚<br>ä»¥ä¸‹æ˜¯ä»£ç å®ç°æ­¥éª¤ã€‚</p></div><h3 id="1-é¢„å‡†å¤‡">1.  é¢„å‡†å¤‡</h3><h4 id="1-1-å®‰è£…-Python-ä¾èµ–åº“">1.1 å®‰è£… Python ä¾èµ–åº“</h4><p>æœ¬æ¬¡ä¾èµ–çš„åº“ï¼š</p><ul><li>pandas</li><li>numpy</li><li>jupyter</li><li>stock-pandas</li></ul><h4 id="1-2-ä¸‹è½½æ•°æ®é›†">1.2 ä¸‹è½½æ•°æ®é›†</h4><p>è¿™æ¬¡ä½¿ç”¨çš„è¿˜æ˜¯ HuggingFaceä¸Šçš„ Aè‚¡æ—¥çº¿æ•°æ®é›† <a href="https://huggingface.co/datasets/ellendan/a-share-21">ellendan/a-share-21</a>ï¼Œè¯·æ‰‹åŠ¨ä¸‹è½½ csv æ–‡ä»¶ï¼Œä¿å­˜åˆ° demo project çš„ <code>dataset</code> æ–‡ä»¶å¤¹ä¸‹ã€‚</p><div class="note warning"><p>æœ¬æ–‡å‘å‡ºæ—¶ï¼Œä¿®æ­£äº†ä¸Šæ¬¡ä¸€äº› na æ— ç”¨æ•°æ®é—®é¢˜ï¼Œå·²ç»ä¸‹è½½äº†è¯¥æ•°æ®é›†çš„å°ä¼™ä¼´ï¼Œå¦‚æœè‡ªå®šä¹‰ç¼–ç¨‹æ—¶ï¼Œç¢°åˆ° na é—®é¢˜ï¼Œå¯ä»¥ï¼š</p><ul><li>å¯ä»¥æ— éœ€é‡æ–°ä¸‹è½½ï¼Œè‡ªå·±ä½¿ç”¨ä»£ç é¢„å¤„ç† <code>source_data_frame = source_data_frame.dropna(subset=['close'])</code>ã€‚</li><li>æˆ–è€…ï¼Œé‡æ–°ä¸‹è½½ã€‚</li></ul></div><p><img src="/2025/02/11/shi-yong-python-stock-pandas-ku-jin-xing-macd-kdj-shuang-yin-zi-de-ce-suan/dataset.png" alt="ä¸‹è½½ dataset csv æ–‡ä»¶"></p><h3 id="2-åŠ è½½æ•°æ®æº">2. åŠ è½½æ•°æ®æº</h3><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">from stock_pandas import StockDataFrameimport pandas as pdpd.options.display.max_columns = None# éœ€è¦ä» HuggingFace dataset ä¸Šæ‰‹åŠ¨ä¸‹è½½çš„ csv æ–‡ä»¶æ”¾åœ¨æœ¬åœ°ã€‚æœ¬ä»£ç åº“çš„ dataset ç›®å½•å·²ç»åŠ å…¥äº†.gitignoreï¼Œä¸ä¼šå°†æ•°æ®é›†æäº¤åˆ°ä»£ç åº“ã€‚data_path = '../../dataset/all-prices-with-values-250127.csv'prices_df = pd.read_csv(data_path, index_col=(0,1))prices_df.tail()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-è®¡ç®—-MACDåˆ—ã€KDJ-åˆ—å’Œæœªæ¥5æ—¥æ¶¨å¹…åˆ—">3. è®¡ç®— MACDåˆ—ã€KDJ åˆ—å’Œæœªæ¥5æ—¥æ¶¨å¹…åˆ—</h3><p>è®¡ç®— 3 ä¸ªå…³é”®åˆ—ï¼š</p><ul><li><code>macd.g.fork</code>ï¼Œmacd é‡‘å‰ã€‚</li><li><code>kdj.g.fork</code>ï¼Œkdj é‡‘å‰ã€‚</li><li><code>target</code>ï¼Œä»¥å½“æ—¥æ”¶ç›˜ä»·ä¸ºåŸºå‡†ï¼Œè®¡ç®—æœªæ¥ç¬¬5ä¸ªäº¤æ˜“æ—¥çš„æ”¶ç›˜ä»·çš„æ¶¨å¹…æ˜¯å¦è¶…è¿‡10%ã€‚</li></ul><p>æµ‹ç®—çš„æœ€ç»ˆç›®æ ‡ï¼Œå¯ä»¥ç†è§£ä¸ºä»¥åŒé‡‘å‰ä¸ºä¹°å…¥ä¿¡å·ï¼Œé¢„æµ‹æŒè‚¡5æ—¥åçš„æ¶¨å¹…æ˜¯å¦è¶…è¿‡10%ã€‚</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">def cacluate_indicators_and_target(source_data_frame, last_n_days=400):    source_data_frame = source_data_frame.iloc[-(last_n_days+26):]    stock_df = StockDataFrame(source_data_frame)        predict_days = 5    target = ((stock_df[f'change:close,{predict_days + 1}'] &gt; 0.1) * 1).shift(-predict_days)    df = pd.DataFrame({        'close': stock_df['column:close'],        'bullish': stock_df['style:bullish'] * 1,        'macd.dif': stock_df['macd.dif'],        'macd.dea': stock_df['macd.dea'],        'macd.h': stock_df['macd.h'],        'kdj.k': stock_df['kdj.k'],        'kdj.d': stock_df['kdj.d'],        'macd.g.fork': (stock_df['macd.dif / macd.dea'] &amp; stock_df['macd.dea &gt;= 0']) * 1,        'kdj.g.fork': (stock_df['kdj.k / kdj.d'] &amp; stock_df['kdj.k &lt; 40']) * 1,        'target': target,        }, index=source_data_frame.index)    df.dropna(inplace=True)    return df_indicators_df = prices_df.groupby(level=0, group_keys=False).apply(    lambda x: cacluate_indicators_and_target(x, 400), include_groups=False)_indicators_df.head()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä»£ç ä¸­ä¸»è¦ä½¿ç”¨äº† stock-pandas çš„å‡ ä¸ªæŒ‡ä»¤è¡¨è¾¾å¼ï¼š</strong></p><ul><li><code>column:close</code>ï¼Œè·å– StockDataFrame ä¸­ä¼ å…¥çš„åŸå§‹å­—æ®µåˆ—<code>close</code>(æ”¶ç›˜ä»·)ã€‚å–å‡ºæ”¶ç›˜ä»·ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç”¨äºéªŒè¯å’Œæ¯”å¯¹è®¡ç®—æ•°æ®ã€‚</li><li><code>change:&lt;on&gt;, &lt;period&gt;</code>ï¼Œè®¡ç®— StockDataFrameä¸­æŸåˆ—çš„å€¼çš„å˜åŒ–ç‡ã€‚</li><li><code>style:bullish</code>ï¼Œè®¡ç®—å½“å¤©æ˜¯å¦æ˜¯æ¶¨ï¼ˆçº¢è‰²èœ¡çƒ›ï¼‰ã€‚</li><li><code>macd.*</code>ï¼Œè®¡ç®— macd ç³»åˆ—æŒ‡æ ‡ï¼Œå¦‚ <code>dif</code>(å¿«çº¿)ã€<code>dea</code>ï¼ˆæ…¢çº¿ï¼‰ã€<code>h</code>ï¼ˆçº¢ç»¿æŸ±ï¼‰ã€‚</li><li><code>kdj.*</code>ï¼Œè®¡ç®— kdj ç³»åˆ—æŒ‡æ ‡ï¼Œå¦‚ <code>k</code>ã€<code>d</code>ã€‚</li><li><code>/</code>ï¼Œç‰¹æ®Šæ“ä½œç¬¦ â€œä¸Šç©¿â€ï¼Œæ¯”å¦‚ macd é‡‘å‰ï¼Œå°±æ˜¯ <code>macd.dif / macd.dea</code>ï¼ˆå¿«çº¿ä»å·¦å¾€å³ä¸Šç©¿æ…¢çº¿ï¼‰ã€‚<br>åŒç†è¿˜æœ‰ï¼Œ<code>\</code>ï¼Œâ€œä¸‹ç©¿â€ã€‚</li><li><code>&gt;=</code>ã€<code>&gt;</code>ã€<code>&gt;&lt;</code>ã€<code>==</code>ã€<code>&lt;=</code>ã€<code>&lt;</code>ï¼Œå€¼æ¯”è¾ƒæ“ä½œç¬¦ã€‚<br>æ›´å¤šè¯´æ˜è§ (stock-pandasæ–‡æ¡£ README)[<a href="https://github.com/kaelzhang/stock-pandas">https://github.com/kaelzhang/stock-pandas</a>]ã€‚</li></ul><p><strong>ä»£ç ä¸­ä½¿ç”¨äº†é‡‘å‰çš„åˆ¤æ–­æ¡ä»¶ä¸ºï¼š</strong></p><ul><li>MACD é‡‘å‰(macd.g.fork)ï¼š<code>stock_df['macd.dif / macd.dea'] &amp; stock_df['macd.dea &gt;= 0']</code><ul><li><code>stock_df['macd.dif / macd.dea']</code>ï¼Œmacd çš„ diff çº¿æ˜¯å¦ä¸Šç©¿ dea çº¿ã€‚</li><li><code>stock_df['macd.dea &gt;= 0']</code>ï¼Œdea å€¼æ˜¯å¦å¤„äºé›¶ä¸Šï¼Œç”¨äºé™å®šé‡‘å‰æ˜¯<code>é›¶ä¸Šé‡‘å‰</code>ã€‚</li></ul></li><li>KDJ é‡‘å‰(kdj.g.fork)ï¼š<code>stock_df['kdj.k / kdj.d'] &amp; stock_df['kdj.k &lt; 40']</code><ul><li>`stock_df[â€˜kdj.k / kdj.dâ€™]ï¼Œkdj çš„ k çº¿ æ˜¯å¦æ˜¯ä¸Šç©¿ d çº¿ã€‚</li><li><code>stock_df['kdj.k &lt; 40']</code>ï¼Œk å€¼æ˜¯å¦å°äº 40ï¼Œç”¨äºé™å®šé‡‘å‰åœ¨ <code>è¶…å–åŒº</code>é™„è¿‘ã€‚</li></ul></li></ul><p><strong>ä»£ç ä¸­è®¡ç®—æœªæ¥5å¤©çš„æ¶¨å¹…çš„æ–¹å¼ï¼š</strong><code>((stock_df[f'change:close,{predict_days + 1}'] &gt; 0.1) * 1).shift(-predict_days)</code></p><ul><li>1ã€<code>stock_df['change:close,6'] &gt; 0.1</code>ï¼Œå–å½“æ—¥çš„æ”¶ç›˜ä»·ï¼Œä»¥ â€œ6â€ ä¸ºæ—¶é—´çª—ã€å¯¹æ¯”å¾€å‰æ•°5å¤©çš„æ”¶ç›˜ä»· â€”â€” æ¶¨è·Œå¹…æ˜¯å¦å¤§äº10%ã€‚<br><img src="/2025/02/11/shi-yong-python-stock-pandas-ku-jin-xing-macd-kdj-shuang-yin-zi-de-ce-suan/target_rolling_window.jpg" alt="æœªæ¥5æ—¥æ—¶é—´çª—ç»Ÿè®¡"></li><li>2ã€<code>.shift(-5)</code>ï¼Œç”±äºå…¨æ–‡ä»£ç çš„ç›®æ ‡ï¼Œæ˜¯ä¸ºäº†çœ‹â€œå½“æ—¥â€åŒé‡‘å‰å¯¹â€œæœªæ¥5æ—¥â€æ¶¨å¹…é¢„æµ‹çš„å‡†ç¡®åº¦ï¼Œå› æ­¤éœ€è¦å°†ç¬¬1æ­¥è®¡ç®—å‡ºäº†çš„<code>change:close</code> Seriesä¸­æ¯ä¸ªå€¼æŒ‰ index æ–¹å‘å‘å‰ç§»åŠ¨5è¡Œã€‚è¿™æ ·ï¼Œåœ¨æ¯è¡Œçš„æ•°æ®ä¸­ï¼Œæ—¢æœ‰äº†å½“æ—¥çš„æ˜¯å¦é‡‘å‰çš„åˆ—ï¼Œä¹Ÿæœ‰äº†æœªæ¥5æ—¥çš„æ¶¨å¹…åˆ—ã€‚</li><li>3ã€å°†å€¼æ·»åŠ ä¸º DataFrame çš„æ–°åˆ— <code>target</code>ã€‚</li></ul><p><img src="/2025/02/11/shi-yong-python-stock-pandas-ku-jin-xing-macd-kdj-shuang-yin-zi-de-ce-suan/target.png" alt="è¿è¡Œä¹‹åçš„ç»“æœ"></p><h3 id="4-æŒ‰ç…§åŒé‡‘å‰æ¡ä»¶è¿›è¡Œè¿‡æ»¤å’Œç»“æœç»Ÿè®¡">4.  æŒ‰ç…§åŒé‡‘å‰æ¡ä»¶è¿›è¡Œè¿‡æ»¤å’Œç»“æœç»Ÿè®¡</h3><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">exist_macd_g_fork = _indicators_df['macd.g.fork'] &gt; 0exist_kdj_g_fork = _indicators_df['kdj.g.fork'] &gt; 0current_bullish = _indicators_df['bullish'] &gt; 0# æ·»åŠ å½“æ—¥çº¢è‰²èœ¡çƒ›ä¸ºè¾…åŠ©æ¡ä»¶æå‡é¢„æµ‹æˆåŠŸç‡double_g_fork = _indicators_df[exist_macd_g_fork &amp; exist_kdj_g_fork &amp; current_bullish]display(double_g_fork[double_g_fork['target'] &gt; 0].head())print(f"MACDã€KDJåŒé‡‘å‰é¢„æµ‹æœªæ¥5æ—¥çš„æ¶¨å¹…å¤§äº10% çš„æˆåŠŸç‡ï¼š{double_g_fork[double_g_fork['target'] &gt; 0].shape[0] / double_g_fork.shape[0] :.2%}")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œåç»“æœï¼š<br><img src="/2025/02/11/shi-yong-python-stock-pandas-ku-jin-xing-macd-kdj-shuang-yin-zi-de-ce-suan/result.png" alt="è¿è¡Œç»“æœ"></p><p>æˆ‘è¿™é‡Œä¾ç„¶æ˜¯ä½¿ç”¨çš„æœ€è¿‘400ä¸ªäº¤æ˜“æ—¥çš„æ•°æ®ã€‚æœ€åæµ‹ç®—å‡ºï¼šå½“æ—¥åŒæ—¶å‡ºç°åŒé‡‘å‰ã€é¢„æµ‹æœªæ¥5å¤©æ¶¨å¹…è¶…è¿‡10%çš„æˆåŠŸç‡åªæœ‰ <strong>11.03%</strong>ã€‚</p><div class="note info"><p>å½“ç„¶ï¼Œä½¿ç”¨è¿‡ MACDã€KDJ æŒ‡æ ‡çš„å°ä¼™ä¼´ä»¬ï¼Œä¼šå‘ç°è¿™é‡Œä½¿ç”¨çš„åˆ¤å®šæ¡ä»¶æ˜¯â€œå½“æ—¥åŒæ—¶å‡ºç°åŒé‡‘å‰â€ï¼Œè€Œå¾ˆå¤šæ—¶å€™ KDJ æ¯” MACD çµæ•ï¼Œä¸€èˆ¬ä¼šæ¯” MACD é‡‘å‰æå‰å‘ç”Ÿï¼Œé‚£ä¹ˆé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¦‚ä½•è¿›è¡Œåˆ¤æ–­å‘¢ï¼Ÿ<br>æœ‰å…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥è‡ªå·±è¯•ä¸€ä¸‹å®Œæˆç¼–ç ã€‚</p></div>]]></content>
      
      
      <categories>
          
          <category> Pandas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é‡åŒ–åˆ†æ </tag>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pandasåˆ†æAè‚¡åœ°å¤©æ¿æ•°é‡çš„åˆ†å¸ƒ</title>
      <link href="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/"/>
      <url>/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ˜¥èŠ‚åå¼€å¸‚çš„ç¬¬ä¸€å¤©ï¼Œä¸€äº›å¹´å‰çš„æ¶¨åœæ¿ç›´æ¥å‡ºç°äº†è·Œåœçš„æƒ…å†µï¼ŒåŒæ—¶ä¹Ÿå‡ºç°äº†ä¸€æ”¯åœ°å¤©æ¿ã€‚<br>å½“åœ°å¤©æ¿å‡ºç°æ—¶ï¼Œå¦‚æœä»åœ°æ¿ä¹°å…¥ï¼Œåˆ™ä¼šåœ¨ä¸€å¤©å†…è·å¾— 20cm çš„æµ®ç›ˆï¼Œè¯±æƒ‘æ˜¯å¤§çš„ã€‚<br><strong>ä½†æ˜¯</strong>ï¼Œæ³¨æ„ï¼Œ<strong>ä½†æ˜¯</strong> â€”â€” è¿æ¿ä¸­è§¦åŠè·Œåœåï¼Œå®ç°åœ°å¤©æ¿çš„æ¦‚ç‡æœ‰å¤šå°‘å‘¢ï¼Ÿåˆæœ‰å¤šå¤§æ¦‚ç‡ä¼šç›´æ¥èººåœ°æ¿ä¸Šèµ·ä¸æ¥ï¼Œæˆ–è€…ç¨å¾®å¥½ä¸€ç‚¹ä»åœ°æ¿ä¸Šç¿˜æ¿æˆåŠŸå‘¢ï¼Ÿ</p><pre class="mermaid">flowchart LR;    A[å·²ç»è¿ç»­æ¶¨åœNæ¿] --&gt; B{åˆ†æ—¶å›¾çªç„¶è§¦åŠè·Œåœ};    B -.-&gt;|å¯èƒ½| C[åœ°å¤©æ¿];    B -.-&gt;|å¯èƒ½| D[èººåœ°æ¿];    B -.-&gt;|å¯èƒ½| E[ç¿˜æ¿æˆåŠŸ];    subgraph ç»§ç»­è¿æ¿;        C;    end;    subgraph ç ´è¿æ¿;        D;        E;    end;</pre><p>åœ¨ä¸Šç¯‡åšå®¢ä¸­ï¼ˆ<a href="https://ellendan.com/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/">ä½¿ç”¨Pandasåˆ†æAè‚¡è¿æ¿æ•°é‡çš„åˆ†å¸ƒ</a>ï¼‰ï¼Œæˆ‘ä½¿ç”¨ Pandas ç»Ÿè®¡äº†è¿‘æœŸçš„æ¶¨åœè¿æ¿çš„æ•°é‡åˆ†å¸ƒï¼Œè¿™æ¬¡æˆ‘ä»¬ç”¨å¦ä¸€ç§æ€è·¯æ¥ç»Ÿè®¡ä¸€ä¸‹åœ°å¤©æ¿çš„æ•°é‡åˆ†å¸ƒï¼ŒåŒæ—¶å›ç­”ä¸€ä¸‹ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>åœ¨å„æ•°é‡è¿æ¿çš„è‚¡ç¥¨ä¸­ï¼Œåœ°å¤©æ¿åˆ†åˆ«åˆ†å¸ƒåœ¨ç¬¬å‡ æ¿ï¼Ÿ</li><li>åœ¨æ‰€æœ‰è¿æ¿çš„è‚¡ç¥¨ä¸­ï¼Œä¸€æ—¦åœ¨ç¬¬Næ¿çš„ä½ç½®ä¸Šè§¦åŠè·Œåœï¼Œå®ç°åœ°å¤©æ¿çš„è‚¡ç¥¨æ•°é‡ã€ç ´è¿æ¿ä¸”èººåœ°æ¿çš„è‚¡ç¥¨æ•°é‡ã€ç ´è¿æ¿ä¸”åœ°æ¿ç¿˜æ¿æˆåŠŸçš„è‚¡ç¥¨æ•°é‡ã€‚</li><li>æ‰€æœ‰æ¶‰åŠè¿æ¿åè§¦åŠè·Œåœçš„æƒ…å†µä¸­ï¼Œåœ°å¤©æ¿çš„å æ¯”ã€èººåœ°æ¿çš„å æ¯”ã€ç¿˜åœ°æ¿çš„å æ¯”ã€‚</li></ol><div class="note info"><p>æœ¬æ–‡æ—¨åœ¨é€šè¿‡åˆ†æåœ°å¤©æ¿çš„æ•°æ®åˆ†å¸ƒï¼Œæ¥è§‚å¯Ÿå’Œç†è§£è¿æ¿ä¸­å‡ºç°è·Œåœåå„æƒ…å†µçš„æ¦‚ç‡ï¼Œç«¯æ­£ç†æ€§è¿½æ¿çš„å¿ƒæ€ã€‚åŒæ—¶ï¼Œå¯¹äºæƒ³è¦å­¦ä¹  Pandas çš„å°ä¼™ä¼´æ¥è¯´ï¼Œè‚¡ç¥¨æ•°æ®åˆ†æä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»é¢˜å®è·µæ–¹å‘ã€‚</p><p>ä»¥ä¸‹æ˜¯ä»£ç æ­¥éª¤ã€‚å¦‚æœæƒ³ç›´æ¥çœ‹æ•°æ®ç»“æœï¼Œå¯ä»¥è·³åˆ°æœ€åä¸€ä¸ªç« èŠ‚ã€‚</p></div><h2 id="1-åŠ è½½æ—¥-K-çº¿æ•°æ®">1. åŠ è½½æ—¥ K çº¿æ•°æ®</h2><p>ä¸åŒäºä¸Šç¯‡åšå®¢ä¸­ä½¿ç”¨ HuggingFace çš„<code>datasets</code>åº“æ¥ä¸‹è½½å’ŒåŠ è½½æ•°æ®é›†ï¼Œè¿™æ¬¡æˆ‘ä»¬æ‰‹åŠ¨ä¸‹è½½ csv æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ Pandas è‡ªå¸¦çš„å‡½æ•°ä»æœ¬åœ°åŠ è½½æ•°æ®é›†ã€‚</p><h3 id="1-1-ä¸‹è½½æ•°æ®é›†-csv-æ–‡ä»¶åˆ°æœ¬åœ°">1.1 ä¸‹è½½æ•°æ®é›† csv æ–‡ä»¶åˆ°æœ¬åœ°</h3><p>è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨å¦ä¸€ä¸ªAè‚¡æ—¥çº¿æ•°æ®é›†ï¼ŒHuggingFace dataset ä½ç½® <a href="https://huggingface.co/datasets/ellendan/a-share-21">ellendan/a-share-21</a>ã€‚<br>ä¸ä¹‹å‰çš„æ•°æ®é›†ä¸åŒçš„æ˜¯ï¼Œè¯¥æ•°æ®é›†çš„èŒƒå›´æ˜¯ï¼š2021-01 ~ 2025-01 çš„ Aè‚¡æ—¥çº¿æ•°æ®ã€‚<br>åœ¨ç¼©å°äº†æ•°æ®èŒƒå›´çš„åŒæ—¶ï¼Œæ¯è¡Œçš„æ•°æ®ç‰¹å¾é™¤äº†æ—¥Kçº¿çš„æ•°æ®ä¹‹å¤–ï¼Œå¢åŠ äº†æ¯æ—¥çš„ DDE æ•°æ®å’Œä¼°å€¼æ•°æ®ï¼ˆè¿™ä¸¤å—æ•°æ®æœ¬æ¬¡åšå®¢ä»£ç ä¸­ä¸ä¼šä½¿ç”¨ï¼‰ã€‚</p><p><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/dataset.png" alt="ä¸‹è½½ dataset csv æ–‡ä»¶ "></p><p>æ•°æ®é›†æ¯è¡Œæ•°æ®ï¼Œæ—¥Kçº¿éƒ¨åˆ†åŒ…æ‹¬ï¼š</p><ul><li>codeï¼Œè‚¡ç¥¨çš„ä»£ç ã€‚</li><li>dateï¼Œè¡Œæƒ…å‘ç”Ÿçš„æ—¥æœŸã€‚</li><li>closeï¼Œæ”¶ç›˜ä»·ã€‚</li><li>openï¼Œå¼€ç›˜ä»·ã€‚</li><li>lowï¼Œæœ€ä½ä»·ã€‚</li><li>highï¼Œæœ€é«˜ä»·ã€‚</li><li>volumeï¼Œæˆäº¤é‡ã€‚</li><li>turnoverï¼Œæˆäº¤é¢ã€‚</li><li>turnover_rateï¼Œæ¢æ‰‹ç‡ã€‚</li><li>is_pausedï¼Œæ˜¯å¦åœç‰Œã€‚ï¼ˆ0å¦ï¼Œ1æ˜¯ï¼‰</li><li>high_limitï¼Œå½“æ—¥æ¶¨åœçš„é™ä»·ã€‚</li><li>low_limitï¼Œå½“æ—¥è·Œåœçš„é™ä»·ã€‚</li><li>avg_priceï¼Œå½“æ—¥æ‰€æœ‰æˆäº¤é‡çš„å‡ä»·ã€‚</li><li>pre_closeï¼Œå‰ä¸€æ—¥æ”¶ç›˜ä»·ã€‚</li><li>quote_rateï¼Œæ¶¨è·Œå¹…ã€‚</li><li>is_stï¼Œæ˜¯å¦ STã€‚ï¼ˆ0å¦ï¼Œ1æ˜¯ï¼‰<br>æ€»æ•°æ®é‡çº¦æœ‰ 4.92 Mè¡Œã€‚</li></ul><h3 id="1-2-åˆ›å»º-notebook-script-æ–‡ä»¶">1.2 åˆ›å»º notebook script æ–‡ä»¶</h3><p>è¿™æ¬¡æˆ‘ä»¬çš„ä»£ç ï¼Œä¾èµ–çš„ Python åº“åˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>Pandas</code></li><li><code>numpy</code></li><li><code>jupyter</code></li><li><code>matplotlib</code></li></ul><p>ç¡®ä¿æœ¬åœ°ä»£ç åº“å·²ç»è¿›è¡Œäº†å®‰è£…ã€‚<br>å¦‚æœæ˜¯ä¸‹è½½ç¬”è€… HuggingFace Space ä¸Šçš„ Demo ä»£ç åº“<a href="https://huggingface.co/spaces/ellendan/a-share-demo">ellendan/a-share-demo</a>ï¼Œä¸‹è½½åè¯·é˜…è¯» README è¿›è¡Œå®‰è£…ã€‚<br>è¿™æ¬¡çš„ Pandas notebook script æ–‡ä»¶çš„ä½ç½®åœ¨<code>&lt;projectDirectory&gt;/a_share/ipynb/floor_ceiling.ipynb</code>ã€‚</p><h3 id="1-3-åŠ è½½ä¸‹è½½å¥½çš„-csv-æ–‡ä»¶">1.3 åŠ è½½ä¸‹è½½å¥½çš„ csv æ–‡ä»¶</h3><p>åœ¨ <code>floor_ceiling.ipynb</code>æ–‡ä»¶è¿è¡Œä»¥ä¸‹ python ä»£ç ã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltpd<span class="token punctuation">.</span>options<span class="token punctuation">.</span>display<span class="token punctuation">.</span>max_columns <span class="token operator">=</span> <span class="token boolean">None</span><span class="token comment"># è®¾ç½®ä¸­æ–‡å­—ä½“</span>plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Songti SC'</span><span class="token punctuation">]</span>plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment"># éœ€è¦ä» HuggingFace dataset ä¸Šæ‰‹åŠ¨ä¸‹è½½çš„ csv æ–‡ä»¶æ”¾åœ¨æœ¬åœ°ã€‚æœ¬ä»£ç åº“çš„ dataset ç›®å½•å·²ç»åŠ å…¥äº†.gitignoreï¼Œä¸ä¼šå°†æ•°æ®é›†æäº¤åˆ°ä»£ç åº“ã€‚</span>data_path <span class="token operator">=</span> <span class="token string">'../../dataset/all-prices-with-values-250127.csv'</span>prices_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>data_path<span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>prices_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œåå¯ä»¥çœ‹åˆ°æ•°æ®é›†ä¸­çš„å„åˆ—ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/load_local_dataset.png" alt="åŠ è½½æ—¥Kçº¿åŸå§‹æ•°æ®é›†çš„ç»“æœ"></p><h2 id="2-ç¼–å†™-Pandas-å‡½æ•°è®¡ç®—è¿æ¿ä¸­çš„åœ°å¤©æ¿">2. ç¼–å†™ Pandas å‡½æ•°è®¡ç®—è¿æ¿ä¸­çš„åœ°å¤©æ¿</h2><h3 id="2-1-ç”¨-Pandas-è®¡ç®—æœ€è¿‘400ä¸ªäº¤æ˜“æ—¥å†…çš„ç›®æ ‡æ•°æ®">2.1 ç”¨ Pandas è®¡ç®—æœ€è¿‘400ä¸ªäº¤æ˜“æ—¥å†…çš„ç›®æ ‡æ•°æ®</h3><p><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/pandas_func_for_fc.png" alt=""></p><p>ä»£ç ä¸­æœ‰ä¸‰ä¸ªé‡ç‚¹é¡¹ï¼š</p><ul><li>1 åˆ¤æ–­åœ°å¤©æ¿çš„æ¡ä»¶ï¼š<ul><li><code>source_data_frame['close'] == source_data_frame['high_limit']</code> å½“æ—¥æ”¶ç›˜ä»·ç­‰äºæ¶¨åœä»·</li><li><code>source_data_frame['is_st'] &lt; 1</code> é ST è‚¡ç¥¨</li><li><code>source_data_frame['low'] == source_data_frame['low_limit']</code> å½“æ—¥æœ€ä½ä»·ç­‰äºè·Œåœä»·</li></ul></li><li>2 åœ¨å„è‚¡ç¥¨çš„è¿æ¿åŒºé—´ï¼Œè®¡ç®—åœ°å¤©æ¿çš„æ•°é‡<code>max_count_floor_ceiling</code>ã€ç¬¬ä¸€ä¸ªåœ°å¤©æ¿çš„å‘ç”Ÿä½ç½®ï¼ˆå³æ˜¯ç¬¬å‡ æ¿ï¼‰<code>first_floor_ceiling_day</code></li><li>3 è¿‡æ»¤æ‰ 2 è¿æ¿çš„è‚¡ç¥¨<code>(fc_df['max_high_limit_days'] &gt; 2) &amp;(fc_df['max_count_floor_ceiling'] &gt; 0)</code></li></ul><div class="note default"><p>ä¸ç”¨æ€€ç–‘ â€”â€” çœŸçš„æœ‰è‚¡ç¥¨åœ¨ä¸€æ¬¡è¿æ¿åŒºé—´å‡ºç°äº†ä¸¤æ¬¡åœ°å¤©æ¿ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€åœ°å¤©æ¿å°±å¾ˆå¸¸è§ï¼Œç»§ç»­çœ‹åé¢çš„æ•´ä½“ç»Ÿè®¡å°±ä¼šä½“ä¼šåˆ°ã€‚</p></div><p><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/fc_head_5_result.png" alt="æŸ¥çœ‹å‰5æ¡è®¡ç®—ç»“æœ"></p><h3 id="2-2-ä½¿ç”¨-Matplotlib-å°†ç»“æœå¯è§†åŒ–">2.2 ä½¿ç”¨ Matplotlib å°†ç»“æœå¯è§†åŒ–</h3><p>Matplotlib ç»˜å›¾ä»£ç éƒ½æ¯”è¾ƒç®€å•å’Œæ¨¡å¼åŒ–ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ Demo ä»£ç åº“ï¼Œè¿™é‡Œå°±ä¸å•ç‹¬è§£é‡Šäº†ï¼Œç›´æ¥æ¥çœ‹ä¸€ä¸‹ç»˜å›¾ç»“æœã€‚</p><p><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/fc_result_mat.png" alt="Matplotlib è¿è¡Œç»“æœ"></p><p>è§£é‡Šï¼š</p><ul><li>å›¾ä¸­ä¸€å…±æœ‰12å¼ å­å›¾ï¼Œåˆ†åˆ«å¯¹åº”ç€æœ€è¿‘400ä¸ªäº¤æ˜“æ—¥å†…æœ€é«˜å®ç°äº† 3è¿æ¿ ~ 14è¿æ¿çš„è‚¡ç¥¨æ•°æ®ã€‚</li><li>ä»¥ç¬¬ä¸€å¼ å­å›¾ä¸ºä¾‹å­ï¼Œè¿™å¼ å›¾ç»Ÿè®¡çš„æ˜¯ 400ä¸ªäº¤æ˜“æ—¥å†…æ‰€æœ‰çš„æœ€é«˜å®ç°äº† 3 è¿æ¿çš„è‚¡ç¥¨ï¼Œåœ°å¤©æ¿åˆ†åˆ«æœ‰6æ¬¡å‡ºç°åœ¨ç¬¬ä¸€æ¿ã€2æ¬¡åœ¨ç¬¬äºŒæ¿å’Œ1æ¬¡åœ¨ç¬¬ä¸‰æ¿ã€‚</li></ul><p>ç»“æœè§‚å¯Ÿï¼š</p><ul><li>ä» 4 è¿æ¿ä»¥ä¸Šçš„è‚¡ç¥¨æ•°æ®æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†åœ°å¤©æ¿å‡ºç°äº†ä¹‹åï¼Œè¿æ¿è¶‹åŠ¿å·²è¿‘å°¾å£°ã€‚</li><li>å…¶ä»–ç»“è®ºï¼Œå¯è‡ªè¡Œè¯»å›¾åˆ¤æ–­ã€‚</li></ul><h2 id="3-ç¼–å†™-Pandas-å‡½æ•°è®¡ç®—æ–­æ¿å½“å¤©è§¦åŠè·Œåœçš„æ•°æ®">3. ç¼–å†™ Pandas å‡½æ•°è®¡ç®—æ–­æ¿å½“å¤©è§¦åŠè·Œåœçš„æ•°æ®</h2><h3 id="3-1-ç”¨-Pandas-è®¡ç®—æœ€è¿‘400ä¸ªäº¤æ˜“æ—¥å†…çš„ç›®æ ‡æ•°æ®">3.1 ç”¨ Pandas è®¡ç®—æœ€è¿‘400ä¸ªäº¤æ˜“æ—¥å†…çš„ç›®æ ‡æ•°æ®</h3><p><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/pandas_fc_floor.png" alt=""></p><p>ä¸Šè¿°ä»£ç ä¸­ï¼š</p><ul><li><code>èººåœ°æ¿</code>çš„åˆ¤æ–­æ¡ä»¶<ul><li><code>source_data_frame['is_high_limit'].diff() &lt; 0</code> å‰ä¸€å¤©æ˜¯æ¶¨åœ(å€¼ä¸º 1)ï¼Œå½“å¤©ä¸æ¶¨åœ(å€¼ä¸º0)ï¼Œå› æ­¤ diff å‡½æ•°è¿”å› (0-1) = -1</li><li><code>source_data_frame['close'] == source_data_frame['low_limit']</code> å½“å¤©æ”¶ç›˜ä»·ç­‰äºè·Œåœä»·</li></ul></li><li><code>ç¿˜åœ°æ¿</code>çš„åˆ¤æ–­æ¡ä»¶<ul><li><code>source_data_frame['is_high_limit'].diff() &lt; 0</code></li><li><code>source_data_frame['close'] != source_data_frame['low_limit']</code> å½“å¤©æ”¶ç›˜ä»·ä¸ç­‰äºè·Œåœä»·</li><li><code>source_data_frame['low'] == source_data_frame['low_limit']</code> å½“å¤©æœ€ä½ä»·ç­‰äºè·Œåœä»·</li></ul></li></ul><p>æ¥ç€çœ‹å…¬ç”¨å‡½æ•° <code>break_continuous_high_limit</code>ï¼Œ åŒºåˆ«äºä¹‹å‰åœ°å¤©æ¿â€”â€”é’ˆå¯¹è¿æ¿åŒºé—´å†…çš„æ•°æ®ç»Ÿè®¡ï¼Œè¿™ä¸ªå‡½æ•°ç»Ÿè®¡çš„æ˜¯å„è‚¡ç¥¨ä¸æ¶¨åœçš„è¿ç»­äº¤æ˜“æ—¥åŒºé—´ã€‚<br><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/pandas_fc_floor_2.png" alt="break_continuous_high_limitå‡½æ•°"></p><p><strong>ç‰¹åˆ«æ³¨æ„</strong> å­—æ®µ<code>pre_high_limit_days</code>, è¿™ä¸ªå­—æ®µè®°å½•äº†æ¯æ¬¡ç ´è¿æ¿å‰çš„è¿æ¿å¤©æ•°ï¼Œåé¢é€šè¿‡æ­¤å­—æ®µå€¼ + 1ï¼Œå³å¯å¾—çŸ¥ç ´è¿æ¿å½“å¤©æ˜¯åŸæœ¬è¿æ¿çš„ç¬¬å‡ å¤©ã€‚</p><h3 id="3-2-ä½¿ç”¨-Matplotlib-å°†ç»“æœå¯è§†åŒ–">3.2 ä½¿ç”¨ Matplotlib å°†ç»“æœå¯è§†åŒ–</h3><p><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/fenbu.png" alt="ç ´è¿æ¿åã€ç ´æ¿å½“å¤©è§¦åŠè·Œåœçš„æƒ…å†µæ•°é‡åˆ†å¸ƒ"><br>è§£é‡Šï¼š</p><ul><li>è¿™å¼ å¸ƒå±€å›¾æ˜¯å°†æ‰€æœ‰çš„è¿æ¿è‚¡ç¥¨æ•°æ®ï¼ˆæ— è®ºæœ€é«˜å‡ è¿æ¿ï¼‰éƒ½æ±‡æ€»åˆ°äº†ä¸€å¼ å›¾ä¸Šã€‚</li><li>æˆ‘ä»¬ç»Ÿè®¡çš„æ˜¯å®ç°äº† 3 è¿æ¿ä»¥ä¸Šçš„è‚¡ç¥¨æ•°æ®ï¼Œæ²¡æœ‰åŒ…æ‹¬åªæœ‰ 2 è¿æ¿çš„è‚¡ç¥¨ã€‚</li><li>ä»¥ç¬¬äºŒæ ¹æŸ±ç¾¤ä¸ºä¾‹ï¼Œè¿‘400ä¸ªäº¤æ˜“æ—¥ä»¥å†…æ‰€æœ‰è¿æ¿è‚¡ç¥¨ä¸­ï¼Œåœ¨è¿æ¿çš„ç¬¬äºŒå¤©å‡ºç°åœ°å¤©æ¿çš„æ•°é‡æœ‰3æ¬¡ï¼Œç›¸æ¯”äºåœ°å¤©æ¿ï¼Œç›´æ¥ç ´è¿æ¿å½“å¤©èººåœ°æ¿ä¸Šçš„æœ‰ 278 æ¬¡ï¼Œä»åœ°æ¿ä¸ŠæŒ£æ‰æˆåŠŸçš„æœ‰ 192 æ¬¡ã€‚</li></ul><p>ç»“æœè§‚å¯Ÿï¼š</p><ul><li>æ— è®ºè¿æ¿çš„ç¬¬å‡ å¤©ï¼Œä¸€æ—¦è§¦åŠè·Œåœï¼Œèººåœ°æ¿çš„æ•°é‡ &gt; ç¿˜åœ°æ¿çš„æ•°é‡ &gt;&gt;&gt;(è¿œè¿œå¤§äº)&gt;&gt;&gt; åœ°å¤©æ¿çš„æ•°é‡ã€‚</li></ul><p><strong>æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å°†è¿™3ç±»æ•°æ®æ±‡æ€»åçš„æ€»ä½“æ¯”é‡ï¼š</strong><br><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/summary.png" alt="è®¡ç®—æ±‡æ€»"><br>ç»“æœï¼š</p><ul><li>åœ°å¤©æ¿å‡ºç°å æ¯”æ¬¡æ•°æ˜¯ 4.14%ï¼Œèººåœ°æ¿ 60.9%ï¼Œåœ°æ¿åç¿˜æ¿æˆåŠŸçš„ 34.97%ã€‚</li></ul><h2 id="4-ç»“æœæ€»ç»“">4. ç»“æœæ€»ç»“</h2><p>ä»æœ€è¿‘400ä¸ªäº¤æ˜“æ—¥çš„æ•°æ®ç»Ÿè®¡ç»“æœæ¥çœ‹ï¼ˆæ•°æ®æˆªæ­¢æ—¶é—´2015å¹´01æœˆ31æ—¥ï¼‰ï¼Œå·²ç»å¯ä»¥å›ç­”æ–‡ç« ä¹‹å‰æå‡ºçš„ä¸‰ä¸ªé—®é¢˜ã€‚</p><p><strong>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šâ€åœ¨å„æ•°é‡è¿æ¿çš„è‚¡ç¥¨ä¸­ï¼Œåœ°å¤©æ¿åˆ†åˆ«åˆ†å¸ƒåœ¨ç¬¬å‡ æ¿ï¼Ÿâ€œ</strong><br>ç»“è®ºè§ä¸‹å›¾ï¼š<br><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/fc_result_mat.png" alt="é—®é¢˜1ç­”æ¡ˆ"></p><p><strong>ç¬¬äºŒä¸ªé—®é¢˜ï¼šâ€åœ¨æ‰€æœ‰è¿æ¿çš„è‚¡ç¥¨ä¸­ï¼Œä¸€æ—¦åœ¨ç¬¬Næ¿çš„ä½ç½®ä¸Šè§¦åŠè·Œåœï¼Œå®ç°åœ°å¤©æ¿çš„è‚¡ç¥¨æ•°é‡ã€ç ´è¿æ¿ä¸”èººåœ°æ¿çš„è‚¡ç¥¨æ•°é‡ã€ç ´è¿æ¿ä¸”åœ°æ¿ç¿˜æ¿æˆåŠŸçš„è‚¡ç¥¨æ•°é‡â€œã€‚</strong><br>ç»“è®ºè§ä¸‹å›¾ï¼š<br><img src="/2025/02/06/shi-yong-pandas-fen-xi-a-gu-di-tian-ban-shu-liang-de-fen-bu/fenbu.png" alt="åœ°å¤©æ¿ä¸ç ´è¿æ¿åè§¦åŠè·Œåœçš„å…¶ä»–æƒ…å†µæ•°é‡åˆ†å¸ƒ"></p><p><strong>ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼šâ€æ‰€æœ‰æ¶‰åŠè¿æ¿åè§¦åŠè·Œåœçš„æƒ…å†µä¸­ï¼Œåœ°å¤©æ¿çš„å æ¯”ã€èººåœ°æ¿çš„å æ¯”ã€ç¿˜åœ°æ¿çš„å æ¯”ã€‚â€œ</strong><br>ç»“è®ºï¼š</p><p>ç ´è¿æ¿å½“å¤©è§¦åŠè·Œåœæ—¶ï¼Œéå¸¸éå¸¸å¤§çš„æ¦‚ç‡æ˜¯ç›´æ¥èººåœ°æ¿ï¼Œå…¶æ¬¡æ˜¯ä»åœ°æ¿ä¸ŠæŒ£æ‰ä¸€ä¸‹çš„ç¿˜åœ°æ¿ï¼Œéå¸¸éå¸¸å°çš„æ¦‚ç‡æ˜¯åœ°å¤©æ¿ â€”â€” å…·ä½“æ•°æ®æ˜¾ç¤ºï¼š</p><blockquote><p>æœ€è¿‘400ä¸ªäº¤æ˜“æ—¥ä¸€å…±å‡ºç°åœ°å¤©æ¿ 60 æ¬¡, å è§¦åœ°æ¯”é‡çš„ 4.14%ã€‚<br>å¼€æ¿åæ²¡æœ‰åœ°å¤©æ¿ï¼Œç›´æ¥èººåœ°æ¿æœ‰ 883 æ¬¡, å è§¦åœ°æ¯”é‡çš„ 60.90%ã€‚<br>å¼€æ¿åæ²¡æœ‰åœ°å¤©æ¿ï¼Œä»åœ°æ¿ä¸Šä¸æ–­æŒ£æ‰çš„æœ‰ 507 æ¬¡, å è§¦åœ°æ¯”é‡çš„ 34.97%</p></blockquote><p><strong>å› æ­¤ï¼Œåƒä¸‡ä¸è¦ç›²ç›®åœ°æœŸå¾…åœ°å¤©æ¿ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Pandas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é‡åŒ–åˆ†æ </tag>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pandasåˆ†æAè‚¡è¿æ¿æ•°é‡çš„åˆ†å¸ƒ</title>
      <link href="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/"/>
      <url>/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/</url>
      
        <content type="html"><![CDATA[<p>è‡ª2024å¹´9æœˆåº•Aè‚¡å¸‚åœºçªç„¶ä¸Šæ¶¨ä»¥æ¥ï¼Œæˆ‘é‡æ–°å¼€å§‹å…³æ³¨è‚¡å¸‚ã€‚åŒæ—¶ï¼Œä»ç½‘ä¸Šæ”¶é›†äº†ä¸€äº›æ•°æ®ï¼Œå°è¯•ä»ä¸šåŠ¡å’ŒæŠ€æœ¯ä¸¤ä¸ªè§’åº¦è¿›è¡Œåˆ†æï¼Œå¹¶åˆ©ç”¨æ‰‹å¤´æŒæ¡çš„ä¸€äº›å·¥å…·åŠ ä»¥åº”ç”¨ã€‚<br>æˆ–è®¸æœ‰äººä¼šé—®ï¼Œç°åœ¨å¸‚åœºä¸Šæœ‰è¿™ä¹ˆå¤šè‚¡ç¥¨ç†è´¢Appï¼Œå„ç§æŒ‡æ ‡å·²ç»ç›®ä¸æš‡æ¥ï¼Œä¸ºä»€ä¹ˆè¿˜è¦èŠ±æ—¶é—´è‡ªå·±ç¼–å†™ä»£ç å‘¢ï¼Ÿå¯¹æ­¤ï¼Œæˆ‘æœ‰ä»¥ä¸‹çœ‹æ³•ï¼š</p><ol><li>è‚¡ç¥¨ç†è´¢App å°±è·Ÿ SaaS å¹³å°ä¸€æ ·ï¼Œæä¾›çš„æ˜¯ç¬¦åˆæ›´å¤šå—ä¼—çš„é€šç”¨åŠŸèƒ½ï¼Œä»¥åŠå¸¦æ¥æ›´é«˜é”€å”®é¢å’Œè¿è¥å‘¨æœŸçš„ä»˜è´¹åŠŸèƒ½ã€‚æŒæ¡äº† DDD çš„åº”è¯¥éƒ½çŸ¥é“ï¼Œä¼ä¸šçš„ç«äº‰åŠ›ä½“ç°äºæ ¸å¿ƒåŸŸï¼Œè€Œæ ¸å¿ƒåŸŸçš„åº”ç”¨åŒ–éœ€è¦é å®šåˆ¶æ‰èƒ½è½åœ°ã€‚æŠ•èµ„ç†è´¢äº¦æ˜¯å¦‚æ­¤ï¼ŒæŒæ¡å¦‚ä½•å®šåˆ¶è‡ªå·±çš„å·¥å…·å’Œç­–ç•¥ï¼Œå¯ä»¥å¢å¼ºè‡ªèº«ç†è´¢çš„ç«äº‰åŠ›ï¼ŒåŒæ—¶åšåˆ°æœ‰ä¾æ®çš„ç†æ€§ç†è´¢ã€‚</li><li>åŒºåˆ«äºä¼ä¸šåº”ç”¨é¢†åŸŸçš„å®šåˆ¶åŒ– â€”â€” å”¯æœ‰å¤§ä¼ä¸šæ‰èƒ½æ‰¿æ‹…é«˜æ˜‚çš„å®šåˆ¶æˆæœ¬ï¼Œç†è´¢ç±»é‡åŒ–åˆ†æå°æ•£å³å¯åšåˆ°ã€‚</li><li>ç›¸æ¯”äºä¸€æœ‰æ–°æŠ€æœ¯å°±æ‹¿æ¥é©è‡ªå·±çš„å‘½çš„ç¨‹åºå‘˜ç¾¤ä½“æ¥è¯´ï¼Œæœ‰é‚£ç§å·ç ”å‘æ•ˆèƒ½æŒ‡æ ‡çš„åŠ²å„¿ï¼Œä¸å¦‚è½¬æ¢ä¸‹èµ›é“æ€è·¯ï¼šå‘å‰ä¸€æ­¥ â€”â€” å¤šå­¦ä¹ ä¸€äº›éæŠ€æœ¯é¢†åŸŸçš„ä¸šåŠ¡çŸ¥è¯†ï¼Œæ‹¿æ–°å·¥å…·æ¥å·å·è‡ªå·±çš„ç†è´¢æ”¶ç›Šç‡å•Šã€‚</li><li>å¯¹äºæƒ³å­¦ä¹  Pandas çš„å°ä¼™ä¼´æ¥è¯´ï¼Œè‚¡ç¥¨æ•°æ®åˆ†æä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»é¢˜èƒŒæ™¯ã€‚</li></ol><p>æœ¬æ–‡æ—¨åœ¨é€šè¿‡åˆ†æè¿æ¿æ•°é‡çš„åˆ†å¸ƒæƒ…å†µï¼Œæ¥è§‚å¯Ÿå’Œç†è§£æ‰“æ¿çš„æ¦‚ç‡ï¼Œç«¯æ­£ç†æ€§è¿½æ¿çš„å¿ƒæ€ã€‚<br>ä»¥ä¸‹æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„æ­¥éª¤ã€‚</p><h2 id="1-HuggingFace-Hub-Datasets">1. HuggingFace Hub Datasets</h2><p>æˆ‘ä»ç½‘ä¸ŠæŠ“å–äº†2005å¹´1æœˆ1æ—¥~2024å¹´12æœˆ31æ—¥çš„Aè‚¡æ—¥è¡Œæƒ…æ•°æ®ï¼ˆçƒ›çº¿å›¾æ•°æ®ï¼‰ï¼Œç„¶ååˆ›å»ºäº† HuggingFace dataset: <a href="https://huggingface.co/datasets/ellendan/a-share-prices">ellendan/a-share-prices</a>ã€‚</p><h3 id="1-1-Dataset-çš„ä½¿ç”¨">1.1 Dataset çš„ä½¿ç”¨</h3><h4 id="å®‰è£…-datasets-åº“">å®‰è£… datasets åº“</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pipenv <span class="token function">install</span> datasets<span class="token comment"># or use pip</span><span class="token comment"># pip install datasets</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="ä»HuggingFace-Hub-ä¸Šä¸‹è½½æ•°æ®æ–‡ä»¶">ä»HuggingFace Hub ä¸Šä¸‹è½½æ•°æ®æ–‡ä»¶</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> datasets <span class="token keyword">import</span> load_datasetdataset <span class="token operator">=</span> load_dataset<span class="token punctuation">(</span><span class="token string">"ellendan/a-share-prices"</span><span class="token punctuation">,</span> data_files<span class="token operator">=</span><span class="token string">"all-prices.csv"</span><span class="token punctuation">,</span> download_mode<span class="token operator">=</span><span class="token string">"reuse_dataset_if_exists"</span><span class="token punctuation">)</span>data_frame <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_pandas<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>load_datasetæ–¹æ³•çš„å‚æ•°ï¼š</p><ul><li>data_files å¦‚æœä¸æŒ‡å®šï¼Œå°†ä¼šä¸‹è½½è¯¥ dataset ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ã€‚</li><li>download_mode é»˜è®¤å€¼å°±æ˜¯<code>reuse_dataset_if_exists</code>ï¼Œæ•°æ®æ–‡ä»¶ä¼šè¿›è¡Œæœ¬åœ°ç¼“å­˜ï¼Œé»˜è®¤è·¯å¾„æ˜¯<code>~/.cache/huggingface/datasets</code>ã€‚</li></ul><div class="note warning"><p>æ¯æ¬¡æ‰§è¡Œ&nbsp;<code>load_dataset</code>&nbsp;æ—¶ï¼Œéƒ½éœ€è¦ä½¿ç”¨ VPNï¼Œå› ä¸ºé™¤äº†ä¸‹è½½æ•°æ®å¤–ï¼Œè¯¥è¿‡ç¨‹è¿˜ä¼šè¿›è¡Œ verifyã€‚å› æ­¤ï¼Œå¦‚æœ VPN ç½‘ç»œä¸ç¨³å®šï¼Œå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯å¹¶éœ€è¦é‡æ–°å°è¯•åŠ è½½ã€‚<br>åœ¨è¿™ç§ç½‘ç»œçŠ¶å†µä¸‹ï¼Œå»ºè®®è®¿é—® HuggingFace ç½‘ç«™ï¼Œå°†æ•°æ®é›†ä¸­çš„ csv æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åä»æœ¬åœ°åŠ è½½ã€‚<br><a href="https://huggingface.co/docs/datasets/loading#hugging-face-hub">å®˜ç½‘loading methodæ–‡æ¡£è¯´æ˜</a></p></div><h3 id="1-2-æ•°æ®ç‰¹å¾é¡¹">1.2 æ•°æ®ç‰¹å¾é¡¹</h3><p><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/features.png" alt="all-price.csv æ•°æ®ç‰¹å¾é¡¹"><br>å¦‚ä¸Šå›¾ï¼Œæ¯è¡Œæ•°æ®åŒ…æ‹¬ï¼š</p><ul><li>â€˜Unnamed: 0â€™ï¼Œè¡Œæƒ…å‘ç”Ÿçš„æ—¥æœŸã€‚</li><li>closeï¼Œæ”¶ç›˜ä»·ã€‚</li><li>openï¼Œå¼€ç›˜ä»·ã€‚</li><li>lowï¼Œæœ€ä½ä»·ã€‚</li><li>highï¼Œæœ€é«˜ä»·ã€‚</li><li>volumeï¼Œæˆäº¤é‡ã€‚</li><li>turnoverï¼Œæˆäº¤é¢ã€‚</li><li>turnover_rateï¼Œæ¢æ‰‹ç‡ã€‚</li><li>is_pausedï¼Œæ˜¯å¦åœç‰Œã€‚ï¼ˆ0å¦ï¼Œ1æ˜¯ï¼‰</li><li>high_limitï¼Œå½“æ—¥æ¶¨åœçš„é™ä»·ã€‚</li><li>low_limitï¼Œå½“æ—¥è·Œåœçš„é™ä»·ã€‚</li><li>avg_priceï¼Œå½“æ—¥æ‰€æœ‰æˆäº¤é‡çš„å‡ä»·ã€‚</li><li>pre_closeï¼Œå‰ä¸€æ—¥æ”¶ç›˜ä»·ã€‚</li><li>quote_rateï¼Œæ¶¨è·Œå¹…ã€‚</li><li>is_stï¼Œæ˜¯å¦ STã€‚ï¼ˆ0å¦ï¼Œ1æ˜¯ï¼‰</li><li>codeï¼Œè‚¡ç¥¨çš„ä»£ç ã€‚<br>æ€»æ•°æ®é‡çº¦æœ‰13Mè¡Œã€‚</li></ul><h2 id="2-ç¼–å†™-Pandas-demo">2. ç¼–å†™ Pandas demo</h2><p>æˆ‘åˆ›å»ºäº†ä¸€ä¸ª HuggingFace Spaceï¼Œdemo ä»£ç ä¿å­˜åœ¨å…¶ä¸­<a href="https://huggingface.co/spaces/ellendan/a-share-demo">ellendan/a-share-demo</a>ã€‚<br>å¦‚æƒ³å€Ÿé‰´å¤åˆ¶ä»£ç ï¼Œè¯·ä»¥ HuggingFace Space Repo ä¸Šä¸ºå‡†ï¼Œæœ¬äººåç»­å¯èƒ½ä¼šä¼˜åŒ–å’Œæ›´æ–°ä»£ç ã€‚<br><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/space.png" alt="ellendan/a-share-demo"></p><h3 id="2-1-ä½¿ç”¨-Pandas-è¿›è¡Œè¿æ¿ç»Ÿè®¡">2.1 ä½¿ç”¨ Pandas è¿›è¡Œè¿æ¿ç»Ÿè®¡</h3><p>å…³é”®ä»£ç åœ¨<code>a_share/demo.py</code>æ–‡ä»¶ä¸­ï¼Œæ–¹æ³•<code>load_stock_data</code>ï¼š</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">def load_stock_data():    dataset = load_dataset("ellendan/a-share-prices", data_files="all-prices.csv", download_mode="reuse_dataset_if_exists")    data_frame = dataset['train'].to_pandas()    data_frame['date'] = pd.to_datetime(data_frame['Unnamed: 0'])    data_frame.drop(columns=['Unnamed: 0'], inplace=True)    data_frame.set_index(['code','date'], inplace=True)    return data_frame<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä½¿ç”¨ load_dataset åŠ è½½æ•°æ®é›†</li><li>æ•°æ®é›†è½¬æ¢æˆ pandas DataFrameï¼Œå¹¶è®¾ç½®äºŒç»´ç´¢å¼•ï¼Œç¬¬ä¸€ç»´æ˜¯ column: code, ç¬¬äºŒç»´æ˜¯ colume: date</li></ul><p>æ–¹æ³•<code>serie_high_limit</code>å¯¹å„è‚¡ç¥¨æŒ‰æ—¶é—´åºåˆ—ï¼Œè®¡ç®—è¿ç»­çš„æ¶¨åœæ¿æ•°é‡å’Œç»ˆæ­¢æ—¥æœŸï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">prepare_features</span><span class="token punctuation">(</span>source_data_frame<span class="token punctuation">,</span> last_n_days<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    source_data_frame <span class="token operator">=</span> source_data_frame<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span>last_n_days<span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token comment"># â‘ </span>    is_high_limit <span class="token operator">=</span> <span class="token punctuation">(</span>source_data_frame<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span> <span class="token operator">==</span> source_data_frame<span class="token punctuation">[</span><span class="token string">'high_limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>source_data_frame<span class="token punctuation">[</span><span class="token string">'is_st'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> is_high_limit<span class="token punctuation">[</span>is_high_limit <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>empty<span class="token punctuation">:</span>        <span class="token keyword">return</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>    source_data_frame<span class="token punctuation">[</span><span class="token string">'is_high_limit'</span><span class="token punctuation">]</span> <span class="token operator">=</span> is_high_limit    <span class="token comment"># â‘¡</span>    is_segment_start <span class="token operator">=</span> <span class="token punctuation">(</span>is_high_limit<span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span>    source_data_frame<span class="token punctuation">[</span><span class="token string">'segment_start'</span><span class="token punctuation">]</span> <span class="token operator">=</span> is_segment_start    <span class="token comment"># â‘¢</span>    source_data_frame<span class="token punctuation">[</span><span class="token string">'segment_index'</span><span class="token punctuation">]</span> <span class="token operator">=</span> is_segment_start<span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># â‘£</span>    serie_high_limit <span class="token operator">=</span> source_data_frame<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'segment_index'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>        <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token string">'date'</span><span class="token punctuation">:</span> x<span class="token punctuation">.</span>index<span class="token punctuation">.</span>get_level_values<span class="token punctuation">(</span><span class="token string">"date"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">'high_limit_days'</span><span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">'is_high_limit'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        include_groups<span class="token operator">=</span><span class="token boolean">False</span>    <span class="token punctuation">)</span>    <span class="token comment"># â‘¤</span>    serie_high_limit <span class="token operator">=</span> serie_high_limit<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'segment_index'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span>        max_high_limit_days<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'high_limit_days'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        date<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"high_limit_days"</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>idxmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>    <span class="token keyword">return</span> serie_high_limit<span class="token keyword">def</span> <span class="token function">serie_high_limit</span><span class="token punctuation">(</span>source_data_frame<span class="token punctuation">,</span> last_n_days<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data_frame <span class="token operator">=</span> source_data_frame<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> prepare_features<span class="token punctuation">(</span>x<span class="token punctuation">,</span> last_n_days<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> remove_trade_data_overdate<span class="token punctuation">(</span>data_frame<span class="token punctuation">,</span> last_n_days<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>source_data_frame æ•°æ®é›†ä¸­åŒ…æ‹¬â€œæ‰€æœ‰çš„è‚¡ç¥¨â€çš„æ—¥è¡Œæƒ…æ•°æ®ï¼Œé¦–å…ˆåœ¨<code>serie_high_limit</code>æ–¹æ³•ä¸­å¯¹ source_data_frame æŒ‰ code è¿›è¡Œåˆ†ç»„ï¼Œè¿™æ ·æ‰èƒ½è®¡ç®—æ¯æ”¯è‚¡ç¥¨å„è‡ªå†å²è¡Œæƒ…ä¸­å‡ºç°è¿‡çš„è¿æ¿æ•°æ®ï¼Œè®¡ç®—å®ŒååˆæŒ‰ç…§ code è¿›è¡Œæ±‡æ€»ã€‚<br><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/count.png" alt="å‡½æ•°æœ€ç»ˆè¾“å‡ºç»“æœæ ¼å¼"></li><li>å•æ”¯è‚¡ç¥¨è¿æ¿çš„è®¡ç®—é€»è¾‘åœ¨æ–¹æ³• prepare_features ä¸­ï¼Œæ€è·¯æ˜¯è¿™æ ·çš„ï¼š<ul><li>â‘  å½“æ”¶ç›˜ä»·(close) == æ¶¨åœé™ä»·(high_limit)æ—¶ï¼Œåˆ™æ˜¯å½“æ—¥æ¶¨åœï¼ˆå€¼1ï¼šæ¶¨åœï¼Œå€¼0ï¼šå¦ï¼‰ï¼Œæ·»åŠ  <code>is_high_limit</code>åˆ—ç»™ DataFrame<br><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/1.png" alt="is_high_limit çš„æ•°æ®ç¤ºä¾‹" width="400" height="400"></li><li>â‘¡ å½“æ¯è¡Œæ•°æ®çš„ <code>is_high_limit</code>å€¼ä¸å‰ä¸€å¤©çš„å€¼ä¸ç›¸ç­‰æ—¶ï¼Œåˆ™è®¤ä¸ºä¸è¿ç»­çš„æ®µçš„å¼€å§‹ï¼ˆå€¼1ï¼šæ˜¯ï¼Œå€¼0ï¼šå¦ï¼‰ã€‚æ•°æ®æ·»åŠ æ–°åˆ—<code>segment_start</code>ã€‚<br><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/2.png" alt="segment_start çš„æ•°æ®ç¤ºä¾‹" width="400" height="400"></li><li>â‘¢ ç»™æ¯ä¸ªä¸è¿ç»­çš„æ®µåˆ†é…æ®µç´¢å¼•â€”â€”å¯¹<code>segment_start</code>åˆ—çš„å€¼è¿›è¡Œ cumsum è¿ç®—ï¼Œç„¶åèµ‹å€¼ç»™æ–°åˆ—<code>segment_index</code>ã€‚<br><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/3.png" alt="segment_index çš„æ•°æ®ç¤ºä¾‹" width="400" height="400"></li><li>â‘£ é’ˆå¯¹<code>segment_index</code>åˆ—è¿›è¡Œåˆ†ç»„è¿ç®—ï¼Œæ¯ä¸ªæ®µå†…éƒ¨çš„äº¤æ˜“æ—¥æ˜¯è¿ç»­æ¶¨åœçš„ç¬¬å‡ å¤©ï¼ˆå€¼0ï¼šæœªæ¶¨åœï¼Œå€¼1ï¼šæ¶¨åœç¬¬ä¸€å¤©ï¼Œå€¼2ï¼šè¿ç»­æ¶¨åœç¬¬2å¤©â€¦â€¦å€¼nï¼šç¬¬nå¤©ï¼‰<br><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/4.png" alt=" æ‰§è¡Œåæ•°æ®ç¤ºä¾‹" width="400" height="400"></li><li>â‘¤ å°†åˆ†ç»„è¿›è¡Œèšåˆè¿ç®—ï¼Œæ¯ä¸ªæ®µä»…ä¿ç•™æœ€å¤§è¿æ¶¨é‚£ä¸ªäº¤æ˜“æ—¥çš„æ•°æ®ï¼Œ<code>max_high_limit_days</code> æœ€å¤§çš„è¿æ¶¨å¤©æ•°ï¼Œ<code>date</code> æœ€å¤§è¿æ¶¨é‚£æ¡æ•°æ®å¯¹åº”çš„äº¤æ˜“æ—¥æœŸ<br><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/5.png" alt="æ‰§è¡Œåæ•°æ®ç¤ºä¾‹" width="400" height="400"></li></ul></li></ul><h3 id="2-2-ä½¿ç”¨-gradio-å’Œ-plotly-è¿›è¡Œ-web-å±•ç¤º">2.2 ä½¿ç”¨ gradio å’Œ plotly è¿›è¡Œ web å±•ç¤º</h3><p>Webå±•ç¤ºä»£ç åœ¨<code>app.py</code>æ–‡ä»¶ä¸­ã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gradio <span class="token keyword">as</span> gr<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token keyword">import</span> plotly<span class="token punctuation">.</span>express <span class="token keyword">as</span> px<span class="token keyword">from</span> a_share<span class="token punctuation">.</span>demo <span class="token keyword">import</span> load_stock_data<span class="token punctuation">,</span> serie_high_limitsource_data_frame <span class="token operator">=</span> load_stock_data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">process_and_plot</span><span class="token punctuation">(</span>last_n_days<span class="token punctuation">)</span><span class="token punctuation">:</span>    serie_high_limit_data <span class="token operator">=</span> serie_high_limit<span class="token punctuation">(</span>source_data_frame<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>last_n_days<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># å°†å¤„ç†å¥½çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œåªä¿ç•™è¿æ¿å¤©æ•°&gt;=2çš„æ•°æ®ï¼Œè¿›è¡ŒæŸ±çŠ¶å›¾æ˜¾ç¤º</span>    count_by_high_limit_days <span class="token operator">=</span> serie_high_limit_data<span class="token punctuation">[</span>serie_high_limit_data<span class="token punctuation">[</span><span class="token string">'max_high_limit_days'</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'max_high_limit_days'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>    plot_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token string">'è¿æ¿å¤©æ•°'</span><span class="token punctuation">:</span> count_by_high_limit_days<span class="token punctuation">.</span>index<span class="token punctuation">,</span>        <span class="token string">'è‚¡ç¥¨æ•°é‡'</span><span class="token punctuation">:</span> count_by_high_limit_days<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    fig <span class="token operator">=</span> px<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>        plot_data<span class="token punctuation">,</span>        x<span class="token operator">=</span><span class="token string">'è¿æ¿å¤©æ•°'</span><span class="token punctuation">,</span>        y<span class="token operator">=</span><span class="token string">'è‚¡ç¥¨æ•°é‡'</span><span class="token punctuation">,</span>        title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'æœ€è¿‘</span><span class="token interpolation"><span class="token punctuation">{</span>last_n_days<span class="token punctuation">}</span></span><span class="token string">å¤©è¿æ¿è‚¡ç¥¨ç»Ÿè®¡'</span></span>    <span class="token punctuation">)</span>    fig<span class="token punctuation">.</span>update_traces<span class="token punctuation">(</span>text<span class="token operator">=</span>plot_data<span class="token punctuation">[</span><span class="token string">'è‚¡ç¥¨æ•°é‡'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> textposition<span class="token operator">=</span><span class="token string">'outside'</span><span class="token punctuation">)</span>    ge_2_data <span class="token operator">=</span> serie_high_limit_data<span class="token punctuation">[</span>serie_high_limit_data<span class="token punctuation">[</span><span class="token string">'max_high_limit_days'</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">]</span>    scatter_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token string">'è¿æ¿æ—¥æœŸ'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>ge_2_data<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'è¿æ¿å¤©æ•°'</span><span class="token punctuation">:</span> ge_2_data<span class="token punctuation">[</span><span class="token string">'max_high_limit_days'</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    fig2 <span class="token operator">=</span> px<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>        scatter_data<span class="token punctuation">,</span>        x<span class="token operator">=</span><span class="token string">'è¿æ¿æ—¥æœŸ'</span><span class="token punctuation">,</span>        y<span class="token operator">=</span><span class="token string">'è¿æ¿å¤©æ•°'</span><span class="token punctuation">,</span>        title<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'æœ€è¿‘</span><span class="token interpolation"><span class="token punctuation">{</span>last_n_days<span class="token punctuation">}</span></span><span class="token string">å¤©è¿æ¿åˆ†å¸ƒç»Ÿè®¡'</span></span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    fig2<span class="token punctuation">.</span>update_layout<span class="token punctuation">(</span>        xaxis<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            tickformat<span class="token operator">=</span><span class="token string">"%Y-%m"</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>    <span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>fig<span class="token punctuation">,</span> fig2<span class="token punctuation">]</span><span class="token comment"># åˆ›å»ºGradioç•Œé¢</span>demo <span class="token operator">=</span> gr<span class="token punctuation">.</span>Interface<span class="token punctuation">(</span>    fn<span class="token operator">=</span>process_and_plot<span class="token punctuation">,</span>    inputs<span class="token operator">=</span><span class="token punctuation">[</span>        gr<span class="token punctuation">.</span>Number<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"è¾“å…¥éœ€è¦ç»Ÿè®¡çš„æœ€è¿‘Nå¤©çš„å¤©æ•°"</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span> minimum<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> maximum<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    outputs<span class="token operator">=</span><span class="token punctuation">[</span>gr<span class="token punctuation">.</span>Plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gr<span class="token punctuation">.</span>Plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    title<span class="token operator">=</span><span class="token string">"Aè‚¡è¿æ¿ç»Ÿè®¡åˆ†æ"</span><span class="token punctuation">,</span>    description<span class="token operator">=</span><span class="token string">"è¾“å…¥è¦ç»Ÿè®¡çš„å¤©æ•°ï¼ŒæŸ¥çœ‹ä¸åŒè¿æ¿å¤©æ•°çš„è‚¡ç¥¨æ•°é‡åˆ†å¸ƒ"</span><span class="token punctuation">,</span>    flagging_mode<span class="token operator">=</span><span class="token string">'never'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    demo<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="note info"><p>æœ¬æ¬¡ä»£ç ä¸»è¦æ˜¯ä¸ºäº†å¡«å…… HuggingFace Space APPé¡µé¢ï¼Œå› æ­¤é€‰æ‹©äº†ä½¿ç”¨ gradio + plotlyã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæœ¬åœ°è¿›è¡Œæ•°æ®åˆ†æå’Œæ¢ç´¢æ›´æ¨èä½¿ç”¨ jupyter + matplotlibã€‚<br>åç»­çš„ demo å¤§éƒ¨åˆ†å°†ä½¿ç”¨ jupyter + matplotlib çš„æ–¹å¼ã€‚</p></div><h2 id="3-ç»“æœå±•ç¤º">3. ç»“æœå±•ç¤º</h2><h3 id="è¿è¡Œç»“æœ">è¿è¡Œç»“æœ</h3><p><img src="/2025/01/07/shi-yong-pandas-fen-xi-a-gu-lian-ban-shu-liang-de-fen-bu/results.png" alt="ç»“æœå›¾å±•ç¤º"><br>ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œè¿‘400ä¸ªäº¤æ˜“æ—¥å†…ï¼š</p><ul><li>å›¾1ï¼Œ2024å¹´10æœˆä¹‹åï¼ŒA è‚¡å¸‚åœºè½¬æš–ï¼Œ4è¿æ¿ä»¥ä¸Šå‡ºç°çš„é¢‘ç‡å¢å¤šï¼Œæä¾›äº†æ›´å¤šçš„æ‰“æ¿æœºä¼šã€‚</li><li>å›¾2ï¼Œå†å²è¡Œæƒ…ä¸­æ­¢æ­¥äº 2 è¿æ¿çš„è‚¡ç¥¨æœºä¼šæœ‰2214æ¬¡ã€‚å› æ­¤ï¼Œåªè¦çœ‹åˆ°2è¿æ¿ã€å°±ä¸€å¤´çƒ­å¾€é‡Œå†²ï¼Œå¹»æƒ³ä¼š6è¿æ¿ã€10è¿æ¿çš„å°æ•£ä»¬ï¼Œéœ€è¦è­¦é†’ï¼šçœŸæ­£è·¯è¿‡2è¿æ¿ã€é¡ºåˆ©è¾¾æˆ6è¿æ¿çš„è‚¡ç¥¨æœºä¼šåªæœ‰ 3.1 %ï¼Œä¸è¦æ— è„‘è¿½æ¿ã€‚</li></ul><h3 id="HuggingFace-Space-Web-çº¿ä¸Š-demo">HuggingFace Space Web çº¿ä¸Š demo</h3><div class="note warning"><p>ç™½å«–çš„å…è´¹CPUï¼Œè¿ç®—é€Ÿåº¦å¾ˆæ…¢ï¼Œæ¯æ¬¡æ‰§è¡Œå¯èƒ½è¦1åˆ†é’Ÿ+ã€‚å¯ä»¥å°†ä»£ç åº“ clone åˆ°æœ¬åœ°è¿è¡Œã€‚</p></div><script type="module" src="https://gradio.s3-us-west-2.amazonaws.com/5.9.1/gradio.js"></script><p><gradio-app src="https://ellendan-a-share-demo.hf.space"></gradio-app></p>]]></content>
      
      
      <categories>
          
          <category> Pandas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é‡åŒ–åˆ†æ </tag>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP8266 ESP-01Sçƒ§å½•MicroPythonå›ºä»¶</title>
      <link href="/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/"/>
      <url>/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/</url>
      
        <content type="html"><![CDATA[<p>ä¸‰å¹´å‰ï¼Œæˆ‘åœ¨æ·˜å®ä¸Šè´­ä¹°äº†ä¸€å— Raspberry Pi Pico æ¿ã€‚ç„¶è€Œï¼Œæœ€åˆçš„ Pico æ¿å¹¶ä¸å¸¦æœ‰ WIFI æ¨¡å—ï¼Œå› æ­¤æˆ‘é¢å¤–è´­ç½®äº†ä¸€ä¸ªå°å‹ WIFI æ¨¡å—ï¼Œå³ ESP-01S å¼€å‘æ¿ã€‚<br>ESP-01S å¼€å‘æ¿å‡ºå‚æ—¶ä½¿ç”¨çš„æ˜¯ AT æŒ‡ä»¤é›†ï¼Œå¹¶é™„å¸¦äº†é€‚ç”¨äº C++ å¼€å‘ç¯å¢ƒçš„å›ºä»¶çƒ§å½•è½¯ä»¶ã€‚<br>ä½œä¸ºä¸€åä» Raspberry Pi å…¥é—¨çš„ç¨‹åºå‘˜ï¼Œæˆ‘è‡ªç„¶æ›´åå¥½ä¸ Python ç›¸å…³çš„ MicroPythonã€‚å› æ­¤ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹å…³äº MicroPython çƒ§å½•ä»¥åŠå¼€å‘ç¯å¢ƒæ­å»ºçš„è¿‡ç¨‹ã€‚</p><h2 id="1-å‡†å¤‡å·¥å…·">1. å‡†å¤‡å·¥å…·</h2><p>æ‰‹å¤´é™¤äº† ESP-01S è¿™å— ESP8266 åè®®çš„å¼€å‘æ¿å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ª USB è½¬ä¸²å£çš„å›ºä»¶çƒ§å½•å™¨ã€‚</p><div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/esp-01s.jpg" alt="ESP-01S"></div><div class="group-picture-column"><img src="/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/USB%E6%8E%A5%E5%8F%A3%E7%83%A7%E5%BD%95%E5%99%A8.jpg" alt="çƒ§å½•å™¨"></div><div class="group-picture-column"><img src="/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/%E5%AE%89%E8%A3%85%E5%90%88%E4%BD%93.jpg" alt="å®‰è£…åˆä½“"></div></div></div><div class="note info"><p>æœ‰äº†USBè½¬ä¸²å£çƒ§å½•å™¨ï¼Œå°±å¯ä»¥å°†ESP-01æ’åˆ°ç”µè„‘ä¸Šè¿›è¡Œçƒ§å½•äº†ã€‚</p></div><h2 id="2-ä¸‹è½½-MicroPython-ESP8266-bin-æ–‡ä»¶">2. ä¸‹è½½ MicroPython ESP8266 bin æ–‡ä»¶</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”µè„‘ä¸Šä¸‹è½½é€‚ç”¨äº ESP8266 çš„ MicroPython å›ºä»¶ã€‚è®¿é—® MicroPython çš„å®˜æ–¹ç½‘ç«™è¿›è¡Œä¸‹è½½ã€‚  <a href="https://micropython.org/download/ESP8266_GENERIC/">MicroPythonå®˜æ–¹ä¸‹è½½ESP8266 Firmware</a><br>è§ä¸‹å›¾ï¼Œç‚¹å‡»ä¸‹è½½ã€‚</p><div class="note info"><p>å¦‚è‹¥ä¹‹å‰è´­ä¹°çš„ ESP-01S çš„é—ªå­˜åªæœ‰ 1Mï¼Œä¸‹è½½å›¾ä¸­ç¬¬äºŒä¸ªè“æ¡†ä¸­ä¸‹çš„å›ºä»¶ï¼Œä¸ç„¶çƒ§å½•ä¼šæŠ¥é”™ã€‚</p></div><p><img src="/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/download-firmware.png" alt="å›ºä»¶ä¸‹è½½é¡µé¢"></p><h2 id="3-çƒ§å½•å›ºä»¶">3. çƒ§å½•å›ºä»¶</h2><h3 id="3-1-å®‰è£…-esptool-å·¥å…·">3.1 å®‰è£… esptool å·¥å…·</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> esptool<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-2-æ“¦é™¤-ESP-01S">3.2 æ“¦é™¤ ESP-01S</h3><p>å°†çƒ§å½•å™¨æ’å…¥ç”µè„‘ï¼Œæ‰§è¡Œæ“¦é™¤æŒ‡ä»¤ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥æ‰¾çƒ§å½•å™¨æ¥å…¥çš„ä¸²å£</span><span class="token function">ls</span> <span class="token parameter variable">-l</span> /dev/cu.*<span class="token comment"># æˆ‘çš„æœºå™¨ä¸Šï¼Œæ˜¾ç¤ºä¸²å£åæ˜¯ /dev/cu.usbserial-52D20047991</span>esptool.py <span class="token parameter variable">--port</span> /dev/cu.usbserial-52D20047991 erase_flash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-çƒ§å½•ä¸‹è½½å¥½çš„-MicroPython-å›ºä»¶">3.3 çƒ§å½•ä¸‹è½½å¥½çš„ MicroPython å›ºä»¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># éœ€è¦æ›¿æ¢ä¸²å£å’Œæœ¬åœ°å›ºä»¶çš„è·¯å¾„</span>esptool.py <span class="token parameter variable">--port</span> /dev/cu.usbserial-52D20047991 <span class="token parameter variable">--baud</span> <span class="token number">460800</span> write_flash <span class="token parameter variable">--flash_size</span><span class="token operator">=</span>detect <span class="token number">0</span> ~/Downloads/ESP8266_GENERIC-FLASH_1M-20241129-v1.24.1.bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="note info"><p>çƒ§å½•æˆåŠŸåï¼ŒESP-01S é»˜è®¤è®¾ç½®ä¸º APï¼ˆAccess Pointï¼‰ï¼Œä½¿ç”¨æ‰‹æœºï¼Œå¯ä»¥æŸ¥çœ‹åˆ°ä¸€ä¸ª<code>MicroPython-xxx</code>å¼€å¤´çš„çƒ­ç‚¹ã€‚</p></div><h2 id="4-å®‰è£…-MicroPython-IDE-â€”â€”-Thonny">4. å®‰è£… MicroPython IDE â€”â€” Thonny</h2><h3 id="4-1-å®‰è£…-IDE-Thonny">4.1 å®‰è£… IDE Thonny</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> thonny<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-2-é€‰æ‹©è¿æ¥çš„ç¯å¢ƒï¼ˆè§£é‡Šå™¨ï¼‰">4.2 é€‰æ‹©è¿æ¥çš„ç¯å¢ƒï¼ˆè§£é‡Šå™¨ï¼‰</h3><p>å°†ç”µè„‘ä¸Šçš„çƒ§å½•å™¨æ‹”ä¸‹é‡æ’ã€‚<br>æ‰“å¼€ Thonnyï¼Œç‚¹å‡»å³ä¸‹è§’é€‰æ‹© ESP-01S ä¸Šçš„ MicroPython å¼€å‘ç¯å¢ƒã€‚<br><img src="/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/thonny-interpreter.png" alt=""></p><div class="note info"><p>é€šè¿‡ Thonny -&gt; Configure Interpreter ä¹Ÿå¯ä»¥è¿›è¡Œå›ºä»¶çƒ§å½•å’Œå‡çº§ï¼ŒThonny å†…ç½®äº†esptoolã€‚ä½†æ˜¯èƒ½é€‰æ‹©çš„å›ºä»¶ç‰ˆæœ¬æœ‰é™ï¼Œæ¯”å¦‚ 1M flash çš„ç‰ˆæœ¬å°±æ²¡æœ‰ã€‚<br><img src="/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/configure-interpreter.png" alt=""></p></div><h3 id="4-3-è¯»å–å½“å‰-WIFI-çŠ¶æ€">4.3 è¯»å–å½“å‰ WIFI çŠ¶æ€</h3><p>æœ¬åœ°ç¼–å†™ <a href="http://demo.py">demo.py</a> æ–‡ä»¶ï¼Œç„¶åç‚¹å‡»è¿è¡Œã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> networksta_if <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>ap_if <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>AP_IF<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>sta_if<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>ap_if<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2024/12/22/esp8266-esp-01s-shao-lu-micropython-gu-jian/esp-01-show.png" alt="æ˜¾ç¤ºå½“å‰WIFIçŠ¶æ€ï¼ŒAP=True/ STA=False"></p><h2 id="5-æµ‹è¯•è¿æ¥-WIFI">5. æµ‹è¯•è¿æ¥ WIFI</h2><p>åˆ‡æ¢æˆ STA æ¨¡å¼ â€”â€” è¿æ¥æœ¬åœ°WIFIã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> networksta_if <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>ap_if <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>AP_IF<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>sta_if<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>ap_if<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>ap_if<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>sta_if<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment"># ä½¿ç”¨è‡ªå·±æœ¬åœ°çš„ WIFI SID name å’Œ password æ›¿æ¢</span>sta_if<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'&lt;AP_name&gt;'</span><span class="token punctuation">,</span> <span class="token string">'&lt;key&gt;'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>sta_if<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>sta_if<span class="token punctuation">.</span>ipconfig<span class="token punctuation">(</span><span class="token string">'addr4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> iOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOT </tag>
            
            <tag> æ ‘è“æ´¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨hexoèœå•ä¸ŠæŒ‚è½½gitbookè‡ªåˆ¶çš„wiki</title>
      <link href="/2024/12/20/zai-hexo-cai-dan-shang-gua-zai-gitbook-zi-zhi-de-wiki/"/>
      <url>/2024/12/20/zai-hexo-cai-dan-shang-gua-zai-gitbook-zi-zhi-de-wiki/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æƒ³è¦åœ¨åšå®¢ä¸ŠæŒ‚è½½ä¸€ä¸ªçŸ¥è¯†åº“ï¼Œè™½ç„¶æ›´æ¢åšå®¢çš„ä¸»é¢˜æ˜¯ä¸€ç§è§£å†³æ–¹å¼ï¼Œä½†å®åœ¨ä¸æƒ³æŠ˜è…¾ï¼Œäºæ˜¯å°±ç”¨ gitbook-cli æ¥æ­å»ºä¸€ä¸ªçŸ¥è¯†åº“ï¼Œç„¶åé€šè¿‡ hexo æ¥éƒ¨ç½²åˆ°åšå®¢ä¸Šï¼Œè¿™æ ·æ—¢å¯ä»¥åˆ©ç”¨ hexo çš„åšå®¢åŠŸèƒ½ï¼Œåˆå¯ä»¥åˆ©ç”¨ gitbook çš„çŸ¥è¯†åº“åŠŸèƒ½ã€‚</p><div class="note info"><p>å¯¹äºæ–°æ­å»ºåšå®¢çš„äººæ¥è¯´ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸æ¨èï¼š</p><ol><li>gitbook-cli ç”±äº <a href="http://gitbook.com">gitbook.com</a> å®˜æ–¹æ¨è¿›å•†ä¸šåŒ–çš„åŸå› ï¼Œæ—©åœ¨å‡ å¹´å‰å°±åœæ­¢ç»´æŠ¤äº†ã€‚</li><li>gitbook-cli åªæ”¯æŒ nodejs 10.x ä»¥ä¸‹ç‰ˆæœ¬è¿›è¡Œæ„å»ºï¼Œå¦‚æœä½¿ç”¨ 11.x ä»¥ä¸Šç‰ˆæœ¬ï¼Œä¼šæŠ¥é”™ã€‚</li><li>ç›¸æ¯”äºä½¿ç”¨gitbook-cli, ç›´æ¥é€‰æ‹©å¸¦æœ‰ Wiki å¸ƒå±€çš„åšå®¢ä¸»é¢˜ï¼Œå¯¹äºé¡¹ç›®ç»´æŠ¤æ¥è¯´ï¼Œå¯ä»¥ä¿æŒç»“æ„ç®€å•ã€å‡å°‘ç»´æŠ¤æˆæœ¬å’Œæå‡æ•ˆç‡ã€‚</li></ol><p>å¦‚æœè€ƒè™‘äº†ä»¥ä¸Šä¸‰ç‚¹ï¼Œä»é€‰æ‹© gitbook-cli ä½œä¸ºæ–¹æ¡ˆçš„è¯ï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p></div><p>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨ hexo ä¸ŠæŒ‚è½½ gitbook è‡ªåˆ¶çš„ wiki å‘¢ï¼Ÿ</p><h3 id="1-å®‰è£…-gitbook-cli">1. å®‰è£… gitbook-cli</h3><ul><li><p>é¢„å®‰è£…ç¯å¢ƒ</p><ul><li>nodejs 10.x ä»¥ä¸‹ç‰ˆæœ¬</li><li>npm 7.x ä»¥ä¸‹ç‰ˆæœ¬</li></ul><div class="note info"><p>å¦‚æœæœ¬åœ°æœºå™¨æ— æ³•å®‰è£…ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯ä»¥å°è¯•æ”¾å¼ƒä½¿ç”¨ gitbook äº†ã€‚å› ä¸ºå³ä½¿å¯ä»¥ä½¿ç”¨ CI/CD pipeline ç¯å¢ƒæ¥æ„å»ºï¼Œä½†ç›¸æ¯”äºæœ¬åœ°æœºå™¨ï¼Œåé¦ˆå¼§æœ‰ç‚¹é•¿ï¼Œä¸åˆ©äºé¢„è§ˆå’Œè°ƒè¯•ã€‚é€‰æ‹©å…¶ä»–æ›´æ–°ä¸€äº›çš„æ–¹æ¡ˆï¼Œä¸å¤±ä¸ºä¸€ç§æ›´å¥½çš„æ­å»ºçŸ¥è¯†åº“çš„æ–¹å¼ã€‚</p></div></li><li><p>å®‰è£…</p>  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> gitbook-cli <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="2-åˆå§‹åŒ–-gitbook-é¡¹ç›®">2. åˆå§‹åŒ– gitbook é¡¹ç›®</h3><ol><li><p>æœ¬åœ°åˆ›å»º gitbook é¡¹ç›®ç›®å½•</p></li><li><p>åˆå§‹åŒ– gitbook é¡¹ç›®</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> wiki<span class="token builtin class-name">cd</span> wikinpx gitbook init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆ gitbook çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼Œè‡ªå¸¦é»˜è®¤æ–‡ä»¶ï¼š</p><ul><li><a href="http://README.md">README.md</a>ï¼šé»˜è®¤å°é¢ inntroduction é¡µé¢ã€‚</li><li><a href="http://SUMMARY.md">SUMMARY.md</a>ï¼šwiki æ˜¾ç¤ºåœ¨å·¦ä¾§ä¾§è¾¹æ çš„å†…å®¹ã€‚</li><li>book.jsonï¼šéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œgitbook é…ç½®ç®¡ç†æ–‡ä»¶ã€‚</li></ul></li><li><p>æœ¬åœ°è¿è¡Œ gitbook</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx gitbook serve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h3 id="3-åœ¨-hexo-åšå®¢ä¸Šæ·»åŠ wikièœå•">3. åœ¨ hexo åšå®¢ä¸Šæ·»åŠ wikièœå•</h3><p>åœ¨ hexo ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ <code>_config.yml</code> ä¸­æ·»åŠ å¦‚ä¸‹èœå•é…ç½®ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">menu</span><span class="token punctuation">:</span>  <span class="token key atrule">Wiki</span><span class="token punctuation">:</span>    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>book    <span class="token key atrule">url</span><span class="token punctuation">:</span> /wiki/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åï¼Œå°†æ›´æ–°å¥½çš„ä¸»é¢˜é€šè¿‡åšå®¢é¡¹ç›®è¿›è¡Œéƒ¨ç½²ã€‚</p><h3 id="4-éƒ¨ç½²-wiki">4. éƒ¨ç½² wiki</h3><p>å¯ä»¥é‡‡ç”¨å¤šç§æ–¹å¼éƒ¨ç½²ï¼Œå¦‚æœåšå®¢å·²ç»ä½¿ç”¨çš„ GitHub Pages è¿è¥, è§ä¸‹ 4.1ã€‚</p><h4 id="4-1-github-pages-éƒ¨ç½²æ–¹å¼">4.1 github pages éƒ¨ç½²æ–¹å¼</h4><ol><li><p>å°†æœ¬åœ° wiki é¡¹ç›® push åˆ° github repo</p></li><li><p>é…ç½® Github Action flowï¼Œæ–‡ä»¶ä½ç½® .github/workflows/pages.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy with GitHub Pages dependencies preinstalled<span class="token key atrule">on</span><span class="token punctuation">:</span>  <span class="token key atrule">push</span><span class="token punctuation">:</span>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"main"</span><span class="token punctuation">]</span>  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span><span class="token key atrule">permissions</span><span class="token punctuation">:</span><span class="token key atrule">contents</span><span class="token punctuation">:</span> read<span class="token key atrule">pages</span><span class="token punctuation">:</span> write<span class="token key atrule">id-token</span><span class="token punctuation">:</span> write<span class="token key atrule">concurrency</span><span class="token punctuation">:</span><span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">"pages"</span><span class="token key atrule">cancel-in-progress</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">jobs</span><span class="token punctuation">:</span><span class="token key atrule">build</span><span class="token punctuation">:</span>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest    <span class="token key atrule">steps</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v4    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Gitbook Action        <span class="token comment"># ä½¿ç”¨æ’ä»¶ gitbook-action è¿›è¡Œ gitbook æ„å»º</span>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> ZanderZhao/gitbook<span class="token punctuation">-</span>action@v1.2.4        <span class="token key atrule">with</span><span class="token punctuation">:</span>        <span class="token key atrule">token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.FOR_GITPAGE_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>        <span class="token key atrule">source_branch</span><span class="token punctuation">:</span> main        <span class="token key atrule">publish_branch</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é…ç½® github repo setting</p> <div class="note info"><p>ç”±äºåšå®¢ä¸»ç«™å·²ç»ä½¿ç”¨ GitHub Pagesï¼Œé»˜è®¤åŸŸåæ˜¯ <code>${username}.github.io</code>ã€‚<br>æ¯ä¸ª Github è´¦å·ï¼Œåœ¨ Github pages ä»…èƒ½åˆ›å»ºä¸€ä¸ªä¸»ç«™ç‚¹ï¼Œä½†å¯ä»¥åˆ›å»ºå¤šä¸ªå­ç«™ç‚¹ â€”â€” åœ¨ä¸»ç«™ç‚¹å·²åˆ›å»ºçš„æƒ…å†µä¸‹ï¼Œå…¶ä»– Github pages çš„é¡¹ç›®éƒ½ä¼šè¢«åˆ†é…åˆ°ä¸»ç«™ç‚¹çš„åŸŸåä¹‹ä¸‹ï¼Œæ¯”å¦‚<code>${username}.github.io/wiki</code> ã€‚</p></div></li></ol><p>ç”±äºç¬¬äºŒæ­¥ workflow çš„ <code>publish_branch</code> è®¾ç½®ä¸º <code>gh-pages</code>ï¼Œæ‰€ä»¥åœ¨ github repo setting ä¸­é…ç½® pages æ—¶éœ€è¦å°† <code>Branch</code> è®¾ç½®ä¸º <code>gh-pages</code>ã€‚<br><img src="/2024/12/20/zai-hexo-cai-dan-shang-gua-zai-gitbook-zi-zhi-de-wiki/github-setting-page.png" alt="åœ¨ wiki repo ä¸­é…ç½® pages"></p><h4 id="4-2-è‡ªè¿è¥æœåŠ¡å™¨éƒ¨ç½²æ–¹å¼">4.2 è‡ªè¿è¥æœåŠ¡å™¨éƒ¨ç½²æ–¹å¼</h4><p>å¦‚æœæ˜¯ä½¿ç”¨çš„è‡ªè¿è¥æœåŠ¡å™¨ï¼Œæˆ‘éƒ¨ç½²çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>é€šè¿‡ Github Action å°† wiki é¡¹ç›®ç¼–è¯‘å¥½çš„æ–‡ä»¶ push åˆ°åšå®¢ä¸»ç«™çš„ repo æºç ä¸­ã€‚</li><li>é€šè¿‡åšå®¢ä¸»ç«™çš„ Github Action éƒ¨ç½²ä¸»ç«™çš„æ—¶å€™ï¼Œå°† wiki çš„æ–‡ä»¶æ‰“åŒ…è¿›ä¸»ç«™çš„éƒ¨ç½²ç›®å½•ä¸­ã€‚</li><li>ä¸»ç«™éƒ¨ç½²å®Œæˆæ—¶ï¼Œwiki ä½œä¸ºä¸€ä¸ªå­ç›®å½•éƒ¨ç½²åˆ°äº†åšå®¢ä¸»ç«™ä¸­ã€‚</li></ol><p>å› æ­¤ï¼Œæ‰§è¡Œå±‚é¢ä¸Šï¼š</p><ol><li>åœ¨ wiki repo çš„ Action flow ä¸­ï¼Œé™¤äº†è®¾ç½® <code>publish_branch</code> ä¹‹å¤–ï¼Œè¿˜è¦è®¾ç½® <code>publish_repo</code> å’Œ <code>publish_dir</code>ï¼Œå¦‚ä¸‹ï¼š</li></ol>  <pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>  <span class="token key atrule">build</span><span class="token punctuation">:</span>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest    <span class="token key atrule">steps</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v4      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Gitbook Action        <span class="token key atrule">uses</span><span class="token punctuation">:</span> ZanderZhao/gitbook<span class="token punctuation">-</span>action@v1.2.4        <span class="token key atrule">with</span><span class="token punctuation">:</span>          <span class="token key atrule">token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.FOR_GITPAGE_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>          <span class="token key atrule">source_branch</span><span class="token punctuation">:</span> main          <span class="token comment"># å‘å¸ƒåˆ°ä¸»ç«™çš„ repo åœ°å€ã€branch å’Œå…·ä½“çš„ç›®å½•è·¯å¾„</span>          <span class="token key atrule">publish_repo</span><span class="token punctuation">:</span> xxx/xxx.github.io          <span class="token key atrule">publish_branch</span><span class="token punctuation">:</span> stable<span class="token punctuation">-</span>source          <span class="token key atrule">publish_dir</span><span class="token punctuation">:</span> /books/wiki<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä¿®æ”¹ä¸»ç«™çš„ Action flow æ–‡ä»¶ï¼Œåœ¨ build stage ä¸­ï¼Œæ·»åŠ å¤åˆ¶æ–‡ä»¶çš„æ­¥éª¤ï¼š</li></ol>  <pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>  <span class="token key atrule">build</span><span class="token punctuation">:</span>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest    <span class="token key atrule">steps</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup Node        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3.1.1        <span class="token key atrule">with</span><span class="token punctuation">:</span>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'19.x'</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Before install        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">          sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules          git submodule update --init --recursive          git submodule update --remote --merge          npm install</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">          npm run clean          npm run build -d          # å¤åˆ¶ç¼–è¯‘å¥½çš„ wiki æ–‡ä»¶åˆ°éƒ¨ç½²ç›®å½•ä¸­          cp -r books/wiki public/wiki</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-å®Œæˆ">5. å®Œæˆ</h3><p>éƒ¨ç½²å®Œæˆåï¼Œå°±å¯ä»¥é€šè¿‡ç‚¹å‡»åšå®¢ä¸»ç«™çš„æ–°wikièœå•è·³è½¬åˆ° wiki ä¸»é¡µäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢æ­å»º </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åšå®¢æ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®ä¿¡å°ç¨‹åºæ¶ˆæ¯è®¢é˜…è¹šæ°´å¼é›†æˆ</title>
      <link href="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/"/>
      <url>/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€è¯»ç‰ˆ">ç®€è¯»ç‰ˆ</h2><p><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/wx-subscription.jpg" alt="æ¶ˆæ¯è®¢é˜…è¿‡ç¨‹"></p><h3 id="ä¸€å¼ å›¾è®²æ¸…æ¥šå¾®ä¿¡æ¶ˆæ¯è®¢é˜…çš„æµç¨‹">ä¸€å¼ å›¾è®²æ¸…æ¥šå¾®ä¿¡æ¶ˆæ¯è®¢é˜…çš„æµç¨‹</h3><p>å¾®ä¿¡æ¶ˆæ¯è®¢é˜…åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li>ç¬¬ä¸€é˜¶æ®µï¼Œç”¨æˆ·åŒæ„è¿›è¡Œä¸€æ¬¡æ¶ˆæ¯è®¢é˜…ã€‚<br>åœ¨å°ç¨‹åºé€šè¿‡æœ¬åœ°API <code>wx.requestSubscribeMessage</code> è°ƒèµ·ä¸ç”¨æˆ·çš„äº¤äº’å¼¹çª—ã€å‘é€ä¸€æ¬¡ä»¥ä¸‹æ¶ˆæ¯ã€‘ï¼Œç”¨æˆ·ç‚¹å‡»å…è®¸åï¼Œå°ç¨‹åºè°ƒç”¨å¾®ä¿¡å¹³å°çš„æŸä¸ªAPIã€‚ç„¶åå¾®ä¿¡å¹³å°é€šè¿‡å¼€å‘è€…é…ç½®çš„ã€æ¶ˆæ¯æ¨é€ã€‘åœ°å€ï¼ˆæ¯”å¦‚ä¸Šå›¾ä¸­çš„<code>/api/wx-notification</code>ï¼‰ï¼Œå°†ç”¨æˆ·åŒæ„ä¸€æ¬¡æ¶ˆæ¯é€šçŸ¥çš„äº‹ä»¶ç»“æœæ¨é€ç»™å¼€å‘è€…æœåŠ¡å™¨ã€‚</li><li>ç¬¬äºŒé˜¶æ®µï¼Œå¼€å‘è€…æœåŠ¡å™¨å±¥çº¦ä¸€æ¬¡æ¶ˆæ¯è®¢é˜…ã€‚<br>å½“å¼€å‘è€…æœåŠ¡å™¨éœ€è¦æ¨é€è¿™ä¸€æ¬¡è¢«ç”¨æˆ·è®¢é˜…çš„ä¸šåŠ¡æ¶ˆæ¯ä½“æ—¶ï¼Œé¦–å…ˆè·å–å¾®ä¿¡å¹³å°è°ƒç”¨çš„AccessTokenï¼Œç„¶åé€šè¿‡ AccessToken çš„æƒé™è°ƒç”¨å¾®ä¿¡å¹³å° HTTP API å‘é€ä¸šåŠ¡æ¶ˆæ¯ã€‚ç„¶åå¾®ä¿¡å¹³å°ä¼šå°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä½“ï¼Œæ¨é€åˆ°ç”¨æˆ·æ‰‹æœºå¾®ä¿¡çš„ã€æœåŠ¡é€šçŸ¥ã€‘æ å†…ã€‚å¦‚æœå¼€å‘è€…å‘é€çš„ä¸šåŠ¡æ¶ˆæ¯ä½“å¸¦æœ‰â€œè·³è½¬é“¾æ¥â€çš„ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æ¶ˆæ¯å¡ç‰‡æ—¶ï¼Œä¼šè·³è½¬åˆ°å°ç¨‹åºçš„æŒ‡å®šé¡µé¢ä¸Šã€‚</li></ol><h3 id="é‡åˆ°çš„å‘ï¼š">é‡åˆ°çš„å‘ï¼š</h3><ol><li>å°ç¨‹åºå¼€å‘é˜¶æ®µï¼Œåœ¨ devTool ä¸Šç‚¹å‡»â€œå…è®¸å‘é€æ¶ˆæ¯â€æ—¶ï¼Œä¸ä¼šè§¦å‘å¾®ä¿¡å¹³å°æ¨é€äº‹ä»¶ç»“æœç»™å¼€å‘è€…æœåŠ¡å™¨ã€‚<br><strong>ã€è§£å†³æ–¹å¼ã€‘</strong>ï¼šå¦‚æœéœ€è¦åœ¨å°ç¨‹åºå¼€å‘ç‰ˆä¸Šè¿›è¡Œæµ‹è¯•çš„è¯ï¼Œåªèƒ½é€šè¿‡æ‰‹æœºæ‰«æ devToolä¸Š çš„äºŒç»´ç ï¼Œè¿›è¡ŒçœŸæœºè°ƒè¯•ã€‚</li><li>å¾®ä¿¡å¹³å°æä¾›çš„æ¨é€äº‹ä»¶ç»“æœçš„<a href="https://developers.weixin.qq.com/apiExplorer?type=messagePush">æ¶ˆæ¯æ¨é€è°ƒè¯•å·¥å…·</a>-<strong>â€œè°ƒè¯•å·¥å…·â€</strong>, æ˜æ–‡æ¨¡å¼å³ä½¿æ˜¯æŒ‰ç…§æ–‡æ¡£è¯´æ˜ response ç©ºå­—ç¬¦ä¸²æˆ–è€…successï¼Œä¾ç„¶ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯â€œå›åŒ…æ ¼å¼éæ³•â€ã€‚<br><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/echo-debug.png" alt=""><br><strong>ã€è§£å†³æ–¹å¼ã€‘</strong>ï¼šæœªæ‰¾åˆ°è§£å†³æ–¹å¼ï¼Œå¾®ä¿¡ç¤¾åŒºä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜å‘å¸–ã€‚é€šè¿‡è§‚å¯Ÿï¼Œç›®å‰ä¸å½±å“äº‹ä»¶ç»“æœçš„æ¨é€å’Œåç»­æ¨é€ã€‚</li><li>å¾®ä¿¡å¹³å°æ¨é€çš„äº‹ä»¶ç»“æœä¸æ–‡æ¡£ç¤ºä¾‹ä¸ä¸€è‡´ï¼Œé€ æˆè¯¯è®¤ä¸ºå¾®ä¿¡å¹³å°ä¸æ¨é€äº‹ä»¶ç»“æœã€‚<br><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/event-request-json.png" alt="æ–‡æ¡£ä¸Šçš„ç¤ºä¾‹"><br>è€Œå®é™…ä¸Šï¼š<br><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/runtime-event-request-json.png" alt="å®é™…ä¸Šçš„æ ¼å¼"><br>å½“ç„¶ï¼Œéƒ¨åˆ†å¾®ä¿¡æ–‡æ¡£ä¸Šç”¨æ–‡å­—å¤‡æ³¨è¡¥æ•‘äº†è¿™ä¸ªé—®é¢˜ï¼šList å†…å…ƒç´ ä¸ºå•ä¸ªï¼Œå³è¿”å›å¯¹è±¡ï¼Œå¦åˆ™æ‰è¿”å›æ•°ç»„ã€‚ï¼ˆå…¸å‹çš„ â€”â€” ä¸ä¿®æ­£ä»£ç ï¼Œä¿®æ­£æ–‡æ¡£å¤‡æ³¨ï¼Œæˆ‘å…ˆç¬‘ä¸€ä¸ªï¼‰<br><strong>ã€è§£å†³æ–¹å¼ã€‘</strong>ï¼šå…ˆå…³é—­åç«¯ API çš„ request æ ¼å¼æ ¡éªŒï¼Œä¸»åŠ¨æ—¥å¿—æ‰“å° request bodyï¼Œé‡æ–°æ ¹æ®å®é™…è¿è¡Œæ—¶çš„ request body è‡ªå®šä¹‰ request æ ¼å¼æ ¡éªŒã€‚<br>å¦‚æœå¯¹ List è¿™ä¸ª 1 æˆ– N çš„ Bug æ„Ÿåˆ°åŒå€¦ï¼Œå¯ä»¥åœ¨ request æ ¼å¼æ ¡éªŒæ—¶ï¼Œæ’é™¤å¯¹ List è¿™ä¸ªå­—æ®µçš„æ ¡éªŒã€‚æˆ‘å°±æ˜¯è¿™æ ·å¹²çš„ã€‚</li><li>å¾®ä¿¡æ¨é€çš„äº‹ä»¶ç»“æœä¸­çš„ <strong>ToUserName</strong> ä½¿ç”¨çš„æ˜¯å°ç¨‹åºè´¦å·åŸå§‹IDï¼Œå¹¶éæ˜¯å°ç¨‹åºå¼€å‘æ—¶å¸¸ç”¨çš„è¯†åˆ«èº«ä»½çš„ AppIDã€‚<br><strong>ã€è§£å†³æ–¹å¼ã€‘</strong>ï¼šå¼€å‘è€…æœåŠ¡å™¨è‡ªå·±é¢å¤–ä¿å­˜ originAccountID åˆ° AppID çš„å¯¹ç…§å…³ç³»ï¼Œæ¥æ”¶åˆ°äº‹ä»¶æ¨é€çš„æ—¶å€™ï¼Œåšä¸€æ¬¡ toAppID çš„è½¬æ¢ã€‚</li></ol><h3 id="ä¸ªäººå“”å“”ä¸¤å¥">ä¸ªäººå“”å“”ä¸¤å¥</h3><p>ä½œä¸ºä¸€ä¸ªå¤šå¹´çš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿçš„æ¶æ„å’Œå¼€å‘è€…ï¼Œä¸€ä¸ªä¼ä¸šåº”ç”¨ â€”â€” å°‘åˆ™éœ€è¦ä¸ä¼ä¸šå†…éƒ¨å…¶ä»–ç³»ç»Ÿé›†æˆä¸Š10ä¸ªï¼Œå¤šåˆ™40ã€50ä¸ªï¼Œè°ˆé›†æˆä¸€ç›´æ˜¯åº”ç”¨å¼€å‘çš„ä¸€å¤§é‡ç‚¹ã€‚<br>å› æ­¤ï¼Œè™½ç„¶å¾®ä¿¡çš„æ¶ˆæ¯è®¢é˜…é›†æˆä¸­é‡åˆ°äº†ä¸€äº›ä¸æ„‰å¿«åœ°å°å‘ï¼Œç”šè‡³ä¼šå½±å“å¼€å‘ä½“éªŒï¼Œä½†ä½œä¸ºä¸€ä¸ªç»å¸¸éœ€è¦è°ˆé›†æˆçš„æŠ€æœ¯ä¹Ÿä¸æ˜¯ä¸èƒ½ç†è§£ï¼šä¸€èˆ¬é›†æˆçš„è®¾è®¡å’Œåå•†éƒ¨åˆ†ï¼Œä¼šæŒ‡æ´¾èµ„æ·±ä¸€äº›çš„æŠ€æœ¯äººå‘˜åŒæ–¹å®šå¥½é›†æˆæ–¹å¼ã€åè®®ã€ç»“æ„ä½“å’Œé¢‘æ¬¡ç­‰ç­‰ï¼›è€Œåœ¨å¼€å‘éƒ¨åˆ†å’Œè”è°ƒéƒ¨åˆ†ï¼Œåˆ™ä¼šç”±ä¸€äº›æ™®é€šå¼€å‘äººå‘˜è¿›è¡Œä»£ç å¼€å‘å’Œè°ƒè¯•ã€‚æ¯”å¦‚ï¼šä¸Šé¢ç¬¬3ä¸ªå‘å‡ºç°çš„é—®é¢˜ï¼Œå¯èƒ½å†™ä»£ç ç”šè‡³æ˜¯ä¸€ä¸ªæ¯•ä¸šç”Ÿæˆ–è€…å®ä¹ ç”Ÿã€‚ã€‚<br>ä¸€èˆ¬ä¸ºäº†é˜²æ­¢ä¸Šé¢è¿™ç§å‘çš„å‡ºç°ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›æ‹¥æœ‰å¼€å‘è§„èŒƒçš„æ­£è§„å‚å•†ï¼Œæœ‰ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼š</p><ol><li>åœ¨é›†æˆçš„è®¾è®¡é˜¶æ®µï¼Œä½¿ç”¨å·¥å…·å°†è®¾è®¡å¥½çš„æ¥å£å½¢æˆæ ¼å¼åŒ–çš„å¥‘çº¦ï¼ˆæ¯”å¦‚swagger yamlç­‰ç­‰ï¼‰ï¼Œå¹¶ä¸”å¼€å‘é˜¶æ®µååœ¨ pipeline ä¸Šå®šæœŸå¯¹ä»£ç è¿›è¡Œ <strong>å¥‘çº¦æµ‹è¯•</strong>ã€‚</li><li>éè‡ªåŠ¨åŒ–çš„æ–¹æ¡ˆä¹Ÿæœ‰ï¼Œæ¯”å¦‚ï¼šå¼€å‘äººå‘˜æ¯å¤©è¿›è¡Œcode reviewã€æˆ–è€…æäº¤ä»£ç æ—¶æ PR ç­‰ã€‚</li></ol><h2 id="æµç¨‹æ“ä½œç‰ˆ">æµç¨‹æ“ä½œç‰ˆ</h2><h3 id="1-å‡†å¤‡é˜¶æ®µ">1. å‡†å¤‡é˜¶æ®µ</h3><h4 id="1-1-é€‰æ‹©ä¸šåŠ¡æ¶ˆæ¯æ¨¡æ¿">1.1 é€‰æ‹©ä¸šåŠ¡æ¶ˆæ¯æ¨¡æ¿</h4><p>å°ç¨‹åºæ¶ˆæ¯è®¢é˜…çš„æ¶ˆæ¯åˆ†ä¸ºå››ç±»ï¼šæ–°ç‰ˆä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯Betaï¼ˆä¸ç”¨å¼¹çª—ï¼‰ã€ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯ï¼ˆç”¨æˆ·é€šè¿‡å¼¹çª—è®¢é˜…ï¼‰ã€é•¿æœŸè®¢é˜…æ¶ˆæ¯ã€è®¾å¤‡è®¢é˜…æ¶ˆæ¯ã€‚</p><p>ä½œä¸ºä¸ªäººçš„å°ç¨‹åºèµ„è´¨ï¼Œé€‰æ‹©äº†ç¬¬ 2 ç§ â€”â€” ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯ï¼ˆç”¨æˆ·é€šè¿‡å¼¹çª—è®¢é˜…ï¼‰ã€‚å…¶ä»–ä¸‰ç±»ï¼Œåœ¨èµ„è´¨å’Œä½¿ç”¨åœºæ™¯ä¸Šéƒ½æœ‰ä¸åŒçš„é™åˆ¶ã€‚</p><p>æŒ‰ç…§ <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html">å°ç¨‹åºè®¢é˜…æ¶ˆæ¯å¼€å‘è€…æŒ‡å¼•</a> ç¬¬ä¸€æ­¥å®Œæˆæ¨¡æ¿çš„é€‰æ‹©ï¼Œå°†å…¬å…±æ¨¡æ¿æ·»åŠ å…¥ã€æˆ‘çš„æ¨¡ç‰ˆåº“ã€‘ä¸­å‡†å¤‡ä½¿ç”¨ã€‚<br>è·å–å¼€å‘ä¸­éœ€è¦ä½¿ç”¨çš„<code>templateId</code>ï¼Œä»¥åŠæ¨¡ç‰ˆå†…å®¹éœ€è¦çš„å˜é‡ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„<code>thing1</code>ã€<code>phrase3</code>ã€<code>time4</code>å’Œ<code>Thing5</code>ã€‚<br><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/template.png" alt=""></p><h3 id="2-å¼€å‘é˜¶æ®µ">2. å¼€å‘é˜¶æ®µ</h3><p>è®¤è¯†åˆ°ä¸‰ä¸ªé¢„å®šä¹‰çš„å˜é‡ï¼š</p><ol><li><strong>Token</strong>ï¼šå¾®ä¿¡å¹³å°ä¸å¼€å‘è€…æœåŠ¡å™¨ä¹‹é—´ï¼Œç”Ÿæˆç­¾åå’ŒéªŒè¯ç­¾åæ—¶ä½¿ç”¨çš„ä¿å¯†å­—ç¬¦ä¸²ã€‚</li><li><strong>EncodingAESKey</strong>ï¼šå¾®ä¿¡å¹³å°ä¸å¼€å‘è€…æœåŠ¡å™¨ä¹‹é—´ï¼ŒåŠ å¯†æ¶ˆæ¯å’Œè§£å¯†æ¶ˆæ¯æ—¶ä½¿ç”¨çš„å¯¹ç§°å¯†é’¥ã€‚</li><li><strong>templateID</strong>ï¼šå³ä¸Šé¢å‡†å¤‡é˜¶æ®µè·å–çš„æ¨¡ç‰ˆ IDã€‚</li></ol><p>è®¤è¯†åˆ°å¾®ä¿¡é›†æˆçš„æ¶ˆæ¯ä½“ç»“æ„ï¼š</p><ol><li><strong>JSON å’Œ XML</strong>ï¼Œ å¾®ä¿¡å¹³å°æ¨é€äº‹ä»¶ï¼ˆrequest bodyï¼‰æ—¶æ”¯æŒè¿™ä¸¤ç§æ ¼å¼ï¼Œå¯åœ¨å¾®ä¿¡å¹³å°é…ç½®æ¶ˆæ¯æ¨é€æ—¶æŒ‡å®šæ ¼å¼ã€‚</li><li><strong>æ˜æ–‡æ¨¡å¼ã€å…¼å®¹æ¨¡å¼ã€å®‰å…¨æ¨¡å¼</strong>ï¼Œå¾®ä¿¡å¹³å°å¯¹æ¨é€äº‹ä»¶å†…å®¹è¿›è¡ŒåŠ è§£å¯†çš„æ–¹å¼ã€‚é€‰æ‹©æ˜æ–‡æ¨¡å¼ï¼Œå¾®ä¿¡ä¸ä¼šå¯¹æ¶ˆæ¯å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œå®‰å…¨æ¨¡å¼åˆ™ä¼šåŠ å¯†ã€‚<br><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/development-config.jpeg" alt=""></li></ol><h4 id="2-1-ç”¨äºæµ‹è¯•éªŒç­¾çš„GET-API">2.1 ç”¨äºæµ‹è¯•éªŒç­¾çš„GET API</h4><p>å¼€å‘è€…æœåŠ¡å™¨æ¥æ”¶å¾®ä¿¡äº‹ä»¶æ¨é€çš„ HTTP API éœ€è¦æ˜¯ä¸€æ¡ POST Method APIã€‚<br>ä½†å¾®ä¿¡è¦æ±‚å¼€å‘è€…æœåŠ¡å™¨æä¾›ä¸€æ¡ç›¸åŒè·¯å¾„çš„ GET Method APIï¼Œç”¨ä»¥é…ç½®æ—¶å¯¹æ¶ˆæ¯æ¨é€åœ°å€è¿›è¡Œæµ‹è¯•ã€‚æ­¤API ä¸»è¦çš„ä½œç”¨ï¼š</p><ol><li>è¿é€šæ€§éªŒè¯</li><li>éªŒè¯å¼€å‘è€…éªŒç­¾ç®—æ³•çš„æ­£ç¡®æ€§</li><li>éªŒè¯å¼€å‘è€…å†…å®¹è§£ç ç®—æ³•çš„æ­£ç¡®æ€§ï¼ˆå¦‚æœé€‰æ‹©æ˜æ–‡ä¼ è¾“ï¼Œåˆ™ä¸éœ€è¦è§£å¯†ï¼‰</li></ol><h5 id="1-éªŒç­¾">1. <strong>éªŒç­¾</strong></h5><p>å¾®ä¿¡å¹³å°å‘å¼€å‘è€…é…ç½®çš„ HTTP API æ¨é€äº‹ä»¶æ—¶ï¼Œä¼šåœ¨ queryString ä¸Šä¼ é€’3ä¸ªå‚æ•°ï¼š<code>signature</code>ã€<code>timestamp</code>ã€<code>nonce</code>ã€‚<br>å¼€å‘è€…è¿™éœ€è¦å°†ï¼ˆæ˜æ–‡æ¨¡å¼ï¼‰ï¼š</p><ol><li><code>timestamp</code>ã€<code>nonce</code> å’Œ é¢„å®šä¹‰å˜é‡ <code>token</code> ä¸€å…± 3 é¡¹å°è£…è¿›ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå¯¹æ•°ç»„è¿›è¡ŒæŒ‰å­—å…¸å‡åºæ’åºï¼Œæœ€åå°†æ•°ç»„é¡¹æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li><li>å¯¹æ­¥éª¤1ç”Ÿæˆçš„å­—ç¬¦ä¸²è¿›è¡Œ sha1 è¿ç®—ï¼Œè®¡ç®—å‡ºç­¾å calc_signatureã€‚</li><li>å°† queryString ä¸Šçš„ <code>signature</code> å€¼ä¸æ­¥éª¤2è®¡ç®—å‡ºçš„ calc_signature å€¼ï¼Œè¿›è¡Œæ¯”è¾ƒï¼šå¦‚æœç›¸ç­‰ï¼Œåˆ™è®¤ä¸ºéªŒè¯é€šè¿‡ â€”â€” å‘é€æ–¹æ‹¥æœ‰æ­£ç¡®çš„ä¿å¯†å­—ç¬¦ä¸²ï¼Œå¦åˆ™è®¤ä¸ºéªŒè¯ä¸é€šè¿‡ã€‚</li></ol><p>ä»¥ä¸Šæ˜¯<strong>æ˜æ–‡æ¨¡å¼</strong>ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š<br><strong>input</strong>: <code>signature</code>ã€<code>timestamp</code>ã€<code>nonce</code>ã€<code>token</code><br><strong>output</strong>: return calc_signature == signature</p><p><strong>å®‰å…¨æ¨¡å¼</strong>ï¼Œä¸åŒçš„ç‚¹æ˜¯ï¼š<br><strong>input</strong>: <code>msg_signature</code>ã€<code>timestamp</code>ã€<code>nonce</code>ã€<code>token</code>ã€<code>Encrypt</code><br><strong>output</strong>: return calc_signature == msg_signature</p><ul><li>éœ€è¦å¤šåŠ å…¥ request body ä¸­çš„ <code>Encrypt</code>ï¼Œä¸€å…± 4 é¡¹è¿›è¡Œ sha1 è®¡ç®—ç­¾å calc_signatureã€‚</li><li>éªŒç­¾æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ queryString ä¸Šçš„ <code>msg_signature</code> å€¼ã€‚</li></ul><h5 id="2-åŠ è§£å¯†">2. <strong>åŠ è§£å¯†</strong></h5><p>å¾®ä¿¡è¦æ±‚å¼€å‘è€…ä½¿ç”¨ï¼š</p><ol><li>ä½¿ç”¨ <strong>PKCS#7</strong> æ ‡å‡†çš„å¡«å……è§„åˆ™ï¼Œæ¥å°è£…åŸå§‹æ¶ˆæ¯å†…å®¹ã€‚</li><li>ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³• AES çš„ CBC æ¨¡å¼ æ¥åŠ è§£å¯†ã€‚</li><li>éœ€è¦ç”¨åˆ°é¢„å®šä¹‰å˜é‡ä¸­çš„ <code>EncodingAESKey</code> ã€‚</li></ol><p>è¿™éƒ¨åˆ†å¾®ä¿¡æä¾›äº†ä¸åŒè¯­è¨€çš„ Sample ä»£ç ï¼Œå¯ç›´æ¥å‚è€ƒä»£ç ã€‚<a href="https://wximg.gtimg.com/shake_tv/mpwiki/cryptoDemo.zip">åŠ è§£å¯†å®˜æ–¹æä¾› Sample code</a></p><h5 id="3-æµ‹è¯•">3. <strong>æµ‹è¯•</strong></h5><p>å½“ GET API å¼€å‘å®Œæˆï¼Œå¹¶å‘å¸ƒåˆ°å¼€å‘è€…æœåŠ¡å™¨ä¸Šä¹‹åï¼Œå¯ä»¥ä½¿ç”¨å¾®ä¿¡æä¾›çš„<a href="https://developers.weixin.qq.com/apiExplorer?type=messagePush">æ¶ˆæ¯æ¨é€è°ƒè¯•å·¥å…·</a>çš„ç¬¬ä¸€ä¸ª â€œ<strong>URLé…ç½®éªŒè¯</strong>â€ å¯¹ GET API è¿›è¡ŒéªŒè¯å’Œè¯Šæ–­ã€‚æ³¨æ„ï¼Œè¿™æ—¶è¿˜ä¸éœ€è¦å»å°ç¨‹åºç®¡ç†åå°è®¾ç½®å¼€å‘è€…æœåŠ¡å™¨åœ°å€ã€‚</p><h5 id="4-æå‰é…ç½®éªŒè¯">4. <strong>æå‰é…ç½®éªŒè¯</strong></h5><p>åœ¨å®Œæˆäº†â€œURLé…ç½®éªŒè¯â€çš„æµ‹è¯•ä¹‹åï¼Œå¯ä»¥è€ƒè™‘æå‰å»å¾®ä¿¡å¹³å°é…ç½®å¼€å‘è€…æœåŠ¡å™¨åœ°å€ï¼ˆå¦‚æœæœ‰æµ‹è¯•ç¯å¢ƒï¼Œå»ºè®®å…ˆé…ç½®æˆæµ‹è¯•ç¯å¢ƒï¼‰ã€‚<br>ç™»å½• <a href="https://mp.weixin.qq.com/">å°ç¨‹åºç®¡ç†åå°</a> ï¼Œåœ¨ã€å¼€å‘ç®¡ç†ã€‘é¡µé¢å®Œæˆé…ç½®ï¼Œæ®è¯´åœ¨ç‚¹å‡»â€œæäº¤â€æ—¶ï¼Œå¾®ä¿¡ä¼šå»éªŒè¯è¿™æ¡GET APIã€‚<br><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/development-config.jpeg" alt=""></p><h4 id="2-2-ç”¨äºæ¥æ”¶å¾®ä¿¡æ¨é€äº‹ä»¶ç»“æœçš„-POST-API">2.2 ç”¨äºæ¥æ”¶å¾®ä¿¡æ¨é€äº‹ä»¶ç»“æœçš„ POST API</h4><p>è¿™æ¡ POST APIï¼Œ æ‰æ˜¯çœŸæ­£æ¥æ”¶å¾®ä¿¡äº‹ä»¶æ¶ˆæ¯çš„ APIã€‚<br>é™¤äº†éªŒç­¾å’ŒåŠ è§£å¯†å¿…è¦çš„ input ä¹‹å¤–ï¼Œå¾®ä¿¡ä¼ å…¥çš„ request body æ˜æ–‡ JSON ï¼ˆæˆ–è€…è§£å¯†ä¹‹åï¼‰æ˜¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">{  "ToUserName": "gh_123456789abc",  "FromUserName": "o7esq5OI1Uej6Xixw1lA2H7XDVbc",  "CreateTime": "1620973045",  "MsgType": "event",  "Event": "subscribe_msg_popup_event",  "List": {        "TemplateId": "hD-ixGOhYmUfjOnI8MCzQMPshzGVeux_2vzyvQu7O68",        "SubscribeStatusString": "accept",        "PopupScene": "0"    }, }# è‹¥ "List" åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™åªè¿”å›å¯¹è±¡æœ¬èº«ï¼›è‹¥ "List" å¤šäºä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯¹è±¡çš„æ•°ç»„ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤API éœ€è¦ï¼š</p><ol><li>ç»§æ‰¿ GET API ä¸­<strong>éªŒç­¾</strong>å’Œ<strong>åŠ è§£å¯†</strong>çš„èƒ½åŠ›ã€‚</li><li>ä¸ºäº†ä¾¿äºæ¶ˆæ¯æ¨é€è°ƒè¯•å·¥å…·è¿›è¡Œè°ƒè¯•ï¼Œä»£ç åˆ†æ”¯ä¸Šå¯ä»¥æ”¯æŒ <code>Event</code>å€¼ä¸º â€œdebug_demoâ€ çš„å¤„ç†é€»è¾‘ã€‚å¦‚æœ Event ç­‰äº <strong>debug_demo</strong>ï¼Œäº‹ä»¶ç»“æœä¸è¯»å– <code>List</code>ï¼Œéœ€è¦è¯»å–<code>debug_str</code>ã€‚ <pre class="line-numbers language-none"><code class="language-none"># debug çš„ request body{    "ToUserName": "gh_97417a04a28d",    "FromUserName": "o9AgO5Kd5ggOC-bXrbNODIiE3bGY",    "CreateTime": 1714037059,    "MsgType": "event",    "Event": "debug_demo",    "debug_str": "hello world"}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ul><li>å¾®ä¿¡æä¾›çš„<a href="https://developers.weixin.qq.com/apiExplorer?type=messagePush">æ¶ˆæ¯æ¨é€è°ƒè¯•å·¥å…·</a>çš„ç¬¬äºŒä¸ªâ€œ<strong>è¯·æ±‚æ„é€ </strong>â€ï¼Œå¯ä»¥æŒ‰ç…§å·¥å…·è¡¨å•ä¸Šå¡«å†™çš„ input ç”Ÿæˆå¾®ä¿¡è°ƒç”¨æ—¶çš„ queryString å’Œ request bodyï¼ˆæ³¨æ„ï¼Œä¸ä¼šå‘é€çœŸå®çš„è¯·æ±‚ï¼‰ã€‚å¤åˆ¶è¿™äº›å†…å®¹ï¼Œå¯ä»¥ç”¨äºæœ¬åœ°å¼€å‘æµ‹è¯•ã€‚</li><li>å¾®ä¿¡æä¾›çš„<a href="https://developers.weixin.qq.com/apiExplorer?type=messagePush">æ¶ˆæ¯æ¨é€è°ƒè¯•å·¥å…·</a>çš„ç¬¬ä¸‰ä¸ªâ€<strong>è°ƒè¯•å·¥å…·</strong>â€œï¼Œä½¿ç”¨çš„å‰ææ¡ä»¶ï¼š1. æå‰åœ¨å°ç¨‹åºç®¡ç†åå°é…ç½®å¥½äº†å¼€å‘è€…æœåŠ¡å™¨åœ°å€ï¼›2. å®ç°äº†"debug_demo"åˆ†æ”¯é€»è¾‘çš„ POST API å·²ç»å‘å¸ƒåˆ°å¼€å‘è€…æœåŠ¡å™¨ä¸Šã€‚<br>åœ¨è°ƒè¯•å·¥å…·çš„è¡¨å•ä¸Šå¡«å†™ <code>AccessToken</code>ï¼ˆå¾®ä¿¡å¹³å°æä¾›çš„API æ¥å£åŠ¨æ€è·å–ï¼‰åï¼Œè°ƒè¯•å·¥å…·ä¼šæ ¹æ®è¿™ä¸ª AccessToken ä»å¾®ä¿¡å¹³å°å®šä½åˆ°å°ç¨‹åºçš„å…·ä½“ä¿¡æ¯ï¼Œä»è€Œå¾—åˆ°å°ç¨‹åºé…ç½®å¥½çš„å¼€å‘è€…æœåŠ¡å™¨åœ°å€ç­‰ä¿¡æ¯ã€‚è°ƒè¯•å·¥å…·å°è£…å¥½<code>DebugStr</code> åˆ° request ä¸­ï¼Œæœ€ç»ˆçœŸå®çš„å»è°ƒç”¨å¼€å‘è€…æœåŠ¡å™¨çš„POST APIã€‚<br><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/debug.png" alt=""></li></ul><ol start="3"><li>é™¤å» Event ä¸º â€œdebug_demoâ€ çš„åˆ†æ”¯å¤–ï¼Œä¸»é€»è¾‘åˆ†æ”¯éœ€è¦å®ç°çœŸå®æ¥æ”¶äº‹ä»¶æ¨é€çš„ä¸šåŠ¡é€»è¾‘ã€‚<br>æ¯”å¦‚ï¼Œæˆ‘çš„å°ç¨‹åºå°±åœ¨æ¯æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯è®¢é˜… Event æ—¶ï¼Œä½¿ç”¨æ•°æ®åº“å¯¹è¯¥ç”¨æˆ·å¯ç”¨çš„è®¢é˜…æ¬¡æ•°è¿›è¡Œè®¡æ•°ï¼Œè¿™æ ·å½“è¯¥ç”¨æˆ·çš„è®¢é˜…æ¬¡æ•°ä¸º0æ—¶ï¼Œåˆ™åœæ­¢å¯¹è¯¥ç”¨æˆ·ä¸‹å‘æ¶ˆæ¯ã€‚</li></ol><h4 id="2-3-ç”¨äºå‘é€ä¸šåŠ¡æ¶ˆæ¯ä½“çš„æ–¹æ³•é€»è¾‘">2.3 ç”¨äºå‘é€ä¸šåŠ¡æ¶ˆæ¯ä½“çš„æ–¹æ³•é€»è¾‘</h4><p>ç›¸æ¯”äºå¼€å‘è€…æŒ‰ç…§å¾®ä¿¡çš„è¦æ±‚æä¾› APIï¼Œè°ƒç”¨å¾®ä¿¡çš„ API è¿›è¡Œå‘é€æ¶ˆæ¯åˆ™éå¸¸ç®€å•ã€‚<br>å¯ç›´æ¥å‚è€ƒ<a href="https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/mp-message-management/subscribe-message/sendMessage.html">å‘é€è®¢é˜…æ¶ˆæ¯å®˜æ–¹æ–‡æ¡£</a><br>å…·ä½“åœ¨ä»€ä¹ˆæ—¶æœºè°ƒç”¨å‘é€æ¶ˆæ¯ï¼ŒæŒ‰ç…§å„è‡ªçš„ä¸šåŠ¡æ¥ã€‚</p><h3 id="3-è”è°ƒé˜¶æ®µ">3. è”è°ƒé˜¶æ®µ</h3><ol><li>é…ç½®æ¶ˆæ¯æ¨é€åœ°å€<br>å¦‚æœåœ¨å¼€å‘é˜¶æ®µï¼Œæ²¡æœ‰æå‰é…ç½®å°ç¨‹åºçš„å¼€å‘è€…æœåŠ¡å™¨åœ°å€ï¼Œåœ¨è”è°ƒé˜¶æ®µé¦–å…ˆè¦åšçš„ï¼Œå°±æ˜¯å»é…ç½®å¼€å‘è€…æœåŠ¡å™¨çš„åœ°å€ã€‚</li><li>å°ç¨‹åºè°ƒèµ·æ¶ˆæ¯ä¸€æ¬¡æ€§è®¢é˜…å¼¹æ¡†<br>å¼€å‘è€…åœ¨å°ç¨‹åºçš„ä¸šåŠ¡æµç¨‹ä¸­æ·»åŠ ä»£ç <code>wx.requestSubscribeMessage</code>ï¼Œå‚æ•°å€¼éœ€è¦å¸¦æœ‰<code>tmplIds</code>(å³ templateID çš„å€¼ï¼Œè¿™é‡Œæ”¯æŒå¤šä¸ª templateID)ã€‚<br>å…·ä½“APIè¯´æ˜è§<a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html">wx.requestSubscribeMessage å®˜æ–¹æ–‡æ¡£</a><br><img src="/2024/09/05/wei-xin-xiao-cheng-xu-xiao-xi-ding-yue-tang-shui-shi-ji-cheng/popup.jpg" alt=""></li><li>ç¡®è®¤å¼€å‘è€…æœåŠ¡å™¨æ¥æ”¶åˆ°äº‹ä»¶ç»“æœ<br>è¿™é‡Œå®Œæˆå¯¹â€œå¾®ä¿¡æ¶ˆæ¯è®¢é˜…ç¬¬ä¸€é˜¶æ®µâ€çš„è”è°ƒï¼Œç¡®ä¿ POST API æŒ‰é¢„æœŸæ¥æ”¶åˆ°å°ç¨‹åºç”¨æˆ·çš„æ“ä½œç»“æœï¼Œå¹¶å®Œæˆåå°ä¸šåŠ¡å¤„ç†ã€‚</li><li>ç¡®è®¤æ‰‹æœºå¾®ä¿¡æ¥æ”¶åˆ°ä¸šåŠ¡æ¶ˆæ¯<br>æ ¹æ®ä¸šåŠ¡é€»è¾‘è§¦å‘æ¶ˆæ¯å‘é€ï¼Œç¡®ä¿ç”¨æˆ·åœ¨æ‰‹æœºå¾®ä¿¡ä¸Šæ¥æ”¶åˆ°äº†â€œæœåŠ¡æ¶ˆæ¯â€ï¼Œå¹¶æŒ‰æœŸæœ›å¡«å……äº†æ¶ˆæ¯æ¨¡æ¿çš„å†…å®¹ã€‚</li><li>ç¡®è®¤ä¸šåŠ¡æ¶ˆæ¯å¡ç‰‡è·³è½¬æˆåŠŸ<br>åœ¨ç”¨æˆ·æ‰‹æœºä¸Šç‚¹å‡»æ¥æ”¶åˆ°çš„â€œæœåŠ¡æ¶ˆæ¯â€ï¼Œç¡®ä¿å¾®ä¿¡æ‰“å¼€æœŸæœ›çš„å°ç¨‹åºé¡µé¢ï¼Œå¹¶è¿›è¡Œå†…å®¹å±•ç¤ºã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç³»ç»Ÿé›†æˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç³»ç»Ÿé›†æˆ </tag>
            
            <tag> å¾®ä¿¡å°ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»ºP2S VPNè¿æ¥Azure VNet</title>
      <link href="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/"/>
      <url>/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç°ä»£ä¼ä¸šç¯å¢ƒä¸­ï¼Œå®‰å…¨çš„è¿œç¨‹äº‘èµ„æºè®¿é—®è‡³å…³é‡è¦ã€‚Point-to-Site (P2S) VPN æ˜¯ä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚åˆéœ€è¦ä»ä»»æ„å¤–ç½‘ä½ç½®å®‰å…¨åœ°è®¿é—® Azure è™šæ‹Ÿç½‘ç»œ (VNet) çš„åœºæ™¯ã€‚</p><p><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/gateway-diagram-expand.png" alt="Gateway"></p><h2 id="ä¸€ã€P2S-VPN-çš„æ¶æ„æœºåˆ¶ä¸åŸç†">ä¸€ã€P2S VPN çš„æ¶æ„æœºåˆ¶ä¸åŸç†</h2><p>P2S VPN æ˜¯ä¸€ç§å®‰å…¨çš„éš§é“è¿æ¥ï¼Œå…è®¸å•ä¸ªå®¢æˆ·ç«¯è®¾å¤‡é€šè¿‡äº’è”ç½‘è¿æ¥åˆ° Azure VNetã€‚ä¸åŒäºS2S VPNï¼ˆç«™ç‚¹åˆ°ç«™ç‚¹ï¼ŒSite-to-Siteï¼‰ï¼ŒP2S VPN ä¸éœ€è¦ä»»ä½•ä¸“ç”¨ç¡¬ä»¶æˆ–å¤æ‚çš„ç½‘ç»œé…ç½®ï¼Œå¯ä»¥ç›´æ¥è®©å•ä¸ªè®¾å¤‡ä¸äº‘æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚å®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºå¸¸è§çš„ VPN è¿æ¥ï¼Œä½†é’ˆå¯¹äº‘ç¯å¢ƒè¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><p>åœ¨ P2S VPN çš„æ¶æ„ä¸­ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ç»„ä»¶ï¼š<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/P2S-vpn-components.png" alt=""></p><ol><li><p><strong>å®¢æˆ·ç«¯è®¾å¤‡</strong>ï¼šè¿™æ˜¯ä½ å¸Œæœ›é€šè¿‡ VPN è¿æ¥åˆ° Azure çš„ç»ˆç«¯è®¾å¤‡ã€‚å¯ä»¥æ˜¯ç¬”è®°æœ¬ç”µè„‘ã€å°å¼æœºæˆ–ç§»åŠ¨è®¾å¤‡ã€‚</p></li><li><p><strong>VPN gateway</strong>ï¼šAzure ä¸­çš„è™šæ‹Ÿç½‘ç»œç½‘å…³ï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„ VPN è¯·æ±‚ï¼Œå»ºç«‹å¹¶ç»´æŠ¤ VPN éš§é“ã€‚</p></li><li><p><strong>èº«ä»½è®¤è¯</strong>ï¼šç”¨äºèº«ä»½éªŒè¯çš„æœºåˆ¶ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·èƒ½å¤Ÿå»ºç«‹ VPN è¿æ¥ï¼Œæ¯”å¦‚è¯ä¹¦æˆ– Azure ADã€‚</p></li><li><p><strong>éš§é“ç±»å‹</strong>ï¼šç”¨äºåŠ å¯†æ•°æ®ä¼ è¾“çš„åè®®ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šè¢«çªƒå–æˆ–ç¯¡æ”¹ï¼Œæ¯”å¦‚IPsec æˆ– OpenVPNã€‚</p></li></ol><p>P2S VPN çš„ä¼˜åŠ¿åœ¨äºå…¶çµæ´»æ€§å’Œæ˜“ç”¨æ€§ã€‚æ— è®ºç”¨æˆ·ä½äºä½•åœ°ï¼Œåªè¦æœ‰äº’è”ç½‘è¿æ¥ï¼Œå°±å¯ä»¥é€šè¿‡ P2S VPN å®‰å…¨è®¿é—® Azure VNetã€‚</p><h2 id="äºŒã€èº«ä»½éªŒè¯ä¸é€šé“åè®®">äºŒã€èº«ä»½éªŒè¯ä¸é€šé“åè®®</h2><p>èº«ä»½éªŒè¯å’Œé€šé“åè®®æ˜¯ P2S VPN çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬å…±åŒç¡®ä¿è¿æ¥çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</p><h3 id="1-èº«ä»½éªŒè¯æœºåˆ¶">1. èº«ä»½éªŒè¯æœºåˆ¶</h3><p>åœ¨ Azure ä¸­ï¼ŒP2S VPN æ”¯æŒä¸‰ç§ä¸»è¦çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼š<br>â€¢ <strong>åŸºäºè¯ä¹¦çš„èº«ä»½éªŒè¯</strong>ï¼šgateway ç«¯å¿…é¡»é…ç½®ä¸€ä¸ªå¯ä¿¡çš„æ ¹è¯ä¹¦ï¼Œå¹¶ä½¿ç”¨ä¸å…¶åŒ¹é…çš„å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™ç§æ–¹æ³•å®‰å…¨æ€§è¾ƒé«˜ï¼Œä½†éœ€è¦é¢å¤–çš„è¯ä¹¦ç®¡ç†ã€‚<br>â€¢ <strong>Azure Active Directory (Azure AD)</strong>ï¼šé€šè¿‡ Azure AD è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå…è®¸ä½¿ç”¨ Azure AD è´¦æˆ·ç›´æ¥ç™»å½•å¹¶å»ºç«‹ VPN è¿æ¥ã€‚é€‚åˆäºä¸ Azure AD é›†æˆçš„ä¼ä¸šç¯å¢ƒï¼Œç®€åŒ–äº†ç”¨æˆ·ç®¡ç†ã€‚<br>â€¢ <strong>RADIUS æœåŠ¡å™¨</strong>ï¼šä½¿ç”¨å¤–éƒ¨ RADIUS æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œé€‚ç”¨äºéœ€è¦å¤æ‚èº«ä»½éªŒè¯ç­–ç•¥çš„ç¯å¢ƒï¼Œå¦‚å¤šå› ç´ èº«ä»½éªŒè¯ (MFA)ã€‚</p><h3 id="2-é€šé“åè®®">2. é€šé“åè®®</h3><p>P2S VPN æ”¯æŒä»¥ä¸‹ä¸»è¦é€šé“åè®®ï¼š<br>â€¢ <strong>IKEv2/IPsec</strong>ï¼šè¿™æ˜¯é»˜è®¤çš„é€šé“åè®®ï¼Œæä¾›å¼ºå¤§çš„åŠ å¯†å’Œè®¤è¯ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ã€‚IKEv2 æä¾›ç¨³å®šçš„è¿æ¥å’Œå¿«é€Ÿçš„é‡è¿æ¥èƒ½åŠ›ã€‚<br>â€¢ <strong>OpenVPN</strong>ï¼šOpenVPN æ˜¯ä¸€ç§åŸºäº SSL/TLS çš„å¼€æº VPN åè®®å¼€æºåè®®ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ UDP æˆ– TCP è¿›è¡Œä¼ è¾“ï¼Œèƒ½å¤Ÿè½»æ¾ç©¿è¶Šé˜²ç«å¢™å’Œ NATã€‚å¹¶ä¸”å®ƒæä¾›æ›´é«˜çš„çµæ´»æ€§ï¼Œæ”¯æŒå¤šç§å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯åœ¨è·¨å¹³å°è¿æ¥æ—¶è¡¨ç°å‡ºè‰²ã€‚<br>â€¢ <strong>SSTP (Secure Socket Tunneling Protocol)</strong>ï¼šè¿™æ˜¯å¾®è½¯ä¸“æœ‰åè®®ï¼Œé€šå¸¸ç”¨äºç©¿è¶Šé˜²ç«å¢™å’Œä»£ç†æœåŠ¡å™¨ï¼Œå› ä¸ºå®ƒä½¿ç”¨ HTTPS ç«¯å£ (443) è¿›è¡Œé€šä¿¡ï¼Œé¿å…äº†é˜²ç«å¢™é˜»å¡ã€‚</p><h2 id="ä¸‰ã€åˆ›å»ºP2S-VPN-è¿æ¥-VNent-çš„æ“ä½œæ­¥éª¤">ä¸‰ã€åˆ›å»ºP2S VPN è¿æ¥ VNent çš„æ“ä½œæ­¥éª¤</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»ç†è§£äº† P2S VPN çš„æ¶æ„å’Œå…³é”®ç»„ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨ Azure ä¸­é…ç½®å¹¶å»ºç«‹ P2S VPN è¿æ¥ã€‚</p><h3 id="1-å‡†å¤‡å·¥ä½œ">1. å‡†å¤‡å·¥ä½œ</h3><h4 id="1-1-åœ¨-Azure-VNet-ä¸­åˆ›å»º-GatewaySubnet-å­ç½‘">1.1 åœ¨ Azure VNet  ä¸­åˆ›å»º GatewaySubnet å­ç½‘</h4><p>ç»™ç›®æ ‡ VNet åˆ›å»ºä¸€ä¸ª Virtual Network Gateway Subnetï¼Œå­ç½‘çš„åç§°è‡ªåŠ¨å¡«å……ã€ä¸”åªèƒ½å‘½åä¸º <code>GatewaySubnet</code>ã€‚VPN gateway å°†ä¸“é—¨éƒ¨ç½²åˆ°æ­¤å­ç½‘ã€‚<br>æ³¨æ„ä¸è¦ç»™æ­¤å­ç½‘é…ç½® NSGï¼Œå¦åˆ™ VPN å¯èƒ½æ— æ³•æŒ‰é¢„æœŸå·¥ä½œã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/gateway-subnet.png" alt=""></p><h4 id="1-2-å‡†å¤‡è¯ä¹¦">1.2 å‡†å¤‡è¯ä¹¦</h4><p>è¿™é‡Œä¸ä½¿ç”¨ Azure AD å’Œ RADIUS ä½œä¸ºè®¤è¯æ–¹å¼ï¼Œå› æ­¤éœ€è¦å‡†å¤‡è®¤è¯è¯ä¹¦ï¼Œç•™å¾…åœ¨é…ç½® P2S VPN æ—¶ä½¿ç”¨ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæ˜¯ Mac ç”µè„‘ï¼Œå¹¶ä¸”æƒ³ç”¨ <strong>IKEv2/IPsec</strong> æ¥åˆ›å»ºè¿æ¥çš„è¯ï¼Œæœ€å¥½ä½¿ç”¨ Mac keychain æ¥åˆ›å»ºè¯ä¹¦ï¼Œé˜²æ­¢ MacOS è‡ªå¸¦çš„ VPN æ— æ³•è¯†åˆ«è¯ä¹¦ã€‚<br>ä¸‹é¢çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨æ›´é€šç”¨çš„ OpenVPN åè®®ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨ openssl å·¥å…·æ¥åˆ›å»ºè¯ä¹¦ã€‚</p><ul><li>é¦–å…ˆï¼Œåˆ›å»ºè‡ªç­¾åæ ¹è¯ä¹¦ã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">openssl genrsa -out caKey.pem 2048openssl req -x509 -new -nodes -key caKey.pem -subj "/CN=VPN CA" -days 3650 -out caCert.pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ç„¶åï¼Œåˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦è¯·æ±‚ï¼ˆCSRï¼‰ã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none"># Generate a private keyopenssl genrsa -out "${USERNAME}Key.pem" 2048# Generate a CSR (Certificate Sign Request)openssl req -new -key "${USERNAME}Key.pem" -out "${USERNAME}Req.pem" -subj "/CN=${USERNAME}"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ¥ç€ï¼Œä½¿ç”¨è‡ªç­¾åæ ¹è¯ä¹¦å¯¹è¯ä¹¦è¯·æ±‚è¿›è¡Œç­¾å/è¯ä¹¦é¢å‘ã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">openssl x509 -req -days 365 -in "${USERNAME}Req.pem" -CA caCert.pem -CAkey caKey.pem -CAcreateserial -out "${USERNAME}Cert.pem" -extfile &lt;(echo -e "subjectAltName=DNS:${USERNAME}\nextendedKeyUsage=clientAuth")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æœ€åï¼ŒéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„æ­£ç¡®æ€§ã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">openssl verify -CAfile caCert.pem caCert.pem "${USERNAME}Cert.pem" <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-åˆ›å»ºå’Œé…ç½®-Gateway">2. åˆ›å»ºå’Œé…ç½® Gateway</h3><h4 id="2-1-åˆ›å»ºVPN-gateway">2.1 åˆ›å»ºVPN gateway</h4><p>ç™»å½•åˆ° Azure Portalï¼Œä½¿ç”¨ Portal è¿›è¡Œå®ä¾‹åˆ›å»ºã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/instance-details.png" alt=""></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ol><li>Resource Group / Region éœ€ä¸è¦è¿æ¥çš„ç›®æ ‡ VNet ç›¸åŒã€‚</li><li>å­ç½‘é€‰æ‹©åœ¨ã€å‡†å¤‡å·¥ä½œã€‘é‡Œåˆ›å»ºå¥½çš„Gateway Subnetã€‚</li><li>æ³¨æ„ SKU å’Œ ä»£ç³»ï¼Œè¿™ä¸¤é¡¹ä¸åŒæ”¶è´¹å’ŒåŠŸèƒ½ä¹Ÿä¼šä¸åŒã€‚Azure çš„å…è´¹è´¦å·å¯ä»¥ç™½å«–12ä¸ªæœˆçš„ç¬¬ä¸€ä»£ VPNGw1ã€‚</li><li>æƒ³è¦é«˜å¯ç”¨ï¼Œåˆ™éœ€è¦å¯ç”¨ Active-Active æ¨¡å¼ï¼Œé»˜è®¤æ˜¯ Active-Standby æ¨¡å¼ã€‚å¯ç”¨äº†Active-Active æ¨¡å¼ï¼Œåˆ™éœ€è¦ä¸ºé¢å¤–å¤šæ·»åŠ çš„Public IP static Address ä»˜è´¹ã€‚</li></ol><p>æ›´è¯¦ç»†çš„æ“ä½œé€‰é¡¹ï¼Œè§<a href="https://learn.microsoft.com/zh-cn/azure/vpn-gateway/tutorial-create-gateway-portal#VNetGateway">å®˜æ–¹æ–‡æ¡£</a></p><h4 id="2-2-è¿›è¡Œ-P2S-VPN-è®¾ç½®">2.2 è¿›è¡Œ P2S VPN è®¾ç½®</h4><p>åˆ›å»ºå¥½ VPN Gateway åï¼Œåˆ™è¿›å…¥äº†æœ€é‡è¦çš„ P2S è®¾ç½®ã€‚<br>åœ¨åˆ›å»ºå¥½çš„ VPN gateway å®ä¾‹çš„è®¾ç½®ä¸­ï¼Œé€‰æ‹© <strong>point to site configuration</strong>ã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/vpn-config.png" alt=""></p><ul><li><code>Address Pool</code>ï¼Œæ˜¯å®¢æˆ·ç«¯åœ°å€æ± ã€‚å½“ VPN client è¿æ¥ä¸Š gateway ä¹‹åï¼Œéœ€è¦ç»™ VPN client åˆ†é…å†…ç½‘ IPã€‚<br>Address Pool å°±æ˜¯æŒ‡å®šå¯ä»¥åˆ†é…çš„ IP åœ°å€èŒƒå›´ã€‚</li><li>Tunnel typeï¼Œå»ºç«‹é€šé“çš„åè®®ç±»å‹ã€‚</li><li>èº«ä»½éªŒè¯ç±»å‹ï¼ˆè¯ä¹¦ã€Azure AD æˆ– RADIUSï¼‰<br>å¦‚æœé€‰æ‹©è¯ä¹¦èº«ä»½éªŒè¯ï¼Œè¿™é‡Œè¿˜éœ€è¦ä¸Šä¼ æ ¹è¯ä¹¦çš„å…¬é’¥æ–‡ä»¶çš„ Base64 å†…å®¹(ä¸èƒ½æ¢è¡Œ)ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œ Base64 å†…å®¹å¯¼å‡ºã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none"># é€šè¿‡opensslè·å– Base64 å†…å®¹openssl x509 -in caCert.pem -outform der | base64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸‹é¢æ˜¯å®˜æ–¹æšä¸¾çš„é…ç½® â€”â€” å¯ä»¥æ”¯æŒçš„æ­é…ç±»å‹ã€‚<br><strong>æœ¬æœº VPN å®¢æˆ·ç«¯</strong>ï¼ŒæŒ‡æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„ VPN å·¥å…·ã€‚<br><strong>OpenVPN å®¢æˆ·ç«¯</strong>ï¼ŒæŒ‡éœ€è¦è‡ªè¡Œä¸‹è½½å®‰è£…ã€æ”¯æŒ OpenVPN åè®®çš„ VPN å·¥å…·ã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/protocol-tunnel-os-client.png" alt=""></p><h3 id="3-é…ç½®-VPN-å®¢æˆ·ç«¯">3. é…ç½® VPN å®¢æˆ·ç«¯</h3><h4 id="3-1-ä¸‹è½½-VPN-å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶">3.1 ä¸‹è½½ VPN å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶</h4><p>ç¡®ä¿å·²ä¿å­˜è¿‡ P2S configuration çš„è®¾ç½®ï¼Œç„¶åç‚¹å‡»â€œDonwload VPN clientâ€ã€‚è¿™é‡Œä¸‹è½½çš„å¹¶ä¸æ˜¯å®¢æˆ·ç«¯å·¥å…·ï¼Œä¸‹è½½çš„æ˜¯å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/download-vpn-client.png" alt=""></p><p>å°†ä¸‹è½½å¥½çš„æ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œé‡Œé¢åŒ…æ‹¬ Azure ç”Ÿæˆå¥½çš„é…ç½®æ–‡ä»¶ã€‚<br>æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬æ‰“ç®—ä½¿ç”¨ OpenVPN å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ‰“å¼€ OpenVPN æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/config-file.png" alt=""></p><p>vpnconfig.ovpn æ–‡ä»¶éœ€è¦è¿›è¡Œç¼–è¾‘ï¼Œçº¢æ¡†ä½ç½®æ›¿æ¢æˆä¹‹å‰ã€å‡†å¤‡å·¥ä½œã€‘ä¸­ç”Ÿæˆçš„å®¢æˆ·ç«¯è¯ä¹¦&amp;å¯†é’¥ã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/config-file-content.png" alt=""></p><h4 id="3-2-å®‰è£…å’Œé…ç½®-OpenVPN">3.2 å®‰è£…å’Œé…ç½® OpenVPN</h4><p>è¿™é‡Œæˆ‘ä¸‹è½½å’Œå®‰è£…çš„ OpenVPN connectï¼Œ<a href="https://openvpn.net/client/">å®˜ç½‘åœ°å€</a><br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/openvpn-connect.png" alt=""><br>å®‰è£…å¥½ client å·¥å…·åï¼Œå¯¼å…¥ä¹‹å‰é…ç½®å¥½çš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/openvpn-connet-import.png" alt=""></p><h3 id="4-è¿æ¥åˆ°-Azure-VNet">4. è¿æ¥åˆ° Azure VNet</h3><p>é€‰æ‹©åˆšåˆšé…ç½®å¥½çš„ P2S VPN Gatewayã€‚å¦‚æœè¿æ¥æˆåŠŸï¼Œä½ çš„è®¾å¤‡å°†è·å¾—åˆ†é…çš„ IP åœ°å€ï¼Œå¹¶èƒ½é€šè¿‡ VPN å®‰å…¨è®¿é—® Azure VNet ä¸­çš„èµ„æºã€‚<br>ç‚¹å‡»è¿æ¥ï¼Œå³å¯ä»¥çœ‹åˆ°è¿æ¥ä¸Šçš„çŠ¶æ€ã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/connected.png" alt=""></p><p>åŒæ—¶å¯ä»¥æµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½è®¿é—®äº‘å†…èµ„æºï¼Œæ¯”å¦‚è¿™é‡Œæœ‰ä¸€å°æ²¡æœ‰é…ç½® Public IP Address çš„ VMã€‚SSH å†…ç½‘ IP è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ï¼Œç™»å½•æˆåŠŸã€‚<br><img src="/2024/08/30/chuang-jian-p2s-vpn-lian-jie-azure-vnet/test.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤æ—¥ä¸€æ¦‚å¿µä¹‹Azureç¯‡ â€”â€” äº‘ä¸Šçš„SQLæ•°æ®åº“,ä½ çœ‹æ˜ç™½äº†å—</title>
      <link href="/2024/07/26/liang-ri-yi-gai-nian-zhi-azure-pian-yun-shang-de-sql-shu-ju-ku-ni-kan-ming-bai-liao-ma/"/>
      <url>/2024/07/26/liang-ri-yi-gai-nian-zhi-azure-pian-yun-shang-de-sql-shu-ju-ku-ni-kan-ming-bai-liao-ma/</url>
      
        <content type="html"><![CDATA[<p>ä¸ SQL Server æ•°æ®åº“çš„ä¼ ç»Ÿå°è±¡ä¸åŒï¼Œå¦‚æœæƒ³åœ¨ Azure ä¸Šç”³è¯·ä¸€å° SQL Server æ•°æ®åº“ï¼Œä½ å¯èƒ½ä¼šè¢«å¯¼èˆªåˆ°ä»¥ä¸‹ä¸‰ç§äº§å“ï¼š</p><ul><li>SQL æ•°æ®åº“ï¼ˆSQL databasesï¼‰</li><li>SQL æ‰˜ç®¡å®ä¾‹ï¼ˆSQL managed instancesï¼‰</li><li>è™šæ‹Ÿæœºä¸Šçš„ SQL Serverï¼ˆSQL Server on VMï¼‰<br><img src="/2024/07/26/liang-ri-yi-gai-nian-zhi-azure-pian-yun-shang-de-sql-shu-ju-ku-ni-kan-ming-bai-liao-ma/SQLs.png" alt=""></li></ul><p>ç”¨ä¸€å¹…å›¾ç®€å•è¯´æ˜è¿™ä¸‰ä¸ªäº§å“çš„ä¸åŒï¼š<br><img src="/2024/07/26/liang-ri-yi-gai-nian-zhi-azure-pian-yun-shang-de-sql-shu-ju-ku-ni-kan-ming-bai-liao-ma/azure-sql-servers.png" alt=""><br>SQL databases æ˜¯ serverlessï¼Œ SQL managed instances æ˜¯ PaaSï¼ŒSQL Server on VM æ˜¯åœ¨VM ä¸Šè‡ªç»´æŠ¤ SQL Serverã€‚<br>å¯¹ SQL Server ä¸æ€ä¹ˆç†Ÿæ‚‰çš„å°ä¼™ä¼´å¯ä»¥å°† <strong>Database</strong> æƒ³è±¡æˆ MySQL çš„ <strong>schema</strong>, è€Œ <strong>instance</strong> åˆ™æ˜¯ MySQL çš„ <strong>Database Server</strong>ã€‚<br>å› æ­¤ï¼Œå›¾ä¸Šä¸‰ç§äº§å“æŒ‰ä»å·¦å¾€å³çš„é¡ºåºï¼Œç”¨æˆ·æ¥è§¦åˆ°çš„åº•å±‚çš„é…ç½®å’Œç»´æŠ¤å·¥ä½œé‡å°±è¶Šå¤§ï¼Œä½†å¯ä»¥ä½¿ç”¨çš„åŸç‰ˆ SQL Server çš„åŠŸèƒ½å°±è¶Šå¤šã€å®šåˆ¶çš„è‡ªç”±åº¦å°±è¶Šé«˜ã€‚æ¶æ„è®¾è®¡æ—¶ï¼Œä¸€èˆ¬å¯æŒ‰ç…§åŠŸèƒ½éœ€æ±‚ï¼Œä»å·¦å¾€å³ä¾æ¬¡æ’é™¤å’Œç­›é€‰ã€‚</p><h2 id="1-SQL-databases">1. SQL databases</h2><p>Azure SQL databasesï¼Œæ˜¯ä¸€ç§ serverless æœåŠ¡ â€”â€” å®ƒé¢å‘ç”¨æˆ·æ—¶ï¼ŒæŠ½ç¦»äº†æ“ä½œç³»ç»Ÿå’Œæ•°æ®åº“æœåŠ¡å™¨å®ä¾‹çš„æ¦‚å¿µï¼Œå› æ­¤ç”¨æˆ·ï¼š</p><ul><li>æ— éœ€å¤„ç†å¤æ‚çš„æ•°æ®åº“ä»»åŠ¡ï¼Œä¾‹å¦‚é…ç½®å’Œç®¡ç†é«˜å¯ç”¨æ€§ã€ä¼˜åŒ–å’Œå¤‡ä»½</li><li>ä¸èƒ½æŒ‡å®š SQL Server å®ä¾‹çš„ç‰ˆæœ¬ï¼ŒAzure ä¼šè‡ªåŠ¨å‡çº§æ¯ä¸ª SQL database åº•å±‚çš„ SQL Server çš„ç‰ˆæœ¬åˆ°æœ€æ–°ç‰ˆ</li></ul><h3 id="æ•°æ®åº“å¼¹æ€§æ± ï¼ˆelastic-database-poolsï¼‰">æ•°æ®åº“å¼¹æ€§æ± ï¼ˆelastic database poolsï¼‰</h3><p>SQL databases æä¾›äº†ä¸€ç§åŠ¨æ€çš„çºµå‘å¯ä¼¸ç¼©æ–¹æ¡ˆ â€”â€” å¼¹æ€§æ± ï¼Œç”¨äºç®¡ç†å’Œç¼©æ”¾è´Ÿè½½ä¸æ–­å˜åŒ–ä¸”ä¸å¯é¢„æµ‹çš„å¤šä¸ªæ•°æ®åº“ã€‚<br>åŒä¸€å¼¹æ€§æ± ä¸­çš„æ‰€æœ‰æ•°æ®åº“ä½äºå•ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå¹¶ä»¥å›ºå®šä»·æ ¼å…±äº«å›ºå®šæ•°é‡çš„èµ„æºï¼Œæ¯ä¸ªæ•°æ®åº“å¯è®¾å®šæœ€å°/æœ€å¤§çš„èµ„æºä½¿ç”¨é‡ã€‚<br><img src="/2024/07/26/liang-ri-yi-gai-nian-zhi-azure-pian-yun-shang-de-sql-shu-ju-ku-ni-kan-ming-bai-liao-ma/elastic-pools.png" alt=""></p><h2 id="2-SQL-managed-instances">2. SQL managed instances</h2><p>ä¸ SQL databases ä¸€æ ·ï¼ŒSQL managed instances ä¹Ÿæ˜¯é’ˆå¯¹ SQL Server çš„ PaaS æœåŠ¡ã€‚<br>ä¸åŒçš„æ˜¯ï¼Œä¸åƒ SQL databases é‚£æ ·å‰¥ç¦»äº†æ•°æ®åº“å®ä¾‹çš„æ¦‚å¿µå’Œè¿ç»´ï¼ŒSQL managed instances ä¸ºç”¨æˆ·æä¾›äº† SQL Server instanceï¼Œä½†ä¾ç„¶æ˜¯çœå»äº†å¤§é‡è™šæ‹Ÿæœºç®¡ç†çš„å¼€é”€ã€‚</p><p>æä¾›äº† SQL Server instance ä¹Ÿå°±æ„å‘³ç€ï¼Œç›¸æ¯” SQL databases é¢å¤–æ‹¥æœ‰ä»¥ä¸‹å…³é”®åŠŸèƒ½ï¼š</p><ul><li>åŒä¸€ä¸ª Instance ä¸Šã€è·¨ä¸åŒ databases çš„æŸ¥è¯¢å’Œåˆ†å¸ƒå¼äº‹åŠ¡åŠŸèƒ½</li><li>å¯ä»¥ä½¿ç”¨SQL Server Agentã€CLR(å…¬å…±è¯­è¨€è¿è¡Œæ—¶ï¼Œ<a href="http://xn--jhq.net">ä¸.net</a> framework è¯­è¨€é›†æˆå¼€å‘ç›¸å…³)ã€æ•°æ®åº“è™šæ‹ŸåŒ–ï¼ˆä¸æœºå™¨å­¦ä¹ æœåŠ¡ç›¸å…³ï¼‰ç­‰</li></ul><p>æ›´è¯¦ç»† Azure SQL databases ä¸ Azure SQL managed instances çš„å¯¹æ¯”ï¼Œè§<a href="https://learn.microsoft.com/en-us/azure/azure-sql/database/features-comparison?view=azuresql">å®˜æ–¹è¡¨æ ¼</a></p><h3 id="å®ä¾‹æ± ï¼ˆInstance-Poolï¼‰">å®ä¾‹æ± ï¼ˆInstance Poolï¼‰</h3><p>å¯èƒ½å€Ÿé‰´äºAzure SQL databases çš„å¼¹æ€§æ± ï¼ŒSQL managed instances åˆ›å»ºäº†å®ä¾‹æ± çš„çºµå‘ä¼¸ç¼©æ–¹æ¡ˆï¼ŒåŒæ ·æ˜¯å°†å¤šä¸ª instances éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚æ­¤åŠŸèƒ½ç›®å‰ä»…æ ‡è®°ä¸º <strong>preview(é¢„è§ˆç‰ˆ)</strong>ã€‚</p><h2 id="3-SQL-Server-on-VM">3. SQL Server on VM</h2><p>ä½¿ç”¨ SQL Server on VM æœåŠ¡ï¼Œå¯ä»¥è®¿é—®å®Œæ•´ç‰ˆæœ¬çš„ SQL Server åŠŸèƒ½ï¼Œè€Œæ— éœ€åœ¨æœ¬åœ°ç®¡ç†è®¡ç®—æœºæœåŠ¡å™¨ã€‚ä¸ SQL databases å’Œ SQL managed instances ç›¸æ¯”ï¼Œæ‹¥æœ‰ä»¥ä¸‹å…³é”®ç‰¹å¾ï¼š</p><ul><li>ä¸º SQL Server å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬æä¾›äº†å¹¿æ³›çš„æ”¯æŒ â€”â€” å¯ä»¥åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šé€‰æ‹©ä¸åŒç‰ˆæœ¬çš„ SQL Server è¿›è¡Œå®‰è£…å’Œä½¿ç”¨ã€‚SQL databases å’Œ SQL managed instance å§‹ç»ˆåªèƒ½ä½¿ç”¨æœ€æ–°çš„ SQL Server ç‰ˆæœ¬ã€‚</li><li>å¯ä»¥ä½¿ç”¨åŸç‰ˆ SQL Server çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæ¯”å¦‚ SSASï¼ˆSQL Server Analysis Servicesï¼Œ OLAP å·¥å…·ï¼‰ã€SSRSï¼ˆSQL Server Reporting Servicesï¼‰ç­‰ã€‚</li><li>éœ€è¦ç”¨æˆ·è‡ªå·±è´Ÿè´£ VM æ“ä½œç³»ç»Ÿå’Œ SQL Server ç‰ˆæœ¬çš„æ›´æ–°æ“ä½œã€‚</li></ul><h2 id="4-Azure-SQL-çš„æ¨ªå‘ç¼©æ”¾æ–¹æ¡ˆ">4. Azure SQL çš„æ¨ªå‘ç¼©æ”¾æ–¹æ¡ˆ</h2><p>å‰é¢çš„å¼¹æ€§æ± ã€å®ä¾‹æ± éƒ½åªæ˜¯é’ˆå¯¹çºµå‘ç¼©æ”¾çš„ Azure è§£å†³æ–¹æ¡ˆã€‚åœ¨æ¨ªå‘ä¸Šï¼Œæ˜¯å¦ä¹Ÿæœ‰æ–¹æ¡ˆå‘¢ï¼Ÿ</p><ul><li><p>Shardingï¼ˆåˆ†ç‰‡ï¼‰<br>Azure ä»…é’ˆå¯¹ SQL databases æä¾›äº†<strong>å¼¹æ€§æ•°æ®åº“å®¢æˆ·ç«¯åº“</strong>ï¼Œä»¥æ”¯æŒè¿›è¡Œæ•°æ®åˆ†ç‰‡ã€‚ä»åç§°æè¿°ä¸Šæ¥çœ‹ï¼Œæœ‰ç‚¹åƒ Sharding-JDBC è¿™ç§å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆï¼Œä½†å®é™…ä¸Šè¿™ä¸ªå·¥å…·å®¢æˆ·ç«¯çš„åº•å±‚è¿˜åˆ›å»ºäº†ä¸€ä¸ªç§°ä¸º<strong>åˆ†ç‰‡æ˜ å°„ç®¡ç†å™¨</strong>çš„ç‰¹æ®Šæ•°æ®åº“ã€‚<br>åŒæ—¶æ³¨æ„ï¼Œ<strong>å¼¹æ€§æ•°æ®åº“å®¢æˆ·ç«¯åº“</strong>ç›®å‰åªæœ‰ .net å’Œ Java ç‰ˆæœ¬ã€‚</p></li><li><p>Read scale-outï¼ˆè¯»å–æ‰©å±•ï¼‰<br>ç›¸æ¯”äºåˆ†ç‰‡å’Œä¼ ç»Ÿçš„è¯»å†™åˆ†ç¦»ï¼ŒAzure SQL åœ¨å®ç°è¯»å–æ‰©å±•æ¶æ„æ–¹æ¡ˆä¸Šä¹Ÿæœ‰æ”¯æŒã€‚SQL databases å’Œ SQL managed instances çš„ <strong>Business Critical</strong> æˆ– <strong>Premium</strong> è¿™ä¸¤ä¸ªé«˜çº§ SKU ä¸­æä¾›äº† <strong>Always On availability group</strong> çš„åŠŸèƒ½( Basic,&nbsp;Standard, General Purpose è¿™äº›ä½ä¸­çº§ SKU ä¸æä¾›)ã€‚å€ŸåŠ©æ­¤åŠŸèƒ½ï¼ŒSQL databases å’Œ SQL managed instances å¯ä»¥è¾ƒä¸ºè½»æ¾çš„å®ç°è¯»å–æ‰©å±•æ¶æ„ã€‚<br><img src="/2024/07/26/liang-ri-yi-gai-nian-zhi-azure-pian-yun-shang-de-sql-shu-ju-ku-ni-kan-ming-bai-liao-ma/business-critical-service-tier-read-scale-out.png" alt=""></p></li></ul><p>æ³¨æ„ï¼šç›¸æ¯”äºçºµå‘çš„å¼¹æ€§æ± ã€å®ä¾‹æ± ï¼ŒAzure çš„æ¨ªå‘ä¼¸ç¼©æ–¹æ¡ˆå¯¹å®¢æˆ·çš„é€æ˜åº¦å’Œæ˜“ç”¨æ€§æ²¡æœ‰é‚£ä¹ˆé«˜ï¼Œç‰¹åˆ«æ˜¯éœ€è¦æ³¨æ„ä¸€äº›æœ‰å®¢æˆ·ç«¯åº“çš„åœºæ™¯ï¼ˆæ¯”å¦‚å¼¹æ€§æ•°æ®åº“å®¢æˆ·ç«¯åº“ä»…æ”¯æŒ .net å’Œ Java è¯­è¨€ï¼Œå¼¹æ€§äº‹åŠ¡ä»…æ”¯æŒ .netï¼‰ã€‚å› æ­¤ï¼Œæ¨ªå‘ä¼¸ç¼©æ–¹æ¡ˆï¼Œå¦‚æœä¸è€ƒè™‘ Azure ä¸Š OLAP äº§å“å’Œæœºå™¨å­¦ä¹ çš„é›†æˆå› ç´ å½±å“ï¼Œä¸ªäººè§‰å¾—å¯ä»¥å‚è€ƒå’Œé‡‡ç”¨ä¸€äº›æ›´å¹¿æ³›å’Œæˆç†Ÿçš„å¼€æºæ–¹æ¡ˆã€‚</p><h2 id="5-è‡ªåŠ¨å¤‡ä»½">5. è‡ªåŠ¨å¤‡ä»½</h2><p>SQL databases å’Œ SQL managed instances æ”¯æŒè‡ªåŠ¨å¤‡ä»½ã€‚ç”¨æˆ·äº†è§£å¤‡ä»½çš„é¢‘ç‡ï¼Œå¯ä»¥ç”¨æ¥è¡¡é‡ RPOï¼ˆRecovery Point Objectiveï¼‰ã€‚<br>å¤‡ä»½çš„é¢‘ç‡ï¼š</p><ul><li>æ¯å‘¨åˆ›å»º<a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/backup-restore/full-database-backups-sql-server">å®Œæ•´å¤‡ä»½</a></li><li>æ¯éš” 12 æˆ– 24 å°æ—¶åˆ›å»º<a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/backup-restore/differential-backups-sql-server">å·®å¼‚å¤‡ä»½</a>ã€‚</li><li>å¤§çº¦æ¯éš” 10 åˆ†é’Ÿåˆ›å»º<a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/backup-restore/transaction-log-backups-sql-server">äº‹åŠ¡æ—¥å¿—å¤‡ä»½</a>ã€‚<br>è¯¦ç»†è¯´æ˜ï¼Œè§<a href="https://learn.microsoft.com/zh-cn/azure/azure-sql/database/automated-backups-overview?view=azuresql-db&amp;preserve-view=true">å®˜æ–¹æ–‡æ¡£</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> ä¸¤æ—¥ä¸€æ¦‚å¿µ </tag>
            
            <tag> Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤æ—¥ä¸€æ¦‚å¿µä¹‹Azureç¯‡ â€”â€” Azure ç½‘ç»œæ¶æ„å…³é”®ç»„ä»¶</title>
      <link href="/2024/07/20/liang-ri-yi-gai-nian-zhi-azure-pian-azure-wang-luo-jia-gou-guan-jian-zu-jian/"/>
      <url>/2024/07/20/liang-ri-yi-gai-nian-zhi-azure-pian-azure-wang-luo-jia-gou-guan-jian-zu-jian/</url>
      
        <content type="html"><![CDATA[<p>Azureç½‘ç»œæ¶æ„ç”±å¤šä¸ªå…³é”®ç»„ä»¶ç»„æˆï¼Œè¿™äº›ç»„ä»¶ç›¸äº’é…åˆï¼Œæä¾›äº†é«˜åº¦çµæ´»å’Œå®‰å…¨çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆã€‚</p><h2 id="1-è™šæ‹Ÿç½‘ç»œ-Virtual-Network-VNet">1. è™šæ‹Ÿç½‘ç»œ (Virtual Network, VNet)</h2><p><strong>è™šæ‹Ÿç½‘ç»œ</strong>æ˜¯ Azure ä¸­çš„åŸºç¡€ç½‘ç»œéš”ç¦»å•å…ƒï¼Œæ›´æ˜¯ Azure äº‘ä¸Šä¸“ç”¨ç½‘ç»œçš„åŸºæœ¬æ„å»ºåŸºå—ã€‚é€šè¿‡ VNet å¯ä»¥åœ¨ Azure äº‘ä¸Šæ„å»ºç±»ä¼¼äºæœ¬åœ°å±€åŸŸç½‘ä¸€æ ·çš„å¤æ‚ç½‘ç»œï¼Œå®ƒè¿˜æä¾›äº† Azure åŸºç¡€ç»“æ„çš„é¢å¤–ä¼˜åŠ¿ï¼Œä¾‹å¦‚ç¼©æ”¾ã€å¯ç”¨æ€§å’Œéš”ç¦»ã€‚<br><img src="/2024/07/20/liang-ri-yi-gai-nian-zhi-azure-pian-azure-wang-luo-jia-gou-guan-jian-zu-jian/virtual-network.png" alt="VNet"><br><strong>ç‰¹æ€§ï¼š</strong></p><ul><li><strong>IPåœ°å€ç©ºé—´ç®¡ç†</strong>ï¼šç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ VNet çš„ IP åœ°å€èŒƒå›´ï¼Œä½¿ç”¨ CIDR æ ¼å¼ã€‚</li><li><strong>å­ç½‘ï¼ˆSubnetï¼‰</strong>ï¼šVNet å†…å¯ä»¥åˆ›å»ºå¤šä¸ªå­ç½‘ï¼Œç”¨äºé€»è¾‘éš”ç¦»å’Œç®¡ç†ã€‚æ³¨æ„ï¼Œå­ç½‘å½¼æ­¤ä¹‹é—´ IP åœ°å€èŒƒå›´ä¸èƒ½é‡å ã€‚</li><li><strong>èµ„æºè¿æ¥</strong>ï¼šæ”¯æŒå°†è™šæ‹Ÿæœºã€åº”ç”¨æœåŠ¡ã€æ•°æ®åº“ç­‰èµ„æºè¿æ¥åˆ° VNet ä¸­ã€‚</li></ul><p>å€ŸåŠ© Azure VNetï¼ŒAzure ä¸­çš„èµ„æºå¯ä»¥å®‰å…¨åœ°åœ¨ç›¸äº’ä¹‹é—´ã€ä¸ Internet å’Œæœ¬åœ°ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚<br><img src="/2024/07/20/liang-ri-yi-gai-nian-zhi-azure-pian-azure-wang-luo-jia-gou-guan-jian-zu-jian/virtual-networks.png" alt=" VNets "><br>åœºæ™¯åˆ†åˆ«åŒ…æ‹¬ï¼š</p><ul><li><strong>ä¸ Internet ä¹‹é—´çš„é€šä¿¡ã€‚</strong>&nbsp;å¯ä»¥é€šè¿‡ç»™ VNet å†…çš„èµ„æºï¼Œæ¯”å¦‚ VM â€”â€” åˆ†é… Public IP æˆ– ä½¿ç”¨ Public Load balancer æ¥ä¸è¿™äº›èµ„æºè¿›è¡Œå…¥ç«™é€šä¿¡ï¼Œç”šè‡³ç®¡ç†å‡ºç«™è¿æ¥ã€‚</li><li><strong>Azure èµ„æºä¹‹é—´çš„é€šä¿¡ã€‚</strong>&nbsp;Azure èµ„æºå¯é€šè¿‡ä¸‰ç§å…³é”®æœºåˆ¶è¿›è¡Œé€šä¿¡ï¼šVNetã€Service Endpointsï¼ˆæœåŠ¡ç»ˆç»“ç‚¹ï¼‰ å’Œ VNet Peeringï¼ˆå¯¹ç­‰è¿æ¥ï¼‰ã€‚<ol><li>ä¸€ä¸ª VNet ä¸ä»…å¯ä»¥è¿æ¥ VMï¼Œä¹Ÿå¯ä»¥è¿æ¥å…¶ä»– Azure èµ„æºï¼Œä¾‹å¦‚ Azure Kubernetes Serviceç­‰ã€‚</li><li>å¯ä»¥ä½¿ç”¨ Service Endpoints è¿æ¥åˆ°å…¶ä»– Azure æœåŠ¡ï¼Œä¾‹å¦‚ Azure SQL æ•°æ®åº“å’Œå­˜å‚¨å¸æˆ·ç­‰ã€‚</li><li>åˆ›å»º VNet æ—¶ï¼Œåªè¦ CIDR å—ä¸é‡å ï¼Œå³å¯åˆ›å»ºå¯¹ç­‰è¿æ¥ï¼ˆPeeringï¼‰åˆ°å…¶ä»– VNetã€‚è¿™æ · VNets ä¸­çš„èµ„æºå¯ä»¥ç›¸äº’é€šä¿¡ã€‚</li></ol></li><li><strong>ä¸æœ¬åœ°èµ„æºä¹‹é—´çš„é€šä¿¡ã€‚</strong>&nbsp;å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€é€‰é¡¹å°†æœ¬åœ°è®¡ç®—æœºå’Œç½‘ç»œè¿æ¥åˆ° VNetï¼šç‚¹åˆ°ç«™ç‚¹è™šæ‹Ÿä¸“ç”¨ç½‘ç»œ (Point to Site VPN)ã€ç«™ç‚¹åˆ°ç«™ç‚¹ VPNï¼ˆSite to Site VPNï¼‰ã€Azure ExpressRouteã€‚</li><li><strong>ç­›é€‰ç½‘ç»œæµé‡ã€‚</strong>&nbsp;å¯ä»¥ä½¿ç”¨ç½‘ç»œå®‰å…¨ç»„ï¼ˆNSGï¼‰å’Œç½‘ç»œè™šæ‹Ÿè®¾å¤‡ï¼ˆå¦‚é˜²ç«å¢™ã€ç½‘å…³ã€ä»£ç†å’ŒNATï¼‰çš„ä»»æ„ç»„åˆæ¥ç­›é€‰å­ç½‘ä¹‹é—´çš„ç½‘ç»œæµé‡ã€‚</li><li><strong>è·¯ç”±ç½‘ç»œæµé‡ã€‚</strong>&nbsp;Azure åœ¨ Subnetã€VNetsã€æœ¬åœ°ç½‘ç»œä»¥åŠ Internet ä¹‹é—´è¿›è¡Œç½‘ç»œè·¯ç”±ã€‚ ç”¨æˆ·å¯ä»¥ä½¿ç”¨è·¯ç”±è¡¨ï¼ˆRoute Tableï¼‰æˆ–è¾¹ç•Œç½‘å…³åè®® (BGP) æ¥è¿›è¡Œè·¯ç”±è§„åˆ™å®šåˆ¶ã€‚</li></ul><h2 id="2-ç½‘ç»œå®‰å…¨ç»„-Network-Security-Groups-NSG">2. ç½‘ç»œå®‰å…¨ç»„ (Network Security Groups, NSG)</h2><p>ç½‘ç»œå®‰å…¨ç»„ï¼Œæ˜¯ä¸€ç§ç”¨äºæ§åˆ¶ç½‘ç»œæµé‡çš„è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ã€‚å®ƒé€šè¿‡å®šä¹‰å…¥ç«™ï¼ˆInboundï¼‰å’Œå‡ºç«™ï¼ˆOutboundï¼‰çš„å®‰å…¨è§„åˆ™ï¼Œä¿æŠ¤ Azure èµ„æºå…å—æœªç»æˆæƒçš„è®¿é—®ã€‚<br><strong>ç‰¹æ€§ï¼š</strong></p><ul><li><strong>è§„åˆ™å®šä¹‰</strong>ï¼šç”¨æˆ·å¯ä»¥å®šä¹‰åŸºäºæº IPã€ç›®æ ‡ IPã€ç«¯å£å’Œåè®®çš„å®‰å…¨è§„åˆ™ã€‚</li><li><strong>åº”ç”¨èŒƒå›´</strong>ï¼šNSG å¯ä»¥åº”ç”¨äº<code>å­ç½‘</code>æˆ–<code>å•ä¸ªç½‘ç»œæ¥å£ï¼ˆNICï¼Œ Network Interfaceï¼‰</code>ï¼Œå®ç°ä¸åŒå±‚çº§çš„å®‰å…¨ç­–ç•¥ã€‚</li><li><strong>æµé‡è¿‡æ»¤</strong>ï¼šæä¾›ç»†ç²’åº¦çš„æµé‡æ§åˆ¶ï¼Œç¡®ä¿ç½‘ç»œå®‰å…¨ã€‚</li></ul><p><strong>å•ä¸ª NSG å†… Rules çš„ä¼˜å…ˆçº§ï¼š</strong></p><ul><li>ç”¨æˆ·å®šä¹‰çš„ Ruleï¼šä¼˜å…ˆçº§æ•°å­—èŒƒå›´ 100 ~ 4096 ã€‚</li><li>ä¼˜å…ˆçº§æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</li></ul><p><strong>åº”ç”¨äº Subnet å’Œ NIC çš„ NSG Rules ä¼˜å…ˆçº§ï¼š</strong></p><ul><li>inbound æ–¹å‘ï¼šå…³è”åœ¨ Subnet ä¸Šçš„ NSG Rules ä¼˜å…ˆçº§é«˜äº NIC ä¸Šçš„ã€‚<br>å¦‚ä¸‹å›¾ä¸­ NSG 1 Rules ä¼˜å…ˆçº§é«˜äº NSG 2ã€‚</li><li>outbound æ–¹å‘ï¼šå…³è”åœ¨ NIC ä¸Šçš„ NSG Rules ä¼˜å…ˆçº§é«˜äº Subnet ä¸Šçš„ã€‚<br>å¦‚ä¸‹å›¾ä¸­ NSG 2 Rules ä¼˜å…ˆçº§é«˜äº NSG 1ã€‚<br><img src="/2024/07/20/liang-ri-yi-gai-nian-zhi-azure-pian-azure-wang-luo-jia-gou-guan-jian-zu-jian/nsg.png" alt="NSG"></li></ul><h2 id="3-è™šæ‹Ÿç§æœ‰ç½‘ç»œï¼ˆVirtual-Private-Network-VPNï¼‰">3. è™šæ‹Ÿç§æœ‰ç½‘ç»œï¼ˆVirtual Private Network, VPNï¼‰</h2><p>VPN å…è®¸é€šè¿‡å®‰å…¨çš„æ–¹å¼å°† Azure è™šæ‹Ÿç½‘ç»œä¸æœ¬åœ°ç½‘ç»œã€Azure è™šæ‹Ÿç½‘ç»œä¸å…¶ä»–äº‘ç¯å¢ƒè¿æ¥èµ·æ¥ã€‚å®ƒé€šå¸¸ä½¿ç”¨ IPsec åè®®ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä¿å¯†æ€§å’Œå®Œæ•´æ€§ã€‚<br><strong>ç‰¹æ€§ï¼š</strong></p><ul><li><strong>ç«™ç‚¹åˆ°ç«™ç‚¹VPN</strong>ï¼ˆSite to Siteï¼‰ï¼šç”¨äºè¿æ¥ Azure VNet å’Œæœ¬åœ°æ•°æ®ä¸­å¿ƒã€‚</li><li><strong>ç‚¹åˆ°ç«™ç‚¹VPN</strong>ï¼ˆPoint to Siteï¼‰ï¼šå…è®¸ä¸ªäººè®¾å¤‡é€šè¿‡ VPN è¿æ¥åˆ° Azure è™šæ‹Ÿç½‘ç»œã€‚</li><li><strong>VPN transit for VNet Peering</strong>ï¼šæ˜¯ä¸€ç§æ··åˆçš„ç½‘ç»œè¿æ¥æ–¹æ³•ï¼Œå®ƒç»“åˆäº† VNet Peering å’ŒVPN Gateway çš„ä¼˜åŠ¿ï¼Œå®ç°äº†è·¨è™šæ‹Ÿç½‘ç»œçš„å®‰å…¨è¿æ¥å’Œæ•°æ®ä¼ è¾“ã€‚å¯ç”¨äº Hub-and-Spoke ç½‘ç»œæ¨¡å‹æ¶æ„ã€‚</li></ul><h2 id="4-æœåŠ¡ç»ˆç»“ç‚¹ï¼ˆService-Endpointsï¼‰">4. æœåŠ¡ç»ˆç»“ç‚¹ï¼ˆService Endpointsï¼‰</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAzure æœåŠ¡éƒ½æ˜¯é’ˆå¯¹ç›´æ¥ Internet è®¿é—®è€Œè®¾è®¡çš„ã€‚ æ‰€æœ‰ Azure èµ„æºéƒ½æœ‰ Public IPï¼Œå…¶ä¸­åŒ…æ‹¬ PaaS æœåŠ¡ï¼Œä¾‹å¦‚ Azure SQL æ•°æ®åº“å’Œ Azure å­˜å‚¨ã€‚ ç”±äºè¿™äº›æœåŠ¡å¯¹ Internet éƒ½æ˜¯å…¬å¼€çš„ï¼Œå› æ­¤ä»»ä½•äººéƒ½å¯èƒ½è®¿é—®ä½ çš„ Azure æœåŠ¡ã€‚</p><p>Service Endpoints å¯ä»¥è®© VNet ä¸­çš„èµ„æºç›´æ¥è¿æ¥åˆ°â€œç‰¹å®šç±»å‹çš„ PaaS æœåŠ¡â€ï¼Œç¡®ä¿æ•°æ®åœ¨ Azure éª¨å¹²ç½‘ç»œä¸­ä¼ è¾“ï¼Œæé«˜äº†å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚æ·»åŠ  Service Endpoints ä¸ä¼šåˆ é™¤æš´éœ²ç»™å¤–ç½‘çš„å…¬å…±ç»ˆç»“ç‚¹ï¼Œå®ƒåªæ˜¯æä¾›äº†æµé‡çš„é‡å®šå‘ã€‚</p><p><strong>ç‰¹æ€§ï¼š</strong></p><ul><li><strong>ç½‘ç»œæ‰©å±•</strong>ï¼šå…è®¸è®¡ç®—èµ„æºä» VNet ä¸­ç›´æ¥è®¿é—® Azure æœåŠ¡ã€‚</li><li><strong>å®‰å…¨ä¼ è¾“</strong>ï¼šæ•°æ®ä¼ è¾“åœ¨ Azure å†…éƒ¨ç½‘ç»œä¸­å®Œæˆï¼Œäº‹å®ä¸Šä¸ç»è¿‡ Azure æœåŠ¡çš„å…¬ç½‘ IP æˆ– åŸŸåï¼Œé¿å…äº†å…¬å…±äº’è”ç½‘çš„é£é™©ã€‚</li><li><strong>ç®€åŒ–ç®¡ç†</strong>ï¼šæ— éœ€é¢å¤–çš„ä»£ç†æˆ– NAT é…ç½®ï¼Œç®€åŒ–äº†ç½‘ç»œç®¡ç†ã€‚</li></ul><h2 id="5-ä¸“ç”¨ç»ˆç»“ç‚¹-ä¸“ç”¨é“¾æ¥ï¼ˆPrivate-EndPoint-Private-Linkï¼‰">5. ä¸“ç”¨ç»ˆç»“ç‚¹ / ä¸“ç”¨é“¾æ¥ï¼ˆPrivate EndPoint / Private Linkï¼‰</h2><p>åœ¨ VNet ä¸­åˆ›å»º Private Endpointï¼Œç„¶åé€šè¿‡ Private Link å°†â€œå…·ä½“çš„æŸä¸€ä¸ª Azure æœåŠ¡å®ä¾‹â€ä¸ç”¨æˆ·çš„ VNet è¿æ¥èµ·æ¥ï¼ŒæœåŠ¡å®ä¾‹å¯åˆ é™¤å…¬å…±ç»ˆç»“ç‚¹ï¼Œç¡®ä¿æ‰€æœ‰æµé‡åœ¨ä¸“ç”¨ç½‘ç»œä¸­ä¼ è¾“ã€‚å¯¹æ¯” Service Endpoints è¿›ä¸€æ­¥å¢å¼ºäº†å®‰å…¨æ€§ã€‚</p><p>æ›´å¤š Service Endpoints å’Œ Private Endpoints çš„å·®å¼‚å¯¹æ¯”ï¼Œè§å®˜æ–¹æ–‡æ¡£ <a href="https://learn.microsoft.com/zh-cn/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints">æ¯”è¾ƒä¸“ç”¨ç»ˆç»“ç‚¹å’ŒæœåŠ¡ç»ˆç»“ç‚¹</a></p>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> ä¸¤æ—¥ä¸€æ¦‚å¿µ </tag>
            
            <tag> Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤æ—¥ä¸€æ¦‚å¿µä¹‹Azureç¯‡ â€”â€” VM Scales Sets</title>
      <link href="/2024/07/15/liang-ri-yi-gai-nian-zhi-azure-pian-vm-scales-sets/"/>
      <url>/2024/07/15/liang-ri-yi-gai-nian-zhi-azure-pian-vm-scales-sets/</url>
      
        <content type="html"><![CDATA[<p>ç®¡ç†å¤§è§„æ¨¡çš„è™šæ‹Ÿæœºé›†ååˆ†ä¸æ˜“ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨æ¨¡å¼ä¸ç›¸åŒã€æˆ–è€…å¯¹åº”çš„è¯·æ±‚é‡å­˜åœ¨æ³¢åŠ¨æ—¶ â€”â€” æ—¢è¦ä¿æŒååé‡å’Œå“åº”èƒ½åŠ›ï¼ŒåŒæ—¶æœ€å¤§ç¨‹åº¦çš„é™ä½è¿è¡Œæˆæœ¬ã€‚<br>Azure VMSS æ­£æ˜¯åº”å¯¹è¿™ç§éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆã€‚<br>åŒºåˆ«äºå‰ä¸¤ç¯‡ <a href="../../12/liang-ri-yi-gai-nian-zhi-azure-pian-availability-sets/">Availability Sets</a>ã€<a href="../../08/liang-ri-yi-gai-nian-zhi-azure-pian-availability-zones/">Availability Zones</a> ä¸¤ç§é«˜å¯ç”¨æ€§æœºåˆ¶ï¼ŒVMSS é™¤äº†ä¿éšœé«˜å¯ç”¨ä»¥å¤–ï¼Œæä¾›äº†æ›´ç»¼åˆçš„ VMs çš„ç®¡ç†é¢ã€‚</p><p><em>è®²ä¸€ä¸ªæ®µå­ï¼š<br>åœ¨å…¬å¸çš„æ—¶å€™ï¼Œæœ‰æ—¶ä¼šæ¥åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šå®¢æˆ·è¦è¿›è¡Œä¸‹äº‘è¿ç§»ã€‚ç†ç”±æ˜¯ï¼šæ¯ä¸ªè®¡ç®—èµ„æºæ‰“å¼€ä¸€çœ‹ï¼Œå·¥ä½œè´Ÿè½½ä»…å åˆ†é…é‡çš„10%ã€‚å®¢æˆ·è§‰å¾—é¢„ç®—æ’‘ä¸ä½äº†ã€å¤ªè´¹é’±äº†ï¼Œæƒ³é€šè¿‡ä¸‹äº‘è¿ç§»æ¥å®ç°ç»è´¹æ”¶ç´§çš„ç›®æ ‡ã€‚<br>ä½†å…¶å®ï¼Œç¨å¾®äº†è§£ä¸€ç‚¹äº‘çŸ¥è¯†ï¼Œå°±å¯ä»¥çŸ¥é“è®¡ç®—èµ„æºçš„åˆ†é…å’Œæˆæœ¬ä¼˜åŒ–ï¼Œå¯ä»¥é€šè¿‡æ¨ªå‘/çºµå‘ç´§ç¼©ï¼ˆScale In / Scale Downï¼‰æ¥å¿«é€Ÿå®Œæˆï¼Œå¹¶ä¸”å¶å°”çš„è´Ÿè½½å¢åŠ ä¹Ÿå¯ä»¥é€šè¿‡ä¸´æ—¶çš„å¼¹æ€§æ‰©å±•æ¥æ‰¿æ¥ã€‚<br>ä¸€èˆ¬ï¼Œå‡ºç°è¿™æ ·éœ€æ±‚çš„å®¢æˆ·ï¼Œä¸æ˜¯æœ¬èº«çš„äº‘ç®¡ç†æ–¹æ¡ˆä¸å¤ªå®Œæ•´ï¼Œå°±æ˜¯å¯¹äº‘ç®¡ç†å’Œæˆæœ¬ä¼˜åŒ–ä¸å¤ªäº†è§£ã€‚<br>å› æ­¤ï¼Œäº†è§£ä¸€äº›äº‘çŸ¥è¯†ï¼Œæ˜¯èµ„æ·±ç¨‹åºå‘˜æˆ–è€…æ¶æ„å¸ˆä¸å¯æˆ–ç¼ºçš„èƒ½åŠ›ä¹‹ä¸€ã€‚</em></p><h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯-VM-Scale-Sets">ä¸€ã€ä»€ä¹ˆæ˜¯ VM Scale Sets</h3><p>Azure VM Scale Sets(Azure è™šæ‹Ÿæœºè§„æ¨¡é›†ï¼Œç®€ç§° Azure VMSS)ï¼Œæ—¨åœ¨ç®€åŒ–ç®¡ç†å’Œæ‰©å±• Azure VMs çš„å¤§è§„æ¨¡éƒ¨ç½²ã€‚VMSS èƒ½è§£å†³çš„é—®é¢˜ï¼š</p><ul><li>è‡ªåŠ¨åŒ–ç®¡ç†ã€‚é€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬å’Œç»Ÿä¸€å·¥å…·ï¼Œé›†ä¸­ç®¡ç†å¤§é‡è™šæ‹Ÿæœºï¼Œå‡å°‘æ‰‹åŠ¨å¯¹æ¯ä¸ªè™šæ‹Ÿæœºç»´æŠ¤çš„å·¥ä½œé‡å’Œå¤æ‚æ€§ã€‚</li><li>é«˜å¯ç”¨æ€§ã€‚è‡ªåŠ¨åˆ†é…å’Œç®¡ç†è™šæ‹Ÿæœºï¼Œç¡®ä¿åº”ç”¨çš„é«˜å¯ç”¨æ€§ï¼Œå‡å°‘å•ç‚¹æ•…éšœã€‚</li><li>å¼¹æ€§æ‰©å±•ã€‚éšç€åº”ç”¨è®¿é—®é‡çš„å¢åŠ ï¼Œèƒ½å¤Ÿå¿«é€Ÿè‡ªåŠ¨åœ°æ¨ªå‘æ‰©å±•è®¡ç®—èµ„æºã€‚</li><li>æˆæœ¬ä¼˜åŒ–ã€‚åŠ¨æ€è°ƒæ•´èµ„æºä½¿ç”¨ï¼Œæ ¹æ®è´Ÿè½½é‡è‡ªåŠ¨ç¼©æ”¾è™šæ‹Ÿæœºæ•°é‡ï¼Œä¼˜åŒ–æˆæœ¬æ”¯å‡ºã€‚</li></ul><p>VMSS æ˜¯ä½¿ç”¨è™šæ‹Ÿæœºç»„æˆçš„ï¼Œå¹¶æ·»åŠ äº†è´Ÿè½½å‡è¡¡ç­‰ç»„ä»¶è¿›è¡Œç»¼åˆå®ç°ï¼Œè¿˜æä¾›äº†ç®¡ç†å±‚å’Œè‡ªåŠ¨å±‚æ¥è¿è¡Œå’Œç¼©æ”¾åº”ç”¨ç¨‹åºã€‚ç›¸æ¯”äº IaaSï¼Œå·²ç»è¶‹å‘ PaaS çš„è¡¨ç°ã€‚<br>åœ¨ VMSS å‘å¸ƒä¹‹å‰ï¼Œç”¨æˆ·é€šå¸¸åªèƒ½æ‰‹åŠ¨ä¾æ¬¡åœ°åˆ›å»ºå’Œç®¡ç† VMsï¼Œæˆ–ä½¿ç”¨è‡ªä¸»æ–¹æ¡ˆå»é›†æˆç°æœ‰å·¥å…·ä»¥è¿›è¡Œè‡ªåŠ¨åŒ–ã€‚</p><h3 id="äºŒã€æ”¯æŒçš„åœºæ™¯">äºŒã€æ”¯æŒçš„åœºæ™¯</h3><p>VMSS æ”¯æŒè®¡ç®—èµ„æºã€å¤§æ•°æ®ã€å®¹å™¨åŒ–ç­‰åœºæ™¯çš„å·¥ä½œè´Ÿè½½ï¼Œä»¥åŸºç¡€è®¾æ–½å±‚çš„èº«ä»½ï¼ŒæœåŠ¡äºç”Ÿæˆå¤§è§„æ¨¡çš„æœåŠ¡ã€‚<br>æ¯”å¦‚ï¼š</p><ul><li><strong>Web åº”ç”¨å’Œ APIï¼š</strong> ç”¨äºæ”¯æŒé«˜æµé‡ç½‘ç«™å’Œ API æœåŠ¡ï¼Œè‡ªåŠ¨æ‰©å±•å’Œç¼©å‡ä»¥åº”å¯¹æµé‡æ³¢åŠ¨ã€‚</li><li><strong>æ¸¸æˆæœåŠ¡å™¨ï¼š</strong> åŠ¨æ€ç®¡ç†å’Œæ‰©å±•æ¸¸æˆæœåŠ¡å™¨ï¼Œä»¥åº”å¯¹é«˜å³°æœŸçš„ç©å®¶æ•°é‡ã€‚</li><li><strong>å¤§æ•°æ®å¤„ç†ï¼š</strong> å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ï¼Œå¦‚æ•°æ®ä»“åº“å’Œå¤§æ•°æ®åˆ†æå¹³å°ã€‚</li><li><strong>å®¹å™¨ç¼–æ’ï¼š</strong> æ”¯æŒ Kubernetes å’Œå…¶ä»–å®¹å™¨ç¼–æ’å·¥å…·ï¼Œæä¾›å¼¹æ€§å’Œé«˜å¯ç”¨çš„åŸºç¡€è®¾æ–½ã€‚<br>å› æ­¤ï¼Œå¦‚æœå¤„ç†éœ€æ±‚å„å¼‚ä¸”ä¸å¯é¢„æµ‹çš„å¤§å‹å·¥ä½œè´Ÿè½½ï¼Œåˆ™ VMSS æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</li></ul><p>å¦å¤–ï¼Œä¸æ¨èä½¿ç”¨ VMSS çš„åœºæ™¯ï¼š</p><ul><li>æ‰˜ç®¡åœ¨å•ä¸ª VM ä¸Šçš„åº”ç”¨ç¨‹åºï¼Œè¯¥ VM çš„åˆ©ç”¨ç‡æ²¡æœ‰æ³¢åŠ¨ï¼Œå¹¶ä¸”æ²¡æœ‰å…è®¸è´Ÿè½½å‡è¡¡çš„ä½“ç³»ç»“æ„ã€‚<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨ VM æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ï¼Œä½†åº”å®šæœŸæ£€æŸ¥ VMï¼Œä»¥ç¡®ä¿ VM çš„å¤§å°ä¸å·¥ä½œè´Ÿè½½çš„æ€§èƒ½ç›¸ç¬¦ã€‚</li><li>æ‰˜ç®¡åœ¨å•ä¸ª VM ä¸Šçš„åº”ç”¨ç¨‹åºï¼Œæ¯å¤©ä»…ç”±å°‘æ•°äººåœ¨å›ºå®šæ—¶æ®µä½¿ç”¨ã€‚<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ VM æœ¬èº«çš„è®¡åˆ’æ¥å¯åŠ¨å’Œå…³é—­ VMï¼Œä»è€Œä¼˜åŒ–æˆæœ¬ï¼Œç¡®ä¿ VM åœ¨è¥ä¸šæ—¶é—´å¯ç”¨ï¼Œåœ¨æ²¡æœ‰ä»»ä½•ç”¨æˆ·å·¥ä½œæ—¶å¤„äºè„±æœºçŠ¶æ€ã€‚</li></ul><h3 id="ä¸‰ã€ç‰¹æ€§å’Œæœºåˆ¶">ä¸‰ã€ç‰¹æ€§å’Œæœºåˆ¶</h3><p>ä½¿ç”¨ VMSS å¯ä»¥åˆ›å»ºå¹¶ç®¡ç†ä¸€ç»„è´Ÿè½½å‡è¡¡çš„ VMsï¼ŒåŒæ—¶æ ¹æ®éœ€æ±‚é‡ã€æˆ–å®šä¹‰çš„è®¡åˆ’è‡ªåŠ¨å¢å‡ VM å®ä¾‹çš„æ•°ç›®ã€‚</p><p><strong>1ã€VMSS çš„ç»„ä»¶</strong><br>åˆ›å»ºä¸€ä¸ª VMSS ä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹ç»„ä»¶ï¼š</p><ul><li>é»˜è®¤æƒ…å†µæƒ…å†µä¸‹ï¼Œç”Ÿæˆä¸¤ä¸ª VM å®ä¾‹</li><li>ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨</li><li>ä¸€ä¸ªå…¬ç½‘ IPï¼ˆæŒ‚åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šï¼‰</li><li>ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œ VNET</li><li>ä¸€ä¸ªç½‘ç»œå®‰å…¨ç»„ NSG</li><li>ä¸€ä¸ª VMSS çš„æ§åˆ¶é¢ï¼Œä»¥åŠèƒŒåçš„è‡ªåŠ¨å±‚<br><img src="/2024/07/15/liang-ri-yi-gai-nian-zhi-azure-pian-vm-scales-sets/VMSS%20Components.png" alt="ä¸€ä¸ª VMSS çš„åŸºæœ¬ç»„æˆ"><br>VMSS ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨åœ¨ VMs ä¹‹é—´åˆ†é…è¯·æ±‚ã€‚<br>å¹¶ä¸” VMSS é€šè¿‡é…ç½®è´Ÿè½½å‡è¡¡å™¨ä¸­çš„ health probesï¼Œæ¥ç¡®è®¤æ•´ä¸ªè§„æ¨¡é›†ä¸­æ¯ä¸ª VM å®ä¾‹çš„å¯ç”¨æ€§ã€‚</li><li>æ¢é’ˆ ping é€šï¼Œåˆ™è®¤ä¸º VM å®ä¾‹å¯ç”¨ã€‚</li><li>ping å¤±è´¥æˆ–è¶…æ—¶ï¼Œè§„æ¨¡é›†åˆ™åˆ¤å®š VM å®ä¾‹ä¸å¯ç”¨ï¼Œåˆ™ä¸ä¼šå‘å®ƒå‘é€è¯·æ±‚ã€‚å¹¶ä¸”ç»“åˆå¯ç”¨çš„â€œè‡ªåŠ¨å®ä¾‹ä¿®å¤â€ç­–ç•¥ï¼Œå°è¯•ä¿®å¤ VM å®ä¾‹ã€‚</li></ul><p><strong>2ã€VMSS çš„ä¸šåŠ¡æµç¨‹æ¨¡å¼</strong><br>VMSS çš„ä¸šåŠ¡æ¨¡å¼åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><strong>Uniform orchestrationï¼ˆç»Ÿä¸€ä¸šåŠ¡æµç¨‹æ¨¡å¼ï¼‰</strong><br>æŒ‡åœ¨åŒä¸€ä¸ª VMSS ä¸­ä½¿ç”¨ç›¸åŒè§„æ ¼å’Œé…ç½®çš„ VMs â€”â€” ä¸»è¦è¿ç”¨äºå¤§è§„æ¨¡æ— çŠ¶æ€çš„å·¥ä½œè´Ÿè½½ï¼Œå¤šåº”ç”¨äºå„ VM è¿è¡Œç›¸åŒçš„åº”ç”¨ç¨‹åºã€‚</li><li><strong>Flexible orchestrationï¼ˆçµæ´»ä¸šåŠ¡æµç¨‹æ¨¡å¼ï¼‰</strong><br>åŒä¸€ä¸ª VMSS ä¸­åŒ…å«æœ‰ä¸åŒè§„æ ¼å’Œé…ç½®çš„ VMsï¼Œå¯ä»¥ç”¨äºè¿è¡Œä¸åŒçš„åº”ç”¨ç¨‹åºã€‚<br>ä¸åŒäºç¬¦åˆç›´è§‰çš„â€œç»Ÿä¸€ä¸šåŠ¡æµç¨‹æ¨¡å¼â€ï¼Œçµæ´»ä¸šåŠ¡æµç¨‹ä¸Šçš„ VMs å¯ä»¥æ‹¥æœ‰ä¸åŒçš„é…ç½®å’Œåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸ºæ•´ä¸ª VM é›†æä¾›äº†ç»Ÿä¸€çš„ä½“éªŒã€‚<br>åŒæ—¶ï¼Œçµæ´»æ¨¡å¼å¯¹å®¹é”™åŸŸè¿›è¡Œäº†å…¼å®¹ï¼Œè¿™å¯¹äºè¿è¡ŒåŸºäºä»²è£çš„å·¥ä½œè´Ÿè½½æˆ–æœ‰çŠ¶æ€çš„å·¥ä½œè´Ÿè½½è€Œè¨€è‡³å…³é‡è¦ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ VM çš„è¿‡ç¨‹ä¸­ï¼Œæ¯”èµ·ä½¿ç”¨ Availability Setsï¼ŒAzure ä¼šæ›´æ¨èä½¿ç”¨ VMSS çš„çµæ´»ä¸šåŠ¡æ¨¡å¼ã€‚<br>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š<ul><li>åŸºäºä»²è£çš„å·¥ä½œè´Ÿè½½</li><li>å¼€æºæ•°æ®åº“</li><li>æœ‰çŠ¶æ€åº”ç”¨ç¨‹åº</li><li>éœ€è¦æ··åˆè™šæ‹Ÿæœºç±»å‹çš„æœåŠ¡</li><li>é—ç•™çš„å¯ç”¨æ€§é›†</li></ul></li></ul><p>æ›´å¤šä¸šåŠ¡æµç¨‹çš„æ¯”è¾ƒï¼Œå¯è§å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://learn.microsoft.com/zh-cn/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-orchestration-modes">Azure ä¸­è™šæ‹Ÿæœºè§„æ¨¡é›†çš„ä¸šåŠ¡æµç¨‹æ¨¡å¼ - Azure Virtual Machine Scale Sets</a></p><p><strong>3ã€è‡ªåŠ¨ç¼©æ”¾</strong><br>VMSS çš„è‡ªåŠ¨ç¼©æ”¾åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>è®¡åˆ’ç¼©æ”¾ã€‚<br>å¦‚æœå·²çŸ¥åœ¨æŒ‡å®šæ—¥æœŸ/æ—¶æ®µå†…å·¥ä½œè´Ÿè½½ä¼šå¢åŠ ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚</li><li>æŒ‡æ ‡ç¼©æ”¾ã€‚<br>é€šè¿‡ç›‘è§†ä¸è§„æ¨¡é›†å…³è”çš„æ€§èƒ½æŒ‡æ ‡æ¥è°ƒæ•´ç¼©æ”¾ï¼Œæ¯”å¦‚ CPU ä½¿ç”¨ç‡ã€IO ç­‰ã€‚<br>å¦‚æœè¿™äº›æŒ‡æ ‡è¶…è¿‡æŒ‡å®šé˜ˆå€¼ï¼Œè§„æ¨¡é›†å¯ä»¥è‡ªåŠ¨å¯åŠ¨æ–°çš„è™šæ‹Ÿæœºå®ä¾‹ï¼›å¦‚æœæŒ‡æ ‡è¡¨æ˜ä¸å†éœ€è¦é¢å¤–èµ„æºï¼Œè§„æ¨¡é›†å¯ä»¥å›æ”¶å¤šä½™çš„å®ä¾‹ã€‚</li></ul><p><strong>4ã€Spot instance VMs</strong><br>Azure ä¸º VMSS æä¾›äº†ä½¿ç”¨ Spot instances çš„é€‰é¡¹ã€‚<br>Spot instance VMs ä¸å¤ªå¥½ç¿»è¯‘ï¼ŒèƒŒåä»£è¡¨çš„æ„æ€æ˜¯ï¼šAzure å¹³å°ä¸Šçš„ä¸€äº›é—²ç½®çš„ VMï¼ˆæš‚æ—¶è¿˜æ²¡æœ‰ç§Ÿæˆ·ä½¿ç”¨çš„ï¼‰ã€‚<br>å¯ä»¥å…è®¸ VMSS ä½¿ç”¨è¿™äº›è™šæ‹Ÿæœºï¼Œä¼˜ç‚¹æ˜¯æ¯”æ­£å¸¸çš„å”®ä»·ä¾¿å®œï¼ˆæ ¹æ®ä¸åŒçš„åœ°åŒºï¼ŒèŠ‚çœå¯ä»¥é«˜è¾¾80%ï¼‰ï¼›ç¼ºç‚¹æ˜¯ Azure å¹³å°éšæ—¶å¯èƒ½å›æ”¶ â€”â€” å›æ”¶æ—¶åªä¼šç»™ç”¨æˆ·å‘ä¸ªé€šçŸ¥ï¼Œç„¶åä¼šæ ¹æ®ç”¨æˆ·è®¾ç½®çš„é€å‡ºç­–ç•¥ä» VMSS ä¸­åˆ é™¤è¿™äº›è™šæ‹Ÿæœºï¼Œæ‰€ä»¥ SLA å®Œå…¨ä¸ä¿è¯ã€‚</p><p>å› æ­¤ï¼Œè¿™ä¸ª VMSS with Spot instancesï¼Œåªæ¨èä½¿ç”¨äº â€”â€” å¤„ç†å¯ä»¥æœåŠ¡ä¸­æ–­çš„å·¥ä½œè´Ÿè·ï¼ˆä¾‹å¦‚æ‰¹å¤„ç†ä½œä¸šï¼‰ã€å¼€å‘/æµ‹è¯•ç¯å¢ƒç­‰åœºæ™¯ã€‚</p><h3 id="å››ã€çº¦æŸ">å››ã€çº¦æŸ</h3><ul><li><strong>å®ä¾‹é™åˆ¶ï¼š</strong> å•ä¸ªè§„æ¨¡é›†æœ€å¤šæ”¯æŒ 1,000 ä¸ªè™šæ‹Ÿæœºå®ä¾‹ã€‚</li><li><strong>è™šæ‹Ÿæœºç³»ç»Ÿæ”¯æŒ</strong>ï¼šæ”¯æŒ Linux å’Œ Windows è™šæ‹Ÿæœºã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> ä¸¤æ—¥ä¸€æ¦‚å¿µ </tag>
            
            <tag> Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤æ—¥ä¸€æ¦‚å¿µä¹‹Azureç¯‡ â€”â€” Availability Sets</title>
      <link href="/2024/07/12/liang-ri-yi-gai-nian-zhi-azure-pian-availability-sets/"/>
      <url>/2024/07/12/liang-ri-yi-gai-nian-zhi-azure-pian-availability-sets/</url>
      
        <content type="html"><![CDATA[<p>å‰é¢è®²äº† <a href="../../08/liang-ri-yi-gai-nian-zhi-azure-pian-availability-zones/">Availability Zones</a>ï¼Œè¿™é‡Œå†èŠä¸€ä¸‹å¦ä¸€ä¸ªæ¦‚å¿µï¼š<strong>Availability Setsï¼ˆå¯ç”¨é›†ï¼‰ã€‚</strong></p><h3 id="ä¸€ã€ä½•ä¸º-Availability-Sets">ä¸€ã€ä½•ä¸º Availability Sets</h3><p><strong>Availability Setsï¼ˆä¹Ÿç§°å¯ç”¨é›†ï¼‰</strong>ï¼Œä¹Ÿæ˜¯äº‘å¹³å°é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚ä½†ç›¸æ¯” Availability Zonesï¼Œæ˜¯ä¸€ä¸ªé€‚ç”¨æ€§å¹¶æ²¡é‚£ä¸ªå¹¿çš„æ¦‚å¿µã€‚</p><p>å¦‚æœè¯´ Availability Zones æ˜¯ä»¥è·¨ Zones çš„æ–¹å¼ï¼Œè§£å†³å•ç‚¹é—®é¢˜ï¼›é‚£ Availability Sets åˆ™æ˜¯ â€”â€” å½“æƒ³åœ¨ å•ä¸ª Zone ä»¥å†…ã€æˆ–è€…æ‰€é€‰ Region ä¸æ”¯æŒ Availability Zonesæ—¶ï¼Œè§£å†³å•ç‚¹é—®é¢˜çš„æœºåˆ¶ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š<br>Azure ä¸ºè™šæ‹Ÿæœºæä¾›äº†å¤šä¸ªé«˜å¯ç”¨æ€§é€‰é¡¹ã€‚ å¯ä»¥ä½¿ç”¨Availability Setsã€Availability Zones å’Œ Azure VM Scales Sets æ¥å®ç°é«˜å¯ç”¨æ€§ã€‚ï¼ˆAzure VM Scales Sets è¿™ä¸ªä»¥åèŠï¼Œä¸åŒäºå‰ä¸¤è€…ï¼Œå®ƒæ˜¯ä¸€ä¸ª PaaS åŠŸèƒ½ï¼‰</p><p>å½“ä¸€ç»„ç›¸åŒåŠŸèƒ½ã€æˆ–ç›¸å…³è”çš„ VMsï¼Œä½¿ç”¨ Availability Zones çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œä¸åŒçš„ Zones ä¹‹é—´ä¼šè¿›è¡Œæ•…éšœéš”ç¦»å’Œäº¤æ›¿æ›´æ–°ï¼Œæœ‰æ•ˆé¿å…å•ç‚¹æ•…éšœã€‚<br>è€Œå½“æ²¡æœ‰æ¡ä»¶ä½¿ç”¨ Availability Zones æ—¶ï¼Œå¦‚ä½•è®© Azure äº†è§£å“ªäº› VMs éœ€è¦è¿›è¡Œå¿…è¦çš„æ•…éšœéš”ç¦»å’Œäº¤æ›¿æ›´æ–°å‘¢ï¼Ÿè¿™æ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ Availability Setsäº†ã€‚</p><p>Availability Sets æ˜¯ VM çš„é€»è¾‘åˆ†ç»„ï¼Œå¯ä»¥è®© Azure äº†è§£åº”ç”¨ç¨‹åºçš„æ„å»ºæ–¹å¼ï¼Œä»¥ä¾¿æä¾›å†—ä½™å’Œå¯ç”¨æ€§ã€‚<br>é‚£ä»€ä¹ˆæ˜¯è®© Azure äº†è§£åº”ç”¨ç¨‹åºçš„æ„å»ºæ–¹å¼å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°äº†ç»„æˆ Availability Sets çš„ä¸¤ä¸ªé‡è¦æ¦‚å¿µï¼š<strong>æ›´æ–°åŸŸ</strong> å’Œ <strong>å®¹é”™åŸŸ</strong>ã€‚</p><h3 id="äºŒã€æ›´æ–°åŸŸå’Œå®¹é”™åŸŸ">äºŒã€æ›´æ–°åŸŸå’Œå®¹é”™åŸŸ</h3><p>Azure å¹³å°ä¼šä¸º Availability sets é‡Œçš„æ¯ä¸ª VM åˆ†é…ä¸€ä¸ªæ›´æ–°åŸŸå’Œä¸€ä¸ªå®¹é”™åŸŸ ã€‚</p><ul><li><p><strong>æ›´æ–°åŸŸ</strong><br>åœ¨åŒä¸€æ›´æ–°åŸŸä¸­çš„ VMsï¼Œåœ¨ Azure å‡çº§æ—¶ï¼Œä¼šåŒä¸€æ—¶é—´ä¸€èµ·è¿›è¡Œæ›´æ–°ã€‚</p><p>æ‰€è°“çš„ Azure å‡çº§ï¼ŒæŒ‡â€œè®¡åˆ’å†…ç»´æŠ¤â€ã€‚åœ¨è®¡åˆ’å†…ç»´æŠ¤æœŸé—´ï¼ŒåŒä¸€ä¸ª Availability Zones ä¸€æ¬¡ä»…é‡å¯ä¸€ä¸ªæ›´æ–°åŸŸã€‚é‡å¯çš„æ›´æ–°åŸŸæœ‰30åˆ†é’Ÿçš„æ—¶é—´è¿›è¡Œæ¢å¤ï¼Œæ­¤æ—¶é—´è¿‡åï¼Œå°±ä¼šåœ¨å¦ä¸€æ›´æ–°åŸŸä¸Šå¯åŠ¨æ›´æ–°æ“ä½œã€‚</p><p>é»˜è®¤ï¼Œä¸€ä¸ª Availability Sets ä¼šæœ‰ 5 ä¸ªæ›´æ–°åŸŸï¼Œæœ€å¤šå¯ä»¥è°ƒæ•´åˆ° 20 ä¸ªã€‚åŒä¸€ä¸ª Availability sets å†…çš„ VMs ä¼šå°½é‡å‡åŒ€åˆ†å¸ƒåœ¨ä¸åŒçš„æ›´æ–°åŸŸã€‚<br><img src="/2024/07/12/liang-ri-yi-gai-nian-zhi-azure-pian-availability-sets/update-domain.png" alt="Update domain"></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ª Availability Sets ä¸­æœ‰ 7 å°è™šæ‹Ÿæœºï¼Œåœ¨ Azure å‡çº§æœŸé—´ï¼Œæœ€å°‘æœ‰å¤šå°‘å° VMs å¯ç”¨ï¼Ÿï¼ˆæ•²é»‘æ¿ï¼ŒAzure è®¤è¯ä¼šè€ƒï¼‰<br>ç­”æ¡ˆæ˜¯ï¼š5å°ã€‚7 - 2ï¼ˆä¸€ä¸ªæ›´æ–°åŸŸè¿™æ—¶å€™ï¼Œæœ€å¤šåªä¼šæœ‰ 2å° VMsï¼‰ã€‚</p></li><li><p><strong>å®¹é”™åŸŸ</strong><br>å®¹é”™åŸŸå®šä¹‰ä¸€ç»„è™šæ‹Ÿæœºï¼Œå®ƒä»¬å…±ç”¨ä¸€ä¸ªé€šç”¨ç”µæºå’Œç½‘ç»œäº¤æ¢æœºã€‚<br>å½“å‡ºç°å±€éƒ¨æ–­ç”µã€ç½‘ç»œè®¾æ–½æ•…éšœç­‰ï¼Œä¸åŒå®¹é”™åŸŸå†…çš„è™šæ‹Ÿæœºä¸å—å½±å“ã€‚<br>ä¸€ä¸ª Availability Sets æœ€å¤šåªèƒ½æœ‰ 3 ä¸ªå®¹é”™åŸŸã€‚<br><img src="/2024/07/12/liang-ri-yi-gai-nian-zhi-azure-pian-availability-sets/ud-fd-configuration.png" alt="Fault Domain"></p></li></ul><h3 id="ä¸‰ã€çº¦æŸ">ä¸‰ã€çº¦æŸ</h3><ul><li><p>é…ç½® Availability Sets çš„æ–¹å¼ã€‚<br>åªèƒ½åœ¨åˆ›å»º VM æ—¶å°† VM æ·»åŠ åˆ° Availability Setsï¼Œä¹‹åå·²å­˜åœ¨çš„ VM æ— æ³•å˜æ›´ Availability Setsã€‚<br>è‹¥è¦æ›´æ”¹ Availability Setsï¼Œå¿…é¡»å°†è™šæ‹Ÿæœºåˆ é™¤ï¼Œç„¶åé‡æ–°åˆ›å»ºè™šæ‹Ÿæœºã€‚</p></li><li><p>æœ‰æ¡ä»¶ä½¿ç”¨ Availability Zones æ–¹å¼çš„ï¼Œæ¨èå°½é‡ä¼˜å…ˆä½¿ç”¨ Availability Zones æ–¹æ¡ˆã€‚æ¯”èµ· Availability Setsï¼Œå¯ä¿è¯æ›´ä¼˜ç§€çš„é«˜å¯ç”¨æ€§å’ŒSLAã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> ä¸¤æ—¥ä¸€æ¦‚å¿µ </tag>
            
            <tag> Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤æ—¥ä¸€æ¦‚å¿µä¹‹Azureç¯‡ â€”â€” Availability Zones</title>
      <link href="/2024/07/08/liang-ri-yi-gai-nian-zhi-azure-pian-availability-zones/"/>
      <url>/2024/07/08/liang-ri-yi-gai-nian-zhi-azure-pian-availability-zones/</url>
      
        <content type="html"><![CDATA[<p>Availability Zonesï¼Œæ˜¯å½“ä»Šäº‘å¹³å°æä¾›é«˜å¯ç”¨æœåŠ¡çš„ä¸»è¦æ–¹æ¡ˆä¹‹ä¸€ã€‚<br>â€Availability Zonesâ€œ ä¼šè¢«ç¿»è¯‘ä¸ºâ€å¯ç”¨åŒºâ€œã€â€å¯ç”¨æ€§åŒºâ€œ æˆ–è€… â€å¯ç”¨æ€§åŒºåŸŸâ€œã€‚<br>ä¸ªäººè®¤ä¸ºæ¯”è¾ƒå¥½çš„ç¿»è¯‘æ˜¯â€å¯ç”¨åŒºâ€œï¼Œå› ä¸ºåœ¨ä¸­æ–‡ç¿»è¯‘ä¸­ï¼Œä¼šå°† â€œZoneâ€ å’Œ â€œRegionâ€ éƒ½ç¿»è¯‘æˆâ€œåŒºåŸŸâ€ï¼Œè€Œ Availability Zones å’Œ Region æ­£å¥½æ˜¯äº‘å¹³å°æœ€å¹¿æ³›å’Œé‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µã€‚<br>å½“ç„¶åœ¨çœ‹æ–‡æ¡£æ—¶ï¼Œæ‹…å¿ƒæ··æ·†çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½æ˜¯çœ‹è‹±æ–‡ç‰ˆæœ¬ã€‚</p><h3 id="ä¸€ã€ä½•ä¸º-Availability-Zones">ä¸€ã€ä½•ä¸º Availability Zones</h3><p>åœ¨ææ¸…æ¥š Availability Zones æ˜¯ä»€ä¹ˆä¹‹å‰ï¼Œéœ€è¦äº†è§£ Region çš„æ¦‚å¿µã€‚</p><p><strong>Region</strong> æ˜¯ä¸€ä¸ªåœ°ç†ä½ç½®æ¦‚å¿µï¼Œä»£è¡¨ä¸€ç»„æ•°æ®ä¸­å¿ƒï¼Œè¿™äº›æ•°æ®ä¸­å¿ƒåœ¨ç½‘ç»œç­‰åŸºç¡€è®¾æ–½ä¸Šé«˜åº¦äº’è”ï¼Œå¹¶ä¸”ä½äºç‰¹å®šçš„åœ°ç†ä½ç½®å†…ï¼Œæ¯”å¦‚ä¸œäºšåŒºï¼ˆHKï¼‰ã€æ—¥æœ¬ä¸œéƒ¨ç­‰ã€‚<br>Region ä½¿ç”¨æˆ·èƒ½å¤Ÿé€‰æ‹©æœ€é€‚åˆå…¶ä¸šåŠ¡éœ€æ±‚çš„æ•°æ®ä¸­å¿ƒä½ç½®ï¼Œä»¥å®ç°ä½å»¶è¿Ÿã€é«˜æ€§èƒ½ã€éµä»æ•°æ®å®‰å…¨ç­‰æ³•å¾‹æ³•è§„ã€‚<br><img src="/2024/07/08/liang-ri-yi-gai-nian-zhi-azure-pian-availability-zones/regions.png" alt="Regions"></p><p>åœ¨ Azure äº‘ä¸Šï¼Œæœ‰ä¸å°‘ Regions æ”¯æŒ <strong>Availability Zones</strong>ã€‚<br>åœ¨è¿™äº›æ”¯æŒçš„ Regions ä¸­ï¼ŒåŒä¸€ä¸ª Region å†…éƒ¨çš„æ•°æ®ä¸­å¿ƒåˆæ ¹æ®ç‰©ç†ã€é€»è¾‘éš”ç¦»è¿›è¡Œäº†åˆ†ç»„ï¼Œæ¯ä¸ªç»„å³æ˜¯ä¸€ä¸ª Availability Zoneã€‚<br>Availability Zones ç¡®ä¿ç”¨æˆ·çš„åº”ç”¨ç¨‹åºå’Œæ•°æ®åœ¨é¢å¯¹ç¡¬ä»¶æ•…éšœã€è‡ªç„¶ç¾å®³ç­‰ç¾éš¾æ€§äº‹ä»¶æ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒé«˜å¯ç”¨æ€§å’Œå¯é æ€§ã€‚<br><img src="/2024/07/08/liang-ri-yi-gai-nian-zhi-azure-pian-availability-zones/regions-availability-zones.png" alt="Availability Zones"></p><p>Availability Zones å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li><p>åœ°ç†ä½ç½®ä¸Šï¼ŒZones ä¹‹é—´ä¸èƒ½ç›¸è·è¿‡è¿œï¼Œè¦è¶³ä»¥ä¸ Zones å»ºç«‹ä½å»¶è¿Ÿè¿æ¥ã€‚Zones å½¼æ­¤é—´é€šè¿‡ä½å»¶è¿Ÿçš„é«˜å¸¦å®½ç½‘ç»œç›¸äº’è¿æ¥ï¼Œç¡®ä¿æ•°æ®åœ¨ä¸åŒ Zones ä¹‹é—´å¿«é€ŸåŒæ­¥ã€‚</p></li><li><p>åŒæ—¶ï¼ŒZones ä¹‹é—´ä¸èƒ½ç›¸è·è¿‡è¿‘ï¼Œå½“åœ°å‡ºç°åœç”µæˆ–å¤©æ°”å½±å“æ—¶ï¼Œåº”ç›¸äº’ä¹‹é—´éš”ç»å½±å“ã€‚</p></li><li><p>æ¯ä¸ª Zone æœ‰ç‹¬ç«‹çš„ç”µæºã€å†·å´å’Œç½‘ç»œè®¾æ–½ç­‰åŸºç¡€ç»“æ„ã€‚</p></li><li><p>æ¯ä¸ª Region è‡³å°‘æœ‰ä¸‰ä¸ª Zonesã€‚</p></li><li><p>Azure æœåŠ¡æ›´æ–°ï¼Œä¸€æ¬¡åªä¼šæ›´æ–°ä¸€ä¸ª Zone ã€‚ä¸€ä¸ª Zone æ›´æ–°å®Œï¼Œæ‰ä¼šæ›´æ–°ä¸‹ä¸€ä¸ªã€‚</p></li><li><p>å…·ä½“å“ªä¸ª Region æ˜¯å¦æ”¯æŒ Availability Zonesï¼Œéœ€è¦æŸ¥è¯¢å®˜æ–¹æœ€æ–° Availability Zones æ”¯æŒæ¸…å•ã€‚<a href="https://learn.microsoft.com/zh-cn/azure/reliability/availability-zones-service-support#azure-regions-with-availability-zone-support">æ”¯æŒå¯ç”¨æ€§åŒºåŸŸçš„ Azure æœåŠ¡</a></p></li></ul><h3 id="äºŒã€Zonal-Zone-redundant-Service">äºŒã€Zonal / Zone-redundant Service</h3><p>Availability Zones é’ˆå¯¹ä¸åŒçš„ Azure äº§å“æœåŠ¡æä¾›äº†ä¸¤ç§ä½¿ç”¨æ–¹æ¡ˆï¼š</p><ul><li><p><strong>Zonal Serviceï¼ˆæ”¯æŒå¯ç”¨åŒºçš„æœåŠ¡ï¼‰</strong> â€”â€” èµ„æºå›ºå®šåˆ°æŒ‡å®šçš„ Zoneã€‚<br>ç”¨æˆ·å¯ä»¥è·¨å¤šä¸ª Zones è¿›è¡Œåˆå¹¶éƒ¨ç½²ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±è®¾è®¡æ–¹æ¡ˆ â€”â€” å¤„ç†æ•°æ®å¤åˆ¶ã€è¯·æ±‚åˆ†å‘ã€æ•…éšœè½¬ç§»ç­‰é—®é¢˜ã€‚<br>ä¸€èˆ¬ Azure ä¸Šçš„ IaaS æ”¯æŒ Zonal Deploymentã€‚æ¯”å¦‚ï¼ŒAzure VMã€‚</p></li><li><p><strong>Zone-redundant Serviceï¼ˆæ”¯æŒå¯ç”¨åŒºå†—ä½™çš„æœåŠ¡ï¼‰</strong> â€”â€” å†—ä½™èµ„æºåˆ†å¸ƒäºå¤šä¸ª Zonesã€‚<br>Azure è‡ªåŠ¨å¤„ç†è·¨ Zones çš„æ•°æ®å¤åˆ¶ã€è¯·æ±‚åˆ†å‘ã€æ•…éšœè½¬ç§»ç­‰é—®é¢˜ã€‚<br>PaaS é€šå¸¸æ”¯æŒ Zone-redundantã€‚æ¯”å¦‚ï¼ŒAzure VM Scale Setï¼ˆVM ä¸ç›´æ¥æ”¯æŒ Zone-redundantï¼Œæƒ³è¦ä½¿ç”¨ Zone-redundant å°±ä½¿ç”¨ Azure VM Scale Setï¼‰ã€Azure Database for MySQLç­‰ã€‚</p></li></ul><p>å…·ä½“æœåŠ¡æ˜¯å¦æ”¯æŒ Zonal / Zone-redundant å¯ä»¥æŸ¥æ‰¾æ¸…å•ï¼š<a href="https://learn.microsoft.com/zh-cn/azure/reliability/availability-zones-service-support#azure-services-with-availability-zone-support">æ”¯æŒå¯ç”¨æ€§åŒºåŸŸçš„ Azure æœåŠ¡</a></p>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> ä¸¤æ—¥ä¸€æ¦‚å¿µ </tag>
            
            <tag> Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤æ—¥ä¸€æ¦‚å¿µä¹‹Azureç¯‡ â€”â€” Azure Backup</title>
      <link href="/2024/07/05/liang-ri-yi-gai-nian-zhi-azure-pian-azure-backup/"/>
      <url>/2024/07/05/liang-ri-yi-gai-nian-zhi-azure-pian-azure-backup/</url>
      
        <content type="html"><![CDATA[<p>å‰é¢ä»‹ç»äº†<a href="../../02/liang-ri-yi-gai-nian-zhi-azure-pian-virtual-machine/">Azure VM</a>ã€‚<br>å½“éƒ¨ç½²äº† VM ä¹‹åï¼Œå¦‚ä½•ä» VM å±‚é¢ä¿è¯ â€œä¸šåŠ¡è¿ç»­æ€§å’Œç¾å¤‡ï¼ˆBCDRï¼‰â€è®¡åˆ’å‘¢ï¼Ÿ</p><p>Azure ä¸º VM åœ¨è¿™æ–¹é¢æä¾›äº†å¤šä¸ªé€‰é¡¹å’Œæ–¹æ¡ˆï¼š</p><ul><li>é«˜å¯ç”¨æ–¹é¢ï¼šAvailability Setsï¼ˆå¯ç”¨æ€§é›†ï¼‰ã€Availability Zoneï¼ˆå¯ç”¨æ€§åŒºï¼‰ã€VM Scale Setsï¼ˆè™šæ‹Ÿæœºè§„æ¨¡é›†ï¼‰ã€‚</li><li>å¤‡ä»½å†—ä½™ï¼šAzure Backupã€Azure Site Recoveryã€‚<br>è¿™ç¯‡èŠçš„å°±æ˜¯Azure Backupã€‚</li></ul><p><code>Azure Backup</code> æ˜¯ Azure çš„ ä¸€é¡¹å†…ç½®çš„åŠŸèƒ½ï¼Œæ¶‰åŠåˆ°å¤šä¸ª Azure äº§å“å’ŒæœåŠ¡ã€‚<br>å®ƒä¸º Azure ç®¡ç†çš„æ•°æ®èµ„äº§æä¾›å®‰å…¨å¤‡ä»½ï¼Œå¹¶å°†å¤‡ä»½æ•°æ®ä¿å­˜åˆ° Recovery Services Vault(æ¢å¤æœåŠ¡ä¿ç®¡åº“ï¼Œ<code>Azure Site Recovery</code> ä¹Ÿå°†æ•°æ®ä¿å­˜åœ¨æ­¤å¤„)ã€‚</p><h3 id="ä¸€ã€Azure-Backup-æ”¯æŒçš„åœºæ™¯">ä¸€ã€Azure Backup æ”¯æŒçš„åœºæ™¯</h3><ol><li><code>Azure VM</code> â€”â€” æ— éœ€é¢å¤–å®‰è£…è½¯ä»¶å³å¯è½»æ¾å¤‡ä»½å’Œè¿˜åŸAzure VMã€‚</li><li><code>æœ¬åœ°æœåŠ¡å™¨ï¼ˆæœ¬åœ°ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼‰</code> â€”â€” éœ€è¦å®‰è£… Microsoft Azure Recovery Service (MARS) Agentã€‚æˆ–è€…åœ¨æœ¬åœ°éƒ¨ç½² Microsoft Azure Backup Service (MABS) æˆ– Data Protection Manager (DPM) ï¼Œç„¶åç”± MARS Agent å°†å¤‡ä»½æœåŠ¡å™¨çš„æ•°æ®å¤‡ä»½åˆ° Azure äº‘ã€‚</li><li><code>Azure File Shareï¼ˆAzureæ–‡ä»¶å…±äº«ï¼‰</code></li><li><code>Azure VM ä¸­çš„å·¥ä½œè´Ÿè½½</code> â€”â€” ä»…åŒ…æ‹¬ SQL Server å’Œ SAP HANA ä¸¤ç§æ•°æ®åº“ã€‚</li></ol><p>ç„¶è€Œï¼Œè¿‘æœŸ Azure Backup çš„æœåŠ¡è¾¹ç•Œåœ¨ä¸æ–­æ‰©å±•ï¼Œæ–°å‡ºç°äº†â€œBackup Vaultï¼ˆå¤‡ä»½ä¿ç®¡åº“ï¼‰â€ï¼Œå¹¶å¯¹åº”äº†æ–°çš„æ”¯æŒåœºæ™¯ï¼ˆæœ‰å¾…è§‚å¯Ÿï¼‰:</p><ul><li>Azure Database for PostgreSQL</li><li>Azure Blob</li><li>Azure Kubernetes</li></ul><h3 id="äºŒã€ä¸-Azure-Site-Recovery-çš„åŒºåˆ«">äºŒã€ä¸ Azure Site Recovery çš„åŒºåˆ«</h3><p><code>Recovery Services Vault</code> æ˜¯å¤‡ä»½çš„å­˜å‚¨å®ä½“ã€‚<br>å®ƒé™¤äº†å¯¹ Azure Backup æä¾›æ”¯æŒä»¥å¤–ï¼ŒåŒæ—¶æä¾›äº†å¯¹ Azure Site Recovery çš„æ”¯æŒã€‚</p><p>è¿™ä¸¤è€…çš„åŒºåˆ«ï¼š<br>Azure Backup çš„ä¸»è¦ç›®æ ‡æ˜¯ â€”â€” ç»´æŠ¤è®©ä½ èƒ½å¤ŸåŠæ—¶å›é€€åˆ°ç›®æ ‡çŠ¶æ€çš„æ•°æ®å‰¯æœ¬ï¼Œä½†Azure Site Recovery å‡ ä¹å¯å®æ—¶å¤åˆ¶æ•°æ®ï¼Œå¹¶å…è®¸æ•…éšœè½¬ç§»ã€‚</p><p>ä»ä¸šåŠ¡è¿ç»­æ€§å’Œå¯ç”¨æ€§ä¸Šè¯´ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ç½‘ç»œæˆ–æ–­ç”µç­‰é—®é¢˜ï¼Œä½ å¯ä½¿ç”¨ Availability Zoneï¼ˆå¯ç”¨æ€§åŒºï¼‰ã€‚</li><li>å¯¹äº Regionï¼ˆåŒºåŸŸï¼‰èŒƒå›´çš„ç¾éš¾ï¼ˆå¦‚è‡ªç„¶ç¾å®³ï¼‰ï¼Œä½¿ç”¨ Azure Site Recoveryã€‚</li><li>åœ¨å‡ºç°æ„å¤–æ•°æ®ä¸¢å¤±ã€æ•°æ®æŸåæˆ–å‹’ç´¢è½¯ä»¶æ”»å‡»çš„æƒ…å†µæ—¶ä½¿ç”¨ Azure Backupã€‚</li></ul><h3 id="ä¸‰ã€ç‰¹æ€§å’Œæœºåˆ¶">ä¸‰ã€ç‰¹æ€§å’Œæœºåˆ¶</h3><p>å¤‡ä»½ VM éµå¾ªç®€å•çš„ä¸‰æ­¥éª¤ï¼š<br>åˆ›å»ºæ¢å¤æœåŠ¡ä¿ç®¡åº“ã€å®šä¹‰å¤‡ä»½ç­–ç•¥ã€æ‰§è¡Œå¤‡ä»½ä½œä¸šã€‚<br><img src="/2024/07/05/liang-ri-yi-gai-nian-zhi-azure-pian-azure-backup/backup-steps.png" alt="backup-steps.png"></p><ul><li><p><strong>åˆ›å»º Recovery Services Vault</strong><br>åˆ›å»ºä¿ç®¡åº“æ—¶ï¼Œéœ€è¦é€‰æ‹©ä¿ç®¡åº“çš„å†—ä½™å¤åˆ¶æœºåˆ¶ã€‚</p><ul><li><code>æœ¬åœ°å†—ä½™å­˜å‚¨ (LRS)</code>ã€‚è¿™æ˜¯æˆæœ¬æœ€ä½çš„é€‰é¡¹ï¼Œé’ˆå¯¹æœåŠ¡å™¨æœºæ¶å’Œé©±åŠ¨å™¨æ•…éšœæä¾›åŸºæœ¬ä¿æŠ¤ã€‚å»ºè®®å°†æ­¤é€‰é¡¹ç”¨äºéå…³é”®æ–¹æ¡ˆã€‚</li><li><code>å¼‚åœ°å†—ä½™å­˜å‚¨ (GRS)</code>ï¼šæ­¤ä¸­é—´é€‰é¡¹åœ¨ Paired Regions çš„æ¬¡è¦åŒºåŸŸä¸­å…·æœ‰æ•…éšœè½¬ç§»åŠŸèƒ½ã€‚ å»ºè®®å°†æ­¤é€‰é¡¹ç”¨äºå¤‡ä»½æ–¹æ¡ˆã€‚</li><li><code>åŒºåŸŸå†—ä½™å­˜å‚¨ (ZRS)</code>ï¼šæ­¤é€‰é¡¹é€šè¿‡è·¨ä¸‰ä¸ª Azure å¯ç”¨æ€§åŒºåŸŸåŒæ­¥å¤åˆ¶å­˜å‚¨å¸æˆ·ï¼Œæ¥é˜²èŒƒæ•°æ®ä¸­å¿ƒçº§åˆ«çš„æ•…éšœã€‚ å»ºè®®å°†æ­¤é€‰é¡¹ç”¨äºé«˜å¯ç”¨æ€§æ–¹æ¡ˆã€‚</li></ul><p>ä»¥ä¸Šä¸‰é¡¹ï¼Œä¹Ÿæ˜¯ Azure å„æœåŠ¡ä¸­å¸¸è§çš„ä¸‰ç§å†—ä½™é€‰é¡¹ï¼Œç»å¸¸ä¼šçœ‹è§å®ƒä»¬ã€‚</p></li><li><p><strong>Snapshotsï¼ˆå¿«ç…§ï¼‰</strong><br>Azure Backup å¯¹æ¯ç§æ”¯æŒçš„æ“ä½œç³»ç»Ÿä½¿ç”¨ä¸åŒçš„æ‰©å±•ï¼Œä»¥ç”Ÿæˆå¿«ç…§ï¼š</p><table><thead><tr><th style="text-align:left">OS</th><th style="text-align:left">æ‰©å±•</th></tr></thead><tbody><tr><td style="text-align:left">Windows</td><td style="text-align:left">VMSnapshotï¼šä½¿ç”¨VSSå¯è·å–ç£ç›˜å’Œå†…å­˜ä¸­æ•°æ®çš„å‰¯æœ¬ã€‚</td></tr><tr><td style="text-align:left">Linux</td><td style="text-align:left">VMSnapshotLinuxï¼šå¿«ç…§ä»…æ˜¯ç£ç›˜æ•°æ®çš„å‰¯æœ¬ã€‚</td></tr></tbody></table><p>å¯è§ï¼ŒAzure Backup é’ˆå¯¹ Windows ç³»ç»Ÿå¯ä»¥è‡ªå¸¦å†…å­˜æ•°æ®çš„å¤åˆ¶ï¼Œä½† Linux åˆ™æ²¡æœ‰æ­¤ç‰¹æ€§ã€‚</p><p>ç”Ÿæˆå¿«ç…§çš„ä¸€è‡´æ€§ï¼Œåˆ†ä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li><code>Application consistent(åº”ç”¨ç¨‹åºä¸€è‡´æ€§)  </code><br>å°†æ•´ä¸ª VM ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œå¿«ç…§æ•è·å’Œç”Ÿæˆã€‚å¿«ç…§ä¸º VM åŠæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºæä¾›å®Œå…¨ä¸€è‡´æ€§ã€‚<br>æ³¨æ„ï¼ŒLinux ç³»ç»Ÿè¦è½å®æ­¤ç‰¹æ€§ï¼Œéœ€è¦è‡ªå·±ç¼–å†™æ¯ä¸ªåº”ç”¨çš„pre \ post scriptsï¼Œä»¥æ•è·åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚</li><li><code>File system consistent(æ–‡ä»¶ç³»ç»Ÿä¸€è‡´æ€§) </code><br>å¦‚æœVSSåœ¨ Windows ä¸Šå‡ºç°æ•…éšœï¼Œæˆ– pre \ post scripts åœ¨ Linux ä¸Šå‡ºç°æ•…éšœï¼Œåˆ™ä»…ä¼šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿä¸€è‡´çš„å¿«ç…§ã€‚</li><li><code>Crash consistent(å´©æºƒä¸€è‡´æ€§)  </code><br>å½“æ­£åœ¨å¤‡ä»½æ—¶ï¼ŒVM å‡ºç°äº†å…³é—­çš„æƒ…å†µï¼Œå¿«ç…§ä¼šè¢«æ ‡è®°ä¸ºâ€œCrash consistentâ€ã€‚æ­¤å¿«ç…§æ—¢ä¸èƒ½ä¿è¯ åº”ç”¨ç¨‹åºä¸€è‡´æ€§ï¼Œä¹Ÿä¸èƒ½ä¿è¯æ“ä½œç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚<br>é™¤éå®åœ¨æ²¡æœ‰åŠæ³•ï¼Œå°½é‡ä¸è¦ä½¿ç”¨Crash consistentçš„å¿«ç…§ã€‚</li></ul></li><li><p><strong>Backup policyï¼ˆå¤‡ä»½ç­–ç•¥ï¼‰</strong><br>å¤‡ä»½ç­–ç•¥ï¼Œå¯å®šä¹‰å¤‡ä»½çš„å¤‡ä»½é¢‘ç‡å’Œä¿å­˜æ—¶é•¿ã€‚</p><ul><li><p>å¤‡ä»½é¢‘ç‡<br>ç›®å‰ï¼ŒVM å¤‡ä»½å¯æ¯å¤©æˆ–æ¯å‘¨è§¦å‘ï¼Œå¹¶ä¸”å¯å­˜å‚¨å¤šå¹´ã€‚ å¦‚æœä½¿ç”¨â€å¢å¼ºç­–ç•¥â€œï¼Œå¯ä»¥è§¦å‘æ¯å°æ—¶å¤‡ä»½ã€‚</p></li><li><p>ä¿å­˜æ—¶é•¿<br>å…ˆæ¥äº†è§£ä¸€ä¸‹ï¼ŒAzure å¤‡ä»½ä½œä¸šåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š<br><img src="/2024/07/05/liang-ri-yi-gai-nian-zhi-azure-pian-azure-backup/virtual-machine-snapshot.png" alt="virtual-machine-snapshot.png"></p><ul><li>é˜¶æ®µ 1ï¼šæ ¹æ®è®¾ç½®çš„å¤‡ä»½æ—¶é—´ç‚¹ï¼Œæ•è·å’Œç”Ÿæˆè™šæ‹Ÿæœºæ•°æ®çš„å¿«ç…§ã€‚</li><li>é˜¶æ®µ 2ï¼šå°†å¿«ç…§ä¼ è¾“åˆ° Recovery Services Vaultã€‚<br>ä¸€èˆ¬ï¼Œé˜¶æ®µ1æ˜¯å®æ—¶å®Œæˆï¼Œä½†é˜¶æ®µ2çš„å®Œæˆæ—¶é•¿ä»1å°æ—¶~24å°æ—¶å†…ä¸ç­‰ã€‚</li></ul><p>å› æ­¤ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µæ‹¥æœ‰ä¸åŒçš„ä¿å­˜æ—¶é•¿ã€‚<br>åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œå¿«ç…§åœ¨ VM æœ¬åœ°è¿›è¡Œäº†â€œinstant storeï¼ˆå³æ—¶å­˜å‚¨ï¼‰â€ï¼Œå­˜å‚¨åœ¨ VM æœ¬åœ°çš„å¤‡ä»½åˆç§°ä¸ºâ€œå¿«ç…§å±‚â€ã€‚<br>åœ¨ç¬¬äºŒé˜¶æ®µï¼Œå½“å¤‡ä»½è¢«ä¸Šä¼ åˆ° Recovery Service Vault ä¸­ï¼Œç§°ä¸ºâ€œä¿ç®¡åº“å±‚â€ã€‚</p><ul><li><p><code>å¿«ç…§å±‚ç­–ç•¥</code><br>é»˜è®¤å¤‡ä»½åœ¨ VM æœ¬åœ°ä¿å­˜çš„æ—¶é•¿ä¸º 2 å¤©ï¼Œå¯é…ç½®ä¸º 1 ~ 5 å¤©ã€‚<br>åœ¨æœ¬åœ°å­˜åœ¨å¿«ç…§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨â€œinstant restoreï¼ˆå³æ—¶è¿˜åŸï¼‰â€ï¼Œä»è€Œå‡å°‘ç­‰å¾…å¤‡ä»½æ•°æ®ä¸Šä¼ åˆ°ä¿ç®¡åº“ã€åˆä»ä¿ç®¡åº“ä¸‹è½½æ¢å¤çš„æ—¶é—´ã€‚<br>å› æ­¤ï¼Œå¦‚æœæœ¬åœ°å¿«ç…§ä¿å­˜æ—¶é•¿æ˜¯2å¤©ï¼Œinstant restore ä»…å¯è¿˜åŸä¸¤å¤©å†…çš„å¤‡ä»½æ•°æ®ã€‚</p></li><li><p><code>ä¿ç®¡åº“å±‚ç­–ç•¥</code><br>é»˜è®¤å¤‡ä»½åœ¨ä¿ç®¡åº“ä¿å­˜çš„æ—¶é•¿ä¸º 30 å¤©ï¼Œå¯å»¶é•¿å­˜å‚¨æ•°å¹´ã€‚<br>ä¿å­˜ä¿ç®¡åº“é‡Œçš„å¤‡ä»½ï¼Œé»˜è®¤å¼€å¯äº†è½¯åˆ é™¤ã€‚å³åœ¨åˆ é™¤å¤‡ä»½é¡¹åï¼Œå¤‡ä»½æ•°æ®ä¹Ÿå°†ä¿ç•™ 14 å¤©ã€‚ è¿™å¯é˜²æ­¢æ„å¤–åˆ é™¤æˆ–æ¶æ„åˆ é™¤æƒ…å†µï¼Œä»è€Œå…è®¸æ¢å¤è¿™äº›å¤‡ä»½ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ã€‚</p></li></ul></li></ul></li><li><p><strong>Restore</strong><br>å¯¹äºè¿˜åŸ VMï¼Œå¯ä»¥æ”¯æŒå¤šç§è¿˜åŸæ–¹å¼ï¼š</p><ul><li>åˆ›å»ºæ–° VM â€”â€” ä»è¿˜åŸç‚¹å¿«é€Ÿåˆ›å»ºä¸€ä¸ª<strong>æ–°çš„ VM</strong>ã€‚</li><li>è¿˜åŸç£ç›˜ â€”â€” è¿˜åŸæŸä¸ª VM ç£ç›˜ï¼Œç„¶åä½¿ç”¨å®ƒæ¥åˆ›å»º<strong>æ–°çš„ VM</strong>ã€‚</li><li>æ›¿æ¢ç°æœ‰é¡¹ â€”â€” å¯è¿˜åŸæŸä¸ªç£ç›˜ï¼Œå¹¶ç”¨å®ƒæ¥æ›¿æ¢<strong>ç°æœ‰ VM</strong> ä¸Šçš„ç£ç›˜ã€‚</li><li>è·¨åŒºåŸŸï¼ˆæ¬¡è¦åŒºåŸŸï¼‰ â€”â€” æ”¯æŒ <strong>åˆ›å»ºæ–° VM</strong>ã€<strong>è¿˜åŸç£ç›˜</strong> ï¼Œæš‚ä¸æ”¯æŒ<strong>æ›¿æ¢ç°æœ‰é¡¹</strong>ã€‚</li><li>è·¨è®¢é˜…è¿˜åŸã€è·¨åŒºåŸŸè¿˜åŸã€‚</li><li>é€‰æ‹©æ€§ç£ç›˜å¤‡ä»½ â€”â€”å…è®¸é€šè¿‡å¢å¼ºç­–ç•¥ï¼Œå¤‡ä»½å’Œè¿˜åŸ VM ç£ç›˜å­é›†ã€‚</li></ul></li></ul><h3 id="å››ã€çº¦æŸ">å››ã€çº¦æŸ</h3><ul><li>å¿«ç…§å±‚ä¿å­˜æ—¶é•¿ï¼šæ ‡å‡†ç‰ˆç­–ç•¥ï¼Œé»˜è®¤å¯åœ¨æœ¬åœ°ä¿ç•™ 2 å¤©ï¼Œä½¿ç”¨å¢å¼ºå‹ç­–ç•¥é»˜è®¤å¯åœ¨æœ¬åœ°ä¿ç•™7 å¤©ã€‚ å¯¹äºæ ‡å‡†ç‰ˆç­–ç•¥ï¼Œä¿ç•™æœŸå€¼å¯é…ç½®ä¸º 1 åˆ° 5 å¤©çš„ä»»ä½•å€¼ï¼Œå¯¹äºå¢å¼ºå‹ç­–ç•¥åˆ™ä¸º 1 è‡³ 30 å¤©ã€‚</li><li>è½¯åˆ é™¤ï¼šæ ‡å‡†ç‰ˆç­–ç•¥ï¼Œè½¯åˆ é™¤ä¿ç•™ 14 å¤©ï¼Œä½¿ç”¨å¢å¼ºå‹ç­–ç•¥å¯å»¶é•¿æ­¤æ—¶é•¿ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> ä¸¤æ—¥ä¸€æ¦‚å¿µ </tag>
            
            <tag> Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤æ—¥ä¸€æ¦‚å¿µä¹‹Azureç¯‡ â€”â€” Virtual Machine</title>
      <link href="/2024/07/02/liang-ri-yi-gai-nian-zhi-azure-pian-virtual-machine/"/>
      <url>/2024/07/02/liang-ri-yi-gai-nian-zhi-azure-pian-virtual-machine/</url>
      
        <content type="html"><![CDATA[<p>Azure Virtual Machineï¼ˆç®€ç§° VMï¼‰ æ˜¯ Azure äº‘ä¸Šçš„ä¸€ç§éå¸¸åŸºæœ¬çš„è®¡ç®—èµ„æºï¼ŒåŒç±»ç«å“æœ‰ AWS ä¸Šçš„ EC2ã€é˜¿é‡Œäº‘ä¸Šçš„ ECS ç­‰ã€‚</p><p>åŸºæœ¬ä¸Šæœ‰ä¸Šäº‘ç»éªŒçš„å·¥ç¨‹å¸ˆï¼Œæœ€å…ˆå…¥é—¨çº§çš„äº‘äº§å“å°±æ˜¯è™šæ‹Ÿæœºã€‚</p><p>äº‘å¹³å°ä¸Šçš„è™šæ‹Ÿæœºï¼Œå¦‚é˜¿é‡Œäº‘ ECSã€AWS EC2ã€Azure VMï¼Œå¹¶ä¸æ˜¯çœŸå®çš„ç‰©ç†æœºï¼Œè€Œæ˜¯é€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆHyper-Vã€KVMç­‰ï¼‰åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šåˆ›å»ºçš„è™šæ‹Ÿå®ä¾‹ã€‚è¿™äº›è™šæ‹Ÿæœºä¸ºç”¨æˆ·æä¾›äº†ç±»ä¼¼ç‰©ç†æœºçš„è®¡ç®—èµ„æºï¼ŒåŒ…æ‹¬CPUã€å†…å­˜ã€å­˜å‚¨å’Œç½‘ç»œèµ„æºï¼Œä½†å®é™…ä¸Šæ˜¯å…±äº«åº•å±‚ç‰©ç†ç¡¬ä»¶çš„æŠ½è±¡åŒ–è¡¨ç¤ºã€‚</p><h3 id="ä¸€ã€Azure-VM-çš„ç‰¹å¾">ä¸€ã€Azure VM çš„ç‰¹å¾</h3><ol><li><p>VM åˆ’å±äº IaaSï¼ˆåŸºç¡€ç»“æ„å³æœåŠ¡ï¼‰ï¼ŒVM æä¾›äº†æ“ä½œç³»ç»Ÿã€å­˜å‚¨å’Œç½‘ç»œåŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ­¤ä¹‹ä¸Šè¿è¡Œå„ç§åº”ç”¨ç¨‹åºã€‚</p></li><li><p>VM å¯ä»¥æ ¹æ®éœ€æ±‚å¿«é€Ÿæ“ä½œ â€”â€” çºµå‘æ‰©å±•å’Œç¼©å‡ã€‚</p></li><li><p>ä¸è™šæ‹Ÿæœºç›¸å…³çš„è´£ä»»ç”± Microsoft å’Œå®¢æˆ·å…±åŒæ‰¿æ‹…ã€‚<br>Microsoft è´Ÿè´£åŸºç¡€è®¾æ–½ã€ç‰©ç†æ•°æ®ä¸­å¿ƒçš„ç®¡ç†å’Œç½‘ç»œå®‰å…¨ã€‚å®¢æˆ·åˆ™è´Ÿè´£è™šæ‹Ÿæœºå†…éƒ¨çš„æ“ä½œç³»ç»Ÿã€å®‰å…¨é…ç½®ã€åº”ç”¨ç¨‹åºç®¡ç†å’Œæ•°æ®ä¿æŠ¤ã€‚</p><p>è¿™é‡Œç¨å¾®æä¸€ä¸‹â€œäº‘æœåŠ¡è´£ä»»å…±æ‹…æ¨¡å‹â€ã€‚ä¸€èˆ¬ç”¨æˆ·ä¸Šäº‘çš„ç›®çš„ï¼Œé™¤äº†ä¿éšœSLAã€æ€§èƒ½å¯å¼¹æ€§ã€èŠ‚çœç ”å‘æˆæœ¬ä¹‹å¤–ï¼Œè·å–ä¸“ä¸šè¿ç»´èƒ½åŠ›ä¹‹ä¸Šçš„è´£ä»»å…±æ‹…æ˜¯ä¸€ä¸ªé‡è¦ç†ç”±ã€‚<br><strong>äº‘æœåŠ¡è´£ä»»å…±æ‹…æ¨¡å‹ï¼š</strong><br><img src="/2024/07/02/liang-ri-yi-gai-nian-zhi-azure-pian-virtual-machine/responsibility-layers-4ffbf946.png" alt="responsibility-layers"></p></li></ol><h3 id="äºŒã€VM-ç”±å¤šä¸ªèµ„æºç»„ä»¶ç»„æˆ">äºŒã€VM ç”±å¤šä¸ªèµ„æºç»„ä»¶ç»„æˆ</h3><p>å…·ä½“åŒ…æ‹¬ï¼š</p><ol><li>è®¡ç®—å•å…ƒï¼švCPU ã€ Mem</li><li>å­˜å‚¨å•å…ƒï¼šç£ç›˜</li><li>ç½‘ç»œï¼šNIC ã€ Virtual Network ã€ Security Group</li><li>å…¶ä»–ç»„ä»¶ï¼šå¦‚VM extensionã€è¯Šæ–­å’Œç›‘æ§å·¥å…·</li></ol><p>å› æ­¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ª VM è¢«åˆ›å»ºå‡ºæ¥åï¼Œä¼šåœ¨èµ„æºæ¸…å•ä¸­å‘ç°å¦‚ä¸‹ä¸€æ‰¹èµ„æºé¡¹ï¼š</p><p><img src="/2024/07/02/liang-ri-yi-gai-nian-zhi-azure-pian-virtual-machine/VM_components.png" alt="VMç»„ä»¶"></p><h3 id="ä¸‰ã€å¦‚ä½•é€‰æ‹©VMå¤§å°è§„æ ¼">ä¸‰ã€å¦‚ä½•é€‰æ‹©VMå¤§å°è§„æ ¼</h3><ol><li><p>é¦–å…ˆï¼Œå½“ç„¶æ˜¯æ˜ç¡®ç”¨æˆ·æ–¹çš„éœ€æ±‚ï¼Œæ‹¿ç€éœ€æ±‚æ¥è¿›è¡Œè§„åˆ’ã€‚</p></li><li><p>ç„¶åï¼Œå¯¹ç…§ Azure VM çš„åˆ†ç±»ï¼Œè¿›è¡Œä¸šåŠ¡æ–¹æ¡ˆæ¯”å¯¹ï¼š<br><img src="/2024/07/02/liang-ri-yi-gai-nian-zhi-azure-pian-virtual-machine/VM_%25E5%2588%2586%25E7%25B1%25BB.png" alt="VMç±»å‹"></p></li><li><p>å…¶æ¬¡ï¼Œé€‰æ‹© VM è§„æ ¼ã€‚<br>ç”±äº Azure VM å„åˆ†ç±»ä¸‹çš„è§„æ ¼å’Œæ—ç³»å®åœ¨æ˜¯å¤ªå¤šï¼Œæƒ³è¦äº†è§£å¯ä»¥å‚ç…§ï¼š</p><blockquote><p>[!info] è™šæ‹Ÿæœºå¤§å°æ¦‚è¿° - Azure Virtual Machines<br>åˆ—å‡º Azure ä¸­è™šæ‹Ÿæœºçš„ä¸åŒå¯ç”¨å®ä¾‹å¤§å°ã€‚<br><a href="https://learn.microsoft.com/zh-cn/azure/virtual-machines/sizes/overview?tabs=breakdownseries%2Cgeneralsizelist%2Ccomputesizelist%2Cmemorysizelist%2Cstoragesizelist%2Cgpusizelist%2Cfpgasizelist%2Chpcsizelist#list-of-vm-size-families-by-type">åˆ—å‡º Azure ä¸­è™šæ‹Ÿæœºçš„ä¸åŒå¯ç”¨å®ä¾‹å¤§å°</a></p></blockquote><p>é™¤éæ˜¯å¯¹ Azure VM æ—ç³»éå¸¸ç†Ÿç»ƒäº†è§£ï¼Œä¸ç„¶ä¸æ¨èè‚‰çœ¼éå†æ¸…å•çš„æ–¹å¼é€‰æ‹© VM è§„æ ¼ã€‚<br>æ­£å¸¸æƒ…å†µï¼Œæ¨èä½¿ç”¨ä»¥ä¸‹ VM é€‰æ‹©å™¨ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œå¿«é€Ÿç­›é€‰å‡ºé€‚åˆçš„ VM æ—ç³»å’Œè§„æ ¼ã€‚</p><blockquote><p>[!info] Microsoft Azure VM é€‰æ‹©å™¨<br>Microsoft Azure VM é€‰æ‹©å™¨ï¼šæŸ¥æ‰¾æ‰€éœ€çš„ VM<br><a href="https://azure.microsoft.com/zh-cn/pricing/vm-selector/">Microsoft Azure VM é€‰æ‹©å™¨</a></p></blockquote></li><li><p>æˆæœ¬è®¡ç®—ã€‚<br>å°†ç­›é€‰å‡ºçš„ VM è§„æ ¼æ·»åŠ åˆ°æˆæœ¬è®¡ç®—å™¨ä¸­ï¼Œç»“åˆéœ€æ±‚æˆæœ¬ï¼Œæœ€ç»ˆç¡®å®š VM çš„è§„æ ¼é€‰æ‹©ã€‚</p><blockquote><p>[!info] ä»·æ ¼è®¡ç®—å™¨ | Microsoft Azure<br>ä¸ºç‰¹å®šæ–¹æ¡ˆé…ç½® Azure äº§å“å’ŒåŠŸèƒ½å¹¶é¢„ä¼°è¿™äº›äº§å“å’ŒåŠŸèƒ½çš„æˆæœ¬ã€‚<br><a href="https://azure.microsoft.com/zh-cn/pricing/calculator/">ä»·æ ¼è®¡ç®—å™¨</a></p></blockquote></li></ol><h3 id="å››ã€åˆ›å»º-VM-çš„æ–¹å¼">å››ã€åˆ›å»º VM çš„æ–¹å¼</h3><p>åˆ›å»ºAzure VMçš„æ­¥éª¤åŒ…æ‹¬é€‰æ‹©åŒºåŸŸã€æ“ä½œç³»ç»Ÿã€é…ç½®è™šæ‹Ÿæœºå¤§å°ã€è®¾ç½®å­˜å‚¨å’Œç½‘ç»œï¼Œä»¥åŠåº”ç”¨å®‰å…¨ç»„å’Œè¯Šæ–­æ‰©å±•ç­‰ï¼Œè¿™é‡Œä¸ç»†è¯´ã€‚</p><p><strong>1ã€ç”¨äºåˆ›å»º VM çš„å·¥å…·</strong><br>å¯¹èµ„æºçš„åˆ›å»ºå’Œç®¡ç†ï¼ŒAzure æä¾›äº†å¤šç§èµ„æºç®¡ç†ç»ˆç«¯ã€‚<br>æŒ‰äº¤äº’æ–¹å¼åˆ†ï¼š</p><ul><li>å›¾å½¢ç•Œé¢ï¼š<br>Azure Portal</li><li>å‘½ä»¤è¡Œï¼š<br>Azure Cloud Shell<br>Azure PowerShell<br>Azure CLI<br>å„ç§ç»ˆç«¯é™¤äº†äº¤äº’æ–¹å¼ä»¥å¤–ï¼ŒåŠŸèƒ½ä¸ŠåŸºæœ¬æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼ŒèƒŒåéƒ½æ˜¯è¿æ¥ ARMï¼ˆAzure Resource Managementï¼‰ã€‚</li></ul><p><strong>2ã€Infrastructure as code</strong><br>Azure æä¾› ARM Template ä½œä¸º Infra as code è„šæœ¬ï¼Œæ˜¯ä¸€ç§å£°æ˜å¼å®šä¹‰ï¼Œé€šè¿‡ARM Template è„šæœ¬å¯ä»¥å¿«é€Ÿåˆ›å»ºå’Œå˜æ›´ VMã€‚<br>4ç§ç»ˆç«¯å·¥å…·ï¼Œçš†å¯æ‰§è¡ŒARM Templateã€‚</p><p><strong>3ã€VM Extension</strong><br>å¯ä»¥åœ¨ä½¿ç”¨ ARM Template åˆ›å»ºè™šæ‹Ÿæœºæ—¶ï¼ŒåŒæ—¶å£°æ˜ VM Extensionï¼Œä»¥ä¾¿åœ¨è™šæ‹Ÿæœºåˆ›å»ºå®Œæˆæ—¶è‡ªåŠ¨å®‰è£…è½¯ä»¶ã€‚è¿™æ ·å¯ä»¥è‡ªåŠ¨åŒ–åˆ›å»º VM çš„åŒæ—¶ï¼Œå®Œæˆ VM ç¯å¢ƒçš„åˆå§‹åŒ–ï¼ˆè½¯ä»¶å®‰è£…å’Œé…ç½®æµç¨‹ç­‰ç­‰ï¼‰ï¼Œæé«˜éƒ¨ç½²æ•ˆç‡ã€‚<br>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ VM åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡ VM Extension åŠŸèƒ½æ‰‹åŠ¨è§¦å‘ç¯å¢ƒå®‰è£…ã€‚</p><h3 id="äº”ã€è¿æ¥-VM-çš„æ–¹å¼">äº”ã€è¿æ¥ VM çš„æ–¹å¼</h3><p>Azure æä¾›å¤šç§æ–¹å¼è¿æ¥ VMï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>RDP åè®®ã€‚Windows VM æ¨èï¼Œå¸¦è¿œç¨‹æ¡Œé¢æ–¹å¼ã€‚</li><li>SSH åè®®ã€‚Linux VM æ¨èï¼ŒLinux VM æ— æ³•ä½¿ç”¨ RDPã€‚</li><li>Azure Bastionã€‚æ”¯æŒ Windows å’Œ Linux ä¸¤ç§ VM ç³»ç»Ÿï¼Œä¸éœ€è¦ VM å¼€æ”¾å…¬ç½‘ IP å’Œ NSG inbound è§„åˆ™ã€‚<br>ç”¨æˆ·åªéœ€è¦ç½‘é¡µè®¿é—® Azure Portalï¼ˆhttpsåè®®ï¼‰ï¼ŒAzure Bastion å°†å¤–éƒ¨è¿æ¥è½¬æ¢ä¸ºå†…éƒ¨è¿æ¥æ¥å…¥ç›®æ ‡ VMã€‚<br>ä½†<strong>æ³¨æ„</strong>ï¼Œåˆ›å»ºå’Œä½¿ç”¨ Azure Bastion  éœ€è¦é¢å¤–æ”¶è´¹ã€‚<br><img src="/2024/07/02/liang-ri-yi-gai-nian-zhi-azure-pian-virtual-machine/bastion-connections-29c60c68.png" alt="bastion connections"></li></ul><h3 id="å…­ã€çº¦æŸ">å…­ã€çº¦æŸ</h3><p>å¦‚æœæ˜¯æƒ³è¦è¿›è¡Œ Azure è€ƒè¯• æˆ–è€… Azure æ¶æ„å®æ–½ï¼Œéœ€è¦æ³¨æ„ä¸€äº› Azure äº§å“çš„çº¦æŸç»†èŠ‚ã€‚</p><ul><li>ç£ç›˜çº¦æŸã€‚å•ä¸ªVMå¯ä»¥æŒ‚è½½å¤šä¸ªå­˜å‚¨ç£ç›˜ï¼Œä½†æ¯ä¸ªVMæœ€é«˜æ”¯æŒ256Tçš„å­˜å‚¨ç©ºé—´ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> ä¸¤æ—¥ä¸€æ¦‚å¿µ </tag>
            
            <tag> Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨HuggingFace Transformersè¿›è¡ŒNLPæ¨¡å‹å¾®è°ƒ</title>
      <link href="/2024/06/18/shi-yong-huggingface-transformers-jin-xing-mo-xing-wei-diao/"/>
      <url>/2024/06/18/shi-yong-huggingface-transformers-jin-xing-mo-xing-wei-diao/</url>
      
        <content type="html"><![CDATA[<p>å…³æ³¨ AI é¢†åŸŸä¿¡æ¯çš„å°ä¼™ä¼´ä»¬ï¼ŒåŸºæœ¬å¯¹ HuggingFace Hub æ—©å·²è€³ç†Ÿèƒ½è¯¦ã€‚<br>ç®€å•æ¥è¯´ï¼ŒHuggingFace Hub æ˜¯ä¸€ä¸ªé›†æˆå¹³å°ï¼Œæ±‡é›†äº†æµ·é‡çš„é¢„è®­ç»ƒæ¨¡å‹å’Œæ•°æ®é›†ã€‚<br>é€šè¿‡è¿™ä¸ªå¹³å°ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾æµè§ˆã€ä¸‹è½½å’Œåˆ†äº«æ¨¡å‹å’Œæ•°æ®é›†ï¼Œå¤§å¤§åŠ é€Ÿäº†æœºå™¨å­¦ä¹ çš„ç ”ç©¶å’Œåº”ç”¨ï¼Œå› æ­¤ï¼ŒHuggingFace Hub é€æ¸æˆä¸ºä¸€ä¸ªæœºå™¨å­¦ä¹ é¢†åŸŸä¸å¯æˆ–ç¼ºçš„å¼€æºèµ„æºä¸­å¿ƒã€‚</p><p>ç»å¸¸ä½¿ç”¨ Github çš„ç¨‹åºå‘˜å°ä¼™ä¼´ä»¬ï¼Œå¯èƒ½å°†å…¶ç±»æ¯”æˆ Githubã€‚<br>ä½†å…¶å®å¯¹äº HuggingFace ç”Ÿæ€æ¥è¯´ï¼Œè¿œä¸æ­¢ Hub è¿™ä¹ˆç®€å•ã€‚é™¤äº† HuggingFace Hub ä»¥å¤–ï¼ŒHuggingFace è¿˜æä¾›äº†å¤§é‡çš„å¼€æºåº“ï¼Œå…¶ä¸­å°±åŒ…æ‹¬é—»åçš„ Transformersã€Datasetsã€Tokenizersç­‰ç­‰ï¼Œ<br>å¯ä»¥å¸®åŠ©ç”¨æˆ·å¿«é€Ÿçš„æ‰§è¡Œå„ç§æ¨¡å‹ä»»åŠ¡ã€è®­ç»ƒå’Œå¾®è°ƒã€‚è€Œä¸”è¿™äº›åº“çš„åº•å±‚æ˜¯æ”¯æŒ PyTorch å’Œ TensorFlow çš„ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæä¾›äº†æ›´é«˜çº§åˆ«å°è£…çš„ APIã€‚</p><p>å› æ­¤ï¼Œå¯¹äºæƒ³è¦å…¥é—¨ AI é¢†åŸŸçš„ç¨‹åºå‘˜å°ä¼™ä¼´ä»¬ï¼Œå­¦ä¹ å’Œå®æˆ˜ HuggingFace å·¥å…·åº“ï¼Œæˆ‘è§‰å¾—æ˜¯ä¸ªä¸é”™çš„å…¥é—¨æ–¹å¼ï¼š</p><ol><li>ç”±äº AI é¢†åŸŸéšç€ Chatgpt çš„çˆ†ç«ï¼Œå¸‚é¢ä¸Šæ¶Œå…¥äº†å„ç§ AI çš„å­¦ä¹ ä¹¦ç±å’Œè§†é¢‘ï¼Œé™¤äº†ä¸€äº›åº”ç”¨æ–¹é¢çš„ã€æ˜æ˜¾è¹­çƒ­åº¦çš„ã€å‰²éŸ­èœçš„ç‰©æ–™è¿˜æ¯”è¾ƒå®¹æ˜“æ’é™¤å’Œåˆ†è¾¨ä¹‹å¤–ï¼Œå‰©ä½™çš„ç‰©æ–™ä¾ç„¶å­˜åœ¨ â€”â€” æ—¶æ•ˆæ€§å·®ã€å·¥å…·ä¸å¤Ÿé€šç”¨ã€æ³›æ³›è€Œè°ˆã€çº¯çº¯çš„ AI å¹³å°æ‰“å¹¿å‘Šã€ä¸ºäº†è¿½çƒ­åº¦æŠŠåŠŸèƒ½å¹çš„æƒŠä¸–éª‡ä¿—ç­‰ç­‰é—®é¢˜ã€‚ï¼ˆæˆ‘æœ€è¿‘å‡ ä¸ªæœˆå°±è¸©äº†ä¸å°‘è¿™æ ·çš„å‘ï¼‰</li><li>ä»å­¦ä¹ çš„è§’åº¦æ¥è¯´ï¼Œé¦–å…ˆä»å®è§‚ä¸Šäº†è§£é—®é¢˜å’ŒçŸ¥è¯†åŸŸï¼Œä¼šæ¯”ç›´æ¥è¿›å…¥ç»†èŠ‚å’Œå¾®è§‚æ›´æœ‰åˆ©äºå¿«é€Ÿçš„å­¦ä¹ ã€‚HuggingFace libs æ¯” PyTorch/TensorFlow æœ‰ç€æ›´é«˜çº§çš„å°è£…å’ŒåŠŸèƒ½å±•ç°ï¼Œé€šè¿‡å®ƒæŒæ¡äº†å®è§‚çš„æ¦‚å¿µå’ŒçŸ¥è¯†ä¹‹åï¼Œæƒ³è¦äº†è§£æ›´ç»†èŠ‚çš„çŸ¥è¯†ï¼Œå¯ä»¥å†å»å­¦ä¹ åº•å±‚çš„å†…å®¹ã€‚HuggingFace libs çš„ä½¿ç”¨æ™®åŠç‡ä¹Ÿå¾ˆé«˜ï¼Œä¸ç”¨æ‹…å¿ƒå­¦åˆ°å°ä¼—çš„å·¥å…·è€Œæµªè´¹æ—¶é—´ã€‚</li><li>HuggingFace docs å®˜æ–¹åŸºæœ¬ä¼šä¿æŒå®æ—¶æ›´æ–°ï¼Œæ—¶æ•ˆæ€§æ¯”èµ·å¸‚é¢ä¸Šçš„æ–‡æ¡£ã€ä¹¦ç±ã€è§†é¢‘è¦é«˜ä¸Šä¸å°‘ã€‚</li></ol><p>è¿™ç¯‡æ–‡ç« ï¼Œå°±ç”¨æ¥ä»‹ç»å’Œæ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ HuggingFace Transformersåº“æ¥å®Œæˆä¸€ä¸ªNLPæ¨¡å‹çš„ç®€å•å¾®è°ƒã€‚å¾®è°ƒä¸æ˜¯ç›®çš„ï¼Œå­¦ä¹ å’Œç†Ÿæ‚‰ä½¿ç”¨åº“æ¥å­¦ä¹ å¾®è°ƒçš„æ¦‚å¿µå’Œæ­¥éª¤ï¼Œæ‰æ˜¯ç›®çš„ã€‚<br>ä¸‹é¢å°†è¦åœ¨ä¸€ä¸ªå¾ˆå°çš„ NLP é¢„è®­ç»ƒæ¨¡å‹ä¸Šè¿›è¡Œå¾®è°ƒï¼Œä»¥å®ç°å¯¹å¤–å–è¯„ä»·çš„æ–‡æœ¬åˆ†ç±» â€”â€” å¥½è¯„å’Œå·®è¯„ä¸¤ç±»ã€‚</p><h3 id="1-ç¯å¢ƒå®‰è£…">1. ç¯å¢ƒå®‰è£…</h3><ul><li>å®‰è£…å¥½ pythonï¼Œç‰ˆæœ¬&gt;=3.8</li><li>å®‰è£…å¥½ ç¯å¢ƒ/åŒ…ç®¡ç†å·¥å…·ï¼Œconda æˆ–è€… pipã€‚ï¼ˆå¦‚æœåŒæœ¬äººä¸€æ ·æ¯”è¾ƒé’Ÿçˆ± pipenvï¼Œå¯ä»¥åœ¨å®‰è£…å¥½ pip åï¼Œæ‰§è¡Œ <code>pip install pipenv</code>ï¼Œç„¶åä½¿ç”¨<code>pipenv</code>æ¥æ›¿ä»£<code>pip</code>ä½¿ç”¨å³å¯ã€‚ï¼‰</li><li>ç”¨ç®¡ç†å·¥å…·å®‰è£…ä¾èµ–åº“ï¼š<code>pipenv/pip install transformers datasets evaluate accelerate torch scikit-learn pandas jupyterlab</code>ã€‚<br>å‰4ä¸ªå°±æ˜¯ HuggingFace libsï¼Œå‰©ä¸‹çš„é’ˆå¯¹ä¸åŒçš„è¿è¡Œç¯å¢ƒå¯ä»¥é…Œæƒ…å®‰è£…ï¼Œæ¯”å¦‚ä½¿ç”¨äº†Google colabï¼Œå°±ä¸éœ€è¦å®‰è£… jupyterlabã€‚<br>è¯¦ç»†ä»£ç å·²ç»ä¸Šä¼ åˆ° github <a href="https://github.com/ellendan000/hugging-face-demo/tree/main/00-transformers">hugging-face-demo/00-transformers</a>ã€‚</li></ul><h3 id="2-ç¡®è®¤æ¨¡å‹ä»»åŠ¡çš„åŸæœ‰è¡Œä¸º">2. ç¡®è®¤æ¨¡å‹ä»»åŠ¡çš„åŸæœ‰è¡Œä¸º</h3><h4 id="2-1-æƒ³è¦è°ƒç”¨æ¨¡å‹ï¼Œä½¿ç”¨-HuggingFace-Pipeline-æ¥åšéå¸¸ç®€å•">2.1 æƒ³è¦è°ƒç”¨æ¨¡å‹ï¼Œä½¿ç”¨ HuggingFace Pipeline æ¥åšéå¸¸ç®€å•</h4><pre class="line-numbers language-none"><code class="language-none">from transformers import pipelinepipe = pipeline("text-classification", "hfl/rbt3")sen = "é¥­èœæœ‰äº›å’¸ï¼"pipe(sen)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>text-classification</code> æ˜¯ä»»åŠ¡åï¼Œå³å®Œæˆæ–‡æœ¬åˆ†ç±»ä»»åŠ¡ã€‚</li><li><code>hfl/rbt3</code> æ˜¯é¢„è®­ç»ƒå¥½çš„æ¨¡å‹åã€‚pipeline ä¼šä»è¿œç¨‹ huggingFace Hub ä¸Šä¸‹è½½å¼€æºçš„é¢„è®­ç»ƒæ¨¡å‹åˆ°æœ¬åœ°ç¼“å­˜ã€‚(è®°å¾—å¼€VPNï¼Œæˆ–è€…è®¾ç½®å›½å†…é•œåƒåº“)<br>ä¹Ÿå¯ä»¥äº‹å…ˆå°†æ¨¡å‹åº“cloneæˆ–è€…downloadåˆ°æœ¬åœ°ï¼Œç„¶åå°†è¿™é‡Œçš„<code>hfl/rbt3</code>æ”¹ä¸º<code>./your-path-to-model</code></li><li><code>pipe(sen)</code> ç›´æ¥ä¼ å‚è°ƒç”¨ï¼Œå³æ‰§è¡Œä»»åŠ¡ã€‚</li></ul><p>output:</p><blockquote><p>[{â€˜labelâ€™: â€˜LABEL_1â€™, â€˜scoreâ€™: 0.7034752368927002}]</p></blockquote><ul><li>è¿™é‡Œçš„ label ä¸æˆ‘ä»¬çš„ä¸šåŠ¡å¯èƒ½æ¯«æ— å…³ç³» â€”â€” ä¸æ˜¯å¤–å–è¯„ä»·çš„å¥½è¯„å’Œå·®è¯„ã€‚</li></ul><h4 id="2-2-æ˜ç¡®æ¨¡å‹çš„åŸæœ‰è¡Œä¸ºå’ŒçŠ¶æ€">2.2 æ˜ç¡®æ¨¡å‹çš„åŸæœ‰è¡Œä¸ºå’ŒçŠ¶æ€</h4><p>ä½¿ç”¨å¦‚ä¸Šæ–¹å¼ï¼Œæƒ³è¦è®©æ¨¡å‹è¿›è¡ŒäºŒåˆ†ç±»ï¼Œå¹¶æ˜ å°„æˆâ€å¥½è¯„â€œå’Œâ€å·®è¯„â€œã€‚</p><pre class="line-numbers language-none"><code class="language-none">from transformers import AutoTokenizer, AutoModelForSequenceClassification, pipelinemodel = AutoModelForSequenceClassification.from_pretrained("hfl/rbt3", num_labels=2)tokenizer = AutoTokenizer.from_pretrained("hfl/rbt3")model.config.id2label = {0: "å·®è¯„ï¼", 1: "å¥½è¯„ï¼"}pipe = pipeline("text-classification", model=model, tokenizer=tokenizer)sen = "é¥­èœæœ‰äº›å’¸ï¼"pipe(sen)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>model</code> åˆ†åˆ«åŠ è½½æ¨¡å‹ï¼Œå¹¶ä¸”ä¼ å…¥åˆ†ç±»çš„æ•°é‡<code>num_labels</code></li><li><code>tokenizer</code> åŠ è½½åˆ†è¯å™¨ï¼Œç”±äº pipeline è¦æ±‚åœ¨ä¼ å…¥ model å¯¹è±¡æ—¶ï¼Œå¿…é¡»åŒæ—¶ä¼ å…¥ tokenizerï¼Œå› æ­¤è¿™é‡Œä¹Ÿå¦å¤–å•ç‹¬åŠ è½½äº†åˆ†è¯å™¨ã€‚<br>å¥½åœ¨æ¨¡å‹è®­ç»ƒå¥½çš„åŒæ—¶ï¼Œå¯¹ç…§çš„ tokenizer åŸºæœ¬éƒ½æ˜¯ç¡®å®šçš„ï¼Œç›´æ¥ä»ç›¸åŒçš„ Hub è·¯å¾„ä¸ŠåŠ è½½å³å¯ã€‚<code>tokenizer</code> è™½ç„¶ä¼šè¢«ç¿»è¯‘ä¸º<code>åˆ†è¯å™¨</code>ï¼Œä½†æ˜¯å…¶åŠŸèƒ½ä¸ä»…ä»…æ˜¯è¿›è¡Œåˆ†è¯ï¼Œå®ƒè¿˜åŒ…å«äº†è¯å…¸ã€åºåˆ—æ˜ å°„ã€æ•°æ®æˆªæ–­å¡«å……ç­‰ä¸€ç³»åˆ—æ•°æ®é¢„å¤„ç†åŠŸèƒ½ã€‚</li></ul><p>output:</p><blockquote><p>[{â€˜labelâ€™: â€˜å¥½è¯„ï¼â€™, â€˜scoreâ€™: 0.5472492575645447}]</p></blockquote><p>æ˜æ˜¾è¿™ä¸ªç»“æœå·®å¼ºäººæ„ã€‚<br>é‚£ä¹ˆï¼Œä¸‹é¢å°±è¿›å…¥å¾®è°ƒç¯èŠ‚ã€‚</p><h3 id="3-æ¨¡å‹å¾®è°ƒ">3. æ¨¡å‹å¾®è°ƒ</h3><h4 id="3-1-å‡†å¤‡ç¯å¢ƒï¼Œå¯¼å…¥ç›¸å…³åŒ…">3.1 å‡†å¤‡ç¯å¢ƒï¼Œå¯¼å…¥ç›¸å…³åŒ…</h4><pre class="line-numbers language-none"><code class="language-none">from transformers import AutoTokenizer, AutoModelForSequenceClassification, Trainer, TrainingArgumentsfrom datasets import load_dataset<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>äº‹å…ˆå·²ç»å®‰è£…å¥½ä¾èµ–åº“çš„è¯ï¼Œè¿™é‡Œåªè¦å¯¼å…¥ç›¸å…³åŒ…å³å¯ã€‚</li></ul><h4 id="3-2-å‡†å¤‡æ•°æ®">3.2 å‡†å¤‡æ•°æ®</h4><p>éšç€æ¨¡å‹è®­ç»ƒå’Œå¾®è°ƒçš„åº“è¶Šæ¥è¶Šå¤šï¼Œä»£ç å…¶å®éƒ½å·²ç»æ¨¡å¼åŒ–ï¼Œç”šè‡³å·²ç»å‡ºç°ç›´æ¥ä½¿ç”¨ WebUI ç•Œé¢è¿›è¡Œæ¨¡å‹è®­ç»ƒå’Œå¾®è°ƒï¼ˆæ¯”å¦‚ LLaMA-Factoryï¼‰ï¼Œ<br>å› æ­¤å¯¹äºè¿½æ±‚è®­ç»ƒå’Œå¾®è°ƒä¸ºç›®çš„æ¥è¯´ï¼Œæœ€é‡è¦çš„å…¶å®å°±æ˜¯ä¸¤å— â€”â€” æ•°æ®é›†å’Œæ˜¾å¡ã€‚<br>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ github ä¸Šçš„ä¸€ä¸ª<a href="https://github.com/SophonPlus/ChineseNlpCorpus/blob/master/datasets/waimai_10k/waimai_10k.csv">ä¸­æ–‡å¤–å–è¯„ä»·æ•°æ®é›†</a>ï¼Œç›´æ¥æŠŠå®ƒä¸‹è½½ä¸‹æ¥ï¼Œä¿å­˜åˆ°é¡¹ç›®æœ¬åœ°ã€‚</p><h5 id="åŠ è½½æ•°æ®é›†">åŠ è½½æ•°æ®é›†</h5><pre class="line-numbers language-none"><code class="language-none">dataset = load_dataset("csv", data_files="./waimai_10k.csv", split="train")dataset = dataset.filter(lambda x: x["review"] is not None)dataset<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>outputï¼š</p><blockquote><p>Dataset({<br>features: [â€˜labelâ€™, â€˜reviewâ€™],<br>num_rows: 11987<br>})</p></blockquote><ul><li>è¿™ä¸ªcsvæ–‡ä»¶ï¼ŒåŒ…å«äº†æ­£å‘ 4000 æ¡ï¼Œè´Ÿå‘ çº¦ 8000 æ¡ã€‚æ­£å‘å¥½è¯„ label ä¸º 1ï¼Œè´Ÿå‘å·®è¯„ label ä¸º 0ã€‚features åŒ…æ‹¬ label å’Œ reviewã€‚</li><li><code>split="train"</code> ç”±äºåªæœ‰ä¸€ä¸ªcsvæ–‡ä»¶ï¼Œæ²¡æœ‰è¿›è¡Œ train å’Œ test æ•°æ®é›†çš„æ‹†åˆ†ï¼Œload_dataset ä¼šé»˜è®¤å°†æ‰€æœ‰æ•°æ®éƒ½ç®—å…¥ train æ•°æ®é›†ã€‚ä¸ºäº†æœ‰åˆ©äºåé¢æ‰‹åŠ¨è¿›è¡Œæ•°æ®é›†æ‹†åˆ†ï¼Œè¿™é‡Œå¼ºè°ƒåŠ è½½é»˜è®¤çš„ train æ•°æ®é›†ã€‚</li><li><code>dataset.filter</code> å°†æ— æ–‡æœ¬çš„ review è®°å½•è¿‡æ»¤æ‰ã€‚</li></ul><h5 id="ä½¿ç”¨-tokenizer-è¿›è¡Œæ•°æ®é¢„å¤„ç†">ä½¿ç”¨ tokenizer è¿›è¡Œæ•°æ®é¢„å¤„ç†</h5><pre class="line-numbers language-none"><code class="language-none">import torchtokenizer = AutoTokenizer.from_pretrained("hfl/rbt3")def process_function(examples):    tokenized_examples = tokenizer(examples["review"], max_length=128, truncation=True)    tokenized_examples["labels"] = examples["label"]    return tokenized_examplestokenized_dataset = dataset.map(process_function, batched=True, remove_columns=dataset.column_names)tokenized_dataset<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>output:</p><blockquote><p>Dataset({<br>features: [â€˜input_idsâ€™, â€˜token_type_idsâ€™, â€˜attention_maskâ€™, â€˜labelsâ€™],<br>num_rows: 11987<br>})</p></blockquote><ul><li><code>dataset.map</code> å°†åŸæ•°æ®é›†çš„æ¯æ¡æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå°æ‰¹é‡åœ°æ‰§è¡Œ map function <code>process_function</code>ï¼Œå¹¶ä¸”<code>remove_columns</code> è¿”å›çš„ç»“æœé›†åˆ é™¤æ‰æœªåŠ å·¥çš„åŸå§‹æ•°æ®åˆ—ã€‚</li><li><code>tokenizer</code> å°†æ¯æ¡æ•°æ®è¶…å‡ºæœ€å¤§é•¿åº¦<code>128</code>çš„æ•°æ®è¿›è¡Œæˆªæ–­ã€‚</li></ul><h5 id="åˆ†å‰²æ•°æ®é›†">åˆ†å‰²æ•°æ®é›†</h5><pre class="line-numbers language-none"><code class="language-none">tokenized_datasets = tokenized_dataset.train_test_split(test_size=0.1)tokenized_datasets<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>output:</p><blockquote><p>DatasetDict({<br>train: Dataset({<br>features: [â€˜input_idsâ€™, â€˜token_type_idsâ€™, â€˜attention_maskâ€™, â€˜labelsâ€™],<br>num_rows: 10788<br>})<br>test: Dataset({<br>features: [â€˜input_idsâ€™, â€˜token_type_idsâ€™, â€˜attention_maskâ€™, â€˜labelsâ€™],<br>num_rows: 1199<br>})<br>})</p></blockquote><ul><li>å°†æ•°æ®é›†ä¸­çš„ 10% ä½œä¸ºæµ‹è¯•æ•°æ®é›†ï¼Œå³ 90% ä¸ºè®­ç»ƒæ•°æ®é›†ã€‚è¿”å›ç»“æœä¸º DatasetDict åŒ…å« train å’Œ testã€‚</li></ul><h4 id="3-3-åŠ è½½é¢„è®­ç»ƒæ¨¡å‹">3.3 åŠ è½½é¢„è®­ç»ƒæ¨¡å‹</h4><pre class="line-numbers language-none"><code class="language-none">model = AutoModelForSequenceClassification.from_pretrained("hfl/rbt3")# if torch.cuda.is_available():#     model = model.cuda()#     print('Use cuda GPU')# elif torch.backends.mps.is_available():#     model = model.to('mps')#     print('Use mps')model<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŠ è½½é¢„è®­ç»ƒæ¨¡å‹éå¸¸ç®€å•ï¼ŒHuggingFace ä¹Ÿä¸éœ€è¦åƒ PyTorch é‚£æ ·æ˜¾æ€§çš„å°†æ¨¡å‹å’Œå‚æ•°ä¼ ç»™GPUï¼Œåº•å±‚å·²ç»å¸®åŠ©å®ç°ã€‚<br>å› æ­¤ï¼Œä¸Šé¢æ³¨é‡Šä¸­çš„ torch éƒ¨åˆ†ä»£ç å®Œå…¨å¯ä»¥åˆ æ‰ã€‚</p><p>ä½†å¦‚æœç¼–å†™ PyTorch ä»£ç çš„è¯ï¼Œè¿˜æ˜¯å¿…é¡»åŠ ä¸Šã€‚<br>å¦‚æœè·Ÿæˆ‘ä¸€æ ·ï¼Œä½¿ç”¨çš„æ˜¯ MacOS çš„è¯ã€å¹¶ä¸”æ˜¯ M1 èŠ¯ç‰‡ä¹‹åçš„ç‰ˆæœ¬ï¼Œåœ¨å†™ PyTorch ä»£ç æ—¶ï¼Œéœ€è¦æŠŠæ¨¡å‹å’Œå‚æ•°ä¼ ç»™<code>mps</code>ã€‚<br>å› ä¸º PyTorch åœ¨ M1 ä¹‹åä½¿ç”¨ mps è¿›è¡Œäº†åŠ é€Ÿï¼Œè™½ç„¶æ¯”èµ· GPU é€Ÿåº¦ä¸Šè¿˜æ˜¯æœ‰ä¸å°å·®è·ï¼Œä½†æ˜¯æ¯”èµ·ç›´æ¥ä½¿ç”¨ CPU æ¥è¯´ï¼Œè¿˜æ˜¯å¿«ä¸Šä¸å°‘ã€‚<br>å¦‚æœæ˜¯ M1 ä¹‹å‰çš„ Mac çš„è¯ï¼Œå°±ä¸è¦å‹‰å¼ºäº†ï¼Œç›´æ¥å»ä½¿ç”¨ Google colab æˆ–è€… ç™½å«–ä¸‹é˜¿é‡Œäº‘PAIå¹³å°çš„å…è´¹é™é¢ï¼Œä¸ç„¶é€Ÿåº¦ä¼šæ…¢åˆ°è½æ³ªã€‚</p><h4 id="3-4-è®­ç»ƒå’Œè¯„ä¼°">3.4 è®­ç»ƒå’Œè¯„ä¼°</h4><h5 id="å®šä¹‰è¯„ä¼°å‡½æ•°">å®šä¹‰è¯„ä¼°å‡½æ•°</h5><pre class="line-numbers language-none"><code class="language-none">import evaluateacc_metric = evaluate.load("accuracy")f1_metric = evaluate.load("f1")def eval_metric(eval_predict):    predictions, labels = eval_predict    predictions = predictions.argmax(axis=-1)    acc = acc_metric.compute(predictions=predictions, references=labels)    f1 = f1_metric.compute(predictions=predictions, references=labels)    acc.update(f1)    return acc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>evaluate</code> åº“å·²ç»æä¾›äº†å¤§é‡è¯„ä¼°å‡½æ•°çš„å®ç°ã€‚è¿™é‡Œä½¿ç”¨äº†æœ€ç®€å•çš„<code>å‡†ç¡®ç‡acc</code>å’Œ<code>F1åˆ†å€¼</code>ã€‚<br>åœ¨äºŒåˆ†ç±»ä¸­ï¼Œæ ·æœ¬é¢„æµ‹ç»“æœåˆ†ä¸º4ç±»ï¼š</p><ul><li>TP ï¼ˆTrue Positiveï¼‰ï¼šçœŸ*æ­£ä¾‹ï¼Œå³å®é™…ä¸ºæ­£ç±»ï¼Œâ€æ­£ç¡®â€œé¢„æµ‹ä¸ºæ­£ç±»çš„æ ·æœ¬æ•°ã€‚</li><li>TN ï¼ˆTrue Negativeï¼‰ï¼šçœŸ*è´Ÿä¾‹ï¼Œå³å®é™…ä¸ºè´Ÿç±»ï¼Œâ€æ­£ç¡®â€œé¢„æµ‹ä¸ºè´Ÿç±»çš„æ ·æœ¬æ•°ã€‚</li><li>FP ï¼ˆFalse Positiveï¼‰ï¼šå‡*æ­£ä¾‹ï¼Œå³å®é™…ä¸ºè´Ÿç±»ï¼Œâ€é”™è¯¯â€œé¢„æµ‹ä¸ºæ­£ç±»çš„æ ·æœ¬æ•°ã€‚</li><li>FN ï¼ˆFalse Negativeï¼‰ï¼šå‡*è´Ÿä¾‹ï¼Œå³å®é™…ä¸ºæ­£ç±»ï¼Œâ€é”™è¯¯â€œé¢„æµ‹ä¸ºè´Ÿç±»çš„æ ·æœ¬æ•°ã€‚</li></ul><p><code>acc</code> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{TP+TN}{TP+TN+FP+FN}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">TN</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">FN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">TN</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>,è¢«ç§°ä¸ºå‡†ç¡®ç‡ã€‚</p><p>äº†è§£<code>F1åˆ†å€¼</code>å‰éœ€è¦äº†è§£ <code>ç²¾ç¡®ç‡ Precision</code>ï¼ˆä¹Ÿå«æŸ¥å‡†ç‡ï¼‰ å’Œ <code>å¬å›ç‡ Recall</code>ï¼ˆä¹Ÿå«æŸ¥å…¨ç‡ï¼‰ã€‚</p><ul><li><code>Precison</code> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{TP}{TP+FP}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ï¼Œåœ¨æ‰€æœ‰è¢«é¢„æµ‹ä¸ºæ­£ç±»çš„æ ·æœ¬ä¸­ï¼Œå®é™…çš„ç¡®æ˜¯æ­£ç±»çš„æ¯”ä¾‹ã€‚</li><li><code>Recall</code> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{TP}{TP+FN}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">FN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ï¼Œ åœ¨æ‰€æœ‰æ­£ç±»çš„æ•°æ®é›†èŒƒå›´å†…è¢«æˆåŠŸé¢„æµ‹å¯¹çš„æ¯”ä¾‹ã€‚</li><li><code>F1</code> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>Ã—</mo><mfrac><mrow><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>Ã—</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi></mrow><mrow><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>+</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">2 \times \frac{Precision \times Recall}{Precision + Recall}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2834em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mord mathnormal mtight">rec</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight">ec</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">ll</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mord mathnormal mtight">rec</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">Ã—</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight">ec</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">ll</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ï¼Œæ˜¯ Presion å’Œ Recall çš„è°ƒå’Œå¹³å‡å€¼ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªç»¼åˆè¯„ä»·æŒ‡æ ‡ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ç±»åˆ«ä¸å¹³è¡¡çš„æ•°æ®é›†ã€‚<br>F1åˆ†å€¼åœ¨0åˆ°1ä¹‹é—´ï¼Œå€¼è¶Šæ¥è¿‘1è¡¨ç¤ºæ¨¡å‹çš„æ€§èƒ½è¶Šå¥½ï¼Œæ—¢è€ƒè™‘äº†æ¨¡å‹é¢„æµ‹çš„å‡†ç¡®æ€§ï¼ˆPrecisionï¼‰ï¼Œä¹Ÿè€ƒè™‘äº†æ¨¡å‹è¯†åˆ«å‡ºæ‰€æœ‰æ­£ä¾‹çš„èƒ½åŠ›ï¼ˆRecallï¼‰ã€‚</li></ul><h5 id="å®šä¹‰è®­ç»ƒå‚æ•°">å®šä¹‰è®­ç»ƒå‚æ•°</h5><pre class="line-numbers language-none"><code class="language-none">from transformers import DataCollatorWithPaddingtrain_args = TrainingArguments(output_dir="./checkpoints",      # è¾“å‡ºæ–‡ä»¶å¤¹                               per_device_train_batch_size=64,  # è®­ç»ƒæ—¶çš„batch_size                               per_device_eval_batch_size=128,  # éªŒè¯æ—¶çš„batch_size                               logging_steps=10,                # log æ‰“å°çš„é¢‘ç‡                               eval_strategy="epoch",           # è¯„ä¼°ç­–ç•¥                               save_strategy="epoch",           # ä¿å­˜ç­–ç•¥                               save_total_limit=3,              # æœ€å¤§ä¿å­˜æ•°                               learning_rate=2e-5,              # å­¦ä¹ ç‡                               weight_decay=0.01,               # weight_decay                               metric_for_best_model="f1",      # è®¾å®šè¯„ä¼°æŒ‡æ ‡                               load_best_model_at_end=True)     # è®­ç»ƒå®ŒæˆååŠ è½½æœ€ä¼˜æ¨¡å‹trainer = Trainer(model=model,                   args=train_args,                   train_dataset=tokenized_datasets["train"],                   eval_dataset=tokenized_datasets["test"],                   data_collator=DataCollatorWithPadding(tokenizer=tokenizer),                  compute_metrics=eval_metric)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>HuggingFace åº“å¯¹è®­ç»ƒçš„å®ç°ç»†èŠ‚å·²ç»è¿›è¡Œäº†å°è£…ï¼Œåªéœ€è¦ä¼ å‚å³å¯æ§åˆ¶è¿‡ç¨‹ã€‚å½“ç„¶è¿™äº›å‚æ•°èƒŒåä»£è¡¨çš„è¿‡ç¨‹æ§åˆ¶ï¼Œéœ€è¦äº†è§£ä¸€éƒ¨åˆ†æ¨¡å‹è®­ç»ƒçš„çŸ¥è¯†å’Œç»†èŠ‚ã€‚</li><li><code>batch</code>ä¸<code>step</code>ç›¸å…³ï¼Œæ¯”å¦‚è¿™é‡Œè®­ç»ƒæ•°æ®é›†å…¨é‡æ˜¯1wå¤šæ¡ï¼Œ<code>per_device_train_batch_size</code>è®¾ç½®ä¸º64, <code>step</code>å³ 1w / 64 çº¦ä¸º 156ï¼Œä¹Ÿå°±æ˜¯è®­ç»ƒæ•°æ®é›†è·‘ä¸€æ¬¡å…¨é‡éœ€è¦ 156 step</li><li><code>logging_steps=10</code> æ¯10ä¸ªstepæ‰“å°ä¸€ä¸‹è¿›åº¦</li><li><code>eval_strategy="epoch"</code> æ¯ä¸ªepochï¼ˆä¹Ÿå°±æ˜¯è·‘ä¸€æ¬¡å…¨é‡ï¼‰è¿›è¡Œä¸€æ¬¡è¯„ä¼°</li><li><code>save_strategy="epoch"</code> æ¯ä¸ªepochè¿›è¡Œä¸€æ¬¡ç£ç›˜ä¿å­˜</li><li><code>learning_rate</code> å’Œ <code>weight_decay</code> æ·±åº¦å­¦ä¹ è®­ç»ƒæ¨¡å‹çš„è¶…å‚æ•°è®¾ç½®</li><li>ä»¥<code>metric_for_best_model</code>ä¸ºæ ‡å‡†ï¼ŒåŠ è½½æœ€ä¼˜æ¨¡å‹<code>load_best_model_at_end</code></li></ul><h5 id="æ‰§è¡Œè®­ç»ƒ">æ‰§è¡Œè®­ç»ƒ</h5><pre class="line-numbers language-none"><code class="language-none">trainer.train()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>output:</p><blockquote><p>2%|â–         | 10/507 [00:03&lt;02:18,  3.59it/s]<br>{â€˜lossâ€™: 0.5992, â€˜grad_normâ€™: 1.7134801149368286, â€˜learning_rateâ€™: 1.9605522682445763e-05, â€˜epochâ€™: 0.06}<br>4%|â–         | 20/507 [00:06&lt;02:53,  2.81it/s]<br>{â€˜lossâ€™: 0.5047, â€˜grad_normâ€™: 2.125014543533325, â€˜learning_rateâ€™: 1.921104536489152e-05, â€˜epochâ€™: 0.12}<br>6%|â–Œ         | 30/507 [00:09&lt;02:42,  2.93it/s]<br>{â€˜lossâ€™: 0.4028, â€˜grad_normâ€™: 2.1130874156951904, â€˜learning_rateâ€™: 1.881656804733728e-05, â€˜epochâ€™: 0.18}<br>8%|â–Š         | 40/507 [00:13&lt;02:34,  3.02it/s]<br>{â€˜lossâ€™: 0.3768, â€˜grad_normâ€™: 2.4480748176574707, â€˜learning_rateâ€™: 1.842209072978304e-05, â€˜epochâ€™: 0.24}<br>10%|â–‰         | 50/507 [00:16&lt;02:52,  2.66it/s]<br>â€¦â€¦â€¦â€¦<br>{â€˜lossâ€™: 0.2512, â€˜grad_normâ€™: 3.6124022006988525, â€˜learning_rateâ€™: 2.7613412228796843e-07, â€˜epochâ€™: 2.96}<br>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 507/507 [03:01&lt;00:00,  3.40it/s]<br>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 507/507 [03:03&lt;00:00,  3.40it/s]<br>{â€˜eval_lossâ€™: 0.23135297000408173, â€˜eval_accuracyâ€™: 0.9174311926605505, â€˜eval_f1â€™: 0.8748419721871049, â€˜eval_runtimeâ€™: 2.3411, â€˜eval_samples_per_secondâ€™: 512.143, â€˜eval_steps_per_secondâ€™: 4.271, â€˜epochâ€™: 3.0}<br>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 507/507 [03:04&lt;00:00,  2.75it/s]<br>{â€˜train_runtimeâ€™: 184.3464, â€˜train_samples_per_secondâ€™: 175.561, â€˜train_steps_per_secondâ€™: 2.75, â€˜train_lossâ€™: 0.27392145938421847, â€˜epochâ€™: 3.0}</p></blockquote><ul><li>åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŒ‰ç…§ä¹‹å‰çš„å‚æ•°è®¾ç½®<code>logging_steps</code>ã€<code>eval_strategy</code>æ¥æ‰“å°è¿›åº¦åé¦ˆã€‚</li></ul><h5 id="è¯„ä¼°">è¯„ä¼°</h5><pre class="line-numbers language-none"><code class="language-none">trainer.evaluate()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Output:</p><blockquote><p>{â€˜eval_lossâ€™: 0.23134386539459229,<br>â€˜eval_accuracyâ€™: 0.9182652210175146,<br>â€˜eval_f1â€™: 0.8759493670886076,<br>â€˜eval_runtimeâ€™: 2.2119,<br>â€˜eval_samples_per_secondâ€™: 542.056,<br>â€˜eval_steps_per_secondâ€™: 4.521,<br>â€˜epochâ€™: 3.0}</p></blockquote><ul><li>è¿™é‡Œé»˜è®¤ä½¿ç”¨å‚æ•°è®¾ç½®çš„<code>eval_dataset</code>è¿›è¡Œè¯„ä¼°ã€‚</li><li>æƒ³è¦é‡æ–°é’ˆå¯¹è®­ç»ƒé›†è¿›è¡Œè¯„ä¼°éœ€è¦è°ƒç”¨<code>trainer.evaluate(tokenized_datasets["train"])</code></li></ul><h4 id="3-5-æ¨¡å‹é¢„æµ‹">3.5 æ¨¡å‹é¢„æµ‹</h4><pre class="line-numbers language-none"><code class="language-none">from transformers import pipelineid2_label = {0: "å·®è¯„ï¼", 1: "å¥½è¯„ï¼"}model.config.id2label = id2_labelpipe = pipeline("text-classification", model=model, tokenizer=tokenizer)sen = "é¥­èœæœ‰äº›å’¸ï¼"pipe(sen)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Output:</p><blockquote><p>[{â€˜labelâ€™: â€˜å·®è¯„ï¼â€™, â€˜scoreâ€™: 0.9463842511177063}]</p></blockquote><ul><li>æ˜æ˜¾æ¯”å¾®è°ƒä¹‹å‰çš„é¢„è®­ç»ƒæ¨¡å‹è¦é è°±è®¸å¤šã€‚</li></ul><h4 id="3-6-å¾®è°ƒæ¨¡å‹ä¿å­˜">3.6 å¾®è°ƒæ¨¡å‹ä¿å­˜</h4><h5 id="ä¿å­˜åˆ°æœ¬åœ°">ä¿å­˜åˆ°æœ¬åœ°</h5><pre class="line-numbers language-none"><code class="language-none">local_model_path = './my-awesome-model'model.save_pretrained(local_model_path)tokenizer.save_pretrained(local_model_path)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Output:</p><blockquote><p>(â€˜./my-awesome-model/tokenizer_config.jsonâ€™,<br>â€˜./my-awesome-model/special_tokens_map.jsonâ€™,<br>â€˜./my-awesome-model/vocab.txtâ€™,<br>â€˜./my-awesome-model/added_tokens.jsonâ€™,<br>â€˜./my-awesome-model/tokenizer.jsonâ€™)</p></blockquote><h5 id="ä»æœ¬åœ°åŠ è½½æ¨¡å‹å’Œé¢„æµ‹">ä»æœ¬åœ°åŠ è½½æ¨¡å‹å’Œé¢„æµ‹</h5><pre class="line-numbers language-none"><code class="language-none">model = AutoModelForSequenceClassification.from_pretrained(local_model_path)model.config.id2label = id2_labeltokenizer = AutoTokenizer.from_pretrained(local_model_path)pipe = pipeline("text-classification", model=model, tokenizer=tokenizer)sen = "é¥­èœæœ‰äº›å’¸ï¼"pipe(sen)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é™„">é™„</h3><p>æœ¬æ–‡ä»…ä½¿ç”¨äº†æ™®é€šå¾®è°ƒè®­ç»ƒçš„æ–¹å¼ï¼Œä¼šå¯¹å‚æ•°è¿›è¡Œå…¨é‡è°ƒæ•´ã€‚<br>å¦‚æœæ¶‰åŠåˆ°å‚æ•°åƒä¸‡ä»¥ä¸Šçš„å¤§æ¨¡å‹ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸é€‚åˆ â€”â€” éœ€è¦ä½¿ç”¨ HuggingFace çš„<code>PEFT</code>åº“ï¼Œé’ˆå¯¹å°éƒ¨åˆ†å‚æ•°è¿›è¡Œå¾®è°ƒçš„åŒæ—¶è·å¾—æ›´å¥½çš„æ¨¡å‹é¢„æµ‹æ•ˆæœã€‚<br>å³ä½¿è¿™æ ·ï¼Œä¹Ÿå¹¶éæ™®é€šçš„æ˜¾å¡å°±å¯è¿›è¡Œè®­ç»ƒï¼Œä½œè€…æœ¬äººæ›¾ç»è¯•è¿‡åœ¨ Google Colab ä¸Š15Gæ˜¾å­˜ ä»…åŠ è½½ Llama3 æ¨¡å‹ â€”â€” æ ¹æœ¬åŠ è½½ä¸è¿›å»ï¼Œç›´æ¥ OutOfMemoryã€‚è®ºæ•°æ®é›†å’Œæ˜¾å¡çš„é‡è¦æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ML </tag>
            
            <tag> AI </tag>
            
            <tag> HuggingFace </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes ç»„ä»¶æ¶æ„å›é¡¾</title>
      <link href="/2024/03/19/kubernetes-zu-jian-jia-gou-hui-gu/"/>
      <url>/2024/03/19/kubernetes-zu-jian-jia-gou-hui-gu/</url>
      
        <content type="html"><![CDATA[<p>å‰é¢å›é¡¾äº† Kubernetes çš„é€»è¾‘æ¦‚å¿µæ¨¡å‹å’Œä½¿ç”¨ï¼Œè¿™ç¯‡ä¸»è¦å›é¡¾ä¸€ä¸‹ Kubernetes çš„ç»„ä»¶æ¶æ„ã€‚<br>ä¹‹å‰æåˆ° Kubernetes å°†é›†ç¾¤ä¸­çš„æœºå™¨åˆ’åˆ†ä¸ºè‡³å°‘ä¸€ä¸ª Master èŠ‚ç‚¹å’Œä¸€ç¾¤ Node èŠ‚ç‚¹ã€‚</p><p>Master èŠ‚ç‚¹ä¸Šï¼š</p><ul><li>éœ€è¦é¢„å®‰è£… <code>docker</code> å’Œ <code>kubectl</code> ç¨‹åºï¼ˆè¿è¡Œ Pod çš„å¿…éœ€ç¯å¢ƒï¼‰ã€‚</li><li>ä»¥ static pod çš„æ–¹å¼ï¼ˆä½¿ç”¨ kubectl å‘½ä»¤å®‰è£…ï¼‰è¿è¡Œ<code>Kube-apiserver</code>ã€<code>kube-contoller-manager</code>ã€<code>kube-scheduler</code>ï¼Œè¿™äº›è¿›ç¨‹å®ç°äº†æ•´ä¸ªé›†ç¾¤çš„èµ„æºç®¡ç†ã€å®‰å…¨æ§åˆ¶ã€ç³»ç»Ÿç›‘æ§ã€Podè°ƒåº¦ã€å¼¹æ€§ä¼¸ç¼©ç­‰ç®¡ç†åŠŸèƒ½ã€‚</li><li>é›†ç¾¤æ•°æ®é›†ä¸­å­˜å‚¨åœ¨ <code>etcd</code> é”®å€¼å­˜å‚¨åº“ä¸­ï¼Œä¸ºäº†é˜²æ­¢å•ç‚¹æ•…éšœã€è¿›è¡Œé«˜å¯ç”¨è€ƒè™‘ï¼Œå¯å°† etcd ä»¥é›†ç¾¤æ–¹å¼éƒ¨ç½²ã€‚</li><li>ç½‘ç»œç»„ä»¶ï¼š<code>kube-proxy</code>ã€<code>Flannel</code>(å¦‚æœä½¿ç”¨ Minikubeï¼ŒMinikube ä¸­ä½¿ç”¨çš„ç½‘ç»œç»„ä»¶æ˜¯kindnetï¼Œæ­¤ç»„ä»¶åªé€‚åˆç”¨äºå¼€å‘å’Œæµ‹è¯•)</li></ul><p>Node èŠ‚ç‚¹ä¸Šï¼š</p><ul><li>éœ€è¦é¢„å®‰è£… <code>docker</code> å’Œ <code>kubectl</code> ç¨‹åºã€‚</li><li>ç½‘ç»œç»„ä»¶ï¼š<code>kube-proxy</code>ã€<code>Flannel</code>ã€‚</li></ul><p><img src="/2024/03/19/kubernetes-zu-jian-jia-gou-hui-gu/kubernetes-components.png" alt="Kubernetes components"></p><p><strong>control-panel</strong>: é™¤ Node å·¥ä½œèŠ‚ç‚¹å¤–ï¼ŒMaster èŠ‚ç‚¹ä»£è¡¨çš„é›†ç¾¤æ§åˆ¶é¢è§’è‰²ä¹Ÿè¢«æˆä¸º<code>control-panel</code>ã€‚<br>PVï¼ˆæŒä¹…å·ï¼‰æ˜¯ Kubernetes é›†ç¾¤çš„èµ„æºä¹‹ä¸€ï¼Œä½†å¹¶éæ˜¯å®‰è£… Node å’Œ Master ä¸Šï¼Œç”±ä¸€äº›ç½‘ç»œç£ç›˜ã€å—æˆ–è€…æ–‡ä»¶ç³»ç»Ÿæä¾›ï¼Œç„¶åç”± control-panel è¿›è¡Œ PV Provisioningã€‚<br>å®¹å™¨éœ€è¦ä½¿ç”¨ PV æ—¶ï¼Œéœ€è¦åˆ›å»º PVCï¼ˆPersistentVolumeClaimï¼‰ç”³è¯·å¯¹ PV çš„ä½¿ç”¨ï¼Œæœ€åé€šè¿‡ PVC æŒ‚è½½åˆ° Pod ä¸Šä»¥ä¾›å®¹å™¨ä½¿ç”¨ã€‚</p><h3 id="1-kube-apiserver">1. kube-apiserver</h3><p>Kubernetes API Server æ˜¯ Kubernetes é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>æä¾›é›†ç¾¤ç®¡ç†çš„ API ï¼šAPI Server æä¾›ç»Ÿä¸€çš„ RESTful API æ¥å£ï¼Œå®ç°å¯¹é›†ç¾¤å†…å„ç§èµ„æºå¯¹è±¡ï¼ˆå¦‚Podsã€Servicesã€ConfigMapsã€Deploymentsç­‰ï¼‰çš„ CRUD å’Œ Watchç­‰æ“ä½œã€‚API Server åº•å±‚è¿æ¥é”®å€¼å­˜å‚¨åº“ etcdï¼Œå¯¹æ”¶åˆ°çš„è¯·æ±‚è¿›è¡Œæœ‰æ•ˆæ€§æ ¡éªŒåï¼Œå°†å˜æ›´æ“ä½œè½¬åŒ–ä¸º etcd ä¸­çš„é”®å€¼å¯¹å˜åŒ–ã€‚<br>åŒæ—¶ï¼ŒAPI Server ä½œä¸ºé›†ç¾¤å†…éƒ¨å„ç»„ä»¶é—´é€šä¿¡çš„æ•°æ®æ€»çº¿å’Œæ•°æ®ä¸­å¿ƒï¼ŒAPI Server ä¸ä»…å“åº”èµ„æºè¯·æ±‚ï¼Œè¿˜è´Ÿè´£æä¾›é›†ç¾¤çŠ¶æ€æ•°æ®å˜åŒ–çš„ç›‘æ§æ¥å£ç»™å…¶ä»–ç»„ä»¶å’Œå®¢æˆ·ç«¯ï¼Œå¦‚ Controller Managerã€kubeletç­‰ï¼Œä»è€Œç¡®ä¿æ•´ä¸ªé›†ç¾¤çŠ¶æ€çš„åŠæ—¶æ›´æ–°å’ŒåŒæ­¥ã€‚</li><li>èº«ä»½è®¤è¯å’Œæˆæƒï¼šAPI Server å…·å¤‡å¼ºå¤§çš„å®‰å…¨æœºåˆ¶ï¼Œæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå¦‚ Bearer Tokenã€X509è¯ä¹¦ã€HTTP Baseã€ServiceAccount ç­‰ï¼Œå¹¶å®æ–½ç²¾ç»†çš„æˆæƒç­–ç•¥ï¼Œé€šè¿‡RBACï¼ˆRole-Based Access Controlï¼‰æ§åˆ¶ç”¨æˆ·å’Œç»„ä»¶å¯¹ API èµ„æºçš„è®¿é—®æƒé™ã€‚</li><li>å‡†å…¥æ§åˆ¶ï¼šå®¢æˆ·ç«¯çš„è¯·æ±‚é€šè¿‡èº«ä»½è®¤è¯å’Œæˆæƒåï¼Œè¿˜éœ€è¦é€šè¿‡å‡†å…¥æ§åˆ¶é“¾ä¸­çš„æ¯ä¸ªæ§åˆ¶å™¨çš„æ£€æŸ¥ï¼Œæ£€æŸ¥é€šè¿‡æ‰èƒ½å®Œæˆ API æ“ä½œã€‚</li></ul><h3 id="2-kube-controller-manager">2. kube-controller-manager</h3><p>Controller Manager åŒ…å«ä¸€ç³»åˆ—å­æ§åˆ¶å™¨ï¼Œå®ƒä»¬é€šè¿‡ API Server ç›‘å¬å¯¹åº”çš„èµ„æºå¯¹è±¡å˜åŒ–ï¼Œä½œå‡ºç›¸åº”çš„è°ƒæ•´ä»¥è¾¾åˆ°ç”¨æˆ·å®šä¹‰çš„æœŸæœ›çŠ¶æ€ã€‚<br>è¿™é‡Œé¢åŒ…æ‹¬ã€ä½†ä¸é™äºä»¥ä¸‹å‡ ä¸ªä¸»è¦åŠŸèƒ½ï¼š</p><ul><li>NodeControllerï¼šèŠ‚ç‚¹æ§åˆ¶å™¨ç›‘æ§é›†ç¾¤ä¸­æ¯ä¸ª Node çš„çŠ¶æ€ï¼Œå¤„ç†èŠ‚ç‚¹åŠ å…¥ã€ç¦»å¼€é›†ç¾¤çš„è¿‡ç¨‹ï¼Œå¹¶å¯¹å¼‚å¸¸èŠ‚ç‚¹è¿›è¡Œæ ‡è®°ã€åˆ é™¤æˆ–é‡æ–°è°ƒåº¦å…¶ä¸Šè¿è¡Œçš„Podï¼Œä»¥ä¿æŒé›†ç¾¤æ•´ä½“å¥åº·ã€‚</li><li>ReplicationControllerï¼šç¡®ä¿ç”¨æˆ·å®šä¹‰çš„ Pod å‰¯æœ¬æ•°é‡ä¸é›†ç¾¤ä¸­å®é™…è¿è¡Œçš„æ•°é‡ç›¸åŒ¹é…ã€‚å¦‚æœæœ‰å·®å¼‚ï¼Œå‰¯æœ¬æ§åˆ¶å™¨ä¼šè‡ªåŠ¨å¢åŠ æˆ–å‡å°‘å‰¯æœ¬æ¥ä¿®æ­£å·®å¼‚ã€‚</li><li>ServiceControllerï¼šæœåŠ¡æ§åˆ¶å™¨è´Ÿè´£ç®¡ç†æœåŠ¡èµ„æºå’Œå¯¹åº”çš„ç«¯ç‚¹èµ„æºï¼Œç¡®ä¿æœåŠ¡èƒŒåçš„ Pod èƒ½å¤Ÿè¢«æ­£ç¡®åœ°ä»£ç†å’Œè·¯ç”±æµé‡ã€‚</li><li>NamespaceController | ResourceQuotaContollerï¼šå‘½åç©ºé—´æ§åˆ¶å™¨ç»´æŠ¤å‘½åç©ºé—´çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶èµ„æºé…é¢æ§åˆ¶å™¨ç¡®ä¿å„å‘½åç©ºé—´å†…çš„èµ„æºæ¶ˆè€—ä¸è¶…è¿‡é¢„è®¾é™é¢ã€‚</li><li>DeploymentController | StatefulSetController | DaemonSetControllerï¼šè¿™äº›æ§åˆ¶å™¨åˆ†åˆ«ç®¡ç†ä¸åŒç±»å‹çš„å·¥ä½œè´Ÿè½½ï¼Œç¡®ä¿ Deploymentã€StatefulSetã€DaemonSet èµ„æºå®šä¹‰çš„çŠ¶æ€ä¸å®é™…é›†ç¾¤çŠ¶æ€ä¸€è‡´ï¼Œå¤„ç†Podsçš„åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ã€‚</li></ul><p>é€šè¿‡è¿™äº›æ§åˆ¶å™¨çš„åè°ƒå·¥ä½œï¼Œkube-controller-manager ä¿è¯äº†é›†ç¾¤çš„å¥åº·ä¸åŠ¨æ€è°ƒæ•´èƒ½åŠ›ï¼Œå“åº”èµ„æºå˜åŒ–å’ŒèŠ‚ç‚¹æ•…éšœï¼Œç»´æŒç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚</p><h3 id="3-kube-scheduler">3. kube-scheduler</h3><p>kube-scheduler è´Ÿè´£ç›‘è§†æ–°åˆ›å»ºçš„ã€è¿˜æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹çš„ Podsï¼Œç„¶ååŸºäºè°ƒåº¦ç®—æ³•å’Œç­–ç•¥ï¼Œç¡®å®šæ¯ä¸ªå¾…è°ƒåº¦ Pod åº”è¯¥è¿è¡Œåœ¨å“ªä¸ª Node ä¸Šï¼Œå¹¶å°† Pod ä¸ Node çš„ç»‘å®šä¿¡æ¯é€šè¿‡ API Server å†™å…¥ etcdã€‚<br>kube-scheduler ä¼šè€ƒè™‘å¤šç§å› ç´ æ¥åšå‡ºè°ƒåº¦å†³ç­–ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šå„ä¸ª Node çš„èµ„æºéœ€æ±‚ï¼ˆå¦‚ CPUã€å†…å­˜ç­‰ï¼‰ã€Node çš„å¥åº·çŠ¶æ€ã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è®¾ç½®ã€Pod çš„ä¼˜å…ˆçº§å’ŒæŠ¢å é€»è¾‘ï¼Œä»¥åŠé›†ç¾¤ä¸­å·²ç»éƒ¨ç½²çš„å·¥ä½œè´Ÿè½½åˆ†å¸ƒã€‚é€šè¿‡è¿™äº›ç»†è‡´çš„è€ƒé‡ï¼Œkube-scheduler èƒ½å¤Ÿä¼˜åŒ–è´Ÿè½½çš„åˆ†å¸ƒï¼Œæé«˜é›†ç¾¤çš„èµ„æºåˆ©ç”¨ç‡å’Œå¯é æ€§ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒé«˜çº§è°ƒåº¦åŠŸèƒ½ï¼Œå¦‚æ¨ªå‘æ‰©å±•å’Œè‡ªåŠ¨æ¢å¤ã€‚<br>kube-scheduler ç»™ä¸€ä¸ª Pod åšè°ƒåº¦é€‰æ‹©æ—¶åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>è¿‡æ»¤ï¼šä½¿ç”¨é¢„é€‰ç­–ç•¥ï¼Œéå†æ‰€æœ‰ç›®æ ‡ Nodeï¼Œç­›é€‰å‡ºç¬¦åˆè¦æ±‚çš„å€™é€‰ Nodeã€‚</li><li>æ‰“åˆ†ï¼šä½¿ç”¨ä¼˜é€‰ç­–ç•¥ï¼Œè®¡ç®—å‡ºæ¯ä¸ªå€™é€‰ Node çš„ç§¯åˆ†ï¼Œé€‰å‡ºæœ€é«˜è€…ã€‚</li></ul><h3 id="4-kube-proxy">4. kube-proxy</h3><p>åœ¨ Kubernetes çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šè¿è¡Œä¸€ä¸ª kube-proxy æœåŠ¡è¿›ç¨‹ï¼Œè´Ÿè´£å®ç° Kubernetes Service æ¨¡å‹èƒŒåçš„ç½‘ç»œä»£ç†å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</p><ul><li>ç½‘ç»œä»£ç†ï¼škube-proxy è´Ÿè´£ç›‘å¬ Kubernetes æ§åˆ¶å¹³é¢çš„ Service å’Œ Endpoints çš„å˜åŒ–ï¼Œç„¶åæ›´æ–° Node ä¸Šçš„ç½‘ç»œè§„åˆ™ï¼ˆå¦‚ iptablesã€ipvsç­‰ï¼‰ï¼Œä»è€Œå…è®¸ç½‘ç»œæµé‡åˆ°è¾¾è¿™äº›æœåŠ¡èƒŒåçš„ Podã€‚æ— è®ºæ˜¯æ¥è‡ªå“ªä¸ª Node çš„å¯¹ Service çš„è¯·æ±‚ï¼Œéƒ½å¯ä»¥è¢«è¯¥ Node ä¸Šçš„ kube-proxy ä»£ç†åˆ°æ­£ç¡®åœ°å€ã€‚</li><li>è´Ÿè½½å‡è¡¡ï¼šå½“ä¸€ä¸ª Service çš„åç«¯åŒ…å«å¤šä¸ª Pod æ—¶ï¼Œkube-proxy ä¼šè´Ÿè´£å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡ï¼Œå°†è¿›å…¥æœåŠ¡çš„æµé‡å‡åŒ€åœ°åˆ†é…ç»™åç«¯çš„æ‰€æœ‰ Podã€‚</li></ul><h3 id="5-Kubernetes-ç½‘ç»œ">5. Kubernetes ç½‘ç»œ</h3><p>Kubernetes è‡ªèº«å¹¶ä¸ç›´æ¥æä¾›å®Œæ•´çš„ç½‘ç»œç»„ä»¶ã€‚ç›¸åï¼ŒKubernetes å®šä¹‰äº†ä¸€ç»„ç½‘ç»œè¦æ±‚å’Œæ¥å£ï¼Œä»¥ç¡®ä¿ Pod é—´å’Œé›†ç¾¤å¤–éƒ¨çš„é€šä¿¡ã€‚<br>ä¸ºäº†æ»¡è¶³è¿™äº›è¦æ±‚ï¼Œå®ƒä¾èµ–äºç¬¬ä¸‰æ–¹ç½‘ç»œæ’ä»¶æˆ–è§£å†³æ–¹æ¡ˆï¼Œéµå¾ª CNIï¼ˆContainer Network Interfaceï¼‰æ ‡å‡†ã€‚è¿™äº› CNI æ’ä»¶è´Ÿè´£ä¸º Pod æä¾›ç½‘ç»œåŠŸèƒ½ï¼ŒåŒ…æ‹¬åˆ†é… IP åœ°å€ã€å¤„ç†ç½‘ç»œéš”ç¦»å’Œè·¯ç”±ç­‰ã€‚</p><p>Kuberneteså¯¹ç½‘ç»œæœ‰å‡ ä¸ªåŸºæœ¬çš„è¦æ±‚ï¼Œä»»ä½•æƒ³è¦é›†æˆçš„CNIæ’ä»¶éƒ½éœ€è¦éµå®ˆï¼š</p><ol><li><strong>æ‰€æœ‰Podéƒ½å¿…é¡»èƒ½ç›´æ¥é€šä¿¡ï¼Œæ— éœ€NAT</strong>ï¼šæ¯ä¸ªPodåº”è¯¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œå¹¶ä¸”è¿™ä¸ªIPåœ¨æ•´ä¸ªé›†ç¾¤å†…éƒ¨éƒ½æ˜¯å¯è·¯ç”±çš„ã€‚</li><li><strong>æ‰€æœ‰èŠ‚ç‚¹éƒ½å¿…é¡»èƒ½ç›´æ¥é€šä¿¡</strong>ï¼šèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ä¸åº”è¢«é˜»å¡ã€‚</li><li><strong>Podåœ¨ä¸å¤–ç•Œé€šä¿¡æ—¶ï¼Œåº”ä¿æŒå…¶æºIPåœ°å€</strong>ï¼šä¸ºäº†ç¡®ä¿ç½‘ç»œçš„é€æ˜æ€§å’Œå¯è¿½è¸ªæ€§ã€‚</li></ol><p>å¸¸è§çš„CNIæ’ä»¶ï¼š</p><ul><li><strong>Calico</strong>ï¼šæä¾›äº†ä¸°å¯Œçš„ç½‘ç»œç­–ç•¥åŠŸèƒ½ï¼Œæ”¯æŒè·¨ä¸»æœºå’Œäº‘æä¾›å•†çš„é«˜æ€§èƒ½ç½‘ç»œã€‚</li><li><strong>Flannel</strong>ï¼šç®€å•æ˜“ç”¨ï¼Œå¸¸è¢«ç”¨äºåˆå­¦è€…æˆ–è€…æ˜¯å°è§„æ¨¡ç¯å¢ƒã€‚</li><li><strong>Weave Net</strong>ï¼šæä¾›äº†è‡ªå·±çš„ç½‘ç»œæ¨¡å‹ï¼Œæ”¯æŒæ— ç¼åœ°è·¨è¶Šå¤šä¸ªæ•°æ®ä¸­å¿ƒå’Œäº‘æä¾›å•†ã€‚</li><li><strong>Cilium</strong>ï¼šåˆ©ç”¨Linuxå†…æ ¸çš„BPFï¼ˆBerkeley Packet Filterï¼‰æ¥æä¾›ç½‘ç»œå®‰å…¨ã€ç›‘æ§å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> äº‘åŸç”Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubernetes é€»è¾‘æ¨¡å‹å’Œä½¿ç”¨å›é¡¾</title>
      <link href="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/"/>
      <url>/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/</url>
      
        <content type="html"><![CDATA[<p>å„æ¨¡å‹æ¦‚å¿µçš„å®šä¹‰æ¨¡ç‰ˆï¼Œæ­¤æ–‡ä¸­ä¸ä¼šè¯¦ç»†æ¶‰åŠã€‚k8s æ¨¡ç‰ˆç®¡ç†å’Œæ„å»ºå·¥å…·ï¼Œæ¯”è¾ƒæ¨è Skaffold æˆ– helmã€‚<br>å¦‚æœæƒ³ä½¿ç”¨ kubectl å‘½ä»¤æŒ¨ä¸ªè°ƒç”¨çš„è¯ï¼Œå¸¸ç”¨çš„å‘½ä»¤è§„åˆ™ï¼š<br><code>åˆ›å»º/æ›´æ–°</code>ï¼š<code>kubectl [create|apply] -f [file_name.yaml]</code><br><code>list</code>: <code>kubectl get [type]</code><br><code>get detail</code>: <code>kubectl get [type] [name] -o yaml</code><br><code>describe</code>: <code>kubectl describe [type] [name]</code><br><code>åˆ é™¤</code>ï¼š<code>kubectl delete [type] [name]</code><br>ä»¥ä¸Š<code>[type]</code>æ˜¯èµ„æºç±»å‹ï¼ŒåŒ…æ‹¬ [nodes|pods|rs|deployments|svc|endpoints|namespaces] ç­‰ã€‚<br>å¦‚æœæœ‰ namespaceï¼Œå‘½ä»¤åå¸¦ä¸Š<code>-n [namespace_name]</code><br><em>æ³¨æ„: kubectlå‘½ä»¤èƒŒåæ˜¯åœ¨ä¸<code>Kube-apiserver</code>è¿›è¡Œäº¤äº’ï¼Œå¹¶éç›´æ¥æ“ä½œå·¥ä½œèŠ‚ç‚¹ã€‚å…·ä½“æ¦‚å¿µï¼Œå¯å…ˆçœ‹ä¸‹æ–‡ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯éå¸¸é‡è¦ã€‚</em></p><p>æœ¬æ–‡ä¾æ—§æä¾›<a href="https://github.com/open-ending/demo-kubernetes-kubectl">demo repo</a>ï¼Œé¢„å®‰è£… minikubeã€docker å³å¯ç»ƒä¹ ä½¿ç”¨ã€‚</p><ul><li>å­ç›®å½•<code>k8s/basic</code>ä¸­ï¼Œå°½é‡è¦†ç›–äº†æœ¬æ–‡ä¸­æåˆ°çš„æ¦‚å¿µçš„åŸºæœ¬ä½¿ç”¨ï¼Œå¹¶æŒç»­æ›´æ–°ã€‚</li><li>å­ç›®å½•<code>k8s/share-pod</code> æ˜¯ç¬¬äºŒç« åŒ Pod å†…ä¸¤ä¸ªContainerçš„ä¸€ä¸ªç®€å•æ“ä½œç¤ºä¾‹ã€‚</li><li>å­ç›®å½•<code>k8s/service-without-label</code>æ˜¯ç¬¬å››ç«  No selecter service çš„ä¸€ä¸ªæ“ä½œç¤ºä¾‹ã€‚</li></ul><h2 id="Kubernetes-åŸºæœ¬æ¨¡å‹å’Œé€»è¾‘æ¶æ„">Kubernetes åŸºæœ¬æ¨¡å‹å’Œé€»è¾‘æ¶æ„</h2><p><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/kubernetes-models.png" alt="kubernetes logic model"></p><h3 id="1-Master-å’Œ-Node">1. Master å’Œ Node</h3><h4 id="1-1-æ¦‚è¿°">1.1 æ¦‚è¿°</h4><p>Kubernetes é›†ç¾¤ä¸­æœåŠ¡å™¨åˆ†ä¸ºä¸¤ç§è§’è‰²ï¼š<code>Master</code> å’Œ <code>Node</code>ã€‚<br>Master æ˜¯æ•´ä¸ªé›†ç¾¤çš„å¤§è„‘ï¼Œè´Ÿè´£é›†ç¾¤çš„ç®¡ç†å’Œåè°ƒã€‚å®ƒè¿è¡Œç€å‡ ä¸ªå…³é”®çš„ç»„ä»¶ï¼Œå¦‚<code>Kube-apiserver</code>ã€<code>kube-contoller-manager</code>ã€<code>kube-scheduler</code>ã€<code>etcd</code>ã€‚<br>Node æœºå™¨ä¸Šé™¤äº†å¿…è¦å®‰è£…çš„<code>kubelet</code>ã€<code>docker</code>ã€<code>kube-proxy</code>ä»¥å¤–ï¼Œå¤§éƒ¨åˆ†è¿ç®—èµ„æºéƒ½ä¼šä¾›ç»™åˆ°ç”¨æˆ·ä¸šåŠ¡åº”ç”¨æœåŠ¡ä¸­ã€‚<br>Node å®‰è£…å¥½ä¹‹åï¼Œéœ€è¦å‘ Master æ³¨å†Œå’ŒæŒç»­ä¸ŠæŠ¥è‡ªå·±ã€‚</p><h4 id="1-2-Node-ç®¡ç†">1.2 Node ç®¡ç†</h4><p>æœ¬åœ°å¯ä»¥ä½¿ç”¨ minikube å¿«é€Ÿå¯åŠ¨å¤šèŠ‚ç‚¹é›†ç¾¤ï¼š<code>minikube start --nodes 2 -p multinode-demo</code>ã€‚<br>æŸ¥çœ‹ node çŠ¶æ€ï¼Œ<code>kubectl get nodes</code>ï¼š<br><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/multinodes.png" alt="multi-nodes"></p><p>Node å¯ä»¥æ‰‹åŠ¨ç»´æŠ¤ï¼Œæ ‡è®°ä¸ºä¸å¯è°ƒåº¦ï¼Œå°†é˜»æ­¢æ–° Pod è°ƒåº¦åˆ°è¯¥ Node ä¹‹ä¸Šï¼Œä½†ä¸ä¼šå½±å“ä»»ä½•å·²ç»åœ¨å…¶ä¸Šçš„ Podã€‚è¿™æ˜¯é‡å¯èŠ‚ç‚¹æˆ–è€…æ‰§è¡Œå…¶ä»–ç»´æŠ¤æ“ä½œä¹‹å‰çš„ä¸€ä¸ªæœ‰ç”¨çš„å‡†å¤‡æ­¥éª¤ã€‚<br>å°† Node è„±ç¦»è°ƒåº¦ï¼Œå‘½ä»¤ï¼š<code>kubectl cordon $node_name</code>ï¼š<br><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/SchedulingDisabled.png" alt="SchedulingDisabled"><br>Node é‡æ–°çº³å…¥è°ƒåº¦ï¼Œå‘½ä»¤ï¼š<code>kubectl uncordon $node_name</code></p><h3 id="2-Pod-å’Œ-Container-å®¹å™¨">2. Pod å’Œ Container(å®¹å™¨)</h3><h4 id="2-1-æ¦‚è¿°">2.1 æ¦‚è¿°</h4><p>Containerï¼Œå³ Docker Containerã€‚Kubernetes ç»™ Container åˆ†äº†ä¸åŒçš„ç±»å‹ï¼Œè¿™é‡Œæš‚æ—¶ä¸å±•å¼€ã€‚<br>Pod æ˜¯ Kubernetes ä¸­ç”¨äºéƒ¨ç½²å’Œç®¡ç†å®¹å™¨çš„åŸºæœ¬å•å…ƒï¼Œå®ƒå°†ä¸€ä¸ªæˆ–å¤šä¸ª container å°è£…ä¸ºä¸€ä¸ªå¯ç®¡ç†çš„å•å…ƒã€‚<br>Pod å†…éƒ¨è‡ªå¸¦æœ‰ä¸€ä¸ªæ ¹å®¹å™¨ï¼ˆåå« Pauseï¼‰ï¼Œé€šè¿‡æ ¹å®¹å™¨ï¼ŒåŒä¸€ä¸ª Pod å†…çš„æ‰€æœ‰å®¹å™¨ï¼šå…±äº«ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ï¼ˆPod IP å’Œ Port rangeï¼‰ï¼›å…±äº«å­˜å‚¨å·ï¼ˆVolumeï¼‰ã€‚<br>åŒä¸€ä¸ª Pod å†…çš„ Container æƒ³è¦è®¿é—®å¦ä¸€ä¸ª Container expose portï¼Œä»…éœ€è¦ä½¿ç”¨ localhost + containerPort å³å¯è®¿é—®ã€‚<br><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/kubernetes-pod-localhost.png" alt="pod containers inner access"><br>ä¸€èˆ¬ï¼Œåªæœ‰å½“ä¸¤ä¸ªå®¹å™¨ä¸ºäº†å®ç°åŒä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½ã€å…³ç³»ä¸ºç´§è€¦åˆæ—¶ï¼Œæ‰æ¨èç»„è£…æˆä¸€ä¸ªPodã€‚</p><p>Pod çš„å®šä¹‰æ–‡ä»¶ï¼Œè‡³å°‘åŒ…æ‹¬ä¸¤é¡¹ä¿¡æ¯ï¼š</p><ul><li>æ ‡ç­¾lables</li><li>å®¹å™¨å®šä¹‰<br><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/pod-template.png" alt="pod-template"><br><em>åœ¨ demo çš„ç›®å½• ./k8s/share-pod ä¸­æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„å• Pod å†…åŒæ—¶å®‰è£…äº†appå’Œredisï¼ŒåŒæ—¶åˆ›å»ºäº†serviceå’Œingresså°†app http API é€šè¿‡å†…éƒ¨åŸŸå share-pod.test æš´éœ²å‡º Kubernetes clusterã€‚å¯æ‹¿æ¥ç»ƒä¹ è¯•æ‰‹ã€‚</em></li></ul><h4 id="2-2-ç±»å‹">2.2 ç±»å‹</h4><p>Pod åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š<code>æ™®é€š Pod</code> å’Œ <code>Static Pod</code>ã€‚<br>æ™®é€š Pod æ˜¯çŸ­æš‚çš„å®ä½“ï¼Œå®ƒä»¬ç”± Kubernetes è‡ªåŠ¨éƒ¨ç½²åˆ°é›†ç¾¤ä¸­çš„ Node ä¸Šï¼Œå¹¶åœ¨å®¹å™¨å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨é‡å¯ Podï¼›Node å®•æœºæ—¶ï¼Œè¢«é‡æ–°è°ƒåº¦åˆ°å…¶ä»– Nodeã€‚</p><p>Static Pod ä¸ç”± Master ä¸‹ä»¤å®‰è£…å’Œç®¡ç†ï¼Œä»…åœ¨å…·ä½“çš„æŸä¸ªèŠ‚ç‚¹ä¸Šé€šè¿‡ kubelet å®‰è£…ï¼Œå¹¶ä¸”åªåœ¨å½“å‰èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä¸”ä¸ä¸ŠæŠ¥å¥åº·æ£€æŸ¥ç­‰çŠ¶æ€ã€‚æ¯”å¦‚ Master ä¸Šé¢çš„å‡ å¤§å…³é”®ç»„ä»¶å°±æ˜¯ä»¥ static pod å­˜åœ¨ã€‚</p><h4 id="2-3-èµ„æºé™é¢ç®¡ç†">2.3 èµ„æºé™é¢ç®¡ç†</h4><p>æ¯ä¸ª Pod éƒ½å¯å¯¹å…¶èƒ½ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šçš„è®¡ç®—èµ„æºè®¾ç½®é™é¢ï¼ŒåŒ…æ‹¬ CPU å’Œ Memory ä¸¤é¡¹ã€‚<br>å¦‚æœä¸è®¾ç½®èµ„æºé™åˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒPod å¯¹ Node çš„èµ„æºä½¿ç”¨æ˜¯æ— é™åˆ¶çš„ã€‚<br>Kubernetes çš„é…é¢ç®¡ç†æä¾›äº†ä¸¤ç§çº¦æŸæ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ LimitRanger ä¸ ResourceQuotaã€‚å…¶ä¸­ LimitRanger ä½œç”¨äº Pod å’Œ Containerï¼ŒResourceQuota ä½œç”¨äº Namespaceï¼ˆè§åï¼‰ã€‚</p><p>åœ¨ Pod template å®šä¹‰æ—¶ï¼ŒLimitRanger ä»…èƒ½å®šä¹‰åœ¨ Container[] ä¸Šï¼Œæ‰€æœ‰çš„ Container LimitRanger ç´¯åŠ ï¼Œç­‰äº Pod LimitRangerã€‚</p><ul><li><code>template.spec.containers[].resources.requests.memory</code> å†…å­˜ç”³è¯·çš„æœ€å°é‡</li><li><code>template.spec.containers[].resources.requests.cpu</code> CPU æ ¸æ•°ç»å¯¹å€¼ç”³è¯·çš„æœ€å°é‡</li><li><code>template.spec.containers[].resources.limits.memory</code> å†…å­˜æœ€å¤§å…è®¸é‡</li><li><code>template.spec.containers[].resources.limits.cpu</code> CPU æœ€å¤§å…è®¸é‡</li></ul><p>ä¹Ÿå¯é€šè¿‡ namespace ç»™è¯¥å‘½åç©ºé—´ä¸‹çš„ Pod å’Œ Container ç»Ÿä¸€é…ç½® LimitRangerã€‚<br>æ¯”å¦‚ï¼šåˆ›å»ºä»¥ä¸‹ LimitRange ç»™æŸä¸€ä¸ª Namespaceã€‚</p><pre class="line-numbers language-none"><code class="language-none">apiVersion: v1kind: LimitRangemetadata:  name: cpu-resource-constraintspec:  limits:  - default: # this section defines default limits      cpu: 500m    defaultRequest: # this section defines default requests      cpu: 500m    max: # max and min define the limit range      cpu: "1"    min:      cpu: 100m    type: Container<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-4-Pod-çš„ç”Ÿå‘½å‘¨æœŸå’Œ-Container-é‡å¯ç­–ç•¥">2.4 Pod çš„ç”Ÿå‘½å‘¨æœŸå’Œ Container é‡å¯ç­–ç•¥</h4><p>Pod æœ‰5ç§ç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼š<code>Pending</code>ã€<code>Running</code>ã€<code>Succeeded</code>ã€<code>Failed</code>ã€<code>Unknown</code>ã€‚</p><ul><li><code>Pending</code>: Kubernetes å·²æ¥å—åˆ›å»ºè¯¥ Podï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æœªåˆ›å»ºå®Œæˆã€‚æ­¤é˜¶æ®µåŒ…æ‹¬ç­‰å¾… Pod è¢«è°ƒåº¦å’Œé€šè¿‡ç½‘ç»œä¸‹è½½é•œåƒçš„æ—¶é—´ã€‚</li><li><code>Running</code>: Pod å†…çš„æ‰€æœ‰å®¹å™¨éƒ½å·²åˆ›å»ºå®Œæˆï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨åœ¨è¿è¡Œ æˆ– å¤„äºå¯åŠ¨ï¼ˆåŒ…æ‹¬é‡å¯ï¼‰çŠ¶æ€ã€‚</li><li><code>Succeeded</code>: Pod å†…æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢ï¼Œä¸”é€€å‡ºçŠ¶æ€éƒ½ä¸ºæˆåŠŸï¼ŒPod ä¸ä¼šå†é‡å¯ã€‚</li><li><code>Failed</code>ï¼šPod å†…æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨é€€å‡ºçŠ¶æ€ä¸ºå¤±è´¥ã€‚</li><li><code>Unknown</code>ï¼šç”±äºæŸç§åŸå› æ— æ³•è·å–è¯¥ Pod çš„çŠ¶æ€ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé€šè®¯ä¸ç•…ç­‰ã€‚</li></ul><p><code>restartPolicy</code> æ˜¯ç”¨äºæ§åˆ¶Podå†…éƒ¨å®¹å™¨çš„é‡å¯è¡Œä¸ºã€‚è¿™æ„å‘³ç€å®ƒç›´æ¥å½±å“ Pod ä¸­å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œé—´æ¥å½±å“ Pod æœ¬èº«çš„ç”Ÿå‘½å‘¨æœŸã€‚<br>restartPolicy å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§è®¾ç½®ï¼š</p><ul><li><code>Always</code>ï¼šå½“å®¹å™¨ç»ˆæ­¢è¿è¡Œæ—¶ï¼Œæ— è®ºé€€å‡ºä»£ç æ˜¯ä»€ä¹ˆï¼ŒKubernetes å§‹ç»ˆå°è¯•é‡å¯å®¹å™¨ã€‚</li><li><code>OnFailure</code>ï¼šä»…å½“å®¹å™¨ä»¥éé›¶çŠ¶æ€ï¼ˆå³å¤±è´¥ï¼‰é€€å‡ºæ—¶ï¼Œæ‰ä¼šé‡å¯å®¹å™¨ã€‚</li><li><code>Never</code>ï¼šæ— è®ºå®¹å™¨é€€å‡ºä»£ç å¦‚ä½•ï¼ŒKubernetes éƒ½ä¸ä¼šå°è¯•é‡å¯å®¹å™¨ã€‚<br>é€šè¿‡åœ¨ Pod å®šä¹‰åˆé€‚çš„ restartPolicyï¼Œæ§åˆ¶ Pod ä¸­çš„å®¹å™¨åœ¨ç‰¹å®šæƒ…å†µä¸‹æ˜¯å¦åº”è¯¥è‡ªåŠ¨é‡å¯ã€‚</li></ul><p>å¹¶ä¸” restartPolicy ä¹Ÿéœ€è¦é…åˆæ§åˆ¶å™¨æ¥è®¾ç½®ï¼Œæ¯”å¦‚ï¼š</p><ul><li>RS å’Œ DaemonSetï¼šå¿…é¡»è®¾ç½®ä¸º Alwaysã€‚å› ä¸ºè¦ä¿è¯ Pod æŒç»­è¿è¡Œã€‚</li><li>Jobï¼šä»…èƒ½è®¾ç½®æˆ OnFailure æˆ– Neverã€‚æˆåŠŸæ‰§è¡Œå¹¶é€€å‡ºçš„å®¹å™¨ï¼Œæ²¡å¿…è¦é‡å¯ã€‚</li><li>Static Podï¼šæ— è®ºè®¾ç½®ä¸ºä½•å€¼ï¼Œå®¹å™¨ç»ˆæ­¢è¿è¡Œæ—¶ kubelet éƒ½ä¼šé‡å¯å®¹å™¨ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒPod çš„ç”Ÿå‘½å‘¨æœŸæµè½¬å¦‚ä¸‹å›¾ï¼š<br><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/kubernetes-pod-phases.png" alt="pod lifecycle phases"></p><h4 id="2-5-Container-çš„æ¢é’ˆ">2.5 Container çš„æ¢é’ˆ</h4><p>æ¢é’ˆæ”¯æŒå››ç§æœºåˆ¶ï¼š<code>exec</code>ã€<code>gRPC</code>ã€<code>httpGet</code>å’Œ<code>tcpSocket</code>ã€‚<br>æ¯æ¬¡æ¢æµ‹éƒ½ä¼šå¾—åˆ°ä¸‰ç§ç»“æœä¹‹ä¸€ï¼š</p><ul><li><code>Success</code>ï¼šå®¹å™¨å“åº”æˆåŠŸçŠ¶æ€ã€‚</li><li><code>Failed</code>: å®¹å™¨å“åº”å¤±è´¥çŠ¶æ€ã€‚</li><li><code>Unknown</code>: æ¢æµ‹è¡ŒåŠ¨å¤±è´¥ï¼Œä¸é‡‡å–æªæ–½ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ¢æµ‹ã€‚</li></ul><p>Container æœ‰ä¸¤ç§æ¢é’ˆï¼š</p><ul><li><code>LivenessProbe</code>: æ¢é’ˆå¦‚æœè¿”å›<code>Failed</code>, åˆ™ Kubelet ä¼šæ€æ­»å®¹å™¨ï¼Œç„¶åæ ¹æ® restartPolicy å†³å®šæ˜¯å¦é‡å¯ã€‚</li><li><code>ReadinessProbe</code>: æ¢é’ˆå¦‚æœè¿”å›<code>Success</code>ï¼Œåˆ™ä»£è¡¨å®¹å™¨å‡†å¤‡å¥½å‘å¤–æä¾›æœåŠ¡ï¼Œå¯ä»¥æ¥å—è¯·æ±‚ï¼›å¦‚æœè¿”å›<code>Failed</code>, endpoint controller å°†ä»ä¸ Pod åŒ¹é…çš„æ‰€æœ‰ Service endpoints ä¸­åˆ é™¤è¯¥ Pod çš„ IP åœ°å€ã€‚<br>å¦‚æœå®¹å™¨ä¸æä¾›æ¢é’ˆï¼Œåˆ™é»˜è®¤ä¸€ç›´è¿”å›<code>Success</code>ã€‚</li></ul><h4 id="2-6-Pod-çš„èŠ‚ç‚¹è°ƒåº¦">2.6 Pod çš„èŠ‚ç‚¹è°ƒåº¦</h4><p>å°† Pod è°ƒåº¦éƒ¨ç½²åˆ°å“ªä¸ª Node ä¸Šï¼Œé™¤äº†å†…ç½®çš„é»˜è®¤è°ƒåº¦ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºæŒ‡å®šï¼š</p><ul><li>NodeSelecterï¼šå®šå‘è°ƒåº¦ï¼Œé€šè¿‡ <code>.template.spec.nodeSelecter</code> è®¾ç½®ï¼Œç²¾ç¡®åŒ¹é… Node labelã€‚</li><li>NodeAffinityï¼šäº²å’Œæ€§è°ƒåº¦ï¼Œé€šè¿‡ <code>.template.spec.affinity.nodeAffinity</code>è®¾ç½®ï¼Œæ¯”èµ· NodeSelecter æœ‰æ›´çµæ´»çš„è°ƒåº¦ç­–ç•¥ã€‚NodeAffinity å¯ä»¥å’Œ NodeSelecter ä¸€èµ·ä½¿ç”¨ã€‚</li><li>DaemonSet: é›†ç¾¤çš„æ¯ä¸ª Node éƒ½éœ€è¦è¿è¡ŒæŸä¸€ä»½ç›¸åŒçš„ Pod å‰¯æœ¬ï¼Œåœºæ™¯æ¯”å¦‚æ—¥å¿—é‡‡é›† Fluentd æˆ– logstashã€‚</li><li>Job: æ‰¹å¤„ç†è°ƒåº¦ã€‚</li></ul><p>NodeSelecter ç¤ºä¾‹ï¼š</p><ol><li>ä¸´æ—¶ç»™ node æ‰“ä¸Šæ ‡ç­¾</li></ol><pre class="line-numbers language-none"><code class="language-none">$ kubectl label nodes multinode-demo-m02 workload=fulltime$ kubectl label --list nodes multinode-demo-m02<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>Pod æ¨¡ç‰ˆå®šä¹‰æ—¶è®¾ç½®<code>nodeSelector</code><br><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/nodeSelector.png" alt="nodeSelector"></li></ol><h3 id="3-RCã€Deploymentã€HPA">3. RCã€Deploymentã€HPA</h3><h4 id="3-1-æ¦‚è¿°">3.1 æ¦‚è¿°</h4><p>RCï¼ˆReplication Controllerï¼‰ï¼šæ˜¯æ§åˆ¶ Pod æ°´å¹³æ‰©å±•çš„å…³é”®å…ƒä»¶ï¼Œè´Ÿè´£å¹¶ä¿è¯æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬å§‹ç»ˆè¿è¡Œå’Œå¯ç”¨ã€‚é€šè¿‡ RC Kubernetes å®ç°äº†ç”¨æˆ·åº”ç”¨é›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼ŒåŒæ—¶å¤§å¤§å‡å°‘äº†ç³»ç»Ÿç®¡ç†å‘˜åœ¨ä¼ ç»Ÿ IT ç¯å¢ƒä¸­éœ€è¦å®Œæˆçš„æ‰‹å·¥è¿ç»´å·¥ä½œã€‚<br>å®ƒèƒ½å¤Ÿè‡ªåŠ¨æ›¿æ¢é‚£äº›å¤±è´¥çš„ã€è¢«åˆ é™¤çš„æˆ–ä¸ç¬¦åˆç”¨æˆ·å®šä¹‰çŠ¶æ€çš„Podsã€‚<br>ä¸€ä¸ª RC å®šä¹‰æ–‡ä»¶ä¸­åŒ…æ‹¬3ä¸ªå…³é”®ä¿¡æ¯ï¼š</p><ul><li>Pod å®šä¹‰çš„template</li><li>å‰¯æœ¬æ•°é‡</li><li>ç›‘æ§ç›®æ ‡ Pod çš„æ ‡ç­¾é€‰æ‹©è§„åˆ™</li></ul><p>åœ¨ Kubernets 1.2 version ä¹‹å, Deployment è¢«æå‡ºï¼ŒåŒæ—¶ RC è¢«å‡çº§ä¸º RSï¼ˆReplica Setï¼‰ã€‚<br>Deployment é’ˆå¯¹ Pod æä¾›äº†æ›´é«˜çº§çš„ç®¡ç†åŠŸèƒ½ï¼Œæ¯”å¦‚å£°æ˜å¼çš„æ›´æ–°ã€å›æ»šã€ç¼©æ”¾å’Œè‡ªæˆ‘ä¿®å¤åŠŸèƒ½ï¼ŒåŒæ—¶ä½¿ç”¨ RS æ¥ç®¡ç† Pod çš„å‰¯æœ¬çº§ã€‚<br>HPAï¼ˆHorizontal Pod Autoscalerï¼‰ï¼šè‡ªåŠ¨æ ¹æ® CPU ä½¿ç”¨ç‡æˆ–å…¶ä»–æŒ‡å®šçš„åº¦é‡æŒ‡æ ‡ï¼Œè°ƒæ•´ Pod å‰¯æœ¬çš„æ•°é‡ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨è´Ÿè½½å˜åŒ–æ—¶è¿›è¡Œè‡ªåŠ¨æ‰©å±•æˆ–ç¼©å‡ã€‚ï¼ˆä½¿ç”¨ HPAå‰ï¼Œè®°å¾—è¦å¼€å¯é›†ç¾¤çš„ metrics-serverï¼‰<br><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/deployment-rs-hpa.png" alt="pod-rs-deployment-hpa"></p><h4 id="3-2-Labelï¼ˆæ ‡ç­¾ï¼‰">3.2 Labelï¼ˆæ ‡ç­¾ï¼‰</h4><p>Labels å’Œ LabelSelectors æ˜¯ Kubernetes ç”¨äºç»„ç»‡å’Œé€‰æ‹©èµ„æºçš„å…³é”®å·¥å…·ã€‚<br>Label æ˜¯é™„åŠ åˆ°  Kubernetes èµ„æºä¸Šçš„é”®/å€¼å¯¹ï¼Œå¯ä»¥ç”¨åœ¨å‡ ä¹æ‰€æœ‰çš„ Kubernetes èµ„æºä¸Šï¼Œå®ƒæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹æ³•æ¥æŒ‡å®šå¯¹è±¡çš„å±æ€§ï¼ˆkey/valueéƒ½å¯è‡ªå®šä¹‰ï¼‰ï¼Œä¸”åç»­é€šè¿‡ LabelSelectors å¯¹è¿™äº›å¯¹è±¡è¿›è¡ŒèŒƒå›´ç­›é€‰å’Œç»„ç»‡ã€‚<br>æ¯”å¦‚ï¼šRS é€šè¿‡ Label æ¥ç¡®è®¤å…¶ç®¡ç†çš„ Pod å‰¯æœ¬çš„æ•°é‡å’ŒçŠ¶æ€ï¼ŒService é€šè¿‡ Label æ¥ç¡®è®¤ä¸å“ªäº› Pod å…³è”ã€‚</p><h4 id="3-3-Pod-æ‰©å®¹å’Œç¼©å®¹">3.3 Pod æ‰©å®¹å’Œç¼©å®¹</h4><ul><li>é‡‡ç”¨æ‰‹åŠ¨æ‰©(ç¼©)å®¹ï¼Œå‘½ä»¤ï¼š</li></ul><pre class="line-numbers language-none"><code class="language-none">$ kubectl scale --replicas=1 deployment/[name]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>é‡‡ç”¨è‡ªåŠ¨æ‰©(ç¼©)å®¹ï¼Œåˆ›å»º HPAã€‚<br>HPA å®šä¹‰æ–‡ä»¶ï¼ŒåŒ…å«å…³é”®ä¿¡æ¯ï¼š<ul><li>æ‰©å®¹ç›®æ ‡ Deployment</li><li>æœ€å°å‰¯æœ¬æ•°</li><li>æœ€å¤§å‰¯æœ¬æ•°</li><li>ç›‘æ§æŒ‡æ ‡çš„ç±»å‹å’Œé˜ˆå€¼<br>HPA å¯ä»¥ç›‘æ§çš„æŒ‡æ ‡åˆ†ä¸º<code>èµ„æºæŒ‡æ ‡ï¼ˆCPU å’Œ Memoryï¼‰</code>ã€<code>è‡ªå®šä¹‰æŒ‡æ ‡ï¼ˆPods/Objectï¼‰</code>ã€<code>External æŒ‡æ ‡</code>ï¼Œä½¿ç”¨æ—¶éœ€è¦ Kubernetes é›†ç¾¤å®‰è£…äº†metrics-serverã€‚</li></ul></li></ul><p>ä¸‹é¢æ˜¯æœ€ç®€å•çš„ç›‘æ§èµ„æºæŒ‡æ ‡CPUçš„ä¾‹å­ã€‚</p><pre class="line-numbers language-none"><code class="language-none">apiVersion: autoscaling/v2kind: HorizontalPodAutoscalermetadata:  name: mss-app-hpa  namespace: u1spec:  scaleTargetRef:    apiVersion: apps/v1    kind: Deployment    name: mss-app-deployment  minReplicas: 1  maxReplicas: 3  metrics:    - type: Resource      resource:        name: cpu        target:          type: Utilization          averageUtilization: 15<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœŸæœ›å‰¯æœ¬æ•°çš„è®¡ç®—å…¬å¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">æœŸæœ›å‰¯æœ¬æ•° = ceil[å½“å‰å‰¯æœ¬æ•° * (å½“å‰æŒ‡æ ‡ / æœŸæœ›æŒ‡æ ‡)]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨å¢åŠ è´Ÿè½½å’Œåœæ­¢è´Ÿè½½åï¼Œå‰¯æœ¬æ•°é‡è‡ªåŠ¨å¢åŠ å’Œå‡å°‘ï¼š<br><img src="/2024/03/10/kubernetes-luo-ji-mo-xing-he-shi-yong-hui-gu/hpa.png" alt="hpa"></p><h4 id="3-4-æ»šåŠ¨å‡çº§">3.4 æ»šåŠ¨å‡çº§</h4><p>Deployment è®©æ»šåŠ¨å‡çº§å˜å¾—å®¹æ˜“ï¼Œä»…éœ€è¦ä¿®æ”¹ Deploymentä¸­çš„é•œåƒå³å¯ã€‚</p><ul><li>é‡‡ç”¨<code>ç›´æ¥æ‰§è¡Œå‘½ä»¤</code></li></ul><pre class="line-numbers language-none"><code class="language-none">$ kubectl set image deployment/[deployment_name] [container_name]=[image_name]:[image_version]# æŸ¥çœ‹ä¸Šçº¿çŠ¶æ€$ kubectl rollout status deployment/[deployment_name]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æˆ–è€… <code>ä¿®æ”¹ Deployment yamlæ–‡ä»¶</code>ï¼Œä¿®æ”¹<code>.spec.template.spec.containers[].image</code>åä¿å­˜ï¼Œä¼šè§¦å‘ Deployment å‘å¸ƒã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">$ kubectl edit deployment/nginx-deployment<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹ Deployment å†å²å’Œå›æ»šä¹Ÿååˆ†æ–¹ä¾¿ï¼š</p><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹List$ kubectl rollout history deployment/nginx-deployment# æŸ¥çœ‹è¯¦æƒ…$ kubectl rollout history deployment/nginx-deployment --revision=2# å›æ»šåˆ°ä¸Šä¸€ä¸ª$ kubectl rollout undo deployment/nginx-deployment# å›æ»šåˆ° revision 2 é‚£ä¸ªç‰ˆæœ¬$ kubectl rollout undo deployment/nginx-deployment --to-revision=2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-Service">4. Service</h3><p>kubernetes é›†ç¾¤é€šè¿‡åˆ›å»º Service å®šä¹‰äº†ä¸€ä¸ªæœåŠ¡çš„è®¿é—®å…¥å£åœ°å€ï¼Œé€šè¿‡è¿™ä¸ªç»Ÿä¸€çš„å…¥å£èƒ½è®¿é—®åˆ°å…¶èƒŒåçš„ä¸€ç»„ Pod å‰¯æœ¬é›†ç»„æˆçš„é›†ç¾¤å®ä¾‹ã€‚<br>Service ä¸ èƒŒåçš„ Pod å‰¯æœ¬é›†ä¹‹é—´æ˜¯é€šè¿‡ labelSelecter è¿›è¡ŒåŒ¹é…å…³è”ï¼Œå¹¶ä¸”é€»è¾‘ä¸Š Service æä¾›äº†è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ã€‚</p><p>service type æœ‰å››ç§ç±»å‹ï¼š</p><ul><li><code>ClusterIp</code>: é€šè¿‡é›†ç¾¤çš„å†…éƒ¨ IP å…¬å¼€ Serviceï¼Œé€‰æ‹©è¯¥å€¼æ—¶ Service åªèƒ½å¤Ÿåœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ã€‚ä¸è®¾ç½® type æ—¶ï¼Œé»˜è®¤æ­¤å€¼ã€‚</li><li><code>NodePort</code>: é€šè¿‡ Node IP å’Œ NodePort å…¬å¼€ Serviceã€‚Kubernetes åœ¨ Node ä¸Šä¸ºéœ€è¦å¤–éƒ¨è®¿é—®çš„ Service å¼€å¯ä¸€ä¸ªå¯¹åº”çš„ TCP ç›‘å¬ç«¯å£ï¼Œå¤–éƒ¨ç³»ç»Ÿåªéœ€è¦ Node IP + å…·ä½“çš„ NodePort å³å¯è®¿é—®æ­¤æœåŠ¡ã€‚</li><li><code>LoadBalancer</code>: ä½¿ç”¨äº‘å¹³å° æˆ– å…¶ä»–Kubernetesé›†ç¾¤å¤– çš„è´Ÿè½½å‡è¡¡å™¨å‘å¤–éƒ¨å…¬å¼€ Serviceã€‚</li><li><code>ExternalName</code>: å°† Service æ˜ å°„åˆ°ä¸€ä¸ª DNS åç§°ã€‚å¹¶ä¸”ä¸éœ€è¦è®¾ç½® selectorã€‚</li></ul><p>é™¤äº†å››ç§ç±»å‹å¤–ï¼ŒService è¿˜å¯ä»¥å®šä¹‰æˆï¼š</p><ul><li><code>No selector</code><br><code>No selecter</code>é™¤äº†å¯ä»¥ä¸<code>type=ExternalName</code>ç»“åˆç”¨æ¥æ˜ å°„å¤–éƒ¨åŸŸåä»¥å¤–ï¼Œè¿˜å¯ä»¥ä¸<code>EndpointSlice</code>ä¸€èµ·ä½¿ç”¨ï¼Œæ˜ å°„å¤–éƒ¨endpointsã€‚</li><li><code>Headless</code><br>è®¾ç½® spec.clusterIP=Noneï¼ŒService ä¸æä¾›è´Ÿè½½å‡è¡¡ï¼Œç›´æ¥è¿”å›èƒŒåçš„ pod listã€‚</li></ul><p>åœ¨ demo ç›®å½• ./k8s/service-without-labelä¸­ï¼Œç¼–å†™äº†ä¸€ä¸ª no selecter service ç¤ºä¾‹ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>EndpointSlice</code>æ¥æ˜ å°„å¤–éƒ¨ redis è¿æ¥ç«¯å£ã€‚<br><code>endpoints-external-redis.yaml</code>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">apiVersion: discovery.k8s.io/v1kind: EndpointSlicemetadata:  name: external-redis-service-endpoints  namespace: u1  labels:    kubernetes.io/service-name: external-redis-serviceaddressType: IPv4ports:  - name: ''    appProtocol: tcp    protocol: TCP    port: 6379endpoints:  - addresses:      - "192.168.65.254"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-Volume-å’Œ-Persistent-Volume">5. Volume å’Œ Persistent Volume</h3><p>å·ï¼ˆVolumeï¼‰åœ¨ Kubernetes ä¸­æ‰®æ¼”ç€å­˜å‚¨èµ„æºçš„è§’è‰²ï¼Œå®ƒå¯ä»¥è¢« Podä¸­çš„å®¹å™¨æ‰€æŒ‚è½½å’Œè®¿é—®ã€‚<br>Kubernetes Volume è·Ÿ docker Volume ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå‰è€…æœ‰å¤§é‡çš„ç±»å‹æ‰©å±•å’Œå»¶ä¼¸ã€‚<br>Kubernetes Volume åˆ† ä¸´æ—¶å·ã€æŒä¹…å·ã€configmapã€secretç­‰ã€‚</p><ul><li><code>ä¸´æ—¶å·</code>å®šä¹‰åœ¨ Pod ä¸Šï¼Œä¸ Pod çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œè¢«åŒä¸€ä¸ª Pod å†…çš„å¤šä¸ª Container å…±äº«ã€‚ä¸ Container çš„ç”Ÿå‘½å‘¨æœŸä¸ç›¸å…³ï¼Œå³ä½¿åœ¨ Container é‡å¯æœŸé—´ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚<br>å¸¸ç”¨çš„ä¸´æ—¶å·ï¼š<code>emptyDir</code>ï¼Œåœ¨ Pod åˆ†é…åˆ°èŠ‚ç‚¹æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ä¸€å—ç©ºçš„ç›®å½•ç©ºé—´ã€‚åªè¦è¯¥ Pod åœ¨æ­¤èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå®ƒå°±å­˜åœ¨ï¼›å½“ Pod ä» æ­¤èŠ‚ç‚¹ç§»é™¤ï¼ŒemptyDirä¸­çš„æ•°æ®ä¼šæ°¸ä¹…åˆ é™¤ã€‚</li><li><code>æŒä¹…å·ï¼ˆPersistent Volumeï¼‰</code> å¯ä»¥æ¯” Pod çš„å­˜æ´»æœŸé•¿ï¼Œå½“ Pod ä¸å†å­˜åœ¨ï¼ŒKubernetes ä¹Ÿä¸ä¼šé”€æ¯æŒä¹…å·ã€‚<br>PV æ˜¯ Kubernetes é›†ç¾¤ä¸­çš„ä¸€ç§ç½‘ç»œå­˜å‚¨ï¼Œæ˜¯ä¸€ç§é›†ç¾¤èµ„æºï¼Œä½†ç‹¬ç«‹äº Node ä¹‹å¤–ã€‚å¦‚æœæŸä¸ª Pod æƒ³è¦ç”³è¯· PV, éœ€è¦æ–°å®šä¹‰ä¸€ä¸ª PVCï¼ˆPersistentVolumeClaimï¼‰ï¼Œç„¶ååœ¨ Pod å®šä¹‰çš„ Volume å¼•ç”¨è¿™ä¸ª PVCã€‚</li><li><code>configmap</code>ï¼Œåº”ç”¨éƒ¨ç½²çš„ä¸€ä¸ªæœ€ä½³å®è·µæ˜¯å°†é…ç½®ä¿¡æ¯ä¸ç¨‹åºè¿›è¡Œåˆ†ç¦»ï¼Œconfigmap å°±æ˜¯ Kubernetes æä¾›çš„ä¸€ç§ç»Ÿä¸€é…ç½®ç®¡ç†æ–¹æ¡ˆã€‚</li><li><code>secret</code>ï¼Œä¸configmapç›¸ä¼¼ï¼Œä½†ç”¨æ¥å­˜æ”¾æ›´æœºå¯†çš„ä¿¡æ¯ã€ç§˜é’¥ç­‰ã€‚</li></ul><h3 id="6-Namespace">6. Namespace</h3><p>åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼ŒNamespaceï¼ˆå‘½åç©ºé—´ï¼‰æ˜¯ä¸€ç§å°†ç¾¤é›†å†…çš„èµ„æºåˆ†éš”æˆç‹¬ç«‹ç»„çš„æ–¹æ³•ã€‚å‘½åç©ºé—´æä¾›äº†ä¸€ä¸ªé€»è¾‘éš”ç¦»çš„åˆ†åŒºï¼Œä½¿å¾—å¤šä¸ªå›¢é˜Ÿæˆ–é¡¹ç›®å¯ä»¥åœ¨åŒä¸€ä¸ªç‰©ç†é›†ç¾¤ä¸Šå…±å­˜ï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚</p><p>å‘½åç©ºé—´å¯¹äº Kubernetes é›†ç¾¤çš„èµ„æºç®¡ç†å’Œè®¿é—®æ§åˆ¶æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚å®ƒä»¬å…è®¸æ‚¨ï¼š</p><ul><li>é™åˆ¶èµ„æºä½¿ç”¨ï¼šé€šè¿‡ Kubernetes çš„ Resource Quota / LimitRangerï¼Œå¯ä»¥é™åˆ¶æ¯ä¸ªå‘½åç©ºé—´å¯ä»¥ä½¿ç”¨çš„è®¡ç®—ã€å­˜å‚¨èµ„æºã€‚é¿å…ä¸€ä¸ªå›¢é˜Ÿæˆ–é¡¹ç›®æ¶ˆè€—äº†é›†ç¾¤ä¸­è¿‡å¤šçš„èµ„æºï¼Œä»è€Œå½±å“å…¶ä»–å›¢é˜Ÿã€‚</li><li>èµ„æºåç§°éš”ç¦»ï¼šåœ¨å‘½åç©ºé—´å†…ï¼Œèµ„æºçš„å‘½ååªéœ€åœ¨è¯¥ç©ºé—´å†…ä¿æŒå”¯ä¸€ï¼Œè€Œä¸å¿…æ‹…å¿ƒä¸å…¶ä»–å‘½åç©ºé—´çš„èµ„æºå‘ç”Ÿå†²çªã€‚</li><li>æ‰©å±•æƒé™ç®¡ç†å’Œè®¿é—®æ§åˆ¶ï¼šç»“åˆ Kubernetes çš„ Role-Based Access Control (RBAC)ï¼Œå¯ä»¥éå¸¸ç²¾ç»†åœ°æ§åˆ¶å“ªäº›ç”¨æˆ·æˆ–ç»„å¯ä»¥è®¿é—®ç‰¹å®šå‘½åç©ºé—´ä¸­çš„èµ„æºã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> äº‘åŸç”Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-cloud-kubernetes å¾®æœåŠ¡æ¡†æ¶ä½¿ç”¨</title>
      <link href="/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/"/>
      <url>/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/</url>
      
        <content type="html"><![CDATA[<p>è™½ç„¶æ—¶è‡³å½“ä¸‹ï¼Œå¾®æœåŠ¡æ¶æ„å·²ç»æ¨å‡ºäº†Service Meshã€Serverlessç­‰æ–¹å¼ï¼Œä½†ä½¿ç”¨ Spring cloud è¿™ç§ SDKæ¡†æ¶æ–¹å¼æ­å»ºå¾®æœåŠ¡çš„ä¼ä¸šä»ç„¶ä¼—å¤šã€‚<br>éšç€ K8S çš„æ™®åŠã€Spring cloud Netflix å¥—ç»„å®˜æ–¹æ”¾å¼ƒç»´æŠ¤ï¼ŒSpring cloud æ¨å‡ºäº†ä¸€äº›å¹³æ›¿ç”¨äºè¿ç§»å’Œå‡çº§ã€‚<br>æœåŠ¡æ³¨å†Œï¼š<code>Eureka</code> -&gt; k8s<br>æœåŠ¡å‘ç°ï¼š<code>Eureka client</code> -&gt; <code>spring-cloud-kubernetes</code><br>æ–­è·¯å™¨ä¸å®¹é”™: <code>hystrix</code> -&gt; <code>resilience4j</code><br>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡: <code>ribbon</code> -&gt; <code>spring-cloud-starter-loadbalancer</code><br>REST API client: <code>spring-cloud-starter-openfeign</code><br>é…ç½®ä¸­å¿ƒï¼š<code>spring cloud config</code> -&gt; k8s configmap + <code>spring-cloud-kubernetes</code></p><p><a href="https://github.com/open-ending/demo-spring-cloud-kubernetes">demo ä»£ç åº“</a>æ„å»ºäº†<code>inventory-service</code>å’Œ<code>order-service</code>ä¸¤ä¸ªå­æœåŠ¡ï¼Œorder-service ä¼šè¿œç¨‹è°ƒç”¨ inventory-serviceã€‚<br>åœ¨ä»£ç åº“æ ¹ç›®å½•ä¸­è¿è¡Œ<code>skaffold run</code>å‘½ä»¤ï¼Œå³å¯è‡ªåŠ¨æ‰“åŒ…ä¸¤ä¸ªimageså¹¶éƒ¨ç½²åˆ°æœ¬åœ° Kubernetes ä¸Šã€‚<br>ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°å„å­ç›®å½•ä¸­ï¼ŒåŒæ ·è¿è¡Œ<code>skaffold run</code>å•ç‹¬æ‰“åŒ…å’Œéƒ¨ç½²ã€‚<br>è¿è¡Œé¢„å®‰è£…è¦æ±‚ï¼š</p><ul><li>docker</li><li>minikuberï¼ˆæˆ–è€…åƒ macOSä¸Šçš„docker desktop for kubernetesï¼‰</li><li>Skaffold</li></ul><h3 id="1-REST-API-calls">1. REST API calls</h3><p>OpenFeign ä½œä¸ºä¸€ä¸ªå£°æ˜å¼çš„ HTTP API client lib, ä¹¦å†™æ–¹ä¾¿ï¼Œéå¸¸å¥½ç”¨ã€‚<br>ä»£ç åº“ä¸­ç”± inventory-service æä¾›è¢«è°ƒç”¨çš„ APIï¼Œorder-service å¼•ç”¨å’Œé…ç½®OpenFeignã€‚</p><h3 id="2-æœåŠ¡æ³¨å†Œä¸å‘ç°">2. æœåŠ¡æ³¨å†Œä¸å‘ç°</h3><p><code>æœåŠ¡æ³¨å†Œ</code>ï¼šéšç€ k8s çš„ä½¿ç”¨ï¼Œk8s pods ä¼šä¸ŠæŠ¥å’Œæ³¨å†Œåˆ° k8s API server ä¸­ï¼Œå› æ­¤é€æ¸æ›¿ä»£äº†ä¼ ç»ŸæœåŠ¡æ³¨å†Œï¼Œä¸å†éœ€è¦åº”ç”¨ä»£ç å¤„ç†ã€‚<br><code>æœåŠ¡å‘ç°</code>ï¼šå¦‚æœæ˜¯ç®€å•çš„æœåŠ¡è°ƒç”¨ï¼Œk8s é€šè¿‡å®‰è£… DNS å°† service name ä¸ Cluster IP è¿›è¡Œç»‘å®šï¼Œå®¢æˆ·ç«¯å¯ç›´æ¥ä½¿ç”¨ service name ä½œä¸º host è¿›è¡Œè°ƒç”¨ã€‚ä½†ä¸ºä½•è¿˜éœ€è¦ä½¿ç”¨<code>spring-cloud-kubernetes</code>å‘¢ï¼Ÿ</p><p><code>spring-cloud-kubernetes</code>æä¾›äº†è·å– k8s API server ä¸Š k8s service èƒŒåçš„ pods list çš„åŠæ³• â€”â€” æ˜¯ä½¿ç”¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä»¥åŠfailed retryçš„å‰æã€‚</p><h4 id="2-1-å¼•å…¥ä¾èµ–">2.1 å¼•å…¥ä¾èµ–</h4><p>order-service çš„ build.gradle æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">dependencies {    implementation 'org.springframework.cloud:spring-cloud-starter-kubernetes-fabric8'    implementation 'org.springframework.boot:spring-boot-starter-actuator'    â€¦â€¦}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ç›´æ¥å¼•å…¥ all åŒ…ï¼Œå…¶ä¸­åŒ…æ‹¬äº† DiscoveryClient åŒ… å’Œ config åŒ…ã€‚<br><em>fabric8ç”Ÿæ€è™½ç„¶å·²ç»è¿‡æ—¶ï¼Œä½† spring-cloud-starter-kubernetes-fabric8 ä¾ç„¶æœ‰ç»´æŠ¤ï¼Œå¹¶ä¸”æ¯” spring-cloud-starter-kubernetes-client æ›´æ˜“ä½¿ç”¨ã€‚å› æ­¤è¿™é‡Œä½¿ç”¨äº†kubernetes-fabric8 åŒ…ã€‚</em></p><h4 id="2-2-å¼€å¯é…ç½®">2.2 å¼€å¯é…ç½®</h4><p>åœ¨ Java main application Class ä¸ŠåŠ ä¸Š annotation <code>@EnableDiscoveryClient</code>ã€‚</p><pre class="line-numbers language-none"><code class="language-none">@EnableFeignClients@SpringBootApplication@EnableDiscoveryClientpublic class Application {    public static void main(String[] args) {        SpringApplication application = new SpringApplication(Application.class);        application.run(args);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ application.yml ä¸­ å£°æ˜è·å–çš„ k8s namespacesèŒƒå›´:</p><pre class="line-numbers language-none"><code class="language-none">spring:  cloud:    kubernetes:      discovery:        all-namespaces: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-3-deployment-ä¸­é…ç½®-service-account-æƒé™">2.3 deployment ä¸­é…ç½® service account æƒé™</h4><p>é¡¹ç›®æ ¹è·¯å¾„ä¸‹çš„ k8s ç›®å½•<code>privileges.yaml</code>æ–‡ä»¶å®šä¹‰äº† service accountï¼Œå¹¶ä¸”åœ¨ <code>order-service/k8s/deployment.yaml</code> ä¸­è¿›è¡Œå¼•ç”¨ã€‚<br><img src="/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/k8s-order-deployment.png" alt="order-deployment-config"></p><h4 id="2-4-skaffoldå¼€å‘æ¨¡å¼">2.4 skaffoldå¼€å‘æ¨¡å¼</h4><p>skaffoldæ”¯æŒå¼€å‘æ¨¡å¼ï¼Œä½¿ç”¨å‘½ä»¤:</p><pre class="line-numbers language-none"><code class="language-none">skaffold dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ—¶ï¼Œskaffold ä¼šä½¿ç”¨å‰å°ç»ˆç«¯å‘½ä»¤è¡Œçª—å£æ„å»º image å’Œéƒ¨ç½² k8sï¼Œæ˜¾ç¤º spring console æ§åˆ¶å°ä¿¡æ¯ï¼Œå¹¶ä¸” watch æºä»£ç æ–‡ä»¶çš„å˜æ›´è¿›è¡Œçƒ­åŠ è½½ã€‚<br>æ­£å¸¸å¯åŠ¨åï¼Œè®¿é—®<code>/actuator/health</code>, å¯ä»¥æŸ¥çœ‹åˆ°æœåŠ¡å‘ç°å’Œ k8s podä¿¡æ¯ï¼š<br><img src="/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/order-service-k8s-discovery.png" alt="health endpoint"></p><h3 id="3-å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡">3. å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</h3><p>æœ‰äº†ä¸Šé¢æœåŠ¡å‘ç°è·å–çš„ pods listï¼Œå³å¯ä¾›å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä½¿ç”¨ã€‚</p><h4 id="3-1-å¼•å…¥ä¾èµ–">3.1 å¼•å…¥ä¾èµ–</h4><p>åœ¨ order-service çš„ build.gradle ä¸­å¼•å…¥ä¾èµ–ï¼š</p><pre class="line-numbers language-none"><code class="language-none">dependencies {    implementation 'org.springframework.cloud:spring-cloud-starter-loadbalancer'    â€¦â€¦}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-2-åˆ‡æ¢è´Ÿè½½å‡è¡¡å®ç°">3.2 åˆ‡æ¢è´Ÿè½½å‡è¡¡å®ç°</h4><p><code>spring-cloud-starter-openfeign</code>é»˜è®¤å¼€å¯çš„æ˜¯Ribbonè´Ÿè½½å‡è¡¡ï¼Œæƒ³è¦ç”Ÿæ•ˆ spring-cloud-starter-loadbalancerï¼Œå¿…é¡»åœ¨ order-service çš„ application.yml ä¸­é…ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">spring:  cloud:    loadbalancer:      ribbon:        enabled: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-é™åˆ¶-inventory-service-k8s-serviceè´Ÿè½½å‡è¡¡ç­–ç•¥">3.3 é™åˆ¶ inventory-service k8s serviceè´Ÿè½½å‡è¡¡ç­–ç•¥</h4><p>ä¸ºäº†èƒ½æ˜ç¡®è¡¨ç°å‡ºå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„æ•ˆæœï¼Œè¿™é‡Œç‰¹åˆ«å°† k8s inventory-service é…ç½®æˆ <code>sessionAffinity</code> â€”â€” å¦‚æœé€šè¿‡ k8s service è®¿é—® APIï¼Œæ¥è‡ªç›¸åŒclient IP çš„è¯·æ±‚åªä¼šè¿›å…¥åŒä¸€ä¸ªpodã€‚<br>è¿™é‡Œ service é€šè¿‡è®¾ç½®æˆ<code>sessionAffinity</code>, ä¸»åŠ¨å±è”½ k8s service çš„è´Ÿè½½å‡è¡¡çš„è½®è¯¢ç­–ç•¥ï¼Œç„¶åè¯·æ±‚é€šè¿‡<code>spring-cloud-starter-loadbalancer</code>çš„è´Ÿè½½å‡è¡¡èƒ½åŠ› â€”â€” è°ƒç”¨åˆ°ä¸åŒ podã€‚</p><p><img src="/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/k8s-inventory-service.png" alt="k8s-inventory-service"></p><h4 id="3-4-è¿è¡Œå’ŒéªŒè¯">3.4 è¿è¡Œå’ŒéªŒè¯</h4><p>é¡¹ç›®æ ¹è·¯å¾„ä¸‹<code>skaffold dev</code>ï¼Œè°ƒç”¨ order-service çš„APIï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ curl http://localhost:31002/orders --header 'Content-Type: application/json' --data '{"productId": "123"}'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ—¶å€™ï¼Œçœ‹ inventory-service æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ¥è‡ªä¸åŒinventory-serviceçš„è¢«è°ƒç”¨æ—¥å¿—ï¼š<br><img src="/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/order-service-loadbalance.png" alt="loadbalance"></p><h3 id="4-æ–­è·¯å™¨ä¸å®¹é”™">4. æ–­è·¯å™¨ä¸å®¹é”™</h3><h4 id="4-1-å¼•å…¥ä¾èµ–">4.1 å¼•å…¥ä¾èµ–</h4><pre class="line-numbers language-none"><code class="language-none">dependencies {    implementation 'io.github.resilience4j:resilience4j-spring-boot2'    implementation 'org.springframework.boot:spring-boot-starter-actuator'    â€¦â€¦}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ˜¯ç›´æ¥å¼•ç”¨çš„<code>resilience4j-spring-boot2</code>, è€Œä¸æ˜¯<code>spring-cloud-starter-circuitbreaker</code>ã€‚<br>å› ä¸º spring å®˜æ–¹æä¾›å°è£…çš„åº“ spring-cloud-starter-circuitbreaker-resilience4j æ–‡æ¡£å’Œä»£ç æ•°é‡ä¸å¤šï¼Œæ¨èä½¿ç”¨ resilience4j æä¾›çš„åº“ã€‚</p><h4 id="4-2-è¿›è¡Œé…ç½®">4.2 è¿›è¡Œé…ç½®</h4><p>resilience4j æœ¬èº«åŒ…å«åŠŸèƒ½ï¼š<code>CircuitBreaker</code>ã€<code>Fallback</code>ã€<code>Bulkhead</code>ã€<code>Ratelimiter</code>ã€<code>Timelimiter</code>ã€<code>Retry</code>ã€<code>Cache</code>ã€‚<br>ä½†é’ˆå¯¹OpenFeignçš„æ”¯æŒç›®å‰ä»…æœ‰ï¼šCircuitBreakerã€Fallbackã€Ratelimiter å’Œ Retryã€‚<br>Bulkhead ä¸ç›´æ¥å…¼å®¹OpenFeignï¼Œéœ€è¦é¢å¤–çš„ä»£ç å¤„ç†ã€‚<br><a href="https://resilience4j.readme.io/docs/getting-started-3">å®˜æ–¹é…ç½®å‚æ•°è¯´æ˜è§</a></p><p>ä»¥ circuitbreaker å’Œ retry ä¸¾ä¾‹ï¼Œapplication.ymlä¸­é…ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">resilience4j.circuitbreaker:  configs:    default:      registerHealthIndicator: true      slidingWindowType: COUNT_BASED      slidingWindowSize: 30      minimumNumberOfCalls: 5      permittedNumberOfCallsInHalfOpenState: 5      automaticTransitionFromOpenToHalfOpenEnabled: true      waitDurationInOpenState: 15s      failureRateThreshold: 30      eventConsumerBufferSize: 10  instances:    storage:      baseConfig: defaultresilience4j.retry:  configs:    default:      maxAttempts: 2      waitDuration: 100# actuator configmanagement:  health:    circuitbreakers:      enabled: true    diskspace:      enabled: false  endpoint:    health:      show-details: always    metrics:      enable: true  endpoints:    web:      exposure:        include: health,metrics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¸ hystrix æœºåˆ¶ä¸€æ ·ï¼Œresilience4 ç†”æ–­å™¨åˆ†5ç§çŠ¶æ€ï¼šå¼€å¯ï¼ˆOPENï¼‰ã€å…³é—­ï¼ˆCLOSEï¼‰ã€åŠå¼€ï¼ˆHALF_OPENï¼‰ï¼Œä»¥åŠ ç¦ç”¨ï¼ˆDISABLEDï¼‰å’Œå¼ºå¼€ï¼ˆFORCED_OPENï¼‰ã€‚<br>åˆ¤æ–­ç†”æ–­å™¨æ˜¯å¦å¼€å¯ï¼Œæœ‰ä¸¤ç§æ»‘åŠ¨çª—å£è¿›è¡Œæ±‡èšè®¡ç®—çš„æ–¹å¼ï¼š<code>COUNT_BASED</code>å’Œ<code>TIME_BASED</code>, å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œè®¡ç®—è§„åˆ™å’Œé˜ˆå€¼è®¾ç½®ã€‚<br>å½“ç†”æ–­å™¨å¼€å¯ï¼Œå¤šé•¿æ—¶é—´åå¼€å§‹åŠå¼€å°è¯• <code>waitDurationInOpenState</code>ã€å¦‚ä½•åœ¨åŠå¼€æœŸé—´åˆ¤æ–­ç†”æ–­å¯å…³é—­ç­‰ç­‰ï¼Œéƒ½å¯é€šè¿‡ application.yml è¿›è¡Œå‚æ•°å®šåˆ¶ã€‚</li><li>å¼€å¯ actuator endpoints, å°†ç†”æ–­å™¨çŠ¶æ€æ·»åŠ å…¥ /health æ˜¾ç¤ºã€‚</li></ul><h4 id="4-3-instance-naming-annotation">4.3 instance naming annotation</h4><p>åœ¨ feignClient ä¸Šä½¿ç”¨ annotation å‘½åinstanceã€‚<br><img src="/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/resilience4j-spring-boot2.png" alt="resilience4j-spring-boot2 config"><br>resilience4j çš„ annotation æ”¯æŒæ ‡æ³¨åœ¨ class/method ä¸¤ç§levelã€‚</p><h4 id="4-4-å¯åŠ¨å®¹å™¨å’Œè®¿é—®health-metrics-endpoints">4.4 å¯åŠ¨å®¹å™¨å’Œè®¿é—®health/metrics endpoints</h4><p>ä½¿ç”¨<code>skaffold dev</code>æ„å»ºéƒ¨ç½²ï¼Œè®¿é—®<code>/actuator/health</code>ç¡®è®¤ç†”æ–­å™¨çŠ¶æ€ï¼š<br><img src="/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/order-service-circuitbreak-health.png" alt="health-circuitbreak"></p><p>demo çš„ inventory-service æ·»åŠ äº†random exceptionï¼Œç”¨ä»¥æ”¯æŒç®€å•çš„ API failedæ•ˆæœã€‚<br>è°ƒç”¨ demo çš„ API <code>http://localhost:31002/orders</code>, ç„¶åå¯è§‚å¯Ÿ<code>/actuator/health</code>é‡Œç†”æ–­å™¨çš„æ•°æ®å˜åŒ–ã€‚</p><h3 id="5-é…ç½®ç®¡ç†">5. é…ç½®ç®¡ç†</h3><p>demo order-service é»˜è®¤çš„ application.yml ä¸­ï¼Œå¹¶ä¸ä¼šå¼€å¯ web loggingã€‚<br>è¿™é‡Œä¼šé€šè¿‡ spring-cloud-kubernetes å°† configmap ç®¡ç†çš„é…ç½®è¯»å–åˆ° spring åŠ è½½ä¸­ï¼Œç”¨ä»¥å¼€å¯ web loggingã€‚</p><h4 id="5-1-å®šä¹‰configmap">5.1 å®šä¹‰configmap</h4><p>ä½¿ç”¨ order-service/k8s/configmap.yaml å®šä¹‰configmapï¼š<br><img src="/2024/03/09/spring-cloud-kubernetes-wei-fu-wu-kuang-jia-shi-yong/k8s-order-configmap.png" alt="config"><br>æ³¨æ„ï¼š<code>metadata.name</code> å¿…é¡»ä¸spring profile ä¸­çš„ <code>spring.application.name</code>çš„å€¼ä¿æŒä¸€è‡´ã€‚<br>åœ¨ order-service/k8s/deployment.yaml æ–‡ä»¶ä¸­å¹²å¹²å‡€å‡€ â€”â€” ä¸éœ€è¦å¼•ç”¨configmapã€‚</p><h4 id="5-2-å¼•å…¥ä¾èµ–">5.2 å¼•å…¥ä¾èµ–</h4><pre class="line-numbers language-none"><code class="language-none">dependencies {    implementation 'org.springframework.cloud:spring-cloud-starter-kubernetes-fabric8-config'    â€¦â€¦}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…ç›´æ¥å¼•å…¥ fabric8-all åŒ…ã€‚</p><h4 id="5-3-å¯åŠ¨å®¹å™¨å’ŒéªŒè¯">5.3 å¯åŠ¨å®¹å™¨å’ŒéªŒè¯</h4><p>ä½¿ç”¨<code>skaffold dev</code>è¿è¡Œç¨‹åºï¼Œè°ƒç”¨APIï¼ŒéªŒè¯æ§åˆ¶å°æ˜¯å¦æ‰“å°äº†web http logå³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Cloud </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macOSå®‰è£…sonarqube</title>
      <link href="/2023/12/14/macos-an-zhuang-sonarqube/"/>
      <url>/2023/12/14/macos-an-zhuang-sonarqube/</url>
      
        <content type="html"><![CDATA[<h3 id="1-ç¯å¢ƒå‡†å¤‡">1. ç¯å¢ƒå‡†å¤‡</h3><p>æå‰é¢„å®‰è£…å¥½ docker å’Œ postgresql æ•°æ®åº“ã€‚<br>sonarqube é™¤äº†postgresqlæ•°æ®åº“ä»¥å¤–ï¼Œåªæä¾›å¯¹SQLserverå’Œoracleæ•°æ®ä¸¤ç§é€‰æ‹©ã€‚</p><p>postgresql å®‰è£…å¥½ä»¥åï¼Œä½¿ç”¨å‘½ä»¤ï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ createuser -s postgres$ psql -U postgres&gt; CREATE DATABASE sonarqube;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-ä½¿ç”¨-docker-images-è¿›è¡Œå®‰è£…">2. ä½¿ç”¨ docker images è¿›è¡Œå®‰è£…</h3><h4 id="2-1-create-volumes">2.1 create volumes</h4><pre class="line-numbers language-none"><code class="language-none">$ docker volume create --name sonarqube_data$ docker volume create --name sonarqube_logs$ docker volume create --name sonarqube_extensions<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2-2-docker-run">2.2 docker run</h4><p>æ³¨æ„ï¼šsonarqube åªæœ‰community editionæ˜¯å…è´¹çš„ã€‚</p><pre class="line-numbers language-none"><code class="language-none">docker run -d --name sonarqube \    -p 9000:9000 \    -e SONAR_JDBC_URL=jdbc:postgresql://host.docker.internal:5432/postgres \    -e SONAR_JDBC_USERNAME=postgres \    -e SONAR_JDBC_PASSWORD=... \    -v sonarqube_data:/opt/sonarqube/data \    -v sonarqube_extensions:/opt/sonarqube/extensions \    -v sonarqube_logs:/opt/sonarqube/logs \    sonarqube:lts-community<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-è®¿é—®æœ¬åœ°å®‰è£…å¥½çš„-sonarqube">3. è®¿é—®æœ¬åœ°å®‰è£…å¥½çš„ sonarqube</h3><p>æœ¬åœ°åœ°å€ <a href="http://localhost:9000">http://localhost:9000</a><br>é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š admin/admin</p><h4 id="3-1-åˆ›å»ºproject">3.1 åˆ›å»ºproject</h4><p>ç™»å½•è®¿é—® sonarqueï¼Œç‚¹å‡»èœå•ã€projectsã€‘ï¼Œåˆ›å»ºprojectã€‚<br><img src="/2023/12/14/macos-an-zhuang-sonarqube/create_projects.png" alt="create projects"><br>ä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹åŠ¨åˆ›å»º<br><img src="/2023/12/14/macos-an-zhuang-sonarqube/manual_create_project.png" alt="manual create project"></p><h4 id="3-2-å¯ä»¥ä½¿ç”¨intellij-ideaå®‰è£…sonarlintæ’ä»¶ï¼š">3.2 å¯ä»¥ä½¿ç”¨intellij ideaå®‰è£…sonarlintæ’ä»¶ï¼š</h4><p><img src="/2023/12/14/macos-an-zhuang-sonarqube/sonarlint_configuration.png" alt="sonarlint configuration"><br>é…ç½®å¥½åï¼Œç‚¹å‡»ã€Update local storageã€‘æŒ‰é’®ï¼Œä¸‹è½½å¹¶ä½¿ç”¨sonarqubeä¸Šå®šä¹‰çš„é…ç½®å’Œè§„åˆ™ã€‚<br>è¿™æ ·å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œidea å¯ä»¥å®æ—¶åé¦ˆä»£ç ç¼–å†™é—®é¢˜ã€‚</p><h4 id="3-3-gradle-sonar-plugin">3.3 gradle sonar plugin</h4><p>åœ¨ gradle buildæ–‡ä»¶ä¸­ï¼Œplugins æ·»åŠ  sonarã€‚<br>legacy å†™æ³•:</p><pre class="line-numbers language-none"><code class="language-none">buildscript {    repositories {        mavenCentral()        maven { url 'https://plugins.gradle.org/m2/' }    }    dependencies {        classpath 'org.sonarsource.scanner.gradle:sonarqube-gradle-plugin:3.5.0.2730'    }}apply plugin: 'java'apply plugin: 'org.sonarqube'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨ CI çš„è„šæœ¬ä¸Šæ·»åŠ å‘½ä»¤ï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ ./gradlew :web:sonar \    -Dsonar.projectKey=... \    -Dsonar.host.url=http://localhost:9000 \    -Dsonar.login=&lt;sonar_token&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åå°±å¯ä»¥åœ¨</p><h3 id="é™„å½•ï¼š">é™„å½•ï¼š</h3><p><a href="https://docs.sonarsource.com/sonarqube/9.9/setup-and-upgrade/install-the-server/#installing-sonarqube-from-the-docker-image">sonarsource docs</a></p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DevOps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€åŠ³æ°¸é€¸ NGINX åå‘ä»£ç†è½¬å‘é…ç½®</title>
      <link href="/2023/11/21/yi-lao-yong-yi-nginx-fan-xiang-dai-li-zhuan-fa-pei-zhi/"/>
      <url>/2023/11/21/yi-lao-yong-yi-nginx-fan-xiang-dai-li-zhuan-fa-pei-zhi/</url>
      
        <content type="html"><![CDATA[<p>å½“é¡¹ç›®ç¯å¢ƒ setup æ—¶ï¼Œé’ˆå¯¹ä¸åŒçš„æŠ€æœ¯é€‰å‹ï¼Œä¸€äº›æ—¶å€™éœ€è¦è‡ªå·±ä½¿ç”¨ NGINX é…ç½®åå‘ä»£ç†ã€‚<br>æ¯å½“è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘æ€»æ˜¯è®°ä¸ä½ location å’Œ proxy_pass ä¸­è·¯å¾„å¸¦ <code>/</code> å’Œä¸å¸¦ <code>/</code> çš„å¯¹åº”å…³ç³»ã€é…ç½®é”™è¯¯è¿˜ä¼šå¸¦æ¥é‡å®šå‘ post å˜ get çš„é—®é¢˜ç­‰ç­‰ï¼Œå› æ­¤æ¯æ¯é…ç½®éƒ½éœ€è¦æŸ¥é˜…æ–‡æ¡£ï¼Œåå¤éªŒè¯å’Œæµ‹è¯•ã€‚<br>è€Œæœ€è¿‘æ‰¾åˆ°ä¸€ç§å†™æ³•ï¼Œå¯ä»¥å½»åº•æ”¾å¼ƒä¹‹å‰çš„é…ç½®å›°æ‰° â€”â€” å…¶è§£å†³æ€è·¯å¯ä»¥ç±»æ¯” è¡¨è¾¾å¼ä¸­çš„æ‹¬å·<code>()</code>, å½“è®°ä¸ä½æˆ–è€…ä¸ç¡®å®šæ“ä½œç¬¦ä¹‹é—´çš„ä¼˜å…ˆçº§æ—¶ï¼Œå»ºè®®æ·»åŠ <code>()</code>ï¼Œå³<code>å°†éšå¼è½¬æˆæ˜¾å¼å£°æ˜</code>  â€”â€” é¿å…ä¼˜å…ˆçº§ä¸æ˜ç¡®çš„åŒæ—¶ï¼Œä¹Ÿå¢åŠ äº†ä»£ç çš„å¯è¯»æ€§ã€‚</p><p>ä¸‹é¢å°±æ˜¯ä¸ªäººå»ºè®®çš„ Nginx é…ç½®æ–¹å¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">http {â€¦â€¦    resolver 8.8.8.8;    server {        â€¦â€¦        location ~* ^/api/(players|usage)(.*)$ {            proxy_pass https://example.com/api/$1$2$is_args$args;            proxy_buffering off;            proxy_set_header  X-Forwarded-For $remote_addr;        }        location ~* ^/api/(wx\-tokens|orders)(.*)$ {            proxy_pass https://example.com/api/$1$2$is_args$args;            proxy_buffering off;            proxy_set_header  X-Forwarded-For $remote_addr;        }    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Š</p><ul><li>ä½¿ç”¨æ­£åˆ™ <code>~* ^$</code> åŒ¹é…åŸå§‹çš„æ•´ä¸ªè¯·æ±‚è·¯å¾„</li><li>proxy_pass è·¯å¾„å¸¦ä¸Šæ•´ä¸ªæ­£åˆ™åŒ¹é…çš„å­ç»„ï¼Œ<code>$1$2</code>æ˜ç¡®æ•´ä¸ªURIçš„éƒ¨åˆ†ï¼Œ<code>$is_args$args</code>æ˜ç¡®queryStringéƒ¨åˆ†ï¼ˆè¿™éƒ¨åˆ†ä¸åœ¨location regexçš„åŒ¹é…èŒƒå›´å†…ï¼‰</li><li><code>proxy_buffering off</code> ä¸ºäº†ä½¿ç”¨ chunked æ–¹å¼é€ä¼ ï¼Œéœ€è¦å…³é—­ proxy_buffering</li><li>æ·»åŠ <code>resovler 8.8.8.8;</code>, è§£å†³ä¸€äº›ç‰ˆæœ¬ NGINX æŠ¥é”™<code>no resolver defined to resolve example.com</code>çš„é—®é¢˜</li></ul>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DevOps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®šæ—¶è‡ªåŠ¨åˆ é™¤ACR images</title>
      <link href="/2023/11/17/ding-shi-zi-dong-shan-chu-acr-images/"/>
      <url>/2023/11/17/ding-shi-zi-dong-shan-chu-acr-images/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä¹‹å‰ Azure App Service éƒ¨ç½²æ—¶ï¼Œä½¿ç”¨åˆ°äº† Azure Container Registerï¼Œå¯¹äºè®¸å¤šé¡¹ç›®è€Œè¨€ï¼Œè¶…è¿‡ä¸€å®šæ—¶é™çš„å†å² images å†æ¬¡ä½¿ç”¨çš„å‡ ç‡è¿‘ä¹ä¸ºé›¶ã€‚<br>å› æ­¤ï¼Œæ— è®ºä»åˆ¶å“ç®¡ç†ï¼Œè¿˜æ˜¯å­˜å‚¨æˆæœ¬ï¼Œå®šæœŸæ¸…é™¤ä¸ä½¿ç”¨çš„ imagesæ˜¯ä¸€é¡¹å¸¸è§çš„ä»»åŠ¡ã€‚<br>å¯ä»¥ä½¿ç”¨ Azure æä¾›çš„å·¥å…· acr purge å’Œ acr task æ¥è¾¾æˆè¯¥ç›®æ ‡ã€‚</p><h4 id="1-å‘½ä»¤åˆ›å»ºå®šæ—¶-ACR-task">1. å‘½ä»¤åˆ›å»ºå®šæ—¶ ACR task</h4><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä½¿ç”¨Azure cli æˆ–è€… Azure cloud shellçš†å¯ï¼‰ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ PURGE_CMD="acr purge --filter '.*:.*' --ago 14d --untagged"$ az acr task create --name purgeTask \    --cmd "$PURGE_CMD" \    --schedule "0 1 * * *" \    --registry &lt;register-name&gt; \    --context /dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-æŸ¥çœ‹-task-runs">2. æŸ¥çœ‹ task runs</h4><p>å‘½ä»¤ï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ az acr task list-runs --name purgeTask --registry &lt;register-name&gt; --output table<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-ä¹Ÿå¯ä»¥å•æ¬¡æ‰‹åŠ¨è§¦å‘-ACR-purge">3. ä¹Ÿå¯ä»¥å•æ¬¡æ‰‹åŠ¨è§¦å‘ ACR purge</h4><pre class="line-numbers language-none"><code class="language-none">$ PURGE_CMD="acr purge --filter '.*:.*' --ago 14d --untagged"$ az acr run --cmd "$PURGE_CMD" --registry &lt;register-name&gt; /dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="ç›¸å…³é“¾æ¥">ç›¸å…³é“¾æ¥</h4><ul><li><a href="https://learn.microsoft.com/zh-cn/azure/container-registry/container-registry-tasks-scheduled">æ•™ç¨‹ï¼šæŒ‰å®šä¹‰çš„è®¡åˆ’è¿è¡Œ ACR ä»»åŠ¡</a></li><li><a href="https://learn.microsoft.com/zh-cn/azure/container-registry/container-registry-auto-purge">è‡ªåŠ¨æ¸…é™¤ Azure å®¹å™¨æ³¨å†Œè¡¨ä¸­çš„æ˜ åƒ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Azure </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> äº‘å¹³å° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ Python æŠ€æœ¯æ ˆä¸‹åš DB Migration â€”â€” Alembicï¼ˆFlask Migrationï¼‰</title>
      <link href="/2023/11/12/zai-python-ji-zhu-zhan-xia-zuo-db-migration-alembic-flask-migration/"/>
      <url>/2023/11/12/zai-python-ji-zhu-zhan-xia-zuo-db-migration-alembic-flask-migration/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Java æŠ€æœ¯æ ˆå¸¸ç”¨çš„ DB Migration å·¥å…·æœ‰ Flywayã€Liquibaseï¼Œå¯ä»¥å¿«é€Ÿé›†æˆåœ¨Spring bootä¸­è¿è¡Œã€‚<br>é‚£åœ¨ Python æŠ€æœ¯æ ˆä¸­ï¼Œç›¸ä¼¼åŠŸèƒ½çš„å·¥å…·æœ‰ä¹ˆï¼Ÿè‡ªç„¶æ˜¯æœ‰çš„ã€‚<br>æœ‰äººç¼–å†™äº† pyliquibaseï¼Œæƒ³è¦å°† liquibase åœ¨ Pythonä¸­è¿ç”¨ï¼Œå¯æƒœåœ¨ githubä¸Šåªæœ‰30ä¸ªstarã€‚<br>æˆ‘è¿™é‡Œæ¯”è¾ƒæ¨èçš„æ˜¯ <a href="https://alembic.sqlalchemy.org/en/latest/">Alembic</a>ï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªåŸºäº SQLAlchemyï¼ˆPythonä¸‹çš„ORMåº“ï¼Œç±»æ¯”Javaé‡Œçš„ JPA/Hibernateï¼‰çš„è½»é‡çº§çš„DB Migrationå·¥å…·ï¼Œå¹¶ä¸”ä¸ Flask æœ‰ç°æˆçš„é›†æˆå·¥å…·åŒ… â€”â€” Flask Migrationã€‚</p><p>å½“ç„¶ï¼Œå®ƒæœ€æ‰“åŠ¨æˆ‘çš„åŠŸèƒ½ â€”â€” æ˜¯å¯ä»¥ä» ORM çš„ Model class è‡ªåŠ¨å¯¹æ¯” DB ç°æœ‰ç»“æ„ï¼Œé’ˆå¯¹å·®å¼‚ç”Ÿæˆ migration è„šæœ¬æ–‡ä»¶å¹¶ä¸”ç‰ˆæœ¬ç®¡ç†ã€‚<br>è¿™åœ¨ Groovy/Grails æ—¶ä»£æ˜¯éå¸¸å¸¸è§çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨ Java çš„ DB Migration å·¥å…·ä¸­å´å¹¶ä¸å¸¸è§ã€‚</p><p>ä»¥ä¸‹ï¼Œæ˜¯æˆ‘åœ¨ Flask + Flask-SQLAlchemy ä¸­ç›´æ¥ä½¿ç”¨ Flask-Migration çš„è¿‡ç¨‹ã€‚</p><h4 id="1-å®‰è£…-Flask-Migration">1. å®‰è£… Flask-Migration</h4><pre class="line-numbers language-none"><code class="language-none">$ pipenv install Flask-Migrate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-Flask-åº”ç”¨å¯åŠ¨é¡¹æ·»åŠ -Migration">2. Flask åº”ç”¨å¯åŠ¨é¡¹æ·»åŠ  Migration</h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ™®é€šçš„Flask + Flask-SQLAlchemy çš„åº”ç”¨å¯åŠ¨é¡¹ Demo ä»£ç ï¼Œä½¿ç”¨ Flask-Migration ä»…éœ€è¦æ·»åŠ ç¬¬3è¡Œã€8è¡Œå³å¯ â€”â€” Flask-Migration å¯ä»¥è¯»å–åˆ° SQLAlchemy å’Œ DB çš„é…ç½®ä¿¡æ¯ã€‚</p><pre class="line-numbers language-none"><code class="language-none">from flask import Flaskfrom flask_sqlalchemy import SQLAlchemyfrom flask_migrate import Migrate #ä¸ºä½¿ç”¨flask-migrateæ·»åŠ app = Flask(__name__)app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///app.db'db = SQLAlchemy(app) #ä¸ºä½¿ç”¨flask-migrateæ·»åŠ class User(db.Model):    id = db.Column(db.Integer, primary_key=True)    name = db.Column(db.String(128))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-åˆå§‹åŒ–-DB-Migration-çš„ç›®å½•æ–‡ä»¶ç»“æ„ï¼ˆAlembicçš„ç›®å½•æ–‡ä»¶ç»“æ„ï¼‰">3. åˆå§‹åŒ– DB Migration çš„ç›®å½•æ–‡ä»¶ç»“æ„ï¼ˆAlembicçš„ç›®å½•æ–‡ä»¶ç»“æ„ï¼‰</h4><pre class="line-numbers language-none"><code class="language-none">$ pipenv run flask db init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ—¶ï¼Œä¼šåœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸‹ç”Ÿæˆ migration ä»¥ä¸‹ç›®å½•ç»“æ„ã€‚</p><pre class="line-numbers language-none"><code class="language-none">yourproject/    migrations/        alembic.ini        env.py        README        script.py.mako        versions/            3512b954651e_add_account.py            2b1ae634e5cd_add_order_id.py            3adcc9a56557_rename_username_field.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>DB migration è„šæœ¬ï¼Œå°±å­˜æ”¾åœ¨ migrations/versions æ–‡ä»¶å¤¹ä¸‹ã€‚</p><p>Flask-Migration å°† Alembic çš„å‘½ä»¤è¿›è¡Œäº†å°è£…ï¼Œç›¸åŒçš„å‘½ä»¤åœ¨ Alembic æ˜¯ <code>alembic init</code>ã€‚<br>å…¶ä»–å‘½ä»¤åŸºæœ¬éƒ½å¦‚æ­¤ï¼Œå› æ­¤æƒ³è¦çœ‹æ›´è¯¦ç»†çš„å‘½ä»¤åŠŸèƒ½è¯´æ˜ï¼Œå¯ä»¥æŸ¥æ‰¾ Alembic å‘½ä»¤è¯´æ˜ã€‚</p><h4 id="4-ä¿®æ”¹é…ç½®ï¼Œä¸º-migration-script-æ·»åŠ å¸¦æ—¶é—´æˆ³çš„å‘½åè§„åˆ™">4. ä¿®æ”¹é…ç½®ï¼Œä¸º migration script æ·»åŠ å¸¦æ—¶é—´æˆ³çš„å‘½åè§„åˆ™</h4><p>ä½¿ç”¨ Flyway/Liquibase ä¹ æƒ¯äº†çš„åŒå­¦ï¼Œå¯èƒ½æ¯”è¾ƒå–œæ¬¢ script æ–‡ä»¶åä¸Šæ ‡è®°æœ‰æ—¶é—´ â€”â€” è¿™æ ·å¯ä»¥ä¸€çœ¼æ˜äº†è„šæœ¬æ‰§è¡Œçš„é¡ºåºï¼Œè€Œä¸ç”¨æ‰“å¼€æ–‡ä»¶æŸ¥æ‰¾å¯è¯»æ€§å·®çš„ç‰ˆæœ¬å·ã€‚å¦‚ä¸‹é¢æˆªå›¾è¿™æ ·<br><img src="./%E5%9C%A8Python%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B8%8B%E5%81%9ADB-Migration-%E2%80%94%E2%80%94-Flask-Migration/version-with-timestamp.png" alt="vesrions-with-timestamp"></p><p>åªç”¨æ‰“å¼€é…ç½®æ–‡ä»¶<code>script.py.mako</code>ï¼Œåœ¨ç›¸åŒé¡¹ä¸‹é¢ä¿®æ”¹<code>file_template</code>å³å¯ã€‚</p><pre class="line-numbers language-none"><code class="language-none">[alembic]# template used to generate migration files# file_template = %%(rev)s_%%(slug)sfile_template = %%(year)d_%%(month).2d_%%(day).2d_%%(hour).2d%%(minute).2d-%%(rev)s_%%(slug)s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-å¯¹æ¯”ORM-model-å’Œ-DB-ç°æœ‰ç»“æ„ï¼Œé’ˆå¯¹å·®å¼‚è‡ªåŠ¨ç”Ÿæˆ-version-migrationè„šæœ¬">5. å¯¹æ¯”ORM model å’Œ DB ç°æœ‰ç»“æ„ï¼Œé’ˆå¯¹å·®å¼‚è‡ªåŠ¨ç”Ÿæˆ version migrationè„šæœ¬</h4><pre class="line-numbers language-none"><code class="language-none">$ pipenv run flask db migrate -m "Initial migration."<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ—¶ Flask-Migration ä¼šç”Ÿæˆå¦‚ä¸‹è¿™æ ·çš„è¿ç§»è„šæœ¬ã€‚</p><pre class="line-numbers language-none"><code class="language-none">"""Initial migration.Revision ID: e059cb3579d7Revises: Create Date: 2023-11-01 15:49:13.366391"""# revision identifiers, used by Alembic.revision = 'e059cb3579d7'down_revision = Nonebranch_labels = Nonefrom alembic import opimport sqlalchemy as sadef upgrade():    op.create_table('account',    sa.Column('id', sa.BigInteger(), nullable=False),    sa.Column('username', sa.String(length=50), nullable=False),    sa.Column('password', sa.String(length=50), nullable=False),    sa.PrimaryKeyConstraint('id')    )def downgrade():    op.drop_table('account')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-æ‰§è¡Œ-DB-migrationè„šæœ¬ï¼Œè¿›è¡Œæ•°æ®åº“å˜æ›´">6. æ‰§è¡Œ DB migrationè„šæœ¬ï¼Œè¿›è¡Œæ•°æ®åº“å˜æ›´</h4><pre class="line-numbers language-none"><code class="language-none">$ pipenv run flask db upgrade &lt;revision&gt;# æˆ–è€…é™çº§ pipenv run flask db downgrade &lt;revision&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>revison å¯ä»¥æ˜¯ç‰ˆæœ¬å·å‰ç¼€ï¼Œä¹Ÿå¯ä»¥æ˜¯ headï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰ã€+1ï¼ˆç›¸å¯¹ä½ç½®åŠ ä¸€ï¼‰ã€-x(ç›¸å¯¹ä½ç½®å‡x)ã€‚<br>å¦‚æœ upgrade ä¸æŒ‡å®š revisionï¼Œåˆ™é»˜è®¤æ˜¯ headã€‚<br>downgrade ä¸æŒ‡å®š revisionï¼Œåˆ™é»˜è®¤æ˜¯ -1ã€‚</p><h4 id="7-ä¸èƒ½ä¾èµ–flask-db-migrate-ç”Ÿæˆçš„æƒ…å†µï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™è¿ç§»upgrade-downgrade-æ–¹æ³•">7. ä¸èƒ½ä¾èµ–flask db migrate ç”Ÿæˆçš„æƒ…å†µï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™è¿ç§»upgrade()/downgrade()æ–¹æ³•</h4><p>æ¯”å¦‚ Account è¡¨æ ¼ä¸­éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªsystem admin record æ—¶ï¼Œè¿™ç§æ— æ³•é€šè¿‡flask db migrateè‡ªåŠ¨ç”Ÿæˆã€‚<br>ä½¿ç”¨å‘½ä»¤ï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ pipenv run flask db revision -m 'Init system admin record.'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ—¶ä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„ç‰ˆæœ¬è„šæœ¬æ–‡ä»¶ï¼Œå…¶ä¸­ upgrade()/downgrade()æ–¹æ³•éœ€è¦ç¨‹åºå‘˜ä½¿ç”¨è„šæœ¬è‡ªè¡Œç¼–å†™ã€‚<br>è¯­æ³•æŸ¥çœ‹<a href="https://alembic.sqlalchemy.org/en/latest/ops.html">Alembic Operation Reference</a></p><h4 id="8-ååŒå¼€å‘ï¼Œéœ€è¦ç”¨åˆ°çš„-merge-æ“ä½œ">8. ååŒå¼€å‘ï¼Œéœ€è¦ç”¨åˆ°çš„ merge æ“ä½œ</h4><p>å½“ååŒå¼€å‘ï¼Œæœ‰å¤šäººæäº¤æ—¶ï¼Œéš¾å…ä¼šå‡ºç°æœ‰ä¸¤ä¸ª head revison çš„æƒ…å†µã€‚è§£å†³æ–¹å¼ä¸¤ç§ï¼š</p><ol><li>åœ¨è„šæœ¬è¯­å¥ä¸å­˜åœ¨å†²çªçš„æƒ…å†µä¸‹ï¼Œæäº¤äººå°†è‡ªå·±çš„æ–‡ä»¶ä¸­çš„<code>down_revision</code>å­—æ®µå€¼æ›¿æ¢æˆå¦ä¸€ä¸ª head revision å€¼å³å¯ã€‚ç±»ä¼¼ git pull --rebase çš„è·¯çº¿ã€‚</li><li>ä½¿ç”¨<code>flask db merge</code>å‘½ä»¤ã€‚</li></ol><pre class="line-numbers language-none"><code class="language-none"># åˆ—å‡º head revisions$ pip run flask db heads# ç”Ÿæˆ merge è„šæœ¬$ flask db merge &lt;revision-1&gt; &lt;revision-2&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä»¥ä¸Šæ—¥å¸¸å¼€å‘ä¸­çš„åŸºæœ¬ç”¨æ³•ï¼Œæ›´å¤šåŠŸèƒ½æ¢ç´¢å¯ä»¥æŸ¥é˜… Alembic official documentã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sqlalchemy å¯¹äº sequence çš„æ”¯æŒ</title>
      <link href="/2023/10/18/sqlalchemy-dui-yu-sequence-de-zhi-chi/"/>
      <url>/2023/10/18/sqlalchemy-dui-yu-sequence-de-zhi-chi/</url>
      
        <content type="html"><![CDATA[<p>sqlalchemy å¯¹äº sequence çš„æ”¯æŒï¼ˆåº•å±‚æ•°æ®åº“å¼•æ“å¿…é¡»å…·æœ‰ sequence åŠŸèƒ½ï¼‰ï¼Œå…·æœ‰ç®€å•æ˜“ç”¨æ€§ã€‚<br>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š<br>å‡è®¾åˆ›å»ºä¸åŒç±»å‹çš„ World æ—¶ï¼Œéœ€è¦ä¸€ä¸ªåºåˆ—ç ï¼Œæ­¤åºåˆ—ç å•ç±»å‹å†…å”¯ä¸€ã€‚</p><pre class="line-numbers language-none"><code class="language-none">import pinyinfrom flask_sqlalchemy import SQLAlchemyfrom sqlalchemy_serializer import SerializerMixinfrom sqlalchemy import String, BigInteger, Sequencedb = SQLAlchemy()@dataclassclass World(db.Model, SerializerMixin):    __tablename__ = 'world'    id = db.Column(BigInteger, primary_key=True)    serial_number = db.Column(String(32), nullable=False)    @staticmethod    def create(world_category_id):        world_category = WorldCategory.get(world_category_id)        style_pinyin = pinyin.get(world_category.style, format="strip")        sequence = Sequence(style_pinyin, start=1)        seq_ddl = CreateSequence(sequence, if_not_exists=True)        session = db.session        session.execute(seq_ddl)        next_value = session.scalar(sequence)        world = World(world_category_id=world_category_id, serial_number=next_value)        session.add(world)        session.commit()        return world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿæ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œå¯¹äºä¸æ”¯æŒ Sequence çš„æ•°æ®åº“ï¼Œæ­¤æ®µä»£ç å¹¶ä¸èƒ½ç”Ÿæ•ˆã€‚</p><p>æœ‰æ—¶å€™ï¼Œåæ€ä¸€ä¸‹ä¸šåŠ¡ï¼Œæ˜¯å¦çœŸçš„éœ€è¦è¿ç»­æ€§çš„åºåˆ—ç ï¼Ÿ<br>å…¶å®ï¼Œåºåˆ—ç çš„åˆè¡·æ˜¯å”¯ä¸€æ€§ï¼Œä½¿ç”¨ Sequence æ¥å®ç°ï¼Œç”±äºå…¶è¿ç»­å’Œè®°æ•°æ€§ï¼Œåè€Œä¼šé€ æˆä¸€äº›ä¸šåŠ¡ä¸Šç»Ÿè®¡æ•°æ®çš„æ³„éœ²ï¼Œå¹¶ä¸”ç»™æŠ€æœ¯ä¸Š hack API å’Œ æ•°æ®å¸¦æ¥ä¾¿æ·ã€‚<br>å› æ­¤ï¼Œæ˜¯å¦ä½¿ç”¨ Sequence è§†æƒ…å†µè€Œå®šã€‚<br>å¦‚åºåˆ—ç è¿™æ ·çš„ç”Ÿæˆï¼Œå¯ä»¥æ¥å—æ•°å­—ã€å­—ç¬¦è§„åˆ™çš„ï¼Œå¯ä»¥ä½¿ç”¨ UUIDï¼Œä»…èƒ½æ¥å—æ•°å­—çš„ï¼Œå¯ä»¥ä½¿ç”¨ snowflake ç®—æ³•ï¼Œè¿™æ ·ä¸šåŠ¡ä¸Šå¸¦æ¥è§„åˆ™éšç§˜æ€§ï¼ŒåŒæ—¶æŠ€æœ¯ä¸Šæ‘†è„±äº†å¯¹ç‰¹å®šæ•°æ®åº“ç±»å‹çš„ä¾èµ–ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ GITHUB WORKFLOW è‡ªåŠ¨å‘å¸ƒ Azure CR å’Œéƒ¨ç½² Azure App Service</title>
      <link href="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/"/>
      <url>/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/</url>
      
        <content type="html"><![CDATA[<h3 id="Azure-App-Service-æ¦‚è¿°">Azure App Service æ¦‚è¿°</h3><p>Azure è®¡ç®—æœåŠ¡æä¾›äº†å¤šç§ç±»å‹ï¼š<code>VM</code>ã€<code>Container apps</code>ã€<code>App service</code>ã€<code>static App service</code>ã€<code>AKS</code>ã€<code>Logic apps</code>ã€<code>Functions</code>ã€‚<br>åŒºåˆ«äºå…¶ä»–è®¡ç®—æœåŠ¡ï¼š</p><ul><li>Azure app service æ˜¯ä¸€æ¬¾ PAAS æœåŠ¡ï¼ŒåŸºäº HTTP æä¾›æ‰˜ç®¡ Web åº”ç”¨ç¨‹åºã€REST API å’Œç§»åŠ¨åç«¯ã€‚</li><li>å¯ä»¥é€šè¿‡ App service plan è´­ä¹°ä¸€å¥—â€œå•ä½æ—¶é—´å›ºå®šé™é¢â€çš„å³ä»˜å³ç”¨èµ„æºæ± ï¼Œåœ¨æ­¤ plan ä¸‹å¯ä»¥å»ºç«‹å¤šä¸ªåº”ç”¨ share è¿™ä»½èµ„æºï¼›é€šè¿‡ service plan çš„å˜æ›´è¿›è¡Œåº”ç”¨è®¡ç®—èµ„æºçš„æ¨ªå‘/çºµå‘æ‰©å±•ã€‚</li><li>åŒæ—¶ï¼Œä¸åŒäº IAAS æä¾›äº†è®¡ç®—èµ„æºä¹‹å¤–ï¼Œè¿˜æä¾›åº”ç”¨è¿è¥å¿…é¡»çš„å…¬ç”¨åŸŸåç®¡ç†ã€è´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥ã€éƒ¨ç½²æ§½ã€APIM é›†æˆã€æ—¥å¿—æµç®¡ç†ç­‰æ•´å¥—åº”ç”¨æŠ€æœ¯è¿è¥æ–¹æ¡ˆã€‚</li></ul><p>ä»¥æ­å»ºåº”ç”¨æœåŠ¡ä¸ºç›®æ ‡ï¼Œä½¿ç”¨ App service ç›¸æ¯” VMã€Container appsã€AKSï¼Œåœ¨åŸºç¡€è®¾æ–½çš„è§¦ç‚¹å’Œçµæ´»åº¦ç›¸å¯¹ä¸è¶³ï¼Œå¹¶ä¸”ç€çœ¼ç‚¹æ˜¯æ•´åŒ…çš„åº”ç”¨æœåŠ¡ï¼Œå› æ­¤æ›´é€‚åˆäºæ²¡æœ‰æ•´ä½“ä¼ä¸šæŠ€æœ¯æ¶æ„ã€ä¸ä½¿ç”¨å¾®æœåŠ¡çš„å•ä½“åº”ç”¨çš„æ­å»ºè¿è¥ã€‚</p><p>å½“åº”ç”¨å¯èƒ½é¢ä¸´å¤–éƒ¨å˜åŒ–ã€ä¸šåŠ¡æ‰©å¼ å¢é•¿ï¼Œå½“å‰æƒ³è¦ä¿ç•™åº”ç”¨æ¶æ„æœªæ¥çš„å¯é€‰æ‹©æ€§ã€å»¶è¿Ÿå½“å‰æœåŠ¡æ¶æ„ç±»å‹çš„é€‰å‹ï¼Œå»ºè®®ä½¿ç”¨ App service æ—¶é€‰æ‹© docker æ–¹å¼éƒ¨ç½²ã€‚è¿™æ ·ï¼Œé™¤äº†å¯ä»¥æœ€å¤§ç¨‹åº¦çš„é¿å…ç¯å¢ƒå·®å¼‚ä»¥å¤–ï¼Œåœ¨æœªæ¥æ¶æ„æ‰©å¼ åˆ°éœ€è¦æ”¾å¼ƒ App service éƒ¨ç½²æ–¹å¼æ—¶ï¼Œè¿ç§»åˆ° VMã€K8Sã€æˆ–è€…å…¶ä»–äº‘æä¾›å•†ä¸Šæ—¶ï¼Œåº”ç”¨æœåŠ¡åœ¨ä»£ç å˜æ›´ä¸Šå¯ä»¥èŠ±è´¹æœ€å°çš„æˆæœ¬ã€‚</p><p>ä¸‹é¢çš„æ­¥éª¤ï¼Œå°±æ˜¯é€šè¿‡ App service docker æ–¹å¼éƒ¨ç½²ã€‚</p><h3 id="1-åˆ›å»º-Azure-èµ„æºæœåŠ¡">1. åˆ›å»º Azure èµ„æºæœåŠ¡</h3><h4 id="1-1-åˆ›å»º-Azure-Container-Registry">1.1 åˆ›å»º Azure Container Registry</h4><p>æ‰“å¼€ Azure portalï¼Œåˆ›å»º ACRã€‚<br><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/create_acr.png" alt="create acr"></p><p>æ¥ç€éœ€è¦å¼€å¯ ACR çš„ admin æƒé™ã€‚<br>å¯ä»¥é€‰æ‹©ä¸¤ç§æ–¹å¼ï¼šç›´æ¥æ‰“å¼€ ACR adminï¼Œæˆ–è€…ç”Ÿæˆæ‹¥æœ‰ ACR admin æƒé™çš„ tokenã€‚<br>å»ºè®®ä½¿ç”¨ ACR admin tokenï¼Œç›¸æ¯”äºç›´æ¥å¼€å¯â€æœåŠ¡å”¯ä¸€â€œçš„ ACR admin å‡­è¯ï¼Œadmin token å¯ä»¥åˆ›å»ºå¤šä¸ªï¼Œæ¯ä¸ª token ç‹¬ç«‹è®¾ç½®è¿‡æœŸæ—¶é—´ã€è½®æ¢ä»¥åŠå¤±æ•ˆç®¡ç†ã€‚<br>ä¸‹é¢æ˜¯ä½¿ç”¨ Azure portal åˆ›å»º admin tokenã€‚<br><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/create_acr_token_01.png" alt="create token"></p><p>ç”Ÿæˆ token çš„ passwordã€‚<br><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/create_acr_token_02.png" alt="create token"></p><h4 id="1-2-åˆ›å»º-Azure-appservice-plan">1.2 åˆ›å»º Azure appservice plan</h4><p>è¿™é‡Œä½¿ç”¨azure cli å‘½ä»¤è¡Œåˆ›å»ºã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ az appservice plan create \   --name &lt;MY_APP_SERVICE_PLAN_NAME&gt; \   --resource-group &lt;MY_RESOURCE_GROUP&gt; \   --is-linux <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é»˜è®¤åˆ›å»ºå‡ºçš„ SKU tier æ˜¯ Basic çš„ï¼Œä¸æ”¯æŒ deployment slot.<br>Standard tier ä»¥ä¸Šæ˜¯æ”¯æŒ deployment slotï¼Œå¯ä»¥åœ¨ plan åˆ›å»ºä¹‹å scale up.</p><h4 id="1-3-åˆ›å»º-Azure-appservice">1.3 åˆ›å»º Azure appservice</h4><pre class="line-numbers language-none"><code class="language-none">$ az webapp create \    --name &lt;MY_WEBAPP_NAME&gt; \    --plan &lt;MY_APP_SERVICE_PLAN_NAME&gt; \    --resource-group &lt;MY_RESOURCE_GROUP&gt; \    --deployment-container-image-name &lt;nginx:latest&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ ACR ä¸­è¿˜æ²¡æœ‰è‡ªå»ºçš„ docker ç‰©æ–™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é€šç”¨çš„ nginx image è¿›è¡Œåˆå§‹åŒ–ï¼Œåé¢ä½¿ç”¨ github workflow æ—¶ä¼šè‡ªåŠ¨æ›´æ–° image è®¾ç½®ã€‚</p><h3 id="2-é…ç½®æœºå¯†ä¿¡æ¯">2. é…ç½®æœºå¯†ä¿¡æ¯</h3><h4 id="2-1-ä¸‹è½½-appservice-publish-profile">2.1 ä¸‹è½½ appservice_publish_profile</h4><p><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/download_appservice_publish_profile.png" alt="download appservice publish profile"></p><h4 id="2-2-åœ¨-GITHUB-repo-å°†-appservice-publish-profile-é…ç½®æˆ-secrets">2.2 åœ¨ GITHUB repo å°† appservice_publish_profile é…ç½®æˆ secrets</h4><p><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/configure_appservice_publish_profile.png" alt="configurate appservice publish profile"></p><h4 id="2-3-åœ¨-GITHUB-repo-secrets-é…ç½®-Azure-CR-çš„è´¦å·ä¿¡æ¯">2.3 åœ¨ GITHUB repo secrets é…ç½® Azure CR çš„è´¦å·ä¿¡æ¯</h4><p>ç›¸åŒæ–¹å¼åœ¨ GITHUB repo é‡Œé…ç½® secretsï¼š<code>DOCKER_REGISTRY_SERVER_USERNAME</code> å’Œ <code>DOCKER_REGISTRY_SERVER_PASSWORD</code>ï¼Œ å†…å®¹åˆ†åˆ«æ˜¯ ACR admin token çš„ name å’Œ passwordã€‚<br>åœ¨åé¢ GITHUB workflow è„šæœ¬ä¸­ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªæœºå¯†å¯¹ã€‚</p><h3 id="3-é…ç½®-GITHUB-workflow-æ–‡ä»¶">3. é…ç½® GITHUB workflow æ–‡ä»¶</h3><p>åœ¨ GITHUB repo æ·»åŠ  .github/workflows/&lt;file_name&gt;.yml æ–‡ä»¶ï¼Œå†…å®¹å¯å‚è€ƒï¼š</p><pre class="line-numbers language-none"><code class="language-none"># Docs for the Azure Web Apps Deploy action: https://github.com/Azure/webapps-deploy# More GitHub Actions for Azure: https://github.com/Azure/actions# More info on Python, GitHub Actions, and Azure App Service: https://aka.ms/python-webapps-actionsname: Latest build and deploy Python app to Azure Web Appenv:  AZURE_WEBAPP_NAME: &lt;APPSERVICE_NAME&gt;  CR_REPO_HOST: &lt;CRNAME&gt;.azurecr.ioon:  push:    branches:      - releasepermissions:  contents: 'read'  packages: 'write'jobs:  build:    runs-on: ubuntu-latest    steps:      - uses: actions/checkout@v3      - name: Set up Docker Buildx        uses: docker/setup-buildx-action@v2      - name: Log in to Azure container registry        uses: docker/login-action@v2        with:          registry: ${{ env.CR_REPO_HOST }}          username: ${{ secrets.DOCKER_REGISTRY_SERVER_USERNAME }}          password: ${{ secrets.DOCKER_REGISTRY_SERVER_PASSWORD }}      - name: Lowercase the repo name        run: echo "REPO=${GITHUB_REPOSITORY,,}" &gt;&gt;${GITHUB_ENV}      - name: Build and push container image to registry        uses: docker/build-push-action@v4        with:          push: true          tags: ${{ env.CR_REPO_HOST }}/${{ env.REPO }}:${{ github.sha }}          file: ./Dockerfile  deploy:    runs-on: ubuntu-latest    needs: build    environment:      name: 'Production'      url: ${{ steps.deploy-to-webapp.outputs.webapp-url }}    steps:      - name: Lowercase the repo name        run: echo "REPO=${GITHUB_REPOSITORY,,}" &gt;&gt;${GITHUB_ENV}      - name: Deploy to Azure Web App        id: deploy-to-webapp        uses: azure/webapps-deploy@85270a1854658d167ab239bce43949edb336fa7c        with:          app-name: ${{ env.AZURE_WEBAPP_NAME }}          publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE_PROD }}          images: '${{ env.CR_REPO_HOST }}/${{ env.REPO }}:${{ github.sha }}'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-å¼€å¯-application-logging">4. å¼€å¯ application logging</h3><h4 id="4-1-ä½¿ç”¨-Appservice-çš„-file-logging">4.1 ä½¿ç”¨ Appservice çš„ file logging</h4><p>App service é»˜è®¤æ˜¯ä¸å¼€å¯ application logging çš„ï¼Œå³ä½¿ä»£ç ä¸­é…ç½®äº† logging configã€‚<br>éœ€è¦åœ¨ App service ä¸­æ‰“å¼€ï¼š<br><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/app_service_application_logging.png" alt="app service logging"></p><p>è¿™æ—¶ï¼Œåœ¨ã€ Monitoring ã€‘-&gt;ã€Log streamã€‘æ‰ä¼šå‡ºç°åº”ç”¨çš„ application logã€‚<br>é™¤äº† Log stream è¿™ç§æ–¹å¼å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ç½‘é¡µ<code>https://&lt;your_appservice_name&gt;.scm.azurewebsites.net/DebugConsole</code> æ¥æŸ¥çœ‹ logsã€‚<br><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/app_service_scm_debugconsole.png" alt="app service scm debug console"></p><h4 id="4-2-æ¥å…¥-Log-analytics-workspace">4.2 æ¥å…¥ Log analytics workspace</h4><p>App service çš„æ—¥å¿—å’ŒæŒ‡æ ‡å¯ä»¥å‘é€å’Œæ¥å…¥åˆ° Azure çš„å…¶ä»–æœåŠ¡ä¸­ï¼Œæ¯”å¦‚ Log analytics workspaceï¼Œç”¨ä»¥æ”¯æŒè¯­å¥æŸ¥æ‰¾å’Œåˆ†æã€‚</p><p>éœ€è¦åœ¨ App service å¤„è¿›è¡Œé…ç½®ã€Diagnostic settingã€‘ï¼Œç”¨ä»¥å¼€å¯æ—¥å¿—æ•°æ®å‘é€ã€‚<br><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/app_service_logging.png" alt="app service logging"></p><p>å¯ä»¥é€‰æ‹©æ—¥å¿—ç±»å‹å’Œå‹¾é€‰æŒ‡æ ‡ï¼Œæ—¥å¿—æ•°æ®çš„ç›®æ ‡ä¹Ÿå¯ä»¥å¤é€‰ â€”â€” å‘é€ Log analytics workspace / event hub / partner solution ä»¥åŠ ä¿å­˜åˆ° storage accountï¼ˆAzure å­˜å‚¨è´¦æˆ·ï¼‰ã€‚<br><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/app_service_logging_config.png" alt="app service logging config"></p><p><strong>Log analytics workspace</strong> ä¸­è¿›è¡Œæ—¥å¿—æœç´¢ï¼š<br><img src="/2023/09/01/shi-yong-github-workflow-zi-dong-fa-bu-azure-cr-he-bu-shu-azure-app-service/log_analytics_workspace.png" alt="log analytics workspace"></p>]]></content>
      
      
      <categories>
          
          <category> Azure </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> äº‘å¹³å° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Administrator Associate è€ƒè¯•çŸ¥è¯†ç‚¹</title>
      <link href="/2023/05/30/azure-administrator-associate-zhi-shi-dian/"/>
      <url>/2023/05/30/azure-administrator-associate-zhi-shi-dian/</url>
      
        <content type="html"><![CDATA[<p>Azure Administrator Associate æ¶‰åŠäº”ä¸ªçŸ¥è¯†å—ï¼Œä¸‹é¢æ˜¯å®˜æ–¹è€ƒè¯è§’åº¦ç»™å‡ºçš„æ¸…å•ï¼š<br><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/study_area.png" alt="Azure Administrator Associate Study Area"></p><h2 id="Azure-Administrator-Associate-çŸ¥è¯†å›¾è°±">Azure Administrator Associate çŸ¥è¯†å›¾è°±</h2><div class="markmap-container" style="height:800px">  <svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[0,1]},&quot;v&quot;:&quot;Azure Administrator Associate&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;Azure Basics&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;Identities and governance&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;Azure Active Directory&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;Tenant &amp;amp; Directory&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;User &amp;amp; Group&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;Azure RBAC Role &amp;amp; Azure AD Administrator Role&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;Administractive Unit / Device and so on&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;Azure AD connect&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;Resources&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;Management Group&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;Subscription&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;Resource Group&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;Resource&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;Resource Manage Tools&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;Azure Portal&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;Azure Cloud shell&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[17,18]},&quot;v&quot;:&quot;Azure Powershell&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;Azure CLI&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[19,20]},&quot;v&quot;:&quot;ARM Template&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[20,21]},&quot;v&quot;:&quot;Networking&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;Virtual Networks&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[22,23]},&quot;v&quot;:&quot;IP Addressing&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;public IP &amp;amp; private IP&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[24,25]},&quot;v&quot;:&quot;Network Security&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[25,26]},&quot;v&quot;:&quot;Network Security Group&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[26,27]},&quot;v&quot;:&quot;Application Security Group&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[27,28]},&quot;v&quot;:&quot;Azure Firewall&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[28,29]},&quot;v&quot;:&quot;Azure DNS&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[29,30]},&quot;v&quot;:&quot;Network expand&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[30,31]},&quot;v&quot;:&quot;VNet Peering&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[31,32]},&quot;v&quot;:&quot;VPN Gateway&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[32,33]},&quot;v&quot;:&quot;VPN transit for VNet Peering&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[33,34]},&quot;v&quot;:&quot;Site-to-Site VPN Connections&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[34,35]},&quot;v&quot;:&quot;Point-to-Site VPN Connections&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[35,36]},&quot;v&quot;:&quot;ExpressRoute&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[36,37]},&quot;v&quot;:&quot;Network Traffic&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[37,38]},&quot;v&quot;:&quot;Route Table&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[38,39]},&quot;v&quot;:&quot;Service Endpoint&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[39,40]},&quot;v&quot;:&quot;Load Balancer&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[40,41]},&quot;v&quot;:&quot;Application Gateway&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[41,42]},&quot;v&quot;:&quot;Traffic Manager&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[42,43]},&quot;v&quot;:&quot;Storage&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[43,44]},&quot;v&quot;:&quot;Azure storage account&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[44,45]},&quot;v&quot;:&quot;Azure storage services&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[45,46]},&quot;v&quot;:&quot;Azure Container&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[46,47]},&quot;v&quot;:&quot;Azure Files&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[47,48]},&quot;v&quot;:&quot;Azure Tables&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[48,49]},&quot;v&quot;:&quot;Azure Queues&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[49,50]},&quot;v&quot;:&quot;Replication Strategies&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[50,51]},&quot;v&quot;:&quot;Locally redundant storage (LRS)â€‹&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[51,52]},&quot;v&quot;:&quot;Zone-redundant storage (ZRS)â€‹&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[52,53]},&quot;v&quot;:&quot;Geo-redundant storage (GRS)â€‹&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[53,54]},&quot;v&quot;:&quot;Read access geo-redundant storage (RA-GRS)â€‹&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[54,55]},&quot;v&quot;:&quot;Geo-zone-redundant storage (GZRS)â€‹&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[55,56]},&quot;v&quot;:&quot;Read-access Geo-zone- redundant storage (RA-GZRS)â€‹&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[56,57]},&quot;v&quot;:&quot;Storage Security&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[57,58]},&quot;v&quot;:&quot;Shared Access Signatures&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[58,59]},&quot;v&quot;:&quot;Storage Service Encryption&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[59,60]},&quot;v&quot;:&quot;Managing Storage&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[60,61]},&quot;v&quot;:&quot;Storage Explorer&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[61,62]},&quot;v&quot;:&quot;Import and Export Service&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[62,63]},&quot;v&quot;:&quot;Data Box&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[63,64]},&quot;v&quot;:&quot;AzCopy&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[64,65]},&quot;v&quot;:&quot;Compute&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[65,66]},&quot;v&quot;:&quot;Virtual Machine&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[66,67]},&quot;v&quot;:&quot;Virtual Machine&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[67,68]},&quot;v&quot;:&quot;Virtual Machine Extensions&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[68,69]},&quot;v&quot;:&quot;VM Availability Sets&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[69,70]},&quot;v&quot;:&quot;VM Scale Sets&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[70,71]},&quot;v&quot;:&quot;Azure App Service&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[71,72]},&quot;v&quot;:&quot;Container Services&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[72,73]},&quot;v&quot;:&quot;Azure Kubernetes Service&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[73,74]},&quot;v&quot;:&quot;Monitor and backup&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[74,75]},&quot;v&quot;:&quot;backup&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[75,76]},&quot;v&quot;:&quot;Azure Backup&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[76,77]},&quot;v&quot;:&quot;Recovery Service Vault Backup&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[77,78]},&quot;v&quot;:&quot;Monitor&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[78,79]},&quot;v&quot;:&quot;Azure monitor&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[79,80]},&quot;v&quot;:&quot;Azure alert&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[80,81]},&quot;v&quot;:&quot;Log Analytics&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[81,82]},&quot;v&quot;:&quot;Network Watcher&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[82,83]},&quot;v&quot;:&quot;Diagnostics&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[83,84]},&quot;v&quot;:&quot;IP Flow Verify&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[84,85]},&quot;v&quot;:&quot;Next Hop&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[85,86]},&quot;v&quot;:&quot;VPN troubleshoot&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[86,87]},&quot;v&quot;:&quot;NSG diagnostics&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[87,88]},&quot;v&quot;:&quot;Connection troubleshoot&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[88,89]},&quot;v&quot;:&quot;Packet capture&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[89,90]},&quot;v&quot;:&quot;Effective security rules&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[90,91]},&quot;v&quot;:&quot;Topology&quot;}]}]}]}]}"></svg></div><h2 id="Azure-Basics">Azure Basics</h2><h3 id="1-Identities-and-governance">1. Identities and governance</h3><p><code>Azure Active Directory</code> æä¾›äº†ä¸€å¥—åŸºäºäº‘çš„æ ‡è¯†ç®¡ç†çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚<br>åœ¨åˆ›å»ºç§Ÿæˆ·æ—¶ï¼Œä¼šåŒæ—¶åˆ›å»º Directoryï¼ˆç›®å½•ï¼‰ï¼ŒAzure Active Directory å¯¹ç›®å½•è¿›è¡Œç®¡ç†ï¼ŒåŠŸèƒ½ä¸Šæ—¢æœ‰åŸºç¡€çš„<code>èº«ä»½ç®¡ç†å’ŒéªŒè¯</code>ã€<code>å•ç‚¹ç™»å½•</code>ã€<code>å¤šå› è®¤è¯</code>ï¼Œä¹Ÿæœ‰è¿›é˜¶ä¸€ç‚¹çš„<code>è®¾å¤‡ç®¡ç†</code>ã€<code>ç®¡ç†å•å…ƒ</code>ã€<code>åº”ç”¨ç®¡ç†</code>ï¼ŒåŒæ—¶è¿˜æœ‰æ”¯æŒ Azure AD ä¸ on-premises çš„ Active Directory Domain Serviceï¼ˆå³ AD DSï¼‰ çš„æ··åˆæ ‡è¯†æ–¹æ¡ˆç­‰ç­‰ã€‚</p><h4 id="1-1-AAD-ç›®å½•-èµ„æºå±‚çº§å¯¹åº”å…³ç³»">1.1 AAD ç›®å½•-èµ„æºå±‚çº§å¯¹åº”å…³ç³»</h4><p><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/basic_structure.png" alt="AAD ç›®å½•-èµ„æºå±‚çº§å›¾"></p><ol><li>ç›®å½•å¯¹ç§Ÿæˆ·ä¸‹çš„ç”¨æˆ·ã€ç»„ç­‰è¿›è¡Œç®¡ç†ã€‚</li><li>ä¸€ä¸ªç›®å½•å¯ä»¥è¢«å¤šä¸ªè®¢é˜…æ‰€ä¿¡ä»»ï¼Œä½†ä¸€ä¸ªè®¢é˜…ä»…èƒ½å…³è”ä¸€ä¸ªç›®å½•ã€ä¸èƒ½å…³è”å¤šä¸ªã€‚ç›®å½•ä½¿å¤šç§Ÿæˆ·ä¹‹é—´ä¿¡æ¯ã€èµ„æºç‹¬ç«‹ã€‚</li><li>è®¢é˜…å¯¹èµ„æºè¿›è¡Œé›†ä¸­ç®¡ç†ï¼ŒåŒ…æ‹¬é€»è¾‘å±‚çº§ Resource Group ä»¥åŠå„ç§ Resourceã€‚è®¢é˜…ä¸ºèµ„æºæä¾›ç»Ÿä¸€çš„è´¦å•å’Œç»“ç®—ï¼ŒåŒæ—¶ä¸å…¶ä»–è®¢é˜…ç›¸äº’éš”ç¦»ã€‚</li><li>æƒ³è¦è·¨è®¢é˜…è¿›è¡Œä¸€è‡´çš„è®¿é—®ã€ç­–ç•¥ç­‰ç®¡ç†æ—¶ï¼Œä½¿ç”¨ management group(ç®¡ç†ç»„) å®ç°ã€‚ç®¡ç†ç»„å±‚çº§å¯ä»¥æŒ‰ç…§ç»„ç»‡éƒ¨é—¨è¿›è¡Œåˆ›å»ºï¼Œæœ€å¤šæ”¯æŒçºµå‘æ·±åº¦ 6 å±‚ã€‚</li></ol><h4 id="1-2-Role-Based-Access-Control">1.2 Role-Based Access Control</h4><p>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) æ˜¯ä¸€ç§å¯å¸®åŠ©ç®¡ç†è°å¯ä»¥è®¿é—® Azure èµ„æºçš„æœºåˆ¶ã€‚ é€šè¿‡ RBACï¼Œå¯ä»¥ç¡®å®šç‰¹å®šç”¨æˆ·é’ˆå¯¹ç‰¹å®šèµ„æºå¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼Œå¹¶æ§åˆ¶æ¯ä¸ªç”¨æˆ·å¯ä»¥è®¿é—®çš„èµ„æºåŒºåŸŸã€‚<br>åœ¨ Azure ä¸­åˆ†ä¸ºï¼šå¯¹â€œè®¢é˜…èµ„æºâ€çš„è®¿é—®æˆæƒ å’Œ â€œAzure ADâ€çš„è®¿é—®æˆæƒä¸¤ç±»ã€‚å¯¹â€œè®¢é˜…èµ„æºâ€çš„æˆæƒæœºåˆ¶å³ Azure RBAC(ä¸‹å›¾)ã€‚<br>ä¸‹å›¾æè¿°äº† Role-Based Access Control ä¸­çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š<code>Security Principle</code>(å®‰å…¨ä¸»ä½“)  ã€<code>Role definition</code>(è§’è‰²å®šä¹‰)    ã€<code>Scope</code>(èŒƒå›´)  ã€<code>Role Assignment</code>(åˆ†é…)ã€‚<br><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/RBAC.png" alt="Azure RBAC æœºåˆ¶"></p><ol><li>Security principle å³å¯ä»¥æ˜¯å•ç‹¬çš„ Userï¼Œä¹Ÿå¯ä»¥æ˜¯ æŸä¸ª Groupï¼Œä¹Ÿå¯ä»¥æ˜¯ Service Principleã€‚</li><li>Role definitionï¼Œå¯ä»¥æ˜¯ Azure é¢„å®šä¹‰çš„ï¼Œä¹Ÿå¯ä»¥ä¾æ® è§’è‰²å®šä¹‰æ¨¡æ¿çš„æ ¼å¼ è¿›è¡Œç”¨æˆ·è‡ªå®šä¹‰ã€‚</li><li>Scope å¯ä»¥æ¶‰åŠå¤šå±‚çº§ï¼Œä»èŒƒå›´æœ€å¹¿çš„ç®¡ç†ç»„ï¼Œåˆ°ç²’åº¦æ›´ç»†çš„å…·ä½“èµ„æºã€‚</li><li>Role Assignmentï¼Œå³æ˜¯ç»‘å®šä¸Šé¢ 3 é¡¹çš„å…³ç³»ï¼Œä»¥å®Œæˆé’ˆå¯¹å…·ä½“ Service Principle - Roleï¼ˆpermissionï¼‰- Scope çš„æˆæƒã€‚</li></ol><p>å…¶ä¸­<code>è§’è‰²å®šä¹‰</code>çš„æ ¼å¼ï¼Œç”± JSON æ–‡ä»¶ä¸­å®šä¹‰çš„æƒé™é›†ç»„æˆã€‚ å…¶ä¸­æè¿°æƒé™é›†çš„ç»“æ„ä¸é™äºï¼š</p><ul><li><code>Actions</code> å…è®¸çš„æƒé™æ“ä½œã€‚</li><li><code>NotActions</code> ä¸å…è®¸æ‰§è¡Œçš„æƒé™æ“ä½œã€‚</li><li><code>DataActions</code> æŒ‡ç¤ºå¦‚ä½•æ›´æ”¹æˆ–ä½¿ç”¨æ•°æ®ã€‚</li><li><code>AssignableScopes</code> å¯ä»¥åˆ†é…è§’è‰²å®šä¹‰çš„èŒƒå›´ã€‚<br><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/role_definition.png" alt="Role definition"></li></ul><p>Azure RBAC Roles æä¾›äº†100 å¤šç§é¢„å®šä¹‰çš„è§’è‰²å®šä¹‰ï¼Œå…¶ä¸­åŒ…æ‹¬å››ä¸ªåŸºæœ¬çš„å†…ç½®è§’è‰²å®šä¹‰ï¼Œä»¥åŠå…¶ä»–æ ¹æ®å„èµ„æºæœåŠ¡è¿›è¡Œç‰¹åˆ«æ§åˆ¶çš„è§’è‰²å®šä¹‰ã€‚<br>ä¸‹å›¾æ˜¯å››ä¸ªåŸºæœ¬è§’è‰²ï¼š<code>Owner</code>ã€<code>Contributor</code>ã€<code>Reader</code>ã€<code>User Access Administrator</code>ã€‚<br><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/basic_roles.png" alt="Azure RBAC Basic Roles"></p><p><strong>Azure AD Roles:</strong><br>é™¤äº† Azure RBAC Roles ä¹‹å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç±» Azure AD Rolesï¼Œä¹Ÿæ˜¯åŸºäº Role-Based Access Control æœºåˆ¶ï¼ŒåŒºåˆ«ä¸»è¦æ˜¯ Scope æ¶‰åŠ AD çš„å¯¹è±¡å’Œèµ„æºã€‚<br><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/AD_access_control.png" alt="Azure AD Roles"></p><h4 id="1-3-RBAC-Authentication">1.3 RBAC Authentication</h4><p><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/AAD_structure.png" alt="RBAC Authentication"><br>æ³¨æ„ä¸Šé¢æ•´ä½“æ¨¡å‹ä¸­ä¸¤ç±» Roles â€”â€” Azure AD Roles å’Œ Azure RBAC Roles çš„ä½œç”¨èŒƒå›´ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAzure Roles ä¸ Azure AD Roles ä¸ä¼šè·¨è¶Š Azure ä¸ Azure AD çš„ Scope è¾¹ç•Œã€‚ ä½†æ˜¯ï¼Œå¦‚æœå…¨å±€ç®¡ç†å‘˜é€šè¿‡åœ¨ Azure é—¨æˆ·ä¸­é€‰æ‹©â€œAzure èµ„æºçš„è®¿é—®ç®¡ç†â€å¼€å…³ï¼Œæå‡äº†è‡ªå·±çš„è®¿é—®æƒé™ï¼Œåˆ™ä¼šé’ˆå¯¹ç‰¹å®šç§Ÿæˆ·çš„æ‰€æœ‰è®¢é˜…ä¸ºå…¨å±€ç®¡ç†å‘˜æˆäºˆ<code>User Access Administrator</code>ï¼ˆç”¨æˆ·è®¿é—®ç®¡ç†å‘˜è§’è‰²ï¼‰ã€‚ ç”¨æˆ·è®¿é—®ç®¡ç†å‘˜è§’è‰²å¯ä»¥å‘å…¶ä»–ç”¨æˆ·æˆäºˆå¯¹ Azure èµ„æºçš„è®¿é—®æƒé™ã€‚<br>å› æ­¤ï¼ŒGlobal Administrator æœ¬èº«åªæ˜¯ Azure AD çš„æœ€é«˜æƒé™è§’è‰²ï¼Œæœ¬èº«å¹¶ä¸æ¶µç›–å¯¹ Azure èµ„æºçš„æƒé™ã€‚<br>èƒ½å¯¹ Azure èµ„æºè¿›è¡Œæƒé™åˆ†é… çš„ Global Administrator çš„ Userï¼Œ ä¸€èˆ¬æ˜¯è¿›è¡Œäº†â€œæƒé™æå‡â€ï¼Œæˆ–è€…è¯¥ User æœ¬èº«æ˜¯æŸä¸ª Subscription çš„ Ownerã€‚</p><h3 id="2-Resources">2. Resources</h3><p>Azure é’ˆå¯¹èµ„æºçš„ç®¡ç†å±‚çº§ï¼ˆåŒ…æ‹¬é€»è¾‘å±‚çº§ï¼‰ï¼Œä»ä¸Šè‡³ä¸‹ä¸€å…±åˆ†ä¸ºï¼š<code>ç®¡ç†ç»„</code>ã€<code>è®¢é˜…</code>ã€<code>èµ„æºç»„</code>ã€<code>èµ„æº</code>ã€‚<br>ç®¡ç†ç»„ã€è®¢é˜…ã€èµ„æºç»„éƒ½æœ‰å•ç‹¬çš„ Service é¡µé¢è¿›è¡Œè®¾ç½®å’Œä½¿ç”¨ã€‚</p><h4 id="2-1-Policy">2.1 Policy</h4><p>Azure Policy æ˜¯ Azure ä¸­çš„ä¸€é¡¹æœåŠ¡ï¼Œå¯ç”¨äºåˆ›å»ºã€åˆ†é…å’Œç®¡ç†ç­–ç•¥ï¼Œç”¨äºæ§åˆ¶æˆ–å®¡æ ¸èµ„æºã€‚ è¿™äº›ç­–ç•¥å¯¹èµ„æºé…ç½®å¼ºåˆ¶å®æ–½ä¸åŒçš„è§„åˆ™ï¼Œä½¿è¿™äº›é…ç½®ç¬¦åˆç»„ç»‡æ ‡å‡†å’Œåˆè§„æ€§è¦æ±‚ã€‚<br>Azure Policy å¯ä»¥è¢«åˆ†é…å’Œä½œç”¨äºå¤šä¸ªå±‚çº§ã€‚<br>Policy çš„ä½¿ç”¨æœ‰å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>å®šä¹‰<code>Policy</code>ï¼ˆç­–ç•¥ï¼‰ã€‚</li><li>å®šä¹‰<code>initiative</code>(å®˜æ–¹ç¿»è¯‘ï¼šè®¡åˆ’)ï¼Œæ˜¯ Policy çš„é›†åˆã€‚</li><li>åˆ›å»º<code>Assignments</code>ã€‚</li><li>ç¡®å®š<code>Compliance</code>ã€‚<br>Azure é¢„è®¾äº†ä¸€äº› Policy å’Œ Initiativeï¼Œå¯ä»¥ç›´æ¥ç”¨æ¥åˆ›å»º Assignmentï¼›ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€äº› Policy å’Œ Initiativeã€‚<br>Policy å’Œ Initiative åœ¨å®šä¹‰çš„æ—¶å€™åˆ›å»ºäº†ä¸€äº›å‚æ•°ï¼Œå¯ä»¥åœ¨åˆ›å»º Assignments çš„æ—¶å€™è®¾ç½®å’Œä¼ å…¥å‚æ•°å€¼ã€‚<br>æ¯”å¦‚ï¼šåˆ›å»ºäº†ä¸€ä¸ª XX_Initiativeï¼Œå…¶ä¸­åŒ…å«äº† <code>Allowed locations</code> çš„ Policyï¼Œæ­¤ policy å£°æ˜äº†å…¥å‚ <code>listOfAllowedLocations</code>ã€‚åœ¨åˆ›å»º Assignments æ—¶ï¼Œ<br>å¯ä»¥æŒ‡å®šé™å®šçš„ location å€¼ã€‚<br>Policy - Initiative - Assignment åˆ›å»ºå®Œï¼Œå¾…åˆè§„æ€§æ£€æŸ¥æ‰§è¡Œå®Œæˆåï¼Œå¯ä»¥é€šè¿‡<code>Compliance</code> é¡µé¢ç¡®å®šåˆè§„æ€§æ£€æŸ¥çš„ç»“æœã€‚<br><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/compliance.png" alt="Policy Compliance"></li></ul><h4 id="2-2-Lock">2.2 Lock</h4><p>é”ï¼Œè·Ÿ Policy ä¸åŒï¼Œå¯ä»¥è¢«è®¾ç½®çš„çº§åˆ«æ˜¯ï¼šè®¢é˜…ã€èµ„æºç»„ã€èµ„æºã€‚é”ä¼šè¢«ç»§æ‰¿ã€å½±å“å­èŒƒå›´å†…çš„æ‰€æœ‰èµ„æºã€‚<br>é”ç±»å‹åˆ†ä¸¤ç§ï¼šdelete å’Œ read-onlyã€‚</p><ul><li>è¢« delete é”ä½çš„èµ„æºï¼Œä¸èƒ½åˆ é™¤ï¼Œé™¤éå…ˆåˆ é™¤ delete é”ã€‚</li><li>è¢« read-only é”ä½çš„èµ„æºï¼Œä¸èƒ½è¢«å˜æ›´ï¼Œé™¤éå…ˆåˆ é™¤é”ã€‚<br>æ³¨æ„ï¼Œè¿™é‡Œçš„å˜æ›´é’ˆå¯¹èµ„æºçš„å…ƒæ•°æ®ï¼Œä¸åŒ…æ‹¬èµ„æºç®¡ç†çš„å†…å®¹ã€‚æ¯”å¦‚ read-only è®¾ç½®åœ¨æ•°æ®åº“èµ„æºä¸Šï¼Œæ•°æ®åº“ç®¡ç†çš„æ•°æ®æ˜¯ä¾ç„¶å¯ä»¥è¯»å†™åˆ ï¼Œä½†æ•°æ®åº“è®¾ç½®åˆ™ä¸èƒ½å˜æ›´ï¼Œæ¯”å¦‚ <code>reset password</code>ã€æ·»åŠ  tag ç­‰ç­‰ã€‚</li></ul><h4 id="2-3-Tag">2.3 Tag</h4><p>æ ‡ç­¾ï¼Œæ˜¯ä¸€ç§æ ‡è®°ç¬¦å·ï¼Œä¸»è¦ç”¨æ¥æŸ¥è¯¢ã€è¿‡æ»¤èµ„æºã€‚<br>æ ‡ç­¾åœ¨èµ„æºå±‚çº§ä¹‹é—´<code>ä¸èƒ½ç»§æ‰¿</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œèµ„æºç»„æ‰“ä¸Šäº† Tagï¼Œå¦‚æœéœ€è¦ç»™èµ„æºç»„å†…æ‰€æœ‰èµ„æºæ‰“ä¸Šç›¸åŒ Tag çš„è¯ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>æ‰‹åŠ¨ç»™èµ„æºåˆ†åˆ«åŠ ä¸Š Tagã€‚</li><li>ç»™è¯¥èµ„æºç»„åˆ†é… Append tag çš„ Policyï¼Œè¿™æ ·å¯ä»¥é€šè¿‡ Policy ç»™èµ„æºåŠ ä¸Šç›¸åŒçš„ Tagã€‚</li></ol><h4 id="2-4-IAM">2.4 IAM</h4><p>æ¯ä¸ªæœåŠ¡çš„ IAM é¡µç­¾ï¼Œæ˜¯ç”¨æ¥é…ç½®è®¿é—®æˆæƒçš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯é’ˆå¯¹å½“å‰èµ„æºæœåŠ¡ç®¡ç† Azure RABC Role assignment çš„åœ°æ–¹ã€‚<br>è®¿é—®æˆæƒåœ¨ä¸åŒèµ„æºå±‚çº§ä¹‹é—´æ˜¯å¯ä»¥ç»§æ‰¿çš„ã€‚æ„æ€æ˜¯ï¼Œå¦‚æœç»™æŸä¸ªç®¡ç†ç»„è®¾ç½®äº† ownerï¼Œè¿™ä¸ª owner ä¼šè¢«ç®¡ç†ç»„ä¸‹çš„æ¯ä¸€ä¸ªèµ„æºæœåŠ¡è¯†åˆ«ä¸º Ownerã€‚</p><h3 id="3-Resource-Manage-Tools">3. Resource Manage Tools</h3><h4 id="3-1-Tools">3.1 Tools</h4><p>å¯¹èµ„æºçš„ç®¡ç†å’Œä½¿ç”¨ï¼ŒAzure æä¾›äº†å¤šç§èµ„æºç®¡ç†ç»ˆç«¯ï¼š</p><ul><li><code>Azure Portal</code>ï¼ŒAzure é—¨æˆ·ç½‘ç«™é¡µé¢ã€‚</li><li><code>Azure Cloud Shell</code>ï¼Œé€šè¿‡ Azure é—¨æˆ·è¿›å…¥ï¼Œä¸€ç§é€šè¿‡æµè§ˆå™¨ç•Œé¢æ˜¾ç¤ºã€å¯ä¸ Azure èµ„æºäº¤äº’çš„ shellå‘½ä»¤å·¥å…·ã€‚Cloud Shell æŒ‰ä¼šè¯åˆ†é…ä¸´æ—¶çš„ä¸»æœºä½œä¸ºæ“ä½œæœºï¼Œä½¿ç”¨æ–‡ä»¶å…±äº«ä¸­ä¿å­˜çš„ 5 GB æ˜ åƒæŒä¹…ä¿å­˜ $HOMEï¼Œå¹¶åœ¨ç”¨æˆ· 20 åˆ†é’Ÿå†…æ²¡æœ‰äº¤äº’æ´»åŠ¨æ—¶ shell è¿æ¥ä¼šè¶…æ—¶ã€‚</li><li><code>Azure PowerShell</code>ï¼Œå®‰è£…äº† Azure module çš„ PowerShell å·¥å…·ã€‚</li><li><code>Azure cli</code>ï¼ŒAzure æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</li></ul><p>å„ç§ç»ˆç«¯é™¤äº†äº¤äº’æ–¹å¼ä»¥å¤–ï¼ŒåŠŸèƒ½ä¸ŠåŸºæœ¬æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼ŒèƒŒåéƒ½æ˜¯è¿æ¥ ARMï¼ˆAzure èµ„æºç®¡ç†å™¨ï¼‰ã€‚<br><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/ARM.png" alt="ARM"></p><p>é’ˆå¯¹ â€œæ‰§è¡Œé¢‘ç‡å’Œé‡å¤æ€§ä¸é«˜ã€é‡å°çš„ Azure è¿ç»´ä»»åŠ¡â€ï¼Œå¯ä»¥é€šè¿‡ Azure Portal è¿›è¡Œå¶å°”æ“ä½œã€‚<br>ä½†å¯¹äºè‡ªåŠ¨åŒ–ã€é‡å¤æ€§é«˜çš„è¿ç»´ä»»åŠ¡æ¥è¯´ï¼Œä½¿ç”¨ Azure Powershell å’Œ Azure Cli é€šè¿‡å‘½ä»¤è¡Œè„šæœ¬æ˜¯æ›´é«˜æ•ˆå’Œå¯é çš„æ–¹å¼ã€‚</p><p>Azure PowerShell ç¤ºä¾‹ï¼š(ConferenceDailyReset.ps1)</p><pre class="line-numbers language-none"><code class="language-none">param([string]$resourceGroup)$adminCredential = Get-Credential -Message "Enter a username and password for the VM administrator."For ($i = 1; $i -le 3; $i++){    $vmName = "ConferenceDemo" + $i    Write-Host "Creating VM: " $vmName    New-AzVm -ResourceGroupName $resourceGroup -Name $vmName -Credential $adminCredential -Image Canonical:0001-com-ubuntu-server-focal:20_04-lts:latest}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œè„šæœ¬æ–‡ä»¶ï¼š</p><pre class="line-numbers language-none"><code class="language-none">./ConferenceDailyReset.ps1 learn-3bd98a6a-c556-42bf-975b-81bcc3e53962<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-2-Azure-Resouce-Manager-Template">3.2 Azure Resouce Manager Template</h4><p>Azure èµ„æºç®¡ç†å™¨æ¨¡æ¿ï¼ˆARM æ¨¡æ¿ï¼‰å®ç°<code>infrastructure as code</code> ï¼ˆåŸºç¡€ç»“æ„å³ä»£ç ï¼‰ã€‚<br>ARM æ¨¡æ¿ä½¿ç”¨å£°æ˜æ€§è¯­æ³•ã€JSON æ–‡ä»¶æ ¼å¼ï¼Œå®šä¹‰éƒ¨ç½²çš„åŸºç¡€ç»“æ„å’Œé…ç½®ã€‚<br>ARM æ¨¡æ¿æ–‡ä»¶ç”±ä¸‹åˆ—å…ƒç´ ç»„æˆï¼š<br><img src="/2023/05/30/azure-administrator-associate-zhi-shi-dian/ARM_template_elements.png" alt="ARM template elements"></p><p>ç¤ºä¾‹ï¼š(azuredeploy.json)</p><pre class="line-numbers language-none"><code class="language-none">{  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",  "contentVersion": "1.0.0.0",  "parameters": {    "storageName": {      "type": "string",      "minLength": 3,      "maxLength": 24,      "metadata": {        "description": "The name of the Azure storage resource"      }    },    "storageSKU": {      "type": "string",      "defaultValue": "Standard_LRS",      "allowedValues": [        "Standard_LRS",        "Standard_GRS",        "Standard_RAGRS",        "Standard_ZRS",        "Premium_LRS",        "Premium_ZRS",        "Standard_GZRS",        "Standard_RAGZRS"      ]    }  },  "functions": [],  "variables": {},  "resources": [    {      "name": "[parameters('storageName')]",      "type": "Microsoft.Storage/storageAccounts",      "apiVersion": "2019-06-01",      "tags": {        "displayName": "[parameters('storageName')]"      },      "location": "[resourceGroup().location]",      "kind": "StorageV2",      "sku": {        "name": "[parameters('storageSKU')]",        "tier": "Standard"      }    }  ],  "outputs": {    "storageEndpoint": {        "type": "object",        "value": "[reference(parameters('storageName')).primaryEndpoints]"    }  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°† ARM æ¨¡æ¿éƒ¨ç½²åˆ° Azure æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>éƒ¨ç½²æœ¬åœ°æ¨¡æ¿</li><li>éƒ¨ç½²å·²é“¾æ¥çš„æ¨¡æ¿</li><li>åœ¨æŒç»­éƒ¨ç½²ç®¡é“ä¸­è¿›è¡Œéƒ¨ç½²</li></ul><p>ä½¿ç”¨ Azure CLI å‘½ä»¤ <code>az deployment group create</code> æˆ– A<code>zure PowerShell å‘½ä»¤ New-AzResourceGroupDeployment</code>ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ az login$ az account list --output table$ az account set --subscription &lt;subscription_name&gt;$ az group list --output table$ az configure --defaults group=&lt;resource_group&gt;$ templateFile="azuredeploy.json"$ today=$(date +"%d-%b-%Y")$ DeploymentName="addSkuParameter-"$today$ az deployment group create \  --name $DeploymentName \  --template-file $templateFile \  --parameters storageSKU=Standard_GRS storageName=&lt;your-unique-name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Azure </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> äº‘å¹³å° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Gradio&amp;huggingfaceå¿«é€Ÿæ­å»ºä¸€ä¸ªChatGPT APP</title>
      <link href="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/"/>
      <url>/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç°åœ¨çš„NLPé¢†åŸŸï¼ŒGPTç³»åˆ—æ¨¡å‹å·²ç»æˆä¸ºäº†NLPé¢†åŸŸçš„æ ‡é…ä¹‹ä¸€ï¼Œè€ŒChatGPTæ˜¯åŸºäºGPTçš„ä¸€ä¸ªèŠå¤©æ¨¡å‹ï¼Œå¯ä»¥ç”¨æ¥ç”Ÿæˆå¯¹è¯ï¼Œå…¶æ•ˆæœéå¸¸å¥½ï¼Œå¯ä»¥è¯´æ˜¯ç›®å‰æœ€å¥½çš„å¼€æºèŠå¤©æ¨¡å‹äº†ã€‚<br>ä¸å°‘ä½¿ç”¨è€…å·²ç»å°†ChatGPTå½“åšäº†æ—¥å¸¸å·¥ä½œçš„åŠ©æ‰‹ï¼Œä¸‹é¢è¿™ä¸ªchatç•Œé¢åŸºæœ¬å·²ç»å¹¿ä¸ºäººçŸ¥ã€‚<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/chatGPT_conversation.png" alt="ChatGPTä¼šè¯ç•Œé¢"></p><p>ä½† ChatGPT å¹¶ä¸ä»…ä»…æ˜¯æ”¯æŒä»¥ä¸Šçš„èŠå¤©ä¼šè¯åŠŸèƒ½ï¼ŒOpenAI å…¬å¸ä¹Ÿå¼€æ”¾äº†ä»¥ä¸Šä¼šè¯èŠå¤©èƒŒåçš„ APIã€‚</p><span id="more"></span><p>è¿™äº› API å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œä½¿ç”¨å‘½ä»¤è¡Œï¼ˆç§‘å­¦ä¸Šç½‘ï¼‰ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ­å»ºæœåŠ¡å™¨ã€‚<br>å¦‚æœä»…ä»…åªæ˜¯æƒ³ä½¿ç”¨ API æ„å»ºä¸€ä¸ªä¼šè¯æœåŠ¡ï¼Œæˆ–è€… Generic èŠå¤©æœºå™¨äººï¼Œä¸“é—¨æ­å»ºä¸€ä¸ªæœåŠ¡å™¨æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å¤§çš„æ„ä¹‰ã€‚<br>ä½†å¦‚æœä»å­¦ä¹ å’Œå°è¯•æ„å»º ChatGPT åº”ç”¨çš„è§’åº¦ã€ä»ä¸Šæ‰‹ç¨‹åº¦æ¥è¡¡é‡çš„è¯ï¼ŒGradio + huggingface ä¸å¤±ä¸ºä¸€ç§å¿«é€Ÿæ„å»ºçš„æ–¹å¼ã€‚<br>Gradio æ˜¯ä¸€ä¸ªå¯ä»¥å¿«é€Ÿæ­å»º Python web çš„å·¥å…·åŒ…ï¼ŒHuggingface æ”¯æŒæºç ç®¡ç†ã€ Gradio åº”ç”¨çš„å¿«é€Ÿæ„å»ºå’Œéƒ¨ç½²ã€‚</p><h3 id="1-ä½¿ç”¨-ChatGPT-API-ç¼–ç¨‹">1. ä½¿ç”¨ ChatGPT API ç¼–ç¨‹</h3><h4 id="1-1-Python-OpenAI-lib-ä¸‹è½½å’Œå®‰è£…">1.1 Python OpenAI lib ä¸‹è½½å’Œå®‰è£…</h4><p>åœ¨æ–°å»ºçš„å·¥ç¨‹ç›®å½•ä¸‹ï¼Œå®‰è£… openAI libã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ pipenv install openai# æˆ–è€…ä½¿ç”¨ pip å·¥å…·å®‰è£…ï¼Œä½œè€…æœ¬äººæ›´åçˆ± pipenvï¼Œå› æ­¤ Python æ–‡ç« é‡Œé¢éƒ½ä½¿ç”¨ pipenv ä½œä¸ºåŒ…ç®¡ç†å’Œæ„å»ºå·¥å…·<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="1-2-é’ˆå¯¹-ChatGPT-API-ç¼–ç¨‹">1.2 é’ˆå¯¹ ChatGPT API ç¼–ç¨‹</h4><p>åœ¨å·¥ç¨‹ç›®å½•ä¸‹ç¼–å†™Chatgptå·¥å…·æ–‡ä»¶<code>chatgpt_api.py</code>ã€‚</p><pre class="line-numbers language-none"><code class="language-none">class ChatgptAPI:    def __init__(self, api_key):        openai.api_key = api_key    def get_single_completion(self, prompt, model='gpt-3.5-turbo'):        messages = [{"role": "user", "content": prompt}]        response = openai.ChatCompletion.create(            model=model,            messages=messages,            temperature=0,            max_tokens=2048,            top_p=1,        )        return response.choices[0].message['content']<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¯´æ˜ï¼š</strong><br>æå‰åˆ›å»ºOpenAIè´¦å·ï¼Œç”ŸæˆAPI keyï¼ˆå„ç§æ–¹æ³•å„æ˜¾ç¥é€šï¼Œè¿™é‡Œä¸åšèµ˜è¿°ï¼‰ã€‚</p><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† OpenAI æä¾›çš„APIï¼Œå…¶ä¸­ï¼š</p><ul><li><code>openai.api_key</code> éœ€è¦èµ‹å€¼ OpenAI å®˜ç½‘ä¸Šè·å–çš„ API key</li><li><code>openai.ChatCompletion.create</code>æ–¹æ³•ï¼ˆèƒŒåå°±æ˜¯ API Endpoint: /chat/completionsï¼‰</li><li><code>gpt-3.5-turbo</code> æ¨¡å‹</li></ul><p>æŸ¥é˜…è¿‡OpenAPI<a href="https://platform.openai.com/docs/api-reference">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå¯ä»¥å‘ç°ï¼ŒOpenAI æä¾›äº†å¤šç§æ¨¡å‹ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚<br>åŒæ—¶ï¼Œä¸åŒAPIï¼Œæ”¯æŒå’Œå…¼å®¹ä¸åŒçš„æ¨¡å‹ã€‚<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/model_endpoint_compatibility.png" alt="model endpoint compatibility"></p><p>GPT 4 ç‰ˆæœ¬ä»¥ä¸‹ï¼Œè¾ƒæ¨èçš„ä¸¤ä¸ªæ¨¡å‹ï¼Œä¸€ä¸ªæ˜¯ <code>gpt-3.5-turbo</code>ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>text-davinci-003</code>ã€‚<br>è¿™ä¸¤ä¸ªæ¨¡å‹çš„åŒºåˆ«åœ¨äºï¼šgpt-3.5-turbo æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œè€Œ text-davinci-003 æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ–‡æœ¬ç”Ÿæˆçš„æ¨¡å‹ã€‚<br>ä½† gpt-3.5-turbo çš„ä»·æ ¼åªæœ‰ text-davinci-003 çš„ 1/10, åŒæ—¶å“åº”é€Ÿåº¦ä¹Ÿæ¯” text-davinci-003 æ›´å¿«ã€‚<br>å› æ­¤ï¼Œgpt-3.5-turbo æ˜¯ä¸€ä¸ªæ€§èƒ½è‰¯å¥½ä¸”ç›¸å¯¹ç»æµå®æƒ çš„GPTæ¨¡å‹ç‰ˆæœ¬ï¼Œé€‚ç”¨äºè®¸å¤šè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ï¼Œå®ƒæä¾›å¿«é€Ÿçš„å“åº”æ—¶é—´å’Œé«˜è´¨é‡çš„æ–‡æœ¬ç”Ÿæˆèƒ½åŠ›ã€‚<br>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒText-davinci-003 æ›´é€‚åˆå¯¹ç”Ÿæˆæ–‡æœ¬è´¨é‡è¦æ±‚æ›´é«˜ã€ä¸”å¯¹å“åº”æ—¶é—´è¦æ±‚ç›¸å¯¹è¾ƒä½çš„åº”ç”¨åœºæ™¯ã€‚</p><p><strong>ä¸‹é¢æ˜¯å®˜æ–¹å¯¹äº3.5ç‰ˆæœ¬çš„æ¨¡å‹çš„å¯¹æ¯”</strong>ï¼š<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/models.png" alt="GPT-3.5 models"></p><h4 id="1-3-Max-Tokens">1.3 Max Tokens</h4><p>åœ¨ä¸Šé¢çš„æ¨¡å‹å¯¹æ¯”å›¾ä¸­ï¼Œä¼šæ³¨æ„åˆ°æœ‰ä¸€ä¸ª<code>Max Tokens</code>çš„æ¦‚å¿µã€‚</p><ul><li>é¦–å…ˆï¼ŒTokens æœ¬èº«æ˜¯æ–‡æœ¬å¤„ç†æ—¶è¿›è¡Œåˆ†è¯çš„æœ€å°å•ä½ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ChatGPTæŠ¥ä»·æ”¶è´¹çš„æœ€å°å•ä½ã€‚<br>æ¯”å¦‚ï¼Œgpt-3.5-turbo ä»·æ ¼æ˜¯ $0.002 / 1K tokensï¼Œtext-davinci-003 åˆ™æ˜¯ $0.0200 / 1K tokensã€‚è¿™ç§æ”¶è´¹æ–¹å¼çœ‹èµ·æ¥ï¼Œè·Ÿä»¥å¤ªåŠçš„ GAS æ¯”è¾ƒç›¸åƒã€‚</li><li>å¦å¤–ï¼Œæ¨¡å‹ä¸­çš„ Max Tokens æ˜¯æŒ‡ï¼Œæ¯æ¬¡è¯·æ±‚çš„æœ€å¤§ tokens æ•°é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šé™åˆ¶æ–‡æœ¬çš„æœ€å¤§é•¿åº¦ã€‚<br>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ¯æ¬¡è¯·æ±‚çš„Max Tokens = User è¯·æ±‚çš„Tokens + AI assistant å“åº”çš„Tokensã€‚ä¹Ÿå°±æ„å‘³ç€ï¼Œå¦‚æœç”¨æˆ·è¯·æ±‚çš„æ–‡æœ¬é•¿åº¦è¿‡é•¿ï¼Œå—Max Tokensçš„é™åˆ¶ï¼Œç•™ç»™AIç”Ÿæˆçš„ Tokenæ•°é‡ä¼šå¾ˆå°‘ï¼Œä»è€Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚</li></ul><p>å› æ­¤ï¼Œå¯¹äºç”¨æˆ·è€Œè¨€ï¼ŒMax Tokens çš„é™åˆ¶ä¼šé€ æˆä¸¤æ–¹é¢çš„è€ƒè™‘ï¼š</p><ul><li>ä¸€æ¬¡è¯·æ±‚çš„æœ€å¤§æ–‡æœ¬é•¿åº¦ï¼Œé˜²æ­¢æ–‡æœ¬è¿‡é•¿ï¼Œé€ æˆè¯·æ±‚å¤±è´¥ã€‚</li><li>å¤„ç†å¤šè½®ä¼šè¯çš„ç­–ç•¥ã€‚GPT APIå¹¶ä¸ä¼šå¸®åŠ©å®¢æˆ·ç«¯ç¼“å­˜ä¸Šä¸‹æ–‡ï¼Œä¸¤æ¬¡APIè¯·æ±‚ä¹‹é—´æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå› æ­¤éœ€è¦å®¢æˆ·ç«¯è‡ªå·±æ¥å¤„ç†å¤šè½®ä¼šè¯çš„ä¸Šä¸‹æ–‡ã€‚<br>æ¯æ¬¡è¯·æ±‚çš„å†…å®¹ï¼Œéƒ½éœ€è¦åŒ…å«ä¹‹å‰è¯·æ±‚çš„æ–‡æœ¬ä¸Šä¸‹æ–‡ï¼Œå—Max Tokensé™åˆ¶ï¼Œå¯¹è¯è½®æ•°è¶Šå¤šï¼Œè¯·æ±‚ä¸­ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬å æ¯”å°±ä¼šè¶Šé«˜ï¼Œç•™ç»™AIç”Ÿæˆçš„Tokenä½™é‡å°±ä¼šè¶Šå°‘ã€‚</li></ul><p>ä»£ç ä¸­é’ˆå¯¹è¿™ä¸¤é¡¹è€ƒè™‘ï¼Œå¯åšå¦‚ä¸‹å¤„ç†ï¼ˆä¸”ä¸é™æ­¤æ–¹å¼ï¼‰ï¼š</p><ul><li>è®¾ç½®APIçš„ max_tokenså‚æ•°ï¼Œè¿™é‡Œé™åˆ¶çš„æ˜¯AIç”Ÿæˆçš„Tokenæœ€å¤§æ•°ã€‚é™¤AIç”Ÿæˆçš„Max Tokenså¤–ï¼Œè¯·æ±‚ + å“åº”ä¸­æ€»çš„ Max Tokens å—æ¨¡å‹ç±»å‹é™åˆ¶ã€‚</li><li>åˆ›å»ºä¼šè¯ä¸Šä¸‹æ–‡ç±»å‹ï¼ˆæ¯”å¦‚ Conversationï¼‰ï¼Œç”¨ä»¥ä¿å­˜å’Œä¼ é€’å¤šè½®ä¼šè¯çš„ä¸Šä¸‹æ–‡ã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">class ChatgptAPI:    â€¦â€¦    def get_multi_round_completion(self, prompt, conversation, model='gpt-3.5-turbo'):        conversation.append_question(prompt)        prompts = conversation.get_prompts()        response = openai.ChatCompletion.create(            model=model,            messages=prompts,            temperature=0,            max_tokens=2048,            top_p=1,        )        message = response.choices[0].message['content']        conversation.append_answer(message)        return message, conversationclass Conversation:    def __init__(self, system_prompt='', num_of_round = 5):        self.num_of_round = num_of_round        self.history = []        self.initialized = False        self.history.append({"role": "system", "content": system_prompt})        if len(system_prompt) &gt; 0:            logger.info(f'Conversation initialized with system prompt: {system_prompt}')            self.initialized = True    def is_initialized(self):        return self.initialized        def append_question(self, question):        self.history.append({"role": "user", "content": question})    def append_answer(self, answer):        self.history.append({"role": "assistant", "content": answer})        if len(self.history) &gt; self.num_of_round * 2:            del self.history[1:3]    def clear(self):        self.history.clear()        self.initialized = False    def get_prompts(self):        return self.history        def round_size(self):        return 0 if len(self.history) &lt; 2 else len(self.hitory) - 1        def get_history_messages(self):        return [(u['content'], b['content']) for u,b in zip(self.history[1::2], self.history[2::2])]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬å°†ç”¨æˆ·çš„è¯·æ±‚æ–‡æœ¬å’ŒAI assistantçš„å“åº”æ–‡æœ¬ï¼Œéƒ½ç¼“å­˜åˆ°äº†<code>Conversation</code>ç±»ä¸­ã€‚åœ¨æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œå°† Conversaction ä¸­ç¼“å­˜çš„æ–‡æœ¬ä½œä¸º<code>prompt</code>ä¼ å…¥ï¼Œä»è€Œå®ç°å¤šè½®ä¼šè¯çš„åŠŸèƒ½ã€‚<br>åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨<code>Conversation</code>ç±»ä¸­å¢åŠ ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œæ¯”å¦‚è®¾ç½®ç¼“å­˜çš„æœ€å¤§è½®æ•°ï¼Œè¶…è¿‡æœ€å¤§è½®æ•°åˆ™ä»ç¼“å­˜ä¸­åˆ é™¤æœ€æ—©çš„ä¼šè¯è®°å½•ã€‚</p><h3 id="2-ä½¿ç”¨-Gradio-æ¡†æ¶æ„å»ºäº¤äº’å±‚">2. ä½¿ç”¨ Gradio æ¡†æ¶æ„å»ºäº¤äº’å±‚</h3><p>ä½¿ç”¨ Gradio æ¡†æ¶ï¼Œå¯ä»¥å¿«é€Ÿæ„å»ºä¸€ä¸ªäº¤äº’å¼çš„Webåº”ç”¨ï¼Œç›´æ¥ä½¿ç”¨ Python åˆ›å»ºå‰ç«¯é¡µé¢å’Œäº¤äº’ã€‚</p><h4 id="2-1-å®‰è£…-Gradio">2.1 å®‰è£… Gradio</h4><p>åœ¨å·¥ç¨‹ç›®å½•ä¸‹ï¼Œç»§ç»­å®‰è£… Gradio lib åŒ…ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ pipenv install gradio<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-2-ç¼–å†™-Web-ä»£ç ">2.2 ç¼–å†™ Web ä»£ç </h4><p>åœ¨å·¥ç¨‹ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>app.py</code>çš„æ–‡ä»¶ï¼Œç”¨äºç¼–å†™ Web ä»£ç ã€‚</p><pre class="line-numbers language-none"><code class="language-none">import loggingimport osimport gradio as grfrom tools.chatGPT_API import Conversation, ChatgptAPIchat_api = ChatgptAPI(os.environ.get("OPENAI_API_KEY"))def predict(system_input, password_input, user_input, conversation):    if password_input != os.environ.get("APP_PASSWORD"):       return [(None, "Wrong password!")], conversation, user_input    if conversation.is_initialized() == False:        conversation = Conversation(system_input, 5)    _, conversation = chat_api.get_multi_round_completion(user_input, conversation)    return conversation.get_history_messages(), conversation, Nonedef clear_history(conversation):    conversation.clear()    return None, conversationwith gr.Blocks(css="#chatbot{height:350px} .overflow-y-auto{height:600px}") as demo:    chatbot = gr.Chatbot(elem_id="chatbot")    conversation = gr.State(value=Conversation())    with gr.Row():      system_in_txt = gr.Textbox(lines=1, label="System role content:", placeholder="Enter system role content")      password_in_txt = gr.Textbox(lines=1, label="Password:", placeholder="Enter password")           with gr.Row():      user_in_txt = gr.Textbox(lines=3, label="User role content:", placeholder="Enter text...").style(container=False)        with gr.Row():      submit_button = gr.Button("Submit")      reset_button = gr.Button("Reset")        submit_button.click(predict, [system_in_txt, password_in_txt, user_in_txt, conversation], [chatbot, conversation, user_in_txt])    reset_button.click(clear_history, [conversation], [chatbot, conversation], queue=False)demo.launch()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/Gradio_UI.png" alt="ç•Œé¢æ•ˆæœ"><br><strong>è¯´æ˜:</strong><br>- ä½¿ç”¨äº† Gradio çš„ Chatbot ç»„ä»¶ï¼Œç”¨äºå±•ç¤º User è¯·æ±‚æ–‡æœ¬å’Œ AI assistant çš„å“åº”æ–‡æœ¬ã€‚<br>- ä½¿ç”¨äº† Gradio çš„ State ç»„ä»¶ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·çš„ Conversaction å¯¹è±¡ã€‚<br>- ä½¿ç”¨äº† Gradio çš„ Textbox ç»„ä»¶ï¼Œç”¨äºç”¨æˆ·è¾“å…¥ç³»ç»Ÿæç¤ºæ–‡æœ¬ã€å¯†ç å’Œè¯·æ±‚æ–‡æœ¬ã€‚<br>- ä½¿ç”¨äº† Gradio çš„ Button ç»„ä»¶ï¼Œç”¨äºè§¦å‘ç”¨æˆ·çš„è¯·æ±‚ã€‚</p><p>è¯¦ç»† Gradio å…¥é—¨å¯å‚è€ƒï¼š<a href="https://gradio.app/getting_started">Gradio document</a></p><h3 id="3-æäº¤å’Œéƒ¨ç½²åˆ°-Huggingface">3. æäº¤å’Œéƒ¨ç½²åˆ° Huggingface</h3><h4 id="3-1-åˆ›å»º-Huggingface-Space">3.1 åˆ›å»º Huggingface Space</h4><p>åœ¨ Huggingface ä¸Šåˆ›å»º Spaceï¼Œæ­¥éª¤åŸºæœ¬è·Ÿåˆ›å»º Github çš„Repositoryä¸€æ ·ã€‚<br>å¹¶ä¸”ï¼Œéœ€è¦é€‰æ‹© Space éƒ¨ç½²æ—¶</p><ul><li>Space SDKï¼šGradio</li><li>Space Hardwareï¼šæœ‰å…è´¹çš„<code>CPU</code>å’Œä»˜è´¹çš„<code>GPU</code>å¯é€‰<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/create_space_in_hugging_face.png" alt="Create Space"></li></ul><h4 id="3-2-è®¾ç½®ç¯å¢ƒå˜é‡">3.2 è®¾ç½®ç¯å¢ƒå˜é‡</h4><p>åœ¨ Space ä¸­ï¼Œéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºå­˜å‚¨ OpenAI API Key å’Œ Web App çš„å¯†ç (ä¸ºäº†é˜²æ­¢åé¢App bublicä¹‹åï¼ŒAPI Key è¢«æ»¥ç”¨)ã€‚<br>Gradio å¯åŠ¨æ—¶ï¼Œä¼šä»ç¯å¢ƒå˜é‡ä¸­åŠ è½½è¿™äº›å€¼ã€‚<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/new_repository_secrets.png" alt="Set Environment Variables"></p><h4 id="3-3-æäº¤ä»£ç åˆ°-Huggingface-Space">3.3 æäº¤ä»£ç åˆ° Huggingface Space</h4><p>é€‰æ‹©å°† Space çš„ Repository ç”¨ git clone åˆ°æœ¬åœ°ï¼Œä½¿ç”¨æ–¹æ³•è·Ÿ Github ä¸€æ ·ã€‚<br>ç„¶åï¼Œå°†å‰é¢ä¸¤èŠ‚ç¼–å†™çš„ä»£ç é€šè¿‡ git push åˆ° Huggingfaceï¼ŒHuggingface ä¼šè‡ªåŠ¨å®Œæˆæ„å»ºï¼Œå¹¶éƒ¨ç½² Web Appã€‚<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/build_space.png" alt="build App"></p><p>æ„å»ºå®Œæˆä»¥åï¼ŒWeb App ä¼šç›´æ¥æ˜¾ç¤ºåœ¨ Huggingface Spaceçš„é¡µé¢ä¸Šã€‚<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/chat_web_app.png" alt="Chat Web App"></p><h4 id="3-4-è®¾ç½®-Space-visibility-Public">3.4 è®¾ç½® Space visibility Public</h4><p>å¦‚æœåœ¨åˆ›å»º Space æ—¶ï¼Œé€‰æ‹©äº†å°† Visibility è®¾ç½®ä¸º Privateï¼Œé‚£ä¹ˆåªæœ‰ Space çš„ Owner å’Œ Collaborator æ‰èƒ½è®¿é—®åˆ° Web Appã€‚<br>åŒæ—¶ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡è¯¥ Space çš„ URL è®¿é—®åˆ° Appã€‚</p><p>è‹¥æ˜¯æƒ³è¦å…¶ä»–äººèƒ½é€šè¿‡ Space çš„ URL è®¿é—®åˆ° Web Appï¼Œæˆ–è€…éœ€è¦å°† App åµŒå…¥å…¶ä»–ç½‘ç«™è¿›è¡Œè®¿é—®æ—¶ï¼Œåˆ™éœ€è¦å°† Visibility è®¾ç½®ä¸º Publicã€‚<br>åœ¨è®¾ç½®æˆäº† Public ä¹‹åï¼ŒSpace çš„èœå•ä¼šå‡ºç°<code>Embed this Space</code>ã€‚<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/embed_space.png" alt="Embed this Space"><br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/embed_space_2.png" alt="Embed this Space"></p><p>æ ¹æ®ä¸Šå›¾çš„æç¤ºï¼Œå°†<code>&lt;script&gt;</code>å’Œ<code>&lt;gradio-app&gt;</code>æ ‡ç­¾å¤åˆ¶åˆ°å…¶ä»–ç½‘ç«™çš„ HTML ä¸­ï¼Œå³å¯åµŒå…¥åˆ°å…¶ä»–ç½‘ç«™ä¸­ã€‚<br>æ•ˆæœè§åé¢ã€‚</p><h3 id="4-æˆæœå±•ç¤º">4. æˆæœå±•ç¤º</h3><script type="module" src="https://gradio.s3-us-west-2.amazonaws.com/3.29.0/gradio.js"></script><p><gradio-app src="https://ellendan-chat-lab.hf.space"></gradio-app></p><p>App çš„ Password Input éœ€è¦è¾“å…¥ä½œè€…ä¸ªäººå¾®ä¿¡å·çš„å·ç ï¼Œæ¬¢è¿å¤§å®¶è¯•ç”¨ã€‚<br>åŒæ—¶ï¼Œç”±äº GPT API çš„è°ƒç”¨ï¼Œæœ‰ Rate limits, API æ¯åˆ†é’Ÿçš„è°ƒç”¨æ¬¡æ•°æœ‰é™åˆ¶ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°æ— æ³•å“åº”çš„æƒ…å†µã€‚</p><ul><li><code>RPM</code> - request per minute</li><li><code>TPM</code> - token per minute<br><img src="/2023/05/17/shi-yong-gradio-huggingface-kuai-su-da-jian-yi-ge-chatgpt-app/rate_limits.png" alt="rate limits"></li></ul>]]></content>
      
      
      <categories>
          
          <category> ChatGPT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> ChatGPT </tag>
            
            <tag> ML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åæ‰‹å›æ‘¸Oracle</title>
      <link href="/2022/08/22/fan-shou-hui-mo-oracle/"/>
      <url>/2022/08/22/fan-shou-hui-mo-oracle/</url>
      
        <content type="html"><![CDATA[<p>æœ€åä¸€æ¬¡ç”¨ Oracle åº”è¯¥è¿˜æ˜¯åœ¨2012çš„æ—¶å€™ï¼Œä¹‹åå°±ä¸€è·¯ç”¨å¼€æºæ•°æ®åº“ã€‚<br>æ²¡æƒ³åˆ°ç°åœ¨è¿˜æœ‰åæ‰‹å›æ‘¸çš„æ—¶å€™ã€‚<br>å›æ‘¸ä¹Ÿå°±ç®—äº†ï¼Œç­‰å‡†å¤‡å¥½ Oracle çŸ¥è¯†å›é¡¾ï¼Œæœ€åå‘ç°è®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ï¼Œæš‚æ—¶ç”¨ä¸ä¸Šäº†ã€‚<br>é‡æ–° review äº†ä¸€æŠŠè‡ªå·±çš„kanbanå’Œè®¡åˆ’æ¸…å•ï¼Œèµ¶ç´§è®°å½•ä¸€ä¸‹ï¼Œå›åˆ°ç›®æ ‡çš„äº‹åŠ¡ä¸Šå»ã€‚</p><span id="more"></span><h3 id="1-MacOS-å®‰è£…-Oracle">1. MacOS å®‰è£… Oracle</h3><p>å¯¹äºå·²ç»ä¹ æƒ¯äº†æ‰€æœ‰å·¥å…·éƒ½è¦æœ¬åœ°è£…ä¸€è£…ã€æ‘¸ä¸€æ‘¸çš„å·¥ç¨‹å¸ˆè€Œè¨€ï¼Œè£…ä¸ªå•ä¾‹æ•°æ®åº“è¿™äº‹å„¿è‡ªç„¶ä¸åœ¨è¯ä¸‹ã€‚<br>ç„¶è€Œsearch homebrew å’Œ dockerhubï¼Œçªç„¶å‘ç° â€”â€” å±…ç„¶æ²¡æœ‰oracle databaseã€‚è¿™ä¸å°±å°´å°¬äº†å˜›ï¼Ÿ<br>å» Oracle å®˜ç½‘æŸ¥çœ‹äº†ä¸€ä¸‹ï¼Œè¦æƒ³åœ¨ MacOS ä¸Šå®‰è£…Oracleï¼Œä¸¤ç§æ–¹å¼ï¼š1. visualBox 2. æœ¬åœ° dockerfile buildã€‚<br>é‚£è‡ªç„¶æ˜¯é€‰æ‹©2äº†ã€‚</p><h4 id="1-1-Oracle-å®˜æ–¹dockerfileå¤§åˆé›†">1.1. Oracle å®˜æ–¹dockerfileå¤§åˆé›†</h4><p>è®¿é—® Oracle å®˜æ–¹åœ¨ github ä¸Š repo <a href="https://github.com/oracle/docker-images">docker-images</a>ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ git clone git@github.com:oracle/docker-images.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å­ç›®å½•æ˜¯ Oracle å„ç§äº§å“ç›®å½•ã€‚æ¯”å¦‚databaseï¼Œå°±æ˜¯ <code>OracleDatabase</code>, OGG å°±æ˜¯ <code>OracleGoldenGate</code>ã€‚</p><h4 id="1-2-æŸ¥çœ‹-dockerfile">1.2. æŸ¥çœ‹ dockerfile</h4><p>è¿›å…¥åˆ°æœ¬åœ° repo ç›®å½• <code>OracleDatabase/SingleInstance/dockerfiles</code>ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰æ”¯æŒçš„æ•°æ®åº“ç‰ˆæœ¬ï¼š<br><img src="/2022/08/22/fan-shou-hui-mo-oracle/dockerfile_list.png" alt="dockerfile_list"><br>é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ¯”å¦‚ 19.3.0ï¼Œè¿›å…¥ç›®å½•ã€‚</p><h4 id="1-3-ä¸‹è½½-Linux-Oracle-Database-ç¨‹åºåŒ…">1.3. ä¸‹è½½ Linux Oracle Database ç¨‹åºåŒ…</h4><p>å¯ä»¥æŸ¥æ‰¾å®˜ç½‘ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ readme æ–‡ä»¶ä¸Šçš„é“¾æ¥è·³å…¥ä¸‹è½½é¡µé¢ã€‚<br>ç‚¹å‡»é“¾æ¥ï¼Œæ‰‹åŠ¨ä¸‹è½½ã€‚<br><img src="/2022/08/22/fan-shou-hui-mo-oracle/oracle_download_page.png" alt="download_page"><br>å¯¹ï¼Œ2.8Gã€‚</p><h4 id="1-4-å°†ä¸‹è½½çš„databaseç¨‹åºåŒ…ç§»å…¥OracleDatabase-SingleInstance-dockerfiles-19-3-0">1.4. å°†ä¸‹è½½çš„databaseç¨‹åºåŒ…ç§»å…¥<code>OracleDatabase/SingleInstance/dockerfiles/19.3.0/</code></h4><p><img src="/2022/08/22/fan-shou-hui-mo-oracle/zip_into_directory.png" alt="zip into directory"></p><h4 id="1-5-è¿è¡ŒbuildContainerImage">1.5. è¿è¡ŒbuildContainerImage</h4><p>å›åˆ°<code>OracleDatabase/SingleInstance/dockerfiles</code>ç›®å½•ï¼Œè¿è¡Œå‘½ä»¤<code>buildContainerImage.sh</code>ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ ./buildContainerImage.sh -h$ ./buildContainerImage.sh -v 19.3.0 -s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><em>æ³¨æ„</em> è¿è¡Œå‘½ä»¤buildä¹‹å‰ï¼Œç¡®ä¿æœ¬åœ°æ²¡æœ‰å¼€å¯ä»»ä½•ç½‘ç»œä»£ç†ï¼Œä¸ç„¶ build æ—¶ä¼šå¤±è´¥ã€‚<br>buildæˆåŠŸä¹‹åï¼Œé€šè¿‡<code>docker images</code>æŸ¥çœ‹imageï¼Œæ€»å¤§å°6ä¸ªå¤šGï¼Œä½“é‡æ„Ÿäººã€‚ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœæƒ³è¦å®‰è£…å…¶ä»–ç‰ˆæœ¬ï¼Œæ¯”å¦‚18.4.0 å’Œ xe ç‰ˆæœ¬ï¼Œç›¸åŒçš„æ­¥éª¤å’Œæ–¹å¼ï¼Œä½†å¯èƒ½éœ€è¦ä¿®æ”¹dockerfileçš„éƒ¨åˆ†è¯­å¥ã€‚<br>å³ä½¿è¿›è¡Œäº†dockerfileä¿®æ”¹ï¼Œxe ç‰ˆæœ¬æœ¬äººbuildå¹¶æ²¡æœ‰æˆåŠŸè¿‡ï¼Œè¿™ä¸ªéœ€è¦å†æ¬¡æ£€éªŒå’ŒæŸ¥çœ‹ã€‚</p><h4 id="1-6-docker-run">1.6. docker run</h4><pre class="line-numbers language-none"><code class="language-none">docker run --name oracle19 -d -p 11521:1521 -p 15500:5500 -e ORACLE_PWD=123456 -v ~/tmp-oradata:/opt/oracle/oradata oracle/database/19.3.0-se2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ—¶å€™ï¼Œé€šè¿‡docker hostæœ¬åœ° 11521 ç«¯å£ï¼Œå°±å¯ä»¥è¿æ¥docker oracleäº†ã€‚</p><h3 id="2-Oracle-Database-åŸºç¡€æ¦‚å¿µå’Œè¯­å¥å›¾è°±">2. Oracle Database åŸºç¡€æ¦‚å¿µå’Œè¯­å¥å›¾è°±</h3><div class="markmap-container" style="height:800px">  <svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[0,1]},&quot;v&quot;:&quot;Oracle Database&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;æ•°æ®åº“æ¦‚å¿µ&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;æ•°æ®åº“&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;SQL&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;æŸ¥çœ‹å½“å‰æ•°æ®åº“ï¼šselect name from V$DATABASE;&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;æ•°æ®åº“å®ä¾‹&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;SQL&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;æŸ¥çœ‹å½“å‰æ•°æ®åº“å®ä¾‹ï¼šselect name from V$INSTANCE;&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;SID&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;CDB &amp;amp; PDB&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;SQLPLUS&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;tnsnames.ora&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;sqlnet.ora&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;è¿æ¥&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;sqlplus username/password@host:port/SID&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;conn username/password&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;ç”¨æˆ·/è§’è‰²/æƒé™&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[17,18]},&quot;v&quot;:&quot;ç”¨æˆ·&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;SQL&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[19,20]},&quot;v&quot;:&quot;åˆ›å»ºç”¨æˆ·ï¼šcreate user ogg identified by ogg default tablespace customer;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[20,21]},&quot;v&quot;:&quot;æŸ¥è¯¢ç”¨æˆ·ï¼šselect * from dba_users where lower(username)=â€˜ogg';&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;åˆ é™¤ç”¨æˆ·ï¼šdrop user ogg;&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[22,23]},&quot;v&quot;:&quot;è§’è‰²&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;SQL&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[24,25]},&quot;v&quot;:&quot;åˆ›å»ºè§’è‰²ï¼šcreate role etl;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[25,26]},&quot;v&quot;:&quot;æŸ¥è¯¢è§’è‰²ï¼šselect * from DBA_ROLES;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[26,27]},&quot;v&quot;:&quot;è§’è‰²æˆæƒï¼ˆç³»ç»Ÿï¼‰ï¼šgrant connect,resource,create session, alter session to etl;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[27,28]},&quot;v&quot;:&quot;è§’è‰²æˆæƒï¼ˆå¯¹è±¡ï¼‰ï¼šgrant insert,update,delete on t_custmer to etl;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[28,29]},&quot;v&quot;:&quot;ç»™ç”¨æˆ·æ·»åŠ è§’è‰²ï¼šgrant etl01 to ogg;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[29,30]},&quot;v&quot;:&quot;åˆ é™¤è§’è‰²ï¼šdrop role etl;&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[30,31]},&quot;v&quot;:&quot;æƒé™&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[31,32]},&quot;v&quot;:&quot;å®šä¹‰&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[32,33]},&quot;v&quot;:&quot;ç³»ç»Ÿæƒé™&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[33,34]},&quot;v&quot;:&quot;å¯¹è±¡æƒé™ï¼šæŒ‡ç”¨æˆ·å¯¹å·²æœ‰å¯¹è±¡çš„æ“ä½œæƒé™ã€‚&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[34,35]},&quot;v&quot;:&quot;SQL&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[35,36]},&quot;v&quot;:&quot;ç³»ç»Ÿæƒé™&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[36,37]},&quot;v&quot;:&quot;æŸ¥è¯¢ç³»ç»Ÿæƒé™ï¼šselect distinct PRIVILEGE from DBA_SYS_PRIVS;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[37,38]},&quot;v&quot;:&quot;æŸ¥è¯¢granteeæ‹¥æœ‰çš„æƒé™ï¼šselect * from DBA_SYS_PRIVS where lower(grantee)='oggâ€™;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[38,39]},&quot;v&quot;:&quot;ç»™ç”¨æˆ·æ·»åŠ æƒé™ï¼šgrant create session,alter session to ogg;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[39,40]},&quot;v&quot;:&quot;æ”¶å›æƒé™ï¼šrevoke alter session from ogg;&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[40,41]},&quot;v&quot;:&quot;å¯¹è±¡æƒé™&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[41,42]},&quot;v&quot;:&quot;æŸ¥è¯¢granteeç”¨æˆ·çš„å¯¹è±¡æƒé™ï¼šselect grantee, table_name, privilege from dba_tab_privs where lower(grantee) = â€˜oggâ€™;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[42,43]},&quot;v&quot;:&quot;åˆ†é…å¯¹è±¡æƒé™ï¼šgrant all on t_employees to ogg;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[43,44]},&quot;v&quot;:&quot;æ”¶å›æƒé™ï¼šrevoke delete on t_employees from ogg;&quot;}]}]}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[44,45]},&quot;v&quot;:&quot;é€»è¾‘ç»“æ„&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[45,46]},&quot;v&quot;:&quot;æ•°æ®åº“/è¡¨ç©ºé—´/è¡¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[46,47]},&quot;v&quot;:&quot;æ•°æ®åº“&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[47,48]},&quot;v&quot;:&quot;SQL&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[48,49]},&quot;v&quot;:&quot;è¡¨ç©ºé—´&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[49,50]},&quot;v&quot;:&quot;SQL&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[50,51]},&quot;v&quot;:&quot;åˆ›å»ºè¡¨ç©ºé—´ï¼šCREATE TABLESPACE customer datafile '/opt/oracle/oradata/XE/customer.dbf' SIZE 100M autoextend on next 20M Maxsize 500M;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[51,52]},&quot;v&quot;:&quot;åˆ é™¤è¡¨ç©ºé—´ï¼šdrop tablespace customer including contents and datafiles;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[52,53]},&quot;v&quot;:&quot;æŸ¥çœ‹è¡¨ç©ºé—´æ•°æ®æ–‡ä»¶ï¼šselect file_name, tablespace_name from DBA_DATA_FILES order by FILE_NAME;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[53,54]},&quot;v&quot;:&quot;æŸ¥çœ‹æ‰€æœ‰è¡¨ç©ºé—´ï¼šSELECT TABLESPACE_NAME, STATUS, ALLOCATION_TYPE, CONTENTS FROM DBA_TABLESPACES;&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[54,55]},&quot;v&quot;:&quot;è¡¨&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[55,56]},&quot;v&quot;:&quot;ç”¨æˆ·/schema/å¯¹è±¡&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[56,57]},&quot;v&quot;:&quot;ç”¨æˆ·&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[57,58]},&quot;v&quot;:&quot;SYS/SYSTEM&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[58,59]},&quot;v&quot;:&quot;SYS æ˜¯ SYSDBAã€‚å¯åˆ›å»ºæ•°æ®åº“ã€‚&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[59,60]},&quot;v&quot;:&quot;SYSTEM æ˜¯ SYSOPERã€‚æƒé™æ¬¡ä¹‹ã€‚&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[60,61]},&quot;v&quot;:&quot;SQL&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[61,62]},&quot;v&quot;:&quot;æŸ¥çœ‹å½“å‰åº“ä¸‹æ‰€æœ‰ç”¨æˆ·ï¼šselect username,ACCOUNT_STATUS,DEFAULT_TABLESPACE, TEMPORARY_TABLESPACE from DBA_USERS;&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[62,63]},&quot;v&quot;:&quot;schema&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[63,64]},&quot;v&quot;:&quot;å®šä¹‰&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[64,65]},&quot;v&quot;:&quot;Schema æ˜¯ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰å¯¹è±¡çš„é›†åˆã€‚å¯¹è±¡åŒ…æ‹¬ï¼šè¡¨ã€ç´¢å¼•ã€è§†å›¾ç­‰ç­‰ã€‚&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[65,66]},&quot;v&quot;:&quot;æ¯ä¸ªç”¨æˆ·éƒ½ä¼šæœ‰ç‹¬ç«‹çš„schemaï¼Œschema å¿…é¡»ä¾èµ–ç”¨æˆ·çš„å­˜åœ¨è€Œå­˜åœ¨ã€‚&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[66,67]},&quot;v&quot;:&quot;SQL&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:12,&quot;p&quot;:{&quot;lines&quot;:[67,68]},&quot;v&quot;:&quot;æŸ¥è¯¢å½“å‰ç”¨æˆ·å’Œschemaï¼šselect sys_context('userenv', 'current_user') current_user, sys_context('userenv', 'current_user') current_schema from dual;&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[68,69]},&quot;v&quot;:&quot;å¯¹è±¡&quot;}]}]}]}"></svg></div>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èŠèŠç ”å‘æ•ˆèƒ½æ²»ç†æ–¹æ¡ˆçš„ç†è®ºæ¡†æ¶ï¼ˆä¸‹ç¯‡ï¼‰</title>
      <link href="/2022/07/18/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-xia-pian/"/>
      <url>/2022/07/18/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-xia-pian/</url>
      
        <content type="html"><![CDATA[<p>å·²ç»è¿‡äº†ä¸€æ—¬ï¼Œä¸‹ç¯‡å±…ç„¶è¿˜æ²¡å¼€å§‹åŠ¨ç¬”ã€‚<br>åæ€äº†ä¸€ä¸‹äººç”Ÿï¼šP<br>ä¹¦æ¥ä¸Šå›ã€‚</p><span id="more"></span><h3 id="2-æ¥ä¸Šç¯‡">2. æ¥ä¸Šç¯‡</h3><p>åœ¨ä¸Šä¸€èŠ‚çš„å¥åº·åº¦æŒ‡æ ‡ä¸­ï¼Œæœ‰éå¸¸é‡è¦çš„ä¸€é¡¹ â€”â€” Lead Timeã€‚<br>Lead Time çš„å®šä¹‰æ¥æºäºä¼ ç»Ÿåˆ¶é€ ä¸šï¼ŒæŒ‡ä»å—è®¢åˆ°å‡ºè´§ä¹‹é—´é—´éš”çš„æ—¶é—´ã€‚<br>åŒæ—¶ï¼Œä¸Lead Time ä¸€åŒè¢«æèµ·çš„ï¼Œè¿˜æœ‰<code>"Cycle Time"</code>ã€‚ è€Œ DevOps çš„åº¦é‡æŒ‡æ ‡ï¼Œä¹ æƒ¯ç§°å…¶ä¸º<code>â€œProcess timeâ€</code>ã€‚<br>Cycle Time å’Œ Process Time, åœ¨è½¯ä»¶ç ”å‘å’Œ DevOps é¢†åŸŸåŸºæœ¬ç›¸äº’ç­‰åŒï¼Œä¸»è¦æŒ‡å»æ‰æ’é˜Ÿç­‰å¾…æ—¶é•¿ï¼Œå¤„äºç”Ÿäº§ä»»åŠ¡ï¼ˆå¢å€¼æ´»åŠ¨ï¼‰æ‰§è¡Œçš„æ—¶é•¿ã€‚</p><p>ä¸€å®šè¦è°ˆä¸‹åŒºåˆ«çš„è¯ï¼Œå¯¹ DevOps å·¥å…·è‡ªåŠ¨åŒ–æ¥è¯´ï¼ŒåŸºæœ¬æ¯ä¸ªç¯èŠ‚çš„æ‰§è¡ŒåŠ¨ä½œéƒ½æ˜¯å¯é‡å¤çš„ã€æ ‡å‡†çš„ï¼Œå› æ­¤â€œå•ä»¶â€çš„ Process time åŸºæœ¬å¯ä»¥ä»£è¡¨å½“å‰ä»»åŠ¡çš„ç”Ÿäº§æ€§èƒ½ã€‚<br>ä½äº DevOps ä¹‹å‰çš„ç ”å‘ç¯èŠ‚ï¼Œæ¯ä»¶åˆ¶å“åŒ…å«çŸ¥è¯†ç±»çš„åˆ›é€ ã€ä¸æ˜¯æ ‡å‡†ä»¶ã€æ— æ³•å‡†ç¡®é‡å¤ï¼Œå› æ­¤åœ¨ç»Ÿè®¡ä»»åŠ¡æ—¶é•¿æ—¶ï¼ˆæ¯”å¦‚ï¼šIn Dev processing, in QA processingï¼‰, åªèƒ½é€šè¿‡â€œå¤šä»¶â€è¿ç®—å‡ºå‡å€¼ï¼Œäº¦å°±æ˜¯ Cycle time.<br><img src="/2022/07/18/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-xia-pian/lead&amp;cycle_time.png" alt="lead Time &amp; cycle time"></p><p>Lead Time å’Œ Cycle Time æ˜¯ç²¾ç›Šåˆ¶é€ ä¸­é‡è¦çš„è¡¡é‡æŒ‡æ ‡ã€‚<br>è‡ªä»ç²¾ç›Šç”Ÿäº§åœ¨åˆ¶é€ ä¸šè·å¾—æˆåŠŸä¹‹åï¼Œä¸ºäº†æ”¹å–„äº§å“å¼€å‘æµç¨‹ï¼Œè½¯ä»¶ç ”å‘è¡Œä¸šä¹Ÿå°†ç²¾ç›Šæ€æƒ³å¼•å…¥åˆ°äº†äº§å“ç ”å‘ä¹‹ä¸­ã€‚</p><h4 id="2-2-ä»·å€¼æµåˆ†æå’Œæ”¹è¿›å»ºè®®">2.2. ä»·å€¼æµåˆ†æå’Œæ”¹è¿›å»ºè®®</h4><p>ä»ç ”å‘æ•ˆèƒ½æ¥çœ‹ï¼Œé™¤äº†å®è§‚çš„ lead time çš„å¥åº·åº¦ä¹‹å¤–ï¼Œæƒ³è¦å›ç­” lead time ä¸ºä½•ä¼šèŠ±è´¹è¿™ä¹ˆé•¿æ—¶é—´ã€å…·ä½“é‚£äº›ç¯èŠ‚æ¯”è¾ƒè€—æ—¶ã€æ˜¯å¦å¯ä»¥ä¼˜åŒ–è€—æ—¶æ—¶ï¼Œå°±éœ€è¦å°†ç ”å‘å·¥ä½œæµç¨‹æ‰“å¼€æ¥çœ‹ä¸€çœ‹ã€‚<br>æƒ³è¦ç†è§£å’Œè§‚å¯Ÿç ”å‘æµç¨‹ï¼Œæœ‰ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå°±æ˜¯ â€”â€” ä»·å€¼æµå›¾ï¼ˆValue Stream Mappingï¼Œ VSMï¼‰ã€‚</p><p>è½¯ä»¶ç ”å‘æµç¨‹ï¼Œæ˜¯ä»éœ€æ±‚æ„æƒ³åˆ°äº§å“ï¼ˆæˆ–åŠŸèƒ½ï¼‰å‘å¸ƒä¸Šçº¿çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æä¾›ç”¨æˆ·ä»·å€¼è€Œé‡‡å–çš„ä¸€ç³»åˆ—ç ”å‘æ´»åŠ¨ã€‚<br>ä»·å€¼æµå›¾ï¼Œå°±æ˜¯ç”¨æ¥è§‚å¯Ÿå’Œåˆ†æä»·å€¼åœ¨ç ”å‘æµç¨‹ä¸­æµåŠ¨çš„æƒ…å†µã€‚<br>ä»·å€¼åœ¨æ•´ä¸ªæµåŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šç»å†å¢å€¼æ´»åŠ¨ã€éå¢å€¼ä½†å¿…è¦çš„æ´»åŠ¨ï¼ˆIå‹æµªè´¹ï¼‰ã€ä»¥åŠéå¢å€¼å¯ä»¥å»æ‰çš„æ´»åŠ¨ï¼ˆIIå‹æµªè´¹ï¼‰ã€‚ä»·å€¼æµå›¾åˆ†æçš„ç›®çš„ï¼Œé¦–å…ˆå°±æ˜¯å»æ‰ II å‹æµªè´¹ï¼Œç„¶åå†å°† I å‹æµªè´¹è½¬åŒ–ä¸º II å‹æµªè´¹ä»è€Œæ¶ˆé™¤ã€‚<br><img src="/2022/07/18/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-xia-pian/vsm.png" alt="VSM"></p><p><em>ä¹Ÿè®¸æœ‰äººä¼šè®¤ä¸ºï¼Œä¸Šå›¾ä¸­ QA è¿›è¡Œæµ‹è¯•ã€Ops è¿›è¡Œå‘å¸ƒï¼Œè¿™äº›æ€ä¹ˆèƒ½çœ‹åšæ˜¯å¢å€¼è¡Œä¸ºå‘¢ï¼Ÿè¿™ä¸»è¦æ˜¯å› ä¸ºï¼Œä¸èƒ½åªæ˜¯ä»ä»£ç å³æ˜¯ç”Ÿäº§çš„è§’åº¦å»çœ‹å¾…è½¯ä»¶ç ”å‘ã€‚<br>è½¯ä»¶ç ”å‘ï¼Œå…¶å®æ˜¯ä¸€ç§çŸ¥è¯†å‹çš„åˆ›é€ æ´»åŠ¨ï¼Œè™½ç„¶è¿™äº›çŸ¥è¯†æœ€ç»ˆæ˜¯é€šè¿‡ä»£ç çš„å½¢å¼å›ºåŒ–ä¸‹æ¥çš„ã€‚è¿™ç§çŸ¥è¯†æ€§çš„åˆ›é€ æ´»åŠ¨ï¼ŒåŒ…æ‹¬POã€BAã€Devã€QAã€Opsæ‰€æœ‰è§’è‰²çš„çŸ¥è¯†æ±‡æ€»ã€‚<br>è¿™ä¹Ÿæ˜¯ä¸ºä½•æ•æ·æµ‹è¯•æ€»æ˜¯å¼ºè°ƒæµ‹è¯•å·¦ç§»çš„é‡è¦æ€§ â€”â€” åœ¨éœ€æ±‚åˆ†ææˆ–è€… Feature kick off é˜¶æ®µï¼ŒQA å°½æ—©å‚ä¸åˆ°çŸ¥è¯†æ±‡é›†çš„é˜¶æ®µï¼Œä¹Ÿå¯ä»¥é™ä½ Dev çš„è¿”å·¥ç‡ã€‚å³ä½¿æ˜¯å¤„äºâ€œå¼€å‘â€ä¸‹æ¸¸çš„â€œåŠŸèƒ½æµ‹è¯•â€ï¼Œä¹Ÿå¯ä»¥ä»æä¾›è‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç çš„è§†è§’ï¼Œå¯Ÿè§‰åˆ°æµ‹è¯•çš„å¢å€¼è´¡çŒ® â€”â€” è®©ä»£ç åˆ¶å“æ‹¥æœ‰äº†è‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç ã€‚</em></p><p>æ­£å¦‚å›¾ä¸­æ˜¾ç¤ºï¼Œé»„è‰²æ ‡ç­¾ä¸º I å‹æµªè´¹ï¼Œçº¢è‰²ä¸º II å‹æµªè´¹ï¼Œæ¯”å¦‚â€œç­‰å¾…å‹æµªè´¹â€ â€”â€” ç­‰å¾…è”è°ƒï¼Œ â€œè¿”å·¥å‹æµªè´¹â€ â€”â€” æ”¹ Bugã€‚<br>é‚£å¦‚ä½•å®æ–½æ¶ˆé™¤æµªè´¹å‘¢ï¼Ÿæ¯”å¦‚ä¸Šé¢çš„ç­‰å¾…è”è°ƒã€è”è°ƒåçš„bugè¿”å·¥ä¿®å¤ã€‚<br>æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œä½†å¤§ä½“æœ‰å¦‚ä¸‹æ€è·¯ï¼š</p><ol><li>å½“å‰åç«¯ç­‰å¾…è”è°ƒï¼Œå›¢é˜Ÿçš„Devæ˜¯å¦å¯ä»¥å‘å±•æˆå…¨æ ˆå·¥ç¨‹å¸ˆï¼Œè¿™æ ·å‰åç«¯ä¸€ä¸ªDevå°±ç›´æ¥å®Œæˆäº†ï¼Œä¸å­˜åœ¨è”è°ƒã€‚æ—¢æ¶ˆé™¤äº†è”è°ƒç­‰å¾…ï¼Œä¹Ÿé™ä½äº†è¿”å·¥ç‡ã€‚</li><li>å¦‚æœä¸å‘å±•å…¨æ ˆå·¥ç¨‹å¸ˆï¼Œåœ¨storyå¼€å§‹é˜¶æ®µï¼Œå‰åç«¯æ˜¯å¦å¯ä»¥ä¸€èµ·è®¾è®¡å’Œçº¦å®šå¥½å¥‘çº¦ï¼ˆåŒ…æ‹¬happy pathã€unhappy pathã€å¼‚å¸¸å¤„ç†ï¼‰ï¼Œç”±å¥‘çº¦DSLä¸Šä¼ åˆ°contract Mock serverï¼Œè¿™æ ·å¯ä»¥é™ä½è”è°ƒæˆæœ¬å’Œè¿”å·¥ç‡ã€‚</li></ol><h4 id="2-3-æ•æ·-DevOpså›¢é˜Ÿèƒ½åŠ›å»ºè®¾">2.3. æ•æ· &amp; DevOpså›¢é˜Ÿèƒ½åŠ›å»ºè®¾</h4><p>æœ‰äº†å‰é¢ä¸¤æ­¥æ²»ç†æˆç†Ÿåº¦çš„è¾¾æˆï¼šåº¦é‡è¯„ä¼°å’Œä»·å€¼æµåˆ†æï¼Œå¯¹ç ”å‘æ•ˆèƒ½æœ‰äº†ä¸åŒç»´åº¦æ•´ä½“çš„äº†è§£ä¹‹åï¼Œæ¥ç€å°±è¿›å…¥åˆ°æ²»ç†åŠ¨ä½œçš„å®æ–½ä¸­ã€‚<br>å»ºè®®ä½¿ç”¨å¸¦æœ‰æ•´ä½“ä¼˜åŒ–èƒ½åŠ›çš„ç†è®ºå’Œå®è·µæ¡†æ¶ â€”â€” æ•æ· &amp; DevOpsã€‚è¿™äº›ç†è®ºå’Œå®è·µå·²ç»è¢«åå¤éªŒè¯ï¼Œå¹¶ä¸”éå¸¸æˆç†Ÿã€‚</p><p>æ•æ·ï¼Œé¼“åŠ±åˆ›å»ºç ”å‘çš„å…¨åŠŸèƒ½å›¢é˜Ÿï¼Œæå‡äº¤æµå’Œäº’åŠ¨ï¼Œä»¥å°½æ—©å’ŒæŒç»­çš„äº¤ä»˜é«˜ä»·å€¼çš„è½¯ä»¶ä¸ºç›®æ ‡ã€‚ä¸€äº›å›¢é˜Ÿç”šè‡³è¿˜é¼“åŠ±æˆå‘˜æ‰“ç ´è§’è‰²è¾¹ç•Œï¼Œæ¯”å¦‚èº«å…¼ QA èƒ½åŠ›çš„ Devã€å…·å¤‡ ops èƒ½åŠ›çš„ Dev ç­‰ç­‰ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒåŸºäºScrumã€Kanbanè½¯ä»¶ç ”å‘æ¨¡å¼çš„æ™®åŠï¼ŒæŒç»­äº¤ä»˜ç†å¿µï¼ˆContinuous Delivery, Jez Humble æåˆ°çš„å®è§‚è§’åº¦çš„æŒç»­äº¤ä»˜ï¼‰ä¹Ÿè¶Šæ¥è¶Šè¢«é‡è§†ã€‚</p><p>åˆ°2009å¹´ï¼Œç»ˆäºæœ‰äººåœ¨å€Ÿé‰´æ•æ·å’Œç²¾ç›Šçš„åŸºç¡€ä¸Šï¼Œåˆ›é€ äº† DevOps è¿™ä¸ªè¯ï¼Œæ—¨åœ¨å¼ºè°ƒå°† Ops åŠ å…¥åˆ°äº§å“ç ”å‘å…¨åŠŸèƒ½å›¢é˜Ÿçš„å……åˆ†å¿…è¦æ€§ï¼Œå¹¶ä¸”å…¼é¡¾å¼€å‘æ€ç»´ã€å®è¡Œ infra as codeçš„è¿ç»´æ–¹å¼å’Œæ–¹æ³•ï¼Œæ—¨åœ¨æå‡äº§å“äº¤ä»˜æ•ˆç‡å’Œå¯é æ€§ã€‚</p><p>éšç€ DevOps è¿åŠ¨çš„å…´èµ·å’Œæ¨å¹¿ï¼Œ DevOps é€æ¸å‘å±•ï¼ŒåŒ…æ‹¬å’Œæ¶µç›–äº†æ–¹æ³•è®ºã€æµç¨‹ã€è‡ªåŠ¨åŒ–å·¥å…·ï¼Œä»¥åŠç‰¹åˆ«å¼ºè°ƒçš„ DevOps æ–‡åŒ–ï¼Œå¹¶ä¸”é€æ¸å½±å“åˆ°äº†æ•´ä¸ªç ”å‘ä»·å€¼æµçš„å‚ä¸è€…ä»¬éµå¾ª DevOps ç²¾ç¥è¿›è¡Œç¾¤ç­–ç¾¤åŠ›ã€‚<br>æ¯”å¦‚ï¼šSecã€QA å°†å®‰å…¨å’Œæµ‹è¯•è„šæœ¬åŠ å…¥Pipeline â€”â€” ä¸éœ€è¦ç­‰åˆ°ç¯å¢ƒéªŒè¯ï¼Œåœ¨buildè¿è¡Œçš„è¿‡ç¨‹ä¸­å°±å¯ä»¥å¿«é€Ÿåé¦ˆåˆ°Devï¼Œè¿›è¡Œä»£ç ä¿®å¤ã€‚</p><p>ã€Šå‡¤å‡°é¡¹ç›®ã€‹åœ¨DevOpsåŸåˆ™ï¼Œæ€»ç»“äº†ä¸‰æ­¥å·¥ä½œæ³•ï¼š</p><ul><li>æµåŠ¨åŸåˆ™ã€‚å®ç°å¼€å‘åˆ°è¿ç»´çš„å·¥ä½œå¿«é€Ÿåœ°ä»å·¦å¾€å³æµåŠ¨ã€‚</li><li>åé¦ˆåŸåˆ™ã€‚ä»å³å¾€å·¦çš„æ¯ä¸ªé˜¶æ®µä¸­ï¼Œåº”æŒç»­ã€å¿«é€Ÿåœ°è·å¾—å·¥ä½œåé¦ˆã€‚</li><li>æŒç»­å­¦ä¹ å’Œå®éªŒåŸåˆ™ã€‚å›¢é˜Ÿå»ºç«‹æŒç»­å­¦ä¹ å’Œå®è·µçš„æ–‡åŒ–ã€‚</li></ul><p><img src="/2022/07/18/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-xia-pian/three-steps-method.png" alt="ä¸‰æ­¥æ³•"></p><p>å› æ­¤ï¼Œå›¢é˜Ÿé’ˆå¯¹æ•æ· &amp; DevOps è¿›è¡Œèƒ½åŠ›å»ºè®¾ï¼Œå¯ä»¥ä»æ•´ä½“ä¼˜åŒ–çš„è§’åº¦å¯¹æ•ˆèƒ½è¿›è¡Œæ²»ç†å’Œæå‡ã€‚<br>åœ¨å…·å¤‡äº†æ•æ· &amp; DevOps èƒ½åŠ›ä¸‹ï¼Œå†å»æ¢ç´¢å±€éƒ¨ä¼˜åŒ–å’Œæ²»ç†ã€‚</p><h4 id="2-4-äº¤ä»˜å’Œè¿è¥æ–¹å¼è½¬å˜">2.4. äº¤ä»˜å’Œè¿è¥æ–¹å¼è½¬å˜</h4><p>åœ¨æ•æ· &amp; DevOps å›¢é˜Ÿå…·å¤‡ç¨³å®šå’Œé«˜æ•ˆåœ°ç ”å‘æ•ˆç‡ã€é«˜è´¨é‡ã€é™ä½äº†å‘å¸ƒæˆæœ¬å’Œå‘å¸ƒé£é™©åï¼Œè®©åŸæœ¬æ­£ç¡®ã€ä½†çœ‹èµ·æ¥ä¸å¯å®ç°åœ°äº¤ä»˜å’Œè¿è¥æ–¹å¼å˜å¾—å¯èƒ½ï¼š</p><ul><li>ç³»ç»Ÿ3~6ä¸ªæœˆä¸€æ¬¡å¤§æ‰¹é‡å‘å¸ƒä¸Šçº¿ <code>--&gt;</code> æ¯ä¸ªæœˆ/ç”šè‡³æ›´çŸ­å‘¨æœŸ å°æ‰¹é‡å‘å¸ƒä¸Šçº¿</li><li>ç”±éœ€æ±‚æ‰¹é‡å‹å…¥è¿­ä»£çš„ Scrum ç ”å‘ç®¡ç†æ¨¡å¼ <code>--&gt;</code> éœ€æ±‚æ‹‰åŠ¨çš„ Kanban ç ”å‘ç®¡ç†æ¨¡å¼</li><li>DevOps 2.0ã€æŒç»­äº¤ä»˜2.0 é€æ¸å®ç°ã€‚</li></ul><p>ç ”å‘æ•ˆèƒ½è¢«æåŠï¼Œå…¶ç›®æ ‡æ˜¯å¿«é€ŸéªŒè¯äº§å“ã€è·å–ç”¨æˆ·åé¦ˆçš„èƒ½åŠ›ï¼Œä½äºè¡Œä¸šå‰å°çš„ç³»ç»Ÿçš„å¿«é€Ÿæ¨å‡ºï¼Œè¿˜èƒ½å¸¦æ¥æŠ¢å å¸‚åœºçš„æœºä¼šã€‚<br>å› æ­¤ï¼Œäº¤ä»˜å’Œè¿è¥æ–¹å¼çš„è½¬å˜ï¼Œåœ¨å®Œæˆæ²»ç†æˆç†Ÿåº¦3ä¹‹åï¼Œå¿…è¦ã€ä¸”å¯é¡ºåŠ¿è€Œè¡Œã€‚</p><h4 id="2-5-å…±äº«çš„ã€è‡ªåŠ©çš„ç ”å‘è¿è¥XXXä¸€ä½“åŒ–å¹³å°">2.5. å…±äº«çš„ã€è‡ªåŠ©çš„ç ”å‘è¿è¥XXXä¸€ä½“åŒ–å¹³å°</h4><p>ä¹Ÿè®¸æœ‰äººä¼šå¥‡æ€ªï¼Œåœ¨è¾¾æˆå‰ 4 æ­¥æ•ˆèƒ½æˆç†Ÿåº¦ä¹‹åï¼Œç¬¬ 5 é˜¶æ¬¡çš„æˆç†Ÿåº¦å±…ç„¶æ˜¯æ¨å‡º ç ”å‘è¿è¥XXXä¸€ä½“åŒ–å¹³å°ï¼Ÿï¼ˆXXXå¯èƒ½æ˜¯ä¸šåŠ¡è¿è¥ç­‰ç­‰ï¼Œåæ­£éšç€ DevOps 2.0ã€æŒç»­äº¤ä»˜2.0ã€bizDevOpsè¿™äº›ç›¸ä¼¼æ¦‚å¿µçš„æå‡ºï¼Œå¤§å®¶æ—¨åœ¨å°†äº§å“çš„ä»æ¦‚å¿µåˆ°æŠ•å…¥ç”¨æˆ·ç¾¤ä½“ï¼Œè¿™å…¶ä¸­æ­£å‘ã€åå‘çš„æ´»åŠ¨éƒ½ç»„æˆä¸€ä¸ªé—­ç¯çš„æ•´ä½“ï¼‰<br>å°†ç ”å‘è¿è¥XXXä¸€ä½“åŒ–å¹³å°æ”¾åœ¨æ•ˆèƒ½æ²»ç†æˆç†Ÿåº¦æœ€åä¸€æ­¥çš„é€»è¾‘æ˜¯ï¼š</p><ul><li>å³ä½¿ä¸ä¾æ‰˜ä¸€ä½“åŒ–å¹³å°ï¼Œå¾ªåºå‰å››ä¸ªæˆç†Ÿåº¦æ²»ç†ï¼Œæ•ˆèƒ½æ²»ç†ä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„ä¼ä¸šå’Œç»„ç»‡ä¸­å¼€å±•ã€‚</li><li>å½“å›¢é˜Ÿè¾¾æˆå‰å››æ­¥æ²»ç†æˆç†Ÿåº¦ï¼Œå¯ä»¥è€ƒè™‘å°†å±€éƒ¨ä¼˜åŒ–è½¬åŒ–æˆå…¨å±€ä¼˜åŒ–ã€‚å€ŸåŠ©ç ”å‘è¿è¥XXXä¸€ä½“åŒ–å¹³å°ï¼Œå¯¹ä¼ä¸šå’Œç»„ç»‡å†…çš„å…¨å±€ä¼˜åŒ–äº‹åŠåŠŸå€ã€‚</li><li>ç ”å‘è¿è¥XXXä¸€ä½“åŒ–å¹³å°ï¼Œè¯´ç™½äº†ï¼Œåªæ˜¯ä¸€ä¸ªå·¥å…·ï¼ŒæŠ•å…¥éœ€è¦å¤§æˆæœ¬ã€‚å¦‚æœæ²¡æœ‰å‰å››æ­¥æˆç†Ÿåº¦çš„è®¤çŸ¥å’Œè¾¾æˆï¼Œå®ƒä¹Ÿä»…ä»…åªæ˜¯ä¸ªå·¥å…·ã€‚</li></ul><h3 id="3-æ€»ç»“">3. æ€»ç»“</h3><p>ç ”å‘æ•ˆèƒ½æ²»ç†æ–¹æ¡ˆçš„ç†è®ºæ¡†æ¶ï¼ŒåŸºæœ¬åˆ°è¿™é‡Œå°±é˜è¿°å®Œäº†ã€‚<br>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯ï¼š</p><ul><li>å…ˆåº¦é‡å’Œè¯„ä¼°ï¼Œå†ä»·å€¼æµåˆ†æ</li><li>æ•æ· &amp; DevOps å›¢é˜Ÿèƒ½åŠ›å»ºè®¾</li><li>äº¤ä»˜å’Œè¿è¥æ¨¡å¼è½¬å˜</li><li>æ¨å‡º å…±äº«çš„ã€è‡ªåŠ©çš„ç ”å‘è¿è¥XXXä¸€ä½“åŒ–å¹³å°</li></ul><h3 id="åè¯">åè¯</h3><p>åœ¨æˆ‘å†™å®Œï¼ˆä¸Šç¯‡ï¼‰çš„æ—¶å€™ï¼Œä¸€äº›æœ‹å‹è¡¨è¾¾äº†å¯¹å›½å†…è¶Šæ¥è¶Šçœ‹é‡â€œç ”å‘æ•ˆèƒ½â€ã€â€œç ”å‘æ•ˆèƒ½æ²»ç†â€è¿™äº›å‘½é¢˜å’Œè§‚ç‚¹çš„ä¸æ»¡ï¼Œæˆ‘å…¶å®ä¹Ÿä¸€æ ·ã€‚<br>ä½†æ˜¯å›½å†…è¿™æ–¹é¢çš„å¯¹è½¯ä»¶å®šåˆ¶å’Œå’¨è¯¢çš„å•†æœºï¼Œåˆçš„ç¡®ä¼šç»å¸¸å‡ºç°ã€‚ä»æˆ‘ä»¬è¿™äº›å…¬å¸çš„è§’åº¦ï¼Œå°±ä¼šå»æƒ³ â€”â€” æ˜¯è·ªç€æŠŠè¿™é’±ç»™èµšäº†ï¼Œè¿˜æ˜¯ç«™ç€æŠŠè¿™é’±ç»™èµšäº†çš„é—®é¢˜ã€‚æˆ‘è‡ªå·±ä¹Ÿä¸€ç›´æ²¡æœ‰ç»“è®ºã€‚<br>ç›´åˆ°æœ€è¿‘æˆ‘åœ¨åšä¸€ä¸ªå”®å‰æ–¹æ¡ˆçš„æ—¶å€™ï¼Œè·Ÿå…¬å¸å†…çš„ä¸€ä¸ªå’¨è¯¢å¸ˆäº¤æµï¼Œå‘ç°ä»–å¯¹äºâ€œç ”å‘æ•ˆèƒ½â€è¿™è¯çš„æ’æ–¥ã€‚æˆ‘å†…å¿ƒé¢‡æœ‰ç‚¹æ¼ï¼Œå› ä¸ºä»–è®²çš„é‚£äº›å…¶å®å¤§å®¶éƒ½å¿ƒçŸ¥è‚šæ˜ï¼Œåè€Œæˆ‘å¥½åƒå˜æˆé‚£ä¸ªä¸é“å¾·å’Œç‹­éš˜çš„ä¸€æ–¹ã€‚<br>å› æ­¤ï¼Œå¯¹äºèµšé’±çš„é—®é¢˜ï¼Œæœ‰äº†ç»“è®º â€”â€” é‚£å°±ç«™ç€æŠŠé’±ç»™èµšäº†å§ï¼Œä»¥åå°±åªè°ˆ ä»·å€¼äº¤ä»˜ã€æŒç»­äº¤ä»˜ 2.0ã€DevOpsã€‚</p><p>ä¸ç®¡æ€æ ·ï¼Œç«‹Flagåç¬¬äºŒç¯‡æ–‡ç« ï¼Œæ€»ç®—æ˜¯å®Œæˆäº†ï¼Œyeah~</p>]]></content>
      
      
      <categories>
          
          <category> æ•æ·ç²¾ç›Šè½¯ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç²¾ç›Š </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èŠèŠç ”å‘æ•ˆèƒ½æ²»ç†æ–¹æ¡ˆçš„ç†è®ºæ¡†æ¶ï¼ˆä¸Šç¯‡ï¼‰</title>
      <link href="/2022/07/02/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-shang-pian/"/>
      <url>/2022/07/02/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-shang-pian/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å‡ å¹´ï¼Œå›½å†…ä¸šç•Œè¶Šæ¥è¶Šå¸¸æåŠ<code>â€œç ”å‘æ•ˆèƒ½â€</code>è¿™ä¸ªè¯ï¼Œè¿½å…¶æ ¹æºå¤§éƒ¨åˆ†æ˜¯å§‹äº<code>â€œDevOpsâ€</code>è¿åŠ¨çš„æ´»è·ƒã€‚<br>çŸ¥é“ DevOps å‘å±•å†å²çš„ï¼ŒåŸºæœ¬éƒ½äº†è§£ DevOps æ˜¯å—æ•æ·çš„å½±å“ï¼Œæ˜¯æ•æ·åŸåˆ™åœ¨è½¯ä»¶ç ”å‘åˆ°è¿ç»´è¿è¥å±‚é¢çš„å»¶ä¼¸ã€‚<br>å¾ˆå¤šäº‘å‚å•†åœ¨æ¨å¹¿è‡ªå·± DevOps å¹³å°æœåŠ¡çš„æ—¶å€™ï¼Œä¹Ÿä¼šæåŠå¯¹<code>â€œç ”å‘æ•ˆèƒ½â€</code>çš„å¤§å¹…åº¦å½±å“ï¼Œæ¯”å¦‚ AWS å¯¹ DevOps çš„æè¿°ï¼š</p><blockquote><p>DevOps is the combination of cultural philosophies, practices, and tools that increases an organizationâ€™s ability to deliver applications and services at high velocity: evolving and improving products at a faster pace than organizations using traditional software development and infrastructure management processes. This speed enables organizations to better serve their customers and compete more effectively in the market.</p></blockquote><p>é‚£ä¹ˆï¼Œç ”å‘æ•ˆèƒ½ == DevOps å—ï¼Ÿ<br>ç­”æ¡ˆè‡ªç„¶æ˜¯å¦å®š ã€‚</p><span id="more"></span><p>ç ”å‘æ•ˆèƒ½ æ˜æ˜¾æ˜¯â€œé—®é¢˜åŸŸâ€ã€‚<br>DevOps æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä¸”æ˜¯ä¸€ç§å·²ç»è¢«éªŒè¯ã€éå¸¸æˆç†Ÿçš„ã€å¯ä»¥æå‡è½¯ä»¶ç ”å‘æ•ˆèƒ½çš„è§£å†³æ–¹æ¡ˆã€‚<br>ä½†å°±åƒäººæ„Ÿå†’å‘çƒ§ä¸€æ ·ï¼Œåƒ A è¯å¯ä»¥ç—Šæ„ˆï¼Œåƒ B è¯ä¹Ÿå¯ä»¥ç—Šæ„ˆï¼Œæ‰“é’ˆä¹Ÿå¯ä»¥ç—Šæ„ˆï¼Œç”šè‡³æœ‰æ—¶å€™å‘ç°åƒè¯æ•ˆæœä¸ç†æƒ³ï¼Œæœ€åè¿˜æ˜¯å»æ‰“äº†é’ˆã€‚<br><code>ç ”å‘æ•ˆèƒ½ä½</code>ï¼Œå°±åƒäººæ„Ÿå†’å‘çƒ§ä¸€æ ·ï¼Œæ˜¯ä¸ª â€œé—®é¢˜â€ ã€‚<code>DevOps</code>, æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§ â€œè¯â€ã€‚</p><p>å› æ­¤ï¼Œå¼„æ¸…æ¥šäº†<code>é—®é¢˜åŸŸ</code>å’Œ<code>è§£ç©ºé—´</code>çš„å…³ç³»ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ç ”å‘æ•ˆèƒ½å’Œå®ƒçš„è§£ç©ºé—´ï¼Œå¹¶ä¸”ä¸»è¦èŠä¸€èŠè§£ç©ºé—´ï¼ˆç ”å‘æ•ˆèƒ½æ²»ç†ï¼‰ã€‚</p><h3 id="1-ç ”å‘æ•ˆèƒ½çš„å®šä¹‰">1. ç ”å‘æ•ˆèƒ½çš„å®šä¹‰</h3><p>ç ”å‘æ•ˆèƒ½ï¼Œå³æŒç»­å¿«é€Ÿäº¤ä»˜ä»·å€¼çš„èƒ½åŠ›ã€‚<br>å°†å…¶æ‹†è§£ä¸€ä¸‹ï¼š<code>ç ”å‘æ•ˆèƒ½</code> = <code>æ•ˆç‡</code> + <code>è´¨é‡</code>+ <code>æœ‰æ•ˆä»·å€¼</code>ï¼Œè¿˜æœ‰è¿™ä¸‰é¡¹å¯é‡å¤å’Œç¨³å®šå‘ç”Ÿçš„<code>æŒç»­æ€§</code>ã€‚</p><p>å±•å¼€æ¥è®²ï¼Œå°±æ˜¯</p><ul><li>è¦åœ¨ä¿è¯ç³»ç»Ÿå¯é æ€§ã€ä¸é™ä½äº¤ä»˜è´¨é‡çš„æƒ…å†µä¸‹ï¼Œå°½é‡ç¼©çŸ­ä»ä¸šåŠ¡æ„æƒ³åˆ°åŠŸèƒ½ä¸Šçº¿çš„æ—¶é—´  ï¼ˆè´¨é‡ + æ•ˆç‡ï¼‰</li><li>ä»è€Œä½¿â€œæœ€å°åŒ–å¯è¡Œéœ€æ±‚â€èƒ½å¿«é€Ÿè¢«éªŒè¯ï¼Œç¡®ä¿æœ‰æ•ˆä»·å€¼ï¼Œå‡å°‘æµªè´¹  ï¼ˆæœ‰æ•ˆä»·å€¼ï¼‰</li><li>ä¸”æ•´ä¸ªè¿‡ç¨‹æ•ˆæœå¯é‡å¤å‘ç”Ÿï¼ˆæŒç»­æ€§ï¼‰</li></ul><h3 id="2-ç ”å‘æ•ˆèƒ½çš„æ²»ç†">2. ç ”å‘æ•ˆèƒ½çš„æ²»ç†</h3><p>æœ‰äº†å®šä¹‰ä¹‹åï¼Œå°±æ¥çœ‹çœ‹å¦‚ä½•å¯¹ç ”å‘æ•ˆèƒ½è¿›è¡Œæ²»ç†ã€‚<br>æ ¹æ®å¸‚é¢ä¸Šå¤§éƒ¨åˆ†å…¬å¸çš„è½¯ä»¶å·¥ç¨‹èƒ½åŠ›çŠ¶å†µï¼Œé’ˆå¯¹ç ”å‘æ•ˆèƒ½æ²»ç†ï¼Œè¿™é‡Œæç‚¼äº†ä¸€æ¡â€œç ”å‘æ•ˆèƒ½æ²»ç†æˆç†Ÿåº¦æ¨¡å‹â€ã€‚</p><p><img src="/2022/07/02/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-shang-pian/%E6%B2%BB%E7%90%86%E6%88%90%E7%86%9F%E5%BA%A6%E6%9B%B2%E7%BA%BF.png" alt="ç ”å‘æ•ˆèƒ½æ²»ç†æˆç†Ÿåº¦"><br>ä»å·¦è‡³å³ï¼Œç ”å‘æ•ˆèƒ½æ²»ç†åˆ†ä¸º5ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µä¹Ÿå¿…é¡»åŒ…å«å®ƒå·¦è¾¹æ‰€æœ‰é˜¶æ®µçš„æˆæœã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼šæŸITéƒ¨é—¨é‡‡è´­äº†ä¸€ä¸ª DevOps å¹³å°æœåŠ¡ï¼Œä½†æ—¥å¸¸ä»…ä»…å½“åš CI/CDæµæ°´çº¿ ç”šè‡³æ˜¯â€œå‘å¸ƒå·¥å…·â€æ¥ä½¿ç”¨ï¼Œå¯¹æ•ˆèƒ½æ²»ç†æ²¡ä»€ä¹ˆæ¦‚å¿µï¼Œè¿™æ—¶å€™è¯¥ITéƒ¨é—¨çš„æ²»ç†æˆç†Ÿåº¦è‡ªç„¶æ˜¯ä½çš„ï¼Œå¯èƒ½åªåœ¨â€œåº¦é‡å’Œè¯„ä¼°â€çš„ä½ç½®ã€‚</p><p>æ¥ç€ï¼Œå±•å¼€æ¥çœ‹çœ‹æ•ˆèƒ½æ²»ç†æˆç†Ÿåº¦æ¯ä¸€ä¸ªé˜¶æ®µã€‚</p><h4 id="2-1-åº¦é‡å’Œè¯„ä¼°">2.1. åº¦é‡å’Œè¯„ä¼°</h4><p>ç®¡ç†å­¦ä¹‹çˆ¶å½¼å¾—å¾·é²å…‹æ›¾ç»è¯´è¿‡ï¼šâ€œå¦‚æœä½ æ— æ³•åº¦é‡å®ƒï¼Œå°±æ— æ³•ç®¡ç†å®ƒâ€ã€‚<br>å¯¹ç®¡ç†å¦‚æ­¤ï¼Œå¯¹æ•ˆèƒ½æ²»ç†äº¦æ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œåº¦é‡å’Œè¯„ä¼°ï¼Œå¯¹äºç ”å‘æ•ˆèƒ½çš„æ²»ç†å¿…ä¸å¯å°‘ã€‚</p><p>é‚£ä¹ˆï¼Œå†æ¥çœ‹çœ‹ä¸ºä½•æŠŠâ€œåº¦é‡å’Œè¯„ä¼°â€æ”¾åœ¨æ²»ç†çš„ç¬¬ä¸€æ­¥å‘¢ï¼š</p><ul><li>é¦–å…ˆï¼Œæƒ³è¦å¯¹ç ”å‘æ•ˆèƒ½è¿›è¡Œæ²»ç†ï¼Œå¿…é¡»çŸ¥é“å½“å‰æ•ˆèƒ½å¤„äºä¸€ä¸ªä»€ä¹ˆé˜¶æ®µï¼Œå¯¹ç°çŠ¶æœ‰äº†åº¦é‡è¯„ä¼°å’Œè‡ªæˆ‘è®¤çŸ¥ä¹‹åï¼Œæ‰èƒ½æ˜ç¡®ä¹‹åæ²»ç†çš„æ–¹å‘å’ŒåŠ›åº¦ã€‚</li><li>åŒæ—¶ï¼Œåº¦é‡å’Œè¯„ä¼°æ¨¡å‹åœ¨æŒç»­æ²»ç†çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é˜¶æ®µæ€§åœ°é‡å¤ä½¿ç”¨ï¼Œç”¨ä»¥å‘ˆç°æ²»ç†æˆæœçš„æ•ˆæœå’Œè¿›è¡Œå¿«é€Ÿåé¦ˆã€‚</li></ul><p>å› æ­¤ï¼Œåº¦é‡å’Œè¯„ä¼°ï¼Œä½œä¸ºç ”å‘æ•ˆèƒ½æ²»ç†çš„ç¬¬ä¸€æ­¥ä¸å¯æˆ–ç¼ºã€‚</p><p><strong>æ¥ç€ï¼Œæ¥çœ‹çœ‹å¦‚ä½•åšåº¦é‡å’Œè¯„ä¼°ï¼Ÿ</strong><br><strong>ä» â€œå¥åº·åº¦æŒ‡æ ‡â€ å’Œ â€œå±€éƒ¨è¯Šæ–­æ€§æŒ‡æ ‡â€ åˆ†ä¸¤å±‚æ¥çœ‹ã€‚</strong></p><h5 id="å¥åº·åº¦æŒ‡æ ‡">å¥åº·åº¦æŒ‡æ ‡</h5><p>é¦–å…ˆï¼Œå€Ÿé‰´äº<code>DORA</code>(DevOpsç ”ç©¶å’Œè¯„ä¼°ç»„ç»‡) çš„2021å¹´æŠ¥å‘Šä¸­çš„Four Key Metricsï¼Œå°†å…¶ä½œä¸ºç ”å‘æ•ˆèƒ½çš„4ä¸ªå…³é”® <strong><code>å¥åº·åº¦æŒ‡æ ‡</code></strong>:</p><p><img src="/2022/07/02/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-shang-pian/four_key_metrics.png" alt="four key metrics"></p><ul><li><strong>ç ”å‘æ•ˆç‡</strong>ï¼š<ul><li>éƒ¨ç½²é¢‘ç‡</li><li>å‰ç½®æ—¶é—´ï¼ˆLead timeï¼‰</li></ul></li><li><strong>ç ”å‘è´¨é‡</strong>ï¼š<ul><li>æ•…éšœæ¢å¤æ—¶é—´ ï¼ˆMTTRï¼‰</li><li>éƒ¨ç½²å¤±è´¥ç‡</li></ul></li></ul><p><code>ç‰¹åˆ«æ³¨æ„</code>ï¼šåŒºåˆ«äº DevOps åªå…³æ³¨äºâ€œä»ä»£ç æäº¤åˆ°åŠŸèƒ½å‘å¸ƒâ€è¿™ä¸ªåŒºé—´çš„å‰ç½®æ—¶é—´ï¼Œç ”å‘æ•ˆèƒ½ä¸­çš„â€œå‰ç½®æ—¶é—´â€å»¶ä¼¸äº†è¦†ç›–èŒƒå›´ â€”â€” ä»ä¸šåŠ¡æ„æƒ³åˆ°åŠŸèƒ½å‘å¸ƒï¼Œæ¶‰åŠç ”å‘è¿è¥çš„æ•´ä¸ªç ”å‘å‘¨æœŸã€‚<br>å…¶ä»–ä¸‰é¡¹ï¼Œä¸ DevOps æŠ¥å‘Šç›¸åŒã€‚</p><p>è‡³äºï¼Œç ”å‘æ•ˆèƒ½ä¸­çš„__<code>æœ‰æ•ˆä»·å€¼</code>__ï¼Œå…¶ä¸ä¸šåŠ¡å…³ç³»ç´§å¯†ï¼Œåº¦é‡æ•°æ®æ¨¡å‹éœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡æ¥è®¾è®¡ï¼Œå› æ­¤ç›®å‰ä»…ç»™äºˆè¯¥é¡¹ <code>å¥åº·åº¦è¯„ä¼°æ¨¡å‹</code>ï¼š</p><blockquote><p>Measurement involves collecting factual information about the value of a deployed feature and evaluating it against the original hypothesis statement.<br>Rate your teamâ€™s ability to collect objective information about the actual value realized by deployed features so that it can inform strategic financial decisions.<br>Sit (1-2): We donâ€™t define or measure the value of Features.<br>Crawl (3-4): Weâ€™ve defined what â€œvalueâ€ is but donâ€™t know how to measure it.<br>Walk (5-6): We capture qualitative feedback from the business about the value of our Features.<br>Run (7-8): We capture qualitative and quantitative feedback from the business and our monitoring systems about the value of our features.<br>Fly (9-10): We aggregate the quantitative and qualitative feedback to objectively validate the original hypothesis and inform pivot-or-persevere decisions.</p></blockquote><p>çœ‹åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹çœ¼ç†Ÿï¼Œå¦‚æœåŸæœ¬é¢„æƒ³çš„è§£å†³æ–¹æ¡ˆæ˜¯ â€œDevOpsä¸€ä½“åŒ–â€ çš„è¯ï¼ŒåŠ ä¸Šæœ‰æ•ˆä»·å€¼çš„åº¦é‡ï¼Œæ˜¯ä¸æ˜¯æ–¹æ¡ˆå°±è¦è€ƒè™‘<code>"BizDevOps"</code>?! æ˜¯ä¸æ˜¯ä»…ä»…ä¸€ä¸ªDevOpsçš„æ–¹æ¡ˆå°±ä¸å¤ŸåŒ¹é…äº†ï¼Ÿï¼ˆé‡æ–°å†æ­£è§†ä¸€ä¸‹é—®é¢˜åŸŸå’Œè§£ç©ºé—´çš„åŒºåˆ« :Pï¼‰</p><h5 id="å±€éƒ¨è¯Šæ–­æ€§æŒ‡æ ‡">å±€éƒ¨è¯Šæ–­æ€§æŒ‡æ ‡</h5><p>ä¹Ÿè®¸æœ‰äººä¼šè§‰å¾—ï¼Œå¯¹æ¯”ä¸‹å…¶ä»–ç±»å‹çš„åº¦é‡å’Œè¯„ä¼°æŠ¥å‘Šä¸Šç¹å¤šçš„æŒ‡æ ‡é‡ï¼Œä¸Šé¢è¿™å‡ ä¸ªæŒ‡æ ‡æœªå…æœ‰äº›ç®€é™‹ã€‚<br>æ¯”å¦‚ï¼Œè¿å¸¸è§çš„è¯„ä¼°åº”ç”¨æ¶æ„ç»´åº¦çš„æŒ‡æ ‡éƒ½æ²¡æœ‰ã€‚<br>å…¶å®ï¼Œåº”ç”¨æ¶æ„æŒ‡æ ‡æ˜¯æœ‰çš„ï¼Œä½†å¹¶ä¸å±äºæ•ˆèƒ½â€œå¥åº·åº¦æŒ‡æ ‡â€ï¼Œè€Œæ˜¯â€œå±€éƒ¨è¯Šæ–­æ€§æŒ‡æ ‡â€ã€‚</p><ul><li>å½“å‘ç°å¥åº·åº¦ä¸ç†æƒ³ï¼Œéœ€è¦åˆ†æã€å®šä½å’Œå½¢æˆæ”¹è¿›å»ºè®®æ—¶ï¼Œè¿™æ—¶å°±è¦å€ŸåŠ©äºå±€éƒ¨è¯Šæ–­æ€§æŒ‡æ ‡ã€‚</li><li>å½“å®æ–½äº†æ”¹è¿›å»ºè®®ï¼Œå¯¹å±€éƒ¨æŒ‡æ ‡è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæœ€ç»ˆæ•ˆæœåˆä¼šä¼ å¯¼åˆ°å¥åº·åº¦æŒ‡æ ‡ä¸Šã€‚<br>å¦‚æœå±€éƒ¨æŒ‡æ ‡æ”¹è¿›äº†ï¼Œä½†å¥åº·åº¦æœªæå‡ï¼Œè¿™æ—¶å¯èƒ½éœ€è¦å›è¿‡å¤´æ¥åˆ†æå’Œåæ€ä¸€ä¸‹ï¼šæ˜¯è¯Šæ–­å’Œæ”¹è¿›å»ºè®®çš„é—®é¢˜ï¼Œè¿˜æ˜¯æœ¬èº«å±€éƒ¨æŒ‡æ ‡éœ€è¦è°ƒæ•´ã€‚</li></ul><p><img src="/2022/07/02/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-shang-pian/%E5%B1%80%E9%83%A8%E8%AF%8A%E6%96%AD%E6%80%A7%E6%8C%87%E6%A0%87.png" alt="å±€éƒ¨è¯Šæ–­æ€§æŒ‡æ ‡ç¤ºä¾‹"></p><p>æœ‰äº†è¿™ä¸¤å±‚æŒ‡æ ‡ï¼Œæ•´ä¸ªç ”å‘æ•ˆèƒ½çš„åº¦é‡å’Œè¯„ä¼°æ¨¡å‹æ‰å¤§ä½“å®Œæ•´ã€‚<br>è€Œåœ¨æ•´ä¸ªç ”å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å¸¸å¸¸é˜¶æ®µæ€§çš„ä½¿ç”¨æ¨¡å‹è¿›è¡Œåº¦é‡å’Œè¯„ä¼°ä¸€ä¸‹ï¼Œæ¯”å¦‚æ¯æ¬¡å‘å¸ƒå‘¨æœŸå®Œæˆ æˆ–è€… æ¯æ¬¡sprintå®Œæˆçš„æ—¶å€™ç­‰ç­‰ã€‚<br>ä½¿ç”¨æŒ‡æ ‡å€¼çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ³¨æ„ï¼š<strong>æŒ‡æ ‡å€¼æœ¬èº«å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯é€šè¿‡æ•°æ®é©±åŠ¨å‡ºæ´è§ã€‚è€Œåœ¨æŒç»­æ”¹è¿›çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¶‹åŠ¿æ¯”æ•°æ®å€¼æ›´é‡è¦ã€‚</strong></p><p><img src="/2022/07/02/liao-liao-yan-fa-xiao-neng-zhi-li-fang-an-de-li-lun-kuang-jia-shang-pian/key_metrics_report.png" alt="è¶‹åŠ¿å›¾"></p><p>ã€Šä¸‹ç¯‡ã€‹è®²æ¥ç€èŠå‰©ä¸‹çš„4ä¸ªæˆç†Ÿåº¦é˜¶æ®µã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•æ·ç²¾ç›Šè½¯ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç²¾ç›Š </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“çš„ACIDå’Œåˆ†å¸ƒå¼äº‹åŠ¡</title>
      <link href="/2022/05/10/shu-ju-ku-de-acid-he-fen-bu-shi-shi-wu/"/>
      <url>/2022/05/10/shu-ju-ku-de-acid-he-fen-bu-shi-shi-wu/</url>
      
        <content type="html"><![CDATA[<p>å‰é¢å†™äº†ä¸€ç¯‡å…³äº<code>CAPåŸç†</code>çš„åšæ–‡ï¼Œè¯´åˆ°<code>ä¸€è‡´æ€§ Consistency</code>ï¼Œæœ‰äººå¾€å¾€ä¼šæƒ³åˆ°äº‹åŠ¡<code>ACID</code>ç‰¹æ€§ä¸­çš„<code>C: Consistency</code>ï¼Œè™½ç„¶éƒ½å«ä¸€è‡´æ€§ï¼Œä½†å®Œå…¨æ˜¯ä¸¤ä¸ªä¸œè¥¿ã€‚</p><ul><li><code>CAP</code>çš„ä¸€è‡´æ€§æŒ‡ï¼šæ•°æ®åº“çš„åŒä¸€å¤åˆ¶é›†ï¼ˆreplicaSetï¼‰ä¹‹é—´æ•°æ®ç›¸åŒã€‚<br><em>è¿™é‡Œçš„â€œæ•°æ®åº“â€ï¼Œå¯ä»¥æ˜¯ä¸»ä»ã€ä¸»å¤‡ã€é›†ç¾¤æ¶æ„ï¼Œä½†æ²¡æœ‰å•æœºæ¶æ„ã€‚</em></li><li><code>ACID</code>çš„ä¸€è‡´æ€§æŒ‡ï¼šåœ¨æ•°æ®åº“å•ä¸€å®ä¾‹ä¸­(æš‚ä¸æ¶‰åŠå¤šä¸ªæ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡)ï¼ŒæˆåŠŸå†™å…¥çš„æ•°æ®ä¸è¿åå·²å®šä¹‰çš„æ•°æ®è§„åˆ™ï¼Œå¦‚çº¦æŸã€çº§è”è§„åˆ™ç­‰ç­‰ã€‚<br><em>ä¸€èˆ¬åœ¨<code>ä¸šåŠ¡æµç¨‹</code>è¿™ä¸ªä¸Šä¸‹æ–‡ä¸‹ï¼ŒèŠ<code>æ•°æ®çš„ä¸€è‡´æ€§</code>ï¼Œé€šå¸¸æ˜¯åœ¨èŠå¹¿ä¹‰çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå³<code>ACID</code>è¿™å››é¡¹ï¼Œå¹¶éæ˜¯<code>C</code>ä¸€é¡¹ã€‚å•æœºæ•°æ®åº“å°±æ˜¯é€šè¿‡äº‹åŠ¡æ¥ä¿éšœ<code>æ•°æ®çš„ä¸€è‡´æ€§</code>ã€‚</em><br>æ¥ç€ï¼Œæ¥é€šè¿‡æœ¬åœ°äº‹åŠ¡çš„è¯¦ç»†è¯´ä¸€ä¸‹<code>ACID</code>ï¼Œä»¥åŠè·¨å¤šæ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</li></ul><span id="more"></span><p><strong>æ³¨ï¼š</strong> æ–‡ç« çš„ä½™ä¸‹éƒ¨åˆ†ï¼Œæåˆ°çš„æ•°æ®ä¸€è‡´æ€§ï¼Œéƒ½æ˜¯æŒ‡å¹¿ä¹‰æ•°æ®ä¸€è‡´æ€§ï¼Œå³ACIDå››é¡¹ã€‚ä¸”ä¸å†æ¶‰åŠ<code>CAP</code>éƒ¨åˆ†ã€‚</p><h3 id="1-æœ¬åœ°äº‹åŠ¡ACID">1. æœ¬åœ°äº‹åŠ¡ACID</h3><p><code>æœ¬åœ°äº‹åŠ¡</code>ï¼Œè¿™é‡ŒæŒ‡å•ä¸ªä¸šåŠ¡æœåŠ¡ä»…æ“ä½œå•ä¸€æ•°æ®æºï¼Œå®Œå…¨ç”± DBMS (Data Base Management System)æä¾›çš„äº‹åŠ¡ACIDèƒ½åŠ›ã€‚<br>é™¤å»ä¸Šé¢å¯¹<code>Consistency</code>çš„è§£é‡Šå¤–ï¼Œå‰©ä¸‹çš„ä¸‰é¡¹ï¼š</p><ul><li><code>Atomic(åŸå­æ€§)</code>ï¼šåœ¨äº‹åŠ¡è¾¹ç•Œå†…çš„æ‰€æœ‰å†™æ“ä½œï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥(ä¹Ÿå« All-or-Nothingï¼‰ã€‚<br>é˜»æ­¢å‡ºç°åªæœ‰éƒ¨åˆ†æ›´æ–°çš„æ•°æ®å¼‚å¸¸ã€‚</li><li><code>Isolation(éš”ç¦»æ€§)</code>ï¼šå­˜åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¸åŒçš„è¿æ¥çš„è¯»ã€å†™æ“ä½œç›¸äº’ä¹‹é—´ç‹¬ç«‹ï¼Œå°½é‡ä¸å—å½±å“ã€‚<br>ä»ä½åˆ°é«˜åˆ†ä¸ºå››ä¸ªéš”ç¦»çº§åˆ«ï¼š<code>Read uncommitted</code>ã€<code>Read committed</code>ã€<code>Repeatable read</code>ã€<code>Serializable</code>ã€‚å„æ•°æ®åº“å‚å•†å®ç°æ–¹å¼ä¸åŒï¼Œé€ æˆæ ‡å‡†çš„è¡¨ç°æ€§æœ‰äº›è®¸å·®åˆ«ã€‚æ¯”å¦‚ MySQL InnoDBé‡‡ç”¨ MVCC æœºåˆ¶å®ç°äº‹åŠ¡éš”ç¦»ï¼ŒRepeatable read çº§åˆ«å¯ä»¥é˜²æ­¢å¹»è¯»ã€‚</li><li><code>Durability(æŒä¹…æ€§)</code>ï¼šä¿è¯æ‰€æœ‰æˆåŠŸæäº¤çš„æ•°æ®éƒ½èƒ½æ­£ç¡®è¢«æŒä¹…åŒ–ï¼Œä¸ä¼šè¢«ä¸¢å¤±ã€‚</li></ul><h3 id="2-è·¨å¤šæ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡">2. è·¨å¤šæ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œç”±äºæ•°æ®æäº¤é“¾è·¯ä¼šæ¶‰åŠåˆ°å¤šä¸ªæ•°æ®æºèŠ‚ç‚¹ï¼Œè¦ä¿è¯æäº¤çš„æ•°æ®å¦‚å•æœºèŠ‚ç‚¹ä¸€æ ·æ‹¥æœ‰äº‹åŠ¡çš„ ACID ç‰¹æ€§ï¼Œå°±å˜å¾—éå¸¸å¤æ‚ã€‚<br>å› æ­¤ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼Œå°±æ˜¯å¦‚ä½•åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å®ç°è¿™äº› ACID ç‰¹æ€§ã€‚</p><p>ä¼ ç»Ÿçš„å•æœºæ•°æ®åº“ DBMS æä¾›äº‹åŠ¡çš„ ACID ç‰¹æ€§ï¼Œæä¾›äº†å¼ºä¸€è‡´æ€§ï¼Œå±è”½äº†å¼€å‘äººå‘˜è‡ªå·±å»å¤„ç†åº•å±‚æ•°æ® ACID çš„é—®é¢˜ï¼Œç®€åŒ–äº†å¼€å‘å·¥ä½œã€‚<br>æœ€æ—©å‡ºç°çš„"åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"çš„è§£å†³æ–¹æ¡ˆï¼ŒåŸºæœ¬æ˜¯ä¸ºäº†å¯¹é½æ•°æ®åº“çš„äº‹åŠ¡èƒ½åŠ› â€”â€” å®ç°å¼ºä¸€è‡´æ€§ï¼Œå› æ­¤å‡ºç°äº†æ¯”å¦‚X/Open XAç­‰åè®®æ ‡å‡†ï¼Œå…¶èƒŒåä½¿ç”¨çš„æ˜¯ 2PC (ä¸¤æ®µå¼æäº¤)è§£å†³æ–¹æ¡ˆã€‚<br>å› æ­¤ï¼Œæ”¯æŒX/Open XAæ ‡å‡†çš„è¿™äº›å¼ºä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œåˆ†å¸ƒå¼äº‹åŠ¡â€ã€‚<br><em>æ³¨æ„åŒºåˆ†ä¸€ä¸‹â€œåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜â€å’Œâ€œåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆâ€è¿™ä¸¤ä¸ªè¯ã€‚</em><br><em>å› ä¸ºäº‹åŠ¡è¢«åˆ†æ‹†åˆ°å¤šä¸ªæ•°æ®æºèŠ‚ç‚¹ï¼Œå¸¦æ¥çš„äº‹åŠ¡è¢«åˆ†å¸ƒå¼äº†çš„é—®é¢˜ï¼Œç§°ä¸ºâ€œåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜â€ã€‚ä½†åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œé™¤äº†æœ€æ—©å‡ºç°çš„å¼ºä¸€è‡´æ€§çš„â€œåˆ†å¸ƒå¼äº‹åŠ¡â€è¿™ä¸€ç§æ–¹æ¡ˆå¤–ï¼Œè¿˜æœ‰è€ƒè™‘åœºæ™¯å¯ç”¨çš„â€œå¼±ä¸€è‡´æ€§â€è§£å†³æ–¹æ¡ˆå’Œâ€œæœ€ç»ˆä¸€è‡´æ€§â€è§£å†³æ–¹æ¡ˆã€‚</em><br><em>å› æ­¤ï¼Œå½“æœ‰äººè¯´ï¼šâ€œä¸è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå°½é‡ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§â€æ—¶ï¼Œä»–çš„æ„æ€æ˜¯ä¸è¦ä½¿ç”¨å¼ºä¸€è‡´æ€§ï¼Œå¹¶éæ˜¯è®©ä½ ä¸è¦ä½¿ç”¨å¤šæ•°æ®æºã€‚</em></p><h4 id="2-1-2PC-ä¸¤æ®µå¼æäº¤">2.1 2PC ä¸¤æ®µå¼æäº¤</h4><p>ä¸¤æ®µå¼æäº¤åè®®ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š<br><img src="/2022/05/10/shu-ju-ku-de-acid-he-fen-bu-shi-shi-wu/2PC.png" alt="2PC"></p><h5 id="ç¬¬ä¸€é˜¶æ®µï¼ˆprepare-å‡†å¤‡é˜¶æ®µï¼‰">ç¬¬ä¸€é˜¶æ®µï¼ˆprepare å‡†å¤‡é˜¶æ®µï¼‰</h5><ol><li><strong>åè°ƒè€…ï¼ˆCoordinatorï¼‰</strong>ï¼šå‘èµ·å¹¶ç®¡ç†æ•´ä¸ªäº‹åŠ¡çš„è¿›ç¨‹ã€‚å®ƒé¦–å…ˆå‘æ‰€æœ‰å‚ä¸äº‹åŠ¡çš„èŠ‚ç‚¹ï¼ˆä¹Ÿç§°ä¸ºå‚ä¸è€…ï¼‰å‘é€ prepare requestã€‚</li><li><strong>å‚ä¸è€…ï¼ˆParticipantsï¼‰</strong>ï¼šæ¥æ”¶åˆ° prepare request åï¼Œæ¯ä¸ªå‚ä¸è€…ä¼šé”å®šèµ„æºï¼Œæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†æ“ä½œç»“æœï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰è®°å½•åˆ°æ—¥å¿—ä¸­ã€‚ç„¶åï¼Œå®ƒä»¬å„è‡ªå‘åè°ƒè€…æŠ¥å‘Šâ€å‡†å¤‡å°±ç»ªâ€œï¼ˆè¡¨ç¤ºå¯ä»¥æäº¤ï¼Œèµ„æºå·²é”å®šï¼Œæ“ä½œå·²è®°å½•ï¼Œä½†å°šæœªå®é™…æäº¤ï¼‰æˆ–â€œå‡†å¤‡å¤±è´¥â€œã€‚</li></ol><h5 id="ç¬¬äºŒé˜¶æ®µï¼ˆcommit-æäº¤é˜¶æ®µï¼‰">ç¬¬äºŒé˜¶æ®µï¼ˆcommit æäº¤é˜¶æ®µï¼‰</h5><ul><li>å¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½æŠ¥å‘Šâ€å‡†å¤‡å°±ç»ªâ€œï¼Œåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ commit requestã€‚å‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡æäº¤åé‡Šæ”¾æ‰€æœ‰é”å®šçš„èµ„æºï¼Œå¹¶å‘åè°ƒè€…æŠ¥å‘Šå®Œæˆã€‚</li><li>å¦‚æœä»»ä½•å‚ä¸è€…æŠ¥å‘Šâ€å‡†å¤‡å¤±è´¥â€œï¼Œæˆ–è€…ä»»ä½•å‚ä¸è€…å“åº”è¶…æ—¶ï¼Œåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ rollback requestã€‚å‚ä¸è€…å°†æ’¤é”€æ‰€æœ‰äº‹åŠ¡æ“ä½œï¼Œé‡Šæ”¾æ‰€æœ‰é”å®šçš„èµ„æºï¼Œå¹¶å‘åè°ƒè€…æŠ¥å‘Šå®Œæˆã€‚</li></ul><h5 id="ä¸¤æ®µå¼æäº¤çš„ç¼ºç‚¹">ä¸¤æ®µå¼æäº¤çš„ç¼ºç‚¹</h5><p>å°½ç®¡ä¸¤æ®µå¼æäº¤èƒ½å¤Ÿç¡®ä¿åˆ†å¸ƒå¼ç³»ç»Ÿä¸­äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼š</p><ul><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šæ‰€æœ‰å‚ä¸è€…åœ¨ç¬¬ä¸€é˜¶æ®µç»“æŸæ—¶éƒ½å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°æ”¶åˆ°åè°ƒè€…çš„æœ€ç»ˆå†³å®šï¼ˆæäº¤æˆ–å›æ»šï¼‰ã€‚è¿™ä¸ªç­‰å¾…è¿‡ç¨‹å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿèµ„æºé•¿æ—¶é—´é”å®šï¼Œå½±å“æ€§èƒ½ã€‚</li><li><strong>å•ç‚¹æ•…éšœ</strong>ï¼šå¦‚æœåè°ƒè€…åœ¨ç¬¬äºŒé˜¶æ®µå´©æºƒï¼Œå‚ä¸è€…å¯èƒ½ä¼šé™·å…¥ä¸ç¡®å®šçŠ¶æ€ï¼Œä¸çŸ¥é“æ˜¯åº”è¯¥æäº¤è¿˜æ˜¯å›æ»šï¼Œè¿™ä¼šå¯¼è‡´ç³»ç»ŸæŒ‚èµ·ã€‚</li><li><strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šåœ¨æŸäº›æç«¯æƒ…å†µä¸‹ï¼ˆå¦‚ç½‘ç»œåˆ†åŒºï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†å‚ä¸è€…æäº¤äº‹åŠ¡ï¼Œè€Œå…¶ä»–å‚ä¸è€…å›æ»šäº‹åŠ¡ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul><p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç ”ç©¶è€…æå‡ºäº†è®¸å¤šæ”¹è¿›çš„åè®®ï¼Œå¦‚ä¸‰æ®µå¼æäº¤ï¼ˆThree-Phase Commitï¼Œ3PCï¼‰ç­‰ï¼Œæ—¨åœ¨æé«˜å®¹é”™æ€§å’Œå‡å°‘åœ¨äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­èµ„æºé”å®šçš„æ—¶é—´ã€‚</p><h4 id="2-2-3PC-ä¸‰æ®µå¼æäº¤">2.2 3PC ä¸‰æ®µå¼æäº¤</h4><p>3PC æ˜¯ä¸¤æ®µå¼æäº¤ï¼ˆ2PCï¼‰çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œæ—¨åœ¨è§£å†³ 2PC é¢ä¸´çš„ä¸€äº›ä¸»è¦é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨é¢å¯¹å•ç‚¹æ•…éšœå’Œç½‘ç»œåˆ†åŒºæ—¶ï¼Œèƒ½æ›´å¥½åœ°ä¿æŒåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§ã€‚<br>3PC é€šè¿‡å°†<code>prepareé˜¶æ®µ</code>åˆ†æ‹†æˆ<code>Can Commit</code>å’Œ<code>Pre-Commit</code>ä¸¤ä¸ªé˜¶æ®µï¼Œ é€šè¿‡<code>è¯¢é—®ï¼Œå†é”èµ„æºï¼Œæœ€åçœŸæ­£æäº¤</code>çš„æ–¹å¼ï¼Œæ¥å‡å°‘é˜»å¡å’Œå‡è½»å•ç‚¹æ•…éšœçš„å½±å“ï¼Œæé«˜ç³»ç»Ÿçš„å®¹é”™æ€§ã€‚</p><p><img src="/2022/05/10/shu-ju-ku-de-acid-he-fen-bu-shi-shi-wu/3PC.png" alt="3PC"></p><h5 id="ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µï¼ˆCan-Commitï¼‰">ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µï¼ˆCan Commitï¼‰</h5><ol><li><strong>åè°ƒè€…</strong>å‘æ‰€æœ‰å‚ä¸è€…å‘é€<code>Can Commit</code>è¯·æ±‚ï¼Œå¹¶ç­‰å¾…å‚ä¸è€…çš„å“åº”ã€‚</li><li><strong>å‚ä¸è€…</strong>ï¼š<ul><li>æ”¶åˆ°<code>Can Commit</code>è¯·æ±‚åï¼Œå‚ä¸è€…æ‰§è¡Œäº‹åŠ¡ç›¸å…³çš„å‡†å¤‡å·¥ä½œï¼ˆå¦‚æ£€æŸ¥æ•°æ®çš„æœ‰æ•ˆæ€§ã€é¢„ç•™å¿…éœ€èµ„æºç­‰ï¼‰ã€‚</li><li>å¦‚æœå‚ä¸è€…åˆ¤æ–­è‡ªå·±èƒ½å¤Ÿæäº¤äº‹åŠ¡ï¼Œåˆ™å‘åè°ƒè€…å‘é€<code>Yes</code>å›å¤ï¼Œè¡¨æ˜å‡†å¤‡å°±ç»ªã€‚</li><li>å¦‚æœæ— æ³•æäº¤ï¼ˆå¦‚èµ„æºä¸è¶³æˆ–æ•°æ®éªŒè¯å¤±è´¥ï¼‰ï¼Œåˆ™å‘é€<code>No</code>å›å¤ï¼Œå¹¶ç»ˆæ­¢äº‹åŠ¡ã€‚</li></ul></li></ol><h5 id="ç¬¬äºŒé˜¶æ®µï¼šé¢„æäº¤é˜¶æ®µï¼ˆPre-commitï¼‰">ç¬¬äºŒé˜¶æ®µï¼šé¢„æäº¤é˜¶æ®µï¼ˆPre-commitï¼‰</h5><ul><li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šåªæœ‰å½“åè°ƒè€…ä»æ‰€æœ‰å‚ä¸è€…å¤„æ”¶åˆ°äº†<code>Yes</code>å›å¤ï¼Œæ‰ä¼šè¿›å…¥æ­¤é˜¶æ®µã€‚</li></ul><ol><li><p><strong>åè°ƒè€…</strong>ï¼š</p><ul><li>å‘æ‰€æœ‰å‚ä¸è€…å‘é€<code>Pre-commit</code>è¯·æ±‚ï¼Œé€šçŸ¥å®ƒä»¬è¿›å…¥é¢„æäº¤çŠ¶æ€ã€‚</li><li>å¼€å§‹ç­‰å¾…æ‰€æœ‰å‚ä¸è€…çš„<code>ACK</code>ï¼ˆç¡®è®¤ï¼‰æ¶ˆæ¯ã€‚</li></ul></li><li><p><strong>å‚ä¸è€…</strong>ï¼š</p><ul><li>æ”¶åˆ°<code>Pre-commit</code>è¯·æ±‚åï¼Œå‚ä¸è€…ä¼šæ‰§è¡Œæ‰€æœ‰å¿…è¦æ“ä½œä»¥å‡†å¤‡æäº¤äº‹åŠ¡ï¼Œä½†æ­¤æ—¶ä¸ä¼šçœŸæ­£æäº¤ã€‚è¿™å¯èƒ½åŒ…æ‹¬æœ€ç»ˆçš„<code>èµ„æºé”å®š</code>å’Œ<code>æ—¥å¿—è®°å½•</code>ï¼Œä»¥ç¡®ä¿å¯ä»¥å®‰å…¨åœ°æäº¤äº‹åŠ¡ã€‚</li><li>å‡†å¤‡å°±ç»ªåï¼Œå‚ä¸è€…ä¼šå‘åè°ƒè€…å‘é€<code>ACK</code>ï¼Œè¡¨ç¤ºå‡†å¤‡æäº¤ã€‚</li></ul></li></ol><h5 id="ç¬¬ä¸‰é˜¶æ®µï¼šæäº¤é˜¶æ®µï¼ˆDo-Commitï¼‰">ç¬¬ä¸‰é˜¶æ®µï¼šæäº¤é˜¶æ®µï¼ˆDo Commitï¼‰</h5><ul><li><strong>è§¦å‘æ¡ä»¶ï¼ˆæäº¤ï¼‰</strong>ï¼šå¦‚æœåè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„<code>ACK</code>ï¼Œåˆ™ä¼šè¿›å…¥æäº¤é˜¶æ®µã€‚</li><li><strong>è§¦å‘æ¡ä»¶ï¼ˆä¸­æ­¢ï¼‰</strong>ï¼šå¦‚æœåœ¨ä»»ä½•é˜¶æ®µåè°ƒè€…ä»ä»»ä¸€å‚ä¸è€…é‚£é‡Œæ¥æ”¶åˆ°<code>No</code>ï¼Œæˆ–è€…è¶…æ—¶æ²¡æœ‰æ”¶åˆ°é¢„æœŸçš„å›å¤ï¼Œå®ƒå°†å†³å®šä¸­æ­¢äº‹åŠ¡ã€‚</li></ul><p>å½“è§¦å‘æäº¤åˆ†æ”¯ï¼š</p><ol><li><strong>åè°ƒè€…</strong>ï¼š<ul><li>å‘æ‰€æœ‰å‚ä¸è€…å‘é€<code>Do Commit</code>æŒ‡ä»¤ã€‚</li></ul></li><li><strong>å‚ä¸è€…</strong>ï¼š<ul><li>æ”¶åˆ°<code>Do Commit</code>åï¼Œå‚ä¸è€…æ­£å¼æäº¤äº‹åŠ¡ï¼Œå¹¶åœ¨äº‹åŠ¡æ—¥å¿—ä¸­è®°å½•æ­¤æ¬¡æäº¤ã€‚</li><li>å®Œæˆæäº¤åï¼Œé‡Šæ”¾æ‰€æœ‰é”å®šçš„èµ„æºï¼Œå¹¶å‘åè°ƒè€…å‘é€<code>å®Œæˆ</code>æ¶ˆæ¯ã€‚</li></ul></li></ol><p>å½“è§¦å‘ä¸­æ­¢åˆ†æ”¯ï¼š</p><ol><li><strong>åè°ƒè€…</strong>ï¼š<ul><li>å¦‚æœå†³å®šä¸­æ­¢äº‹åŠ¡ï¼Œåè°ƒè€…ä¼šå‘æ‰€æœ‰å‚ä¸è€…å‘é€<code>Abort</code>æŒ‡ä»¤ã€‚</li></ul></li><li><strong>å‚ä¸è€…</strong>ï¼š<ul><li>æ”¶åˆ°<code>Abort</code>æŒ‡ä»¤çš„å‚ä¸è€…ä¼šæ’¤é”€æ‰€æœ‰äº‹åŠ¡æ“ä½œï¼Œå¹¶é‡Šæ”¾æ‰€æœ‰å ç”¨çš„èµ„æºã€‚</li></ul></li></ol><h5 id="ä¼˜åŠ¿">ä¼˜åŠ¿</h5><ul><li><strong>å‡å°‘é˜»å¡</strong>ï¼šé€šè¿‡ pre-commit é˜¶æ®µçš„æœºåˆ¶è®¾å®šï¼šåœ¨æ­¤é˜¶æ®µæ‰é”å®šèµ„æº ä»¥åŠ å‚ä¸è€…å¯¹äºæŒ‡ä»¤è¶…æ—¶æœªæ¥æ”¶è¿›è¡Œé»˜è®¤äº‹åŠ¡å¤„ç†çš„æ–¹å¼ï¼Œæ¥å‡å°‘äº†é˜»å¡æ—¶é—´ã€‚</li><li><strong>æé«˜å®¹é”™æ€§</strong>ï¼š3PCé€šè¿‡å¼•å…¥é¢å¤–çš„é¢„æäº¤é˜¶æ®µï¼Œå¢åŠ äº†å†³ç­–è¿‡ç¨‹çš„çµæ´»æ€§ï¼Œä½¿ç³»ç»Ÿæ›´èƒ½å®¹å¿åè°ƒè€…çš„å¤±è´¥ã€‚</li></ul><h5 id="ç¼ºç‚¹">ç¼ºç‚¹</h5><ul><li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šå¼•å…¥é¢å¤–çš„é¢„æäº¤é˜¶æ®µæ„å‘³ç€æ›´å¤šçš„é€šä¿¡å¼€é”€ï¼Œå¯èƒ½å¯¹ç³»ç»Ÿæ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</li><li><strong>å¤æ‚æ€§å¢åŠ </strong>ï¼šä¸2PCç›¸æ¯”ï¼Œ3PCçš„å®ç°æ›´åŠ å¤æ‚ï¼Œéœ€è¦æ›´å¤šçš„æ§åˆ¶é€»è¾‘æ¥å¤„ç†é¢å¤–çš„é˜¶æ®µå’Œå¯èƒ½çš„çŠ¶æ€ã€‚</li><li><strong>ä»ç„¶å­˜åœ¨é—®é¢˜</strong>ï¼šå°½ç®¡3PCåœ¨æŸäº›æ–¹é¢æ¯”2PCæ›´å¥å£®ï¼Œä½†å®ƒä»ç„¶ä¸èƒ½å®Œå…¨è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰é—®é¢˜ï¼Œå¦‚ç½‘ç»œåˆ†åŒºæƒ…å†µä¸‹çš„è„‘è£‚é—®é¢˜(åœ¨ç¬¬ä¸‰é˜¶æ®µå‚ä¸è€…æ²¡æœ‰æ¥æ”¶åˆ°AbortæŒ‡ä»¤ï¼Œé‡‡ç”¨äº†é»˜è®¤çš„do commitï¼Œåˆ™ä¼šé€ æˆå‚ä¸è€…ç¾¤çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè™½ç„¶å› ä¸ºå‰ä¸¤é˜¶æ®µçš„è®¾è®¡ï¼Œè¿™ç§æƒ…å†µçš„æ¦‚ç‡ä¼šæ¯”è¾ƒä½)ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼Œ3PCé€šè¿‡å¼•å…¥ä¸‰æ®µå¼ç®—æ³•ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†åˆ†å¸ƒå¼ç³»ç»Ÿäº‹åŠ¡å¤„ç†çš„å¯é æ€§å’Œå®¹é”™æ€§ï¼Œä½†è¿™ä¹Ÿä»¥å¢åŠ ç³»ç»Ÿå¤æ‚æ€§å’Œé€šä¿¡æˆæœ¬ä¸ºä»£ä»·ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®ç³»ç»Ÿçš„å…·ä½“éœ€æ±‚å’Œç¯å¢ƒï¼Œæƒè¡¡3PCä¸å…¶ä»–äº‹åŠ¡å¤„ç†æœºåˆ¶çš„åˆ©å¼Šã€‚</p><h4 id="2-3-æ€»ç»“">2.3 æ€»ç»“</h4><p>é€šè¿‡ä¸Šé¢å¯¹2/3PCç®—æ³•çš„äº†è§£ï¼Œå¯ä»¥å‘ç°å…¶å¹¶ä¸èƒ½å®Œå…¨è¾¾åˆ°å¼ºä¸€è‡´æ€§çš„ç›®æ ‡ï¼Œåœ¨ç½‘ç»œåˆ†åŒºç­‰æƒ…å†µä¸‹ä»ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ï¼ŒåŒæ—¶è¿˜ä¼šå¸¦æ¥ä½æ€§èƒ½ä½å¹¶å‘ç­‰é—®é¢˜ã€‚<br>å› æ­¤ï¼Œæ‰ä¼šæœ‰åé¢è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„å…¶ä»–è§£å†³æ–¹æ¡ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼æ¶æ„å¿…é¡»é‡è§†çš„CAPç†è®º</title>
      <link href="/2022/05/03/fen-bu-shi-jia-gou-bi-xu-chong-shi-de-cap-li-lun/"/>
      <url>/2022/05/03/fen-bu-shi-jia-gou-bi-xu-chong-shi-de-cap-li-lun/</url>
      
        <content type="html"><![CDATA[<p>CAPå®šç†ï¼Œè¯´èµ·æ¥ç¨‹åºå‘˜ä»¬åº”è¯¥è€³ç†Ÿèƒ½è¯¦ï¼šC(Consistency)ã€A(Availability)ã€P(Partition Tolerance)ï¼Œæ„æˆåœ¨åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ä¸­çš„â€œä¸å¯èƒ½ä¸‰è§’â€ï¼Œä¸‰è€…åªèƒ½ä¿è¯å…¶äºŒã€‚<br>æ¥ï¼Œå†å±•å¼€è¯´è¯´ï¼Ÿè¿™æ—¶å€™ï¼Œå¤šæ•°äººçš„å›ç­”å°±ä¼šæ˜¯æ˜¯è€Œéï¼Œæ¨¡æ£±ä¸¤å¯ã€‚<br>ä¹Ÿè®¸ä¸å°‘åº”ç”¨çº§å¼€å‘å·¥ç¨‹å¸ˆè§‰å¾— â€”â€” æˆ‘åˆä¸è‡ªç ”é›†ç¾¤æ•°æ®åº“ï¼Œä¹Ÿä¸å¼€å‘äº‘å¹³å°ï¼Œæ²¡å¿…è¦é‚£ä¹ˆäº†è§£ CAP ç†è®ºã€‚<br>é‚£ä¹ˆï¼Œä½ å¼€å‘çš„åº”ç”¨ç³»ç»Ÿï¼Œæ˜¯å¦ä½¿ç”¨äº†åˆ†å¸ƒå¼æ¶æ„å‘¢ï¼Ÿå¦‚æœæ˜¯ï¼ŒCAP ç†è®ºå¯ä»¥è¯´æ˜¯æŒ‡å¯¼æ„å»ºç³»ç»Ÿçš„æŠ€æœ¯ç†è®ºåŸºçŸ³ä¹‹ä¸€ï¼Œå¿…é¡»è¦é‡è§†èµ·æ¥ã€‚</p><span id="more"></span><h3 id="1-CAP-å®šç†åˆ°åº•è®²äº†ä»€ä¹ˆ">1. CAP å®šç†åˆ°åº•è®²äº†ä»€ä¹ˆ?</h3><p>CAP å®šç†å¯¹åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ç³»ç»Ÿçš„ç‰¹æ€§è¿›è¡Œé«˜åº¦æŠ½è±¡ï¼Œæç‚¼æˆäº†3ä¸ªç»´åº¦ï¼š</p><ul><li><p><code>Consistency ä¸€è‡´æ€§</code>, æ¯ä¸€æ¬¡è¯»å–æ“ä½œï¼Œè¦ä¹ˆç³»ç»Ÿè¿”å›æœ€æ–°çš„æ•°æ®å†™å…¥å€¼ï¼ˆæ— è®ºè¯»å–åˆ°å“ªä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼‰ï¼Œè¦ä¹ˆè¿”å›ç³»ç»Ÿé”™è¯¯ã€‚<br>è¿™é‡Œçš„ä¸€è‡´æ€§ï¼Œä»£è¡¨çš„å¼ºä¸€è‡´æ€§ã€çº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizabilityï¼‰ã€‚</p></li><li><p><code>Availability å¯ç”¨æ€§</code>, æ¯ä¸€æ¬¡è¯»å–æ“ä½œéƒ½èƒ½è·å¾—ç³»ç»Ÿçš„è¿”å›ï¼Œä½†ä¸ä¿è¯è¿”å›çš„æ˜¯æœ€æ–°çš„æ•°æ®å†™å…¥å€¼ã€‚</p></li><li><p><code>Partition Tolerance åˆ†åŒºå®¹é”™æ€§</code>ï¼Œå½“æ•°æ®èŠ‚ç‚¹ä¹‹é—´å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼ˆåŒ…æ‹¬ç½‘ç»œä¸¢åŒ…ã€è¿æ¥ä¸­æ–­é˜»å¡ç­‰ï¼‰ï¼Œç³»ç»Ÿä»ç„¶è¦ç»§ç»­å·¥ä½œã€‚</p></li></ul><p>è¿™å…¶ä¸­çš„åº•å±‚é€»è¾‘æ˜¯ï¼šåˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å„èŠ‚ç‚¹ä¹‹é—´é€šè¿‡ç½‘ç»œè¿æ¥ï¼Œåœ¨è¿è¡ŒæœŸé—´ä¸å¯é¿å…å­˜åœ¨ç½‘ç»œåˆ†åŒºçš„é£é™©ã€‚<br>å½“ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œæ— è®ºæ˜¯èŠ‚ç‚¹ä¹‹é—´çš„çŠ¶æ€åŒæ­¥è¿˜æ˜¯æ•°æ®å¤åˆ¶ï¼Œéƒ½ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œéƒ¨åˆ†èŠ‚ç‚¹çš„æ•°æ®æ»ç•™åœ¨è¿‡å»æ—¶åˆ»çš„æŸç§çŠ¶æ€ã€‚</p><p>è€Œä¿è¯<code>åˆ†åŒºå®¹é”™æ€§</code>ï¼Œå°±æ˜¯å½“å‘ç”Ÿç½‘ç»œåˆ†åŒºå¼‚å¸¸æ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿä»ç„¶è¿è¡Œå¹¶ç»§ç»­å·¥ä½œï¼Œè¿™æ—¶å€™æä¾›çš„æœåŠ¡ç»´åº¦åªå¯èƒ½åœ¨ Consistency å’Œ Availability ä¸­ä¿è¯ä¸€é¡¹ï¼š</p><ul><li><p>ç¡®ä¿ä¸€è‡´æ€§ï¼Œç‰ºç‰²å¯ç”¨æ€§ã€‚<br>ç³»ç»Ÿä¼šé€šè¿‡å†…éƒ¨ç­–ç•¥ï¼Œè‡ªåŠ¨ä¿®å¤é›†ç¾¤ï¼Œæœ€ç»ˆç¡®ä¿<code>Consistency</code>å£°æ˜çš„å¼ºä¸€è‡´æ€§ã€‚åœ¨è‡ªåŠ¨ä¿®å¤å®Œæˆä¹‹å‰ï¼Œå¤–éƒ¨è¯·æ±‚ä¼šè¿”å›ç³»ç»Ÿå‡ºé”™æˆ–è€…è¶…æ—¶ã€‚<br><img src="/2022/05/03/fen-bu-shi-jia-gou-bi-xu-chong-shi-de-cap-li-lun/CAP_CP.png" alt="CP"><br><em>ä¸Šå›¾ç®€åŒ–äº†é›†ç¾¤ä¸­çš„ä¸€äº›é—®é¢˜æè¿°ï¼Œæ¯”å¦‚å…±è¯†ç®—æ³•è‡³å°‘éœ€è¦ä¸‰ä¸ªèŠ‚ç‚¹ã€‚</em><br><em>å½“èŠ‚ç‚¹ 2 ä¸ èŠ‚ç‚¹ 1 ä¹‹é—´å› ä¸ºé€šè®¯å¼‚å¸¸ï¼Œæœªèƒ½å¯¹ x çš„å€¼è¾¾æˆä¸€è‡´ï¼Œæ­¤æ—¶å¤–éƒ¨è¯·æ±‚è¯»å– x çš„å€¼ï¼Œç³»ç»Ÿå°†è¿”å›â€œç³»ç»Ÿå‡ºé”™â€æˆ–è€…è¶…æ—¶ã€‚</em></p></li><li><p>ç¡®ä¿å¯ç”¨æ€§ï¼Œç‰ºç‰²ä¸€è‡´æ€§ã€‚<br>ç³»ç»Ÿåœ¨è‡ªåŠ¨ä¿®å¤é›†ç¾¤æœŸé—´ï¼Œæ²¡æœ‰è¾¾æˆæ•°æ®ä¸€è‡´æ€§çš„å„èŠ‚ç‚¹ä»ä¼šå¯¹å¤–åŠæ—¶å“åº”ï¼Œç¡®ä¿<code>Availability</code>å£°æ˜çš„é«˜å¯ç”¨æ€§ã€‚<br><img src="/2022/05/03/fen-bu-shi-jia-gou-bi-xu-chong-shi-de-cap-li-lun/CAP_AP.png" alt="AP"></p></li></ul><p>ä»¥ä¸Šï¼Œå³æ˜¯ CAP ç†è®ºä¸­ CP å’Œ AP çš„ç”±æ¥ã€‚<br>ç„¶è€Œï¼Œåœ¨åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨æ¶æ„ä¸­ï¼Œè™½ç„¶ç½‘ç»œåˆ†åŒºæ˜¯ä¸å¯å›é¿çš„é£é™©ï¼Œä½†ä¹Ÿä¸æ„å‘³ç€ç³»ç»Ÿä»»ä½•æ—¶å€™éƒ½å¤„äºç½‘ç»œåˆ†åŒºçš„çŠ¶æ€ä¹‹ä¸‹ã€‚åœ¨æ²¡æœ‰å‘ç”Ÿç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼ŒCA åº”è¯¥æ˜¯ä¸»è¦çŠ¶æ€ã€‚</p><p>æœ‰äººä¹Ÿè®¸ä¼šå¯¹æ­¤äº§ç”Ÿè´¨ç–‘ï¼šå³ä½¿åˆ†å¸ƒå¼é›†ç¾¤ä¸€åˆ‡è¿è¡Œæ­£å¸¸ï¼Œæ²¡æœ‰å‘ç”Ÿç½‘ç»œæ•…éšœï¼Œä½†èŠ‚ç‚¹é—´çš„æ•°æ®ä¼ è¾“ä¹Ÿéœ€è¦æ—¶é—´ã€å­˜åœ¨ç½‘ç»œå»¶æ—¶ï¼Œä¸å¯èƒ½åœ¨æœªå®Œæˆæ•°æ®åŒæ­¥çš„ä¸­é—´çŠ¶æ€ä¸‹ï¼Œæ—¢ä¿è¯å¯ç”¨ï¼Œåˆä¿è¯æ‰€æœ‰èŠ‚ç‚¹æ•°æ®ä¸€è‡´æ€§ã€‚<br>æ˜¯çš„ï¼Œè¿™ç§é—®æ³•å¾ˆå¯¹ã€‚<br>å› æ­¤ï¼Œé’ˆå¯¹ CAP ç†è®ºä¸­çš„ Cï¼Œä¸€äº›ä¸“å®¶è§£é‡Šï¼šConsistencyï¼Œæ˜¯å¿½ç•¥æ•°æ®å¤åˆ¶å»¶æ—¶çš„ï¼Œæ˜¯å‡è®¾æ•°æ®å¤åˆ¶ä¸å­˜åœ¨å»¶æ—¶çš„ç†è®ºåœºæ™¯ã€‚</p><p>ç„¶è€Œæ•°æ®å¤åˆ¶çš„å»¶æ—¶ï¼Œåœ¨ç°å®åˆ†å¸ƒå¼ç³»ç»Ÿè¿è¡ŒæœŸé—´å§‹ç»ˆå­˜åœ¨ï¼Œå› æ­¤è¿™æ—¶æ—  <code>P</code> çš„ <code>CA</code> å¾ˆéš¾ä¸ç°å®è¿›è¡Œç›¸äº’æ˜ å°„ï¼Œä½¿ç”¨æ—¶å¯èƒ½ä¼šé€ æˆå›°æ‰°ï¼Œä¸å¦‚ç†è§£ä¸º:</p><ul><li><code>Consistency</code> æ˜¯åŒ…å«æ­£å¸¸æ°´å¹³çš„å¤åˆ¶å»¶æ—¶çš„ï¼Œè¿™éƒ¨åˆ†å»¶æ—¶ä¼šè®¡ç®—åœ¨å“åº”æ—¶é—´ä¸­ï¼Œè€Œä¸ç®—å½±å“ <code>Availability</code>ã€‚è€Œå½“è¾¾æˆä¸€è‡´æ€§çš„å¤„ç†æ—¶é•¿è¶…å‡ºè¿™ä¸ªæ­£å¸¸æ°´å¹³ï¼Œæ‰ç®—ä½œå½±å“ <code>Availability</code>ã€‚<br>å½“ç„¶ï¼Œæ›´å¥½çš„è§£é‡Šï¼Œä¹Ÿè®¸åº”è¯¥çœ‹ä¸‹ <code>PACELC ç†è®º</code>ï¼Œå¯ä»¥å¯¹æ­¤åœºæ™¯è¿›è¡Œè¡¥å……ã€‚</li></ul><h3 id="2-CAP-çš„æ‰©å±•ï¼šPACELC-ç†è®º">2. CAP çš„æ‰©å±•ï¼šPACELC ç†è®º</h3><p>é€šè¿‡ä¸Šé¢å¯¹<code>CAP å®šç†</code>çš„äº†è§£ï¼Œå¯ä»¥æ€»ç»“ä¸ºåœ¨åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨æ¶æ„è®¾è®¡ä¸­ï¼Œè‡³å°‘éœ€è¦ä¸€æ¡ baseline ç­–ç•¥ï¼Œåº”å¯¹å‡ºç°ç½‘ç»œåˆ†åŒºè¿™ç§å±é™©çŠ¶å†µã€‚<br><img src="/2022/05/03/fen-bu-shi-jia-gou-bi-xu-chong-shi-de-cap-li-lun/CAP.png" alt="CAP"></p><p>åœ¨æ²¡æœ‰å‡ºç°ç½‘ç»œåˆ†åŒºã€æ­£å¸¸è¿è¡Œçš„ç³»ç»ŸçŠ¶æ€ä¸‹ï¼ŒCAP ç†è®ºä¸­çš„ CA å¯ä»¥è¾¾æˆï¼Œä½†<code>æ•°æ®ä¸€è‡´æ€§</code>çš„çŠ¶æ€ã€ä»¥åŠéšè—åœ¨è¾¾æˆè¯¥çŠ¶æ€èƒŒåçš„<code>å»¶æ—¶æ—¶é•¿</code> â€”â€” è¿™ä¸¤ä¸ªç°å®ç³»ç»Ÿä¸­è¿‡äºå¸¸è§çš„ç»´åº¦ï¼Œå¦‚ä¸€åŒåœ¨ CAP å®šç†ä¸­è¯´ä¸æ¸…ã€é“ä¸æ˜ã€åˆæ— å¤„å®‰æ”¾çš„å°æ‰‹ï¼Œåˆè¯¥å¦‚ä½•è¡¡é‡å’Œå–èˆå‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™ï¼Œå°±å¯ä»¥çœ‹ä¸€ä¸‹ <code>PACELE ç†è®º</code>ã€‚<br><code>PACELE</code> æ˜¯ <code>CAP ç†è®º</code> çš„æ‰©å±•ï¼Œ <code>PAC</code> å„å­—æ¯åŒ <code>CAP ç†è®º</code>ï¼Œ <code>E (Else)</code> ä»…æ˜¯è¿æ¥è¯ï¼Œ<code>L (latency) </code>ã€<code>C (consistency)</code>ã€‚æ„æ€å°±æ˜¯ï¼Œå½“æ²¡æœ‰å‡ºç°ç½‘ç»œåˆ†åŒºã€ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶ï¼Œ<code>ä½å»¶æ—¶</code>ï¼ˆä½äºæ•°æ®è¾¾æˆä¸€è‡´æ‰€éœ€çš„å¹³å‡å»¶æ—¶æ°´å¹³ï¼‰ å’Œ <code>æ•°æ®ä¸€è‡´æ€§</code>ï¼ŒäºŒè€…éœ€è¦é€‰æ‹©å…¶ä¸€ï¼Œä¸èƒ½åŒæ—¶ä¿è¯ã€‚<br><img src="/2022/05/03/fen-bu-shi-jia-gou-bi-xu-chong-shi-de-cap-li-lun/PACELE.png" alt="PACELE"></p><p>å½“æœ‰äº†åŸºäº<code>CAP</code>æ‰©å±•å‡ºçš„<code>PACELE</code>ï¼Œä¸ªäººè§‰å¾—ï¼Œåˆ†å¸ƒå¼æ•°æ®å­˜å‚¨çš„ç‰¹æ€§æ¶æ„æè¿°æ‰æ¯”è¾ƒå®Œæ•´ã€‚<br>æ¯”å¦‚ï¼ŒMongoDB é›†ç¾¤çš„å°±æ˜¯å…¸å‹çš„ <code>PA/EC</code> ç³»ç»Ÿï¼šåœ¨å‡ºç°ç½‘ç»œåˆ†åŒºæ—¶ï¼ŒMongoDB é›†ç¾¤ä¼˜å…ˆä¿è¯å¯ç”¨æ€§ï¼Œæ•°æ®å¯èƒ½ä¸æ˜¯æœ€æ–°ï¼›åœ¨é›†ç¾¤æ­£å¸¸çŠ¶æ€ä¸‹ï¼Œä¼˜å…ˆä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚<br>è¿™ä¹Ÿå°±é˜²æ­¢äº†ç”¨æˆ·ä¸€å¬åˆ° AP æ¶æ„å°±é€ æˆçš„ææ…Œ â€”â€” ä»¥ä¸ºç³»ç»ŸçŠ¶æ€æ­£å¸¸ä¸‹ï¼Œç¨‹åºå‘˜ä»éœ€è¦å¤§é‡ç¼–ç ã€è‡ªå·±å¤„ç†æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><p>ä¸‹å›¾æ˜¯<code>PACELE ç†è®º</code>ä¸­çš„ç‰¹æ€§æ­é…å›¾ï¼Œï¼ˆæ¨ªè½´æ˜¯å‘ç”Ÿ P æ—¶çš„A or C é€‰æ‹©ï¼Œçºµè½´æ˜¯æ²¡æœ‰å‘ç”Ÿ P æ—¶å¯¹ C or L çš„é€‰æ‹©ï¼‰ï¼š<br><img src="/2022/05/03/fen-bu-shi-jia-gou-bi-xu-chong-shi-de-cap-li-lun/PACELE_2.png" alt="PACELE"></p><h3 id="3-ä¸ºä»€ä¹ˆåšåˆ†å¸ƒå¼æ¶æ„è¦é‡è§†-CAP-ç†è®ºï¼Ÿ">3. ä¸ºä»€ä¹ˆåšåˆ†å¸ƒå¼æ¶æ„è¦é‡è§† CAP ç†è®ºï¼Ÿ</h3><h4 id="3-1-å¯¹åˆ†å¸ƒå¼åº”ç”¨æ¶æ„æœ‰å€Ÿé‰´å’ŒæŒ‡å¯¼ä½œç”¨">3.1. å¯¹åˆ†å¸ƒå¼åº”ç”¨æ¶æ„æœ‰å€Ÿé‰´å’ŒæŒ‡å¯¼ä½œç”¨</h4><p>å½“å‰ä¸»æµçš„åˆ†å¸ƒå¼åº”ç”¨æ¶æ„å¦‚å¾®æœåŠ¡æ¶æ„ï¼Œåœ¨é¢†åŸŸå¾®æœåŠ¡ä¹‹é—´ä¸å¯é¿å…åœ°å­˜åœ¨æ•°æ®å¤åˆ¶ï¼Œæ¯”å¦‚ï¼šæœåŠ¡è¾¹ç•Œå†…å®ä½“ã€åŒæ—¶ä¹Ÿæ˜¯å…¶ä»–å¾®æœåŠ¡çš„å€¼å¯¹è±¡ï¼›é‡‡ç”¨ CQRS æ¨¡å¼æ„å»ºå¾®æœåŠ¡ï¼›ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„æ­å»ºå¾®æœåŠ¡ç­‰ç­‰ã€‚<br>åªè¦å­˜åœ¨æ•°æ®åœ¨ä¸åŒæœåŠ¡ä¹‹é—´çš„å¤åˆ¶ï¼š</p><ul><li>å½“å¤åˆ¶æœºåˆ¶å‡ºç°è¿é€šæ•…éšœã€é˜»å¡ã€é«˜å»¶è¿Ÿç­‰ï¼ˆæ¯”å¦‚æ¶ˆæ¯ç»„ä»¶æ¶ˆæ¯å †ç§¯ç­‰ï¼‰ï¼Œéƒ½å¯ä»¥è¿‘ä¼¼çš„ç†è§£ä¸º <code>ç½‘ç»œåˆ†åŒº</code>ï¼Œ å½“å‘ç”Ÿ<code>ç½‘ç»œåˆ†åŒº</code>æ—¶ï¼Œéœ€è¦æœ‰å¯¹åº”ç­–ç•¥ï¼Œæ— è®ºæ˜¯ä¼˜å…ˆä¿è¯<code>æ•°æ®ä¸€è‡´æ€§</code>ï¼Œè¿˜æ˜¯ä¼˜å…ˆ<code>å¯ç”¨æ€§</code>ï¼Ÿ</li><li>å½“å¤åˆ¶æœºåˆ¶æ­£å¸¸ï¼Œæ•°æ®åŒæ­¥ä»å­˜åœ¨æ—¶é—´æˆæœ¬ã€‚è¿™æ—¶å€™ï¼Œæ˜¯ä¼˜å…ˆä¿è¯<code>æ•°æ®ä¸€è‡´æ€§</code>ï¼Œè¿˜æ˜¯ä¼˜å…ˆ<code>ä½å»¶æ—¶</code>ï¼Ÿ<br>è™½ç„¶ä»¥ä¸Šçš„ â€œæ•°æ®ä¸€è‡´æ€§â€ ä¸ä¸€å®šæ˜¯ CAP ä¸­çš„ â€œçº¿æ€§ä¸€è‡´æ€§â€ è¿™ç§å¼ºä¸€è‡´æ€§ï¼Œä½† CAP ç†è®ºçš„è¿™ç§æ€è€ƒç»´åº¦å’Œæ¡†æ¶ï¼Œä»¥åŠæ‰©å±•å‡ºçš„åˆ†å¸ƒå¼ç®—æ³•å’Œå®è·µï¼Œåœ¨åˆ†å¸ƒå¼åº”ç”¨æ¶æ„è®¾è®¡ä¸­ï¼Œä¹Ÿæœ‰å¾ˆå¼ºçš„å€Ÿé‰´å’ŒæŒ‡å¯¼ä½œç”¨ã€‚</li></ul><h4 id="3-2-æŒ‡å¯¼æ•°æ®å­˜å‚¨æ–¹æ¡ˆçš„é€‰å‹">3.2. æŒ‡å¯¼æ•°æ®å­˜å‚¨æ–¹æ¡ˆçš„é€‰å‹</h4><p>åˆ†å¸ƒå¼åº”ç”¨æ¶æ„ï¼Œä¸å¯é¿å…åœ°ä¼šé¢ä¸´å¯¹å„ç§æ•°æ®å­˜å‚¨äº§å“çš„é€‰å‹ï¼Œé™¤äº†æ ¹æ®åº”ç”¨ä¸šåŠ¡ç‰¹æ€§ä»¥åŠå­˜å‚¨/è¯»/å†™ç»´åº¦æ€§èƒ½çš„éœ€æ±‚ï¼Œæä¾›å®¹é‡æ‰©å±•ã€é«˜å¯ç”¨çš„é›†ç¾¤ç‰¹æ€§ï¼Œä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ä¸€ä¸ªè€ƒå¯Ÿç»´åº¦ã€‚<br>æ¯”å¦‚ï¼Œä¸šåŠ¡ç‰¹æ€§éœ€è¦çš„æ˜¯ä¸€ä¸ª PA/EC ç‰¹æ€§çš„é›†ç¾¤èƒ½åŠ›ï¼ŒPA/EL ç‰¹æ€§çš„äº§å“è‡ªç„¶æ˜¯ä¸åŒ¹é…éœ€æ±‚çš„ã€‚</p><h4 id="3-3-å¸®åŠ©å®Œå–„æ•°æ®å­˜å‚¨æ–¹æ¡ˆè½åœ°">3.3. å¸®åŠ©å®Œå–„æ•°æ®å­˜å‚¨æ–¹æ¡ˆè½åœ°</h4><p>å‰é¢æäº†é›†ç¾¤æ•°æ®åº“çš„é€‰å‹ï¼Œä½†ç¦»æ–¹æ¡ˆå¯è½åœ°ä»æœ‰ä¸€æ®µè·ç¦»ï¼Œéœ€è¦å®Œç¾é€‚é…åº”ç”¨çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¯èƒ½é™¤äº†æ­£ç¡®æ‰§è¡Œå®¢æˆ·ç«¯è°ƒç”¨ä»¥å¤–ï¼Œè¿˜éœ€è¦ä¸€äº›é¢å¤–é…ç½® æˆ–è€… äºŒæ¬¡åŠ å·¥ï¼Œæ‰èƒ½è¾¾åˆ°æŸäº›ç‰¹æ€§ç›®æ ‡ã€‚</p><p>æ¯”å¦‚ MongoDB çš„ readConcern å’Œ writeConcernï¼Œæ²¡æ¥è§¦è¿‡ <code>Quorum NWR</code> ç®—æ³•ç­–ç•¥çš„äººï¼Œå¯èƒ½æ— æ³•å¿«é€Ÿæ„è¯†åˆ° â€”â€” MongoDB å³ä½¿åœ¨ <code>AP</code> çŠ¶æ€ä¸‹ï¼Œä¾ç„¶å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯é…ç½® readConcern/writeConcern æœ‰é€‰æ‹©åœ°è¾¾æˆæ•°æ®å¼ºä¸€è‡´æ€§ã€‚<br>è€Œä¸äº†è§£ <code>Quorum NWR</code> çš„ï¼Œå¯èƒ½ä¼šèˆè¿‘æ±‚è¿œåœ°è®¾è®¡å‡ºä¸€äº›å¤æ‚åº¦è¾ƒé«˜çš„è‡ªç ”ç­–ç•¥ã€‚</p><h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3><p><a href="https://en.wikipedia.org/wiki/CAP_theorem">CAPç†è®ºç»´åŸºç™¾ç§‘åŠé“¾æ¥</a><br><a href="https://en.wikipedia.org/wiki/PACELC_theorem">PACELCç†è®ºç»´åŸºç™¾ç§‘åŠé“¾æ¥</a></p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼æ¶æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼æ¶æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡å¯</title>
      <link href="/2022/04/29/chong-qi/"/>
      <url>/2022/04/29/chong-qi/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å›å¿†è¿‡å¾€å·¥ä½œç»å†ï¼Œå‘ç°ä»¥å¾€çŸ¥è¯†ç»éªŒã€æ—æ—æ€»æ€»ï¼Œæ‰€æ€æ‰€æƒ³èƒ¡ä¹±å †ç§¯ï¼Œæ²¡æœ‰æ•´ç†æˆä¸€å¥—é€»è¾‘æ˜äº†çš„ç»“æ„çº²è¦ã€‚<br>å› æ­¤ï¼Œäºˆä»¥è®°å¿†è€Œè¨€ï¼Œæ•ˆç‡ä¸é«˜ï¼Œä¸”æ²¡æœ‰å…³è”çš„çŸ¥è¯†å—å®¹æ˜“é—å¿˜ï¼›äºˆä»¥è¡¨è¾¾è€Œè¨€ï¼Œæ˜“æ€ç»´é˜»å¡ï¼Œå‰åé€»è¾‘ä¸é¡ºï¼›äºˆä»¥è®¤æ¸…çŸ¥è¯†æœ¬è´¨è€Œè¨€ï¼Œé‡å¤é¢‡å¤šï¼Œè€Œä¸”åªè§äº‘é›¾ä¸è§é’å±±ã€‚<br>æ‰€ä»¥ï¼Œç°è§‰å¾—å¯¹è‡ªèº«çš„çŸ¥è¯†å‚¨å¤‡è¿›è¡Œé‡æ„ï¼Œè¿«åœ¨çœ‰ç«ã€‚<br>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä¸€ç§çœ‹èµ·æ¥æ¯”è¾ƒé è°±çš„æ¶æ„è§£å†³æ–¹æ¡ˆå¯ä»¥è¾¾åˆ°æ­¤ç›®çš„å‘¢ï¼Ÿ<br>é‡è¯»ã€Šé‡‘å­—å¡”åŸç†ã€‹ä¹‹åï¼Œæˆ‘è§‰å¾—ä½¿ç”¨â€œé‡‘å­—å¡”ç»“æ„â€å¯ä»¥ä¸€è¯•ã€‚</p><span id="more"></span><p><strong>ä¸ºä½•ä½¿ç”¨â€œé‡‘å­—å¡”ç»“æ„â€æœ‰åˆ©äºçŸ¥è¯†é‡æ„ï¼Ÿ</strong></p><ol><li>é‡‘å­—å¡”çºµå‘çš„â€œç–‘é—®/å›ç­”å¼â€ç»“æ„ï¼Œç¬¦åˆè½¯ä»¶æ„å»ºçš„æ€è·¯â€”â€”ä»æ„å›¾æ¨å¯¼æ–¹æ¡ˆï¼Œä»é—®é¢˜åŸŸåˆ°è§£å†³æ–¹æ¡ˆåŸŸã€‚</li><li>é‡‘å­—å¡”çš„çºµå‘ç»“æ„ï¼Œå°†çŸ¥è¯†å’Œæ€æƒ³è¿›è¡Œäº†ä¸åŒå±‚æ¬¡çš„æŠ½è±¡å’Œæ±‡æ€»ã€‚</li><li>é‡‘å­—å¡”çš„æ¨ªå‘ç»“æ„ï¼Œå¼ºè°ƒäº†åŒä¸€ä¸ªä¸»é¢˜æ€æƒ³ä¸‹çš„å­æ€æƒ³é¡¹ä¹‹é—´å¿…é¡»ç¬¦åˆé€»è¾‘å…³ç³»ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†™ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker JVMé€šç”¨å·¥å…·è¯Šæ–­æŒ‡å—</title>
      <link href="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/"/>
      <url>/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/</url>
      
        <content type="html"><![CDATA[<p>Docker container å’Œ JVMçš„é—®é¢˜è¯Šæ–­ï¼Œä»æ¥éƒ½ä¸æ˜¯é™æ€çš„ï¼Œæ‰€æœ‰æ¥æºæ•°æ®éƒ½æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹ã€‚<br>ä¸€ä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ•°æ®ã€æˆ–è€…ä¸€ä¸ªå•ä¸€æ•°æ®é¡¹çš„å­—é¢å€¼ï¼Œå¹¶ä¸èƒ½å……åˆ†è¿›è¡Œä¸Šä¸‹æ–‡åˆ†æï¼Œè€Œæ˜¯éœ€è¦ä¸€æ®µæ—¶é—´å†…æŒç»­çš„è§‚æµ‹å’Œæ•°æ®è·å–ï¼Œç„¶ååœ¨æ—¶é—´ç»´åº¦ä¸Šçš„çºµå‘å¯¹æ¯”ã€ä¸åŒå®ä¾‹é—´çš„æ¨ªå‘å¯¹æ¯”ç­‰ç­‰æ‰‹æ®µï¼Œæœ€ç»ˆå®šä½é—®é¢˜ã€‚</p><p>å¦‚ä¸‹å›¾ä¸­ï¼Œèµ„æºåˆ©ç”¨ç‡ â€”â€” å¯èƒ½æ˜¯docker CPU/Memã€JVM CPU/Memã€ç£ç›˜/ç½‘ç»œIOã€çº¿ç¨‹æ•°ç­‰ç­‰ã€‚</p><ul><li><p>å›¾1ï¼šåœ¨æ—¶é—´æ®µä¸Šï¼Œæ ¹æ®ä½¿ç”¨é‡å’Œå‹åŠ›å³°å€¼çš„åˆ†å¸ƒï¼Œèµ„æºç©ºé—²é‡å……è¶³ï¼Œæ— èµ„æºåˆ©ç”¨ç‡ç“¶é¢ˆï¼›æ‰€æœ‰å®ä¾‹è¡¨ç°ä¸€è‡´ã€‚<br>ä¸€èˆ¬ï¼Œå›¾1 è¿™ç§æ­£å¸¸æ€ä¼šä½œä¸ºåŸºå‡†å€¼æ¥å‚è€ƒã€‚</p></li><li><p>å›¾2ï¼šéšç€å‹åŠ›å³°å€¼æ—¶çš„é‡å˜ï¼Œèµ„æºåˆ©ç”¨ç‡è¶…è¿‡é˜ˆå€¼ï¼ˆ80%ï¼‰ï¼Œä½†å³°å€¼è¿‡åï¼Œèµ„æºå¾—åˆ°é€æ¸é‡Šæ”¾ï¼Œåˆ©ç”¨ç‡å¾—åˆ°å›è½ï¼›æ‰€æœ‰å®ä¾‹è¡¨ç°ä¸€è‡´ã€‚<br>é¢å¯¹è¿™ç§å‹åŠ›è¶…è¿‡é˜ˆå€¼çš„æƒ…å†µï¼Œä¸€èˆ¬å°±æ˜¯å¼€æº æˆ–è€… èŠ‚æµçš„è§£å†³æ–¹å¼ï¼š1. å¢åŠ èµ„æºé¢åº¦ï¼›2. åˆ†æèµ„æºçš„top customers, ä¼˜åŒ–ä»£ç ï¼ŒèŠ‚çœèµ„æºçš„ä½¿ç”¨ã€‚</p></li><li><p>å›¾3ï¼šç›¸åŒåº”ç”¨çš„ä¸åŒå®ä¾‹ä¸­ï¼Œæœ‰ä¸€ä¸ªå®ä¾‹çš„åˆ©ç”¨ç‡æ˜æ˜¾åŒºåˆ«äºå…¶ä»–å®ä¾‹ã€‚<br>é¢å¯¹è¿™ç§æƒ…å†µï¼Œåœ¨ç¡®è®¤è´Ÿè½½å‡è¡¡ã€éƒ¨ç½²è®¾æ–½éƒ½ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ‹¿å–é—®é¢˜å®ä¾‹çš„å®¹å™¨å†…ã€JVMå†…çš„å„é¡¹ç»†èŠ‚æ•°æ®è¿›è¡Œæ¨ªå‘å¯¹æ¯”å’Œåˆ†æã€‚</p></li><li><p>å›¾4ï¼šèµ„æºåˆ©ç”¨ç‡ä¸ä½¿ç”¨é‡å’Œå‹åŠ›å³°å€¼ä¸å‘ˆç°ç›´æ¥çš„æ­£ç›¸å…³å…³ç³»ï¼›æ‰€æœ‰å®ä¾‹è¡¨ç°ä¸€è‡´ã€‚<br>è¿™ç§æƒ…å†µï¼Œéœ€è¦æ‹¿å–å®¹å™¨ã€JVMå†…çš„ç»†èŠ‚æ•°æ®ä¸åŸºå‡†çŠ¶æ€ï¼ˆæ¯”å¦‚å‡çº§å‰çš„çº¿ä¸Šç‰ˆæœ¬ï¼‰è¿›è¡Œçºµå‘å¯¹æ¯”å’Œåˆ†æã€‚</p></li></ul><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-graph-trend.png" alt="èµ„æºåˆ©ç”¨ç‡è¶‹åŠ¿å›¾"></p><p>docker JVMå‡ºç°æ€§èƒ½é—®é¢˜æ—¶ï¼Œä¸€èˆ¬ä¼šè¡¨ç°ä¸ºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>å†…å­˜åˆ©ç”¨ç‡é«˜å‡ºé˜ˆå€¼</li><li>CPUåˆ©ç”¨ç‡é«˜å‡ºé˜ˆå€¼</li><li>æ•´ä½“æ€§æœåŠ¡è¯·æ±‚å“åº”å˜æ…¢ æˆ– è¶…æ—¶</li></ul><p>æ³¨ï¼šç”±äºæ­¤ç¯‡æŒ‡å—å¯¹åº”çº¿ä¸Šéƒ¨ç½²ç¯å¢ƒçš„Docker JVMï¼Œé™¤äº†çº¿ä¸Šç›‘æ§å·¥å…·æä¾›çš„ç›‘è§†æ•°æ®ä»¥å¤–ï¼Œæ¶‰åŠåˆ°å›¾å½¢åŒ–åˆ†æå·¥å…·çš„ä½¿ç”¨æ–¹å¼éƒ½æ˜¯ç¦»çº¿åˆ†æï¼Œ<br>å¹¶ä¸”ä¸æ¶‰åŠå„äº‘ç‰¹è‰²çš„è¯Šæ–­å·¥å…·ã€‚</p><h2 id="1-Docker-container-CPU-å†…å­˜é«˜">1. Docker container CPU / å†…å­˜é«˜</h2><p>å½“å‘ç”Ÿdocker container CPU / å†…å­˜é«˜çš„æƒ…å†µï¼Œé¦–å…ˆéœ€è¦ç¡®è®¤ï¼Œæ˜¯å“ªäº›è¿›ç¨‹åœ¨å ç”¨å®¹å™¨èµ„æºã€‚é™¤äº†JVMå¤–ï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–å¤§é‡å ç”¨å®¹å™¨èµ„æºçš„è¿›ç¨‹ï¼Ÿ<br>å¦‚æœç³»ç»Ÿæ²¡æœ‰æ¥å…¥æ€§èƒ½ç›‘æ§å¹³å°ï¼Œæˆ–è€…ç›‘æ§å¹³å°æ•°æ®ä¸ç›´è§‚æ—¶ï¼Œå¯ä»¥åœ¨docker containerå†…ä½¿ç”¨ä¸€äº› Linux å‘½ä»¤ã€‚<br>æ¨èLinuxå·¥å…·å’Œå‘½ä»¤ï¼š</p><ul><li>top</li><li>iostat</li><li>vmstat</li></ul><h3 id="1-1-topå·¥å…·">1.1 topå·¥å…·</h3><p>topæ˜¯Linuxä¸‹å¸¸ç”¨çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºç³»ç»Ÿä¸­å„è¿›ç¨‹çš„èµ„æºå ç”¨çŠ¶å†µã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ top -c$ top -Hp &lt;pid&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>å«ä¹‰ï¼š</strong></p><ul><li>top ç½—åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­çš„èµ„æºçŠ¶å†µï¼Œä»¥åŠè¿›ç¨‹æ•°é‡ã€åˆ—è¡¨ï¼Œå¹¶ä¸”å®æ—¶åˆ·æ–°ï¼Œ<code>-c</code> é€‰é¡¹ï¼Œæ˜¾ç¤ºå®Œæ•´çš„è¿›ç¨‹å¯åŠ¨å‘½ä»¤è¡Œã€‚<br>top ç›‘æ§æ”¯æŒäº¤äº’çš„å½¢å¼ï¼Œå…·ä½“æ“ä½œæŸ¥è¯¢linux topä½¿ç”¨æ–¹æ³•ã€‚</li><li>å½“è·å–åˆ° <code>pid</code> åï¼Œæƒ³è¦æŸ¥çœ‹å…·ä½“ pid è¿›ç¨‹çš„èµ„æºæ¶ˆè€—ï¼Œä»¥åŠè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ—è¡¨ï¼Œå¯ä½¿ç”¨<code>-Hp &lt;pid&gt;</code>ã€‚<br>Hä»£è¡¨ lightweightï¼Œåˆ‡æ¢åˆ°æ­¤æ¨¡å¼ï¼Œæ‰€æœ‰Taskæ˜¾ç¤ºçš„è¿›ç¨‹å†…çš„Threadæ•°é‡ï¼Œæ¸…å•åˆ—è¡¨æ˜¾ç¤ºçš„çº¿ç¨‹æ¸…å•ã€‚</li></ul><p><strong>æ³¨æ„ï¼š</strong><br>åœ¨dockerä¸­è¿è¡Œtopå‘½ä»¤æ—¶ï¼Œ<code>CPU%</code> å’Œ <code>MEM%</code> æ˜¯åŸºäºdocker hostç‰©ç†æœºçš„â€œæ€»CPUâ€å’Œâ€œæ€»ç‰©ç†å†…å­˜â€çš„ç™¾åˆ†æ¯”ã€‚</p><h3 id="1-2-iostatå·¥å…·">1.2 iostatå·¥å…·</h3><p>iostatæ˜¯I/O statisticsçš„ç¼©å†™ï¼Œç”¨æ¥åŠ¨æ€ç›‘æ§ç£ç›˜çš„æ´»åŠ¨ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ iostat -d -x -k 1 10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å«ä¹‰:</strong></p><ul><li><code>-d -x -k 1 10</code> æ˜¾ç¤ºç£ç›˜ï¼Œæ˜¾ç¤ºè¯¦æƒ…ï¼Œä»¥KBä¸ºå•ä½ã€‚1ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œåˆ·æ–°10æ¬¡åé€€å‡ºã€‚</li></ul><p>ç¡®å®šäº†ä¸»è¦å ç”¨èµ„æºçš„è¿›ç¨‹åï¼Œé’ˆå¯¹ä¸åŒçš„è¿›ç¨‹æœåŠ¡ç±»å‹ï¼Œä½¿ç”¨ä¸åŒçš„åˆ†æå·¥å…·ã€‚<br>ä¸‹é¢ä¸»è¦åˆ—ä¸¾äº†Java JVMæ€§èƒ½è¯Šæ–­ã€‚</p><h2 id="2-JVM-å†…å­˜åˆ©ç”¨ç‡é«˜">2. JVM å†…å­˜åˆ©ç”¨ç‡é«˜</h2><h3 id="2-1-JVM-Memoryåˆ†é…ç°çŠ¶">2.1 JVM Memoryåˆ†é…ç°çŠ¶</h3><p>JDKè‡ªå¸¦çš„ä¸¤ä¸ªå·¥å…·çš„ç”¨æ³•ï¼š</p><ul><li><p><code>$ jmap -heap &lt;pid&gt;</code></p></li><li><p><code>$ jstat -gccapacity &lt;pid&gt;</code><br><code>$ jstat -gc &lt;pid&gt;</code></p></li></ul><h3 id="2-2-å†…å­˜æ³„éœ²">2.2 å†…å­˜æ³„éœ²</h3><p>åœ¨ä¸å­˜åœ¨å†…å­˜åˆ†é…é—®é¢˜çš„å‰æä¸‹ï¼Œå†…å­˜æŒç»­åé«˜æ—¶ï¼Œé¦–å…ˆéœ€è¦æ’é™¤æ˜¯å¦æ˜¯å†…å­˜æ³„éœ²ã€‚</p><p>å¦‚ä½•ç¡®è®¤æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²ï¼š</p><ul><li>æŸ¥çœ‹HeapDumpOnOutOfMemoryError</li><li>æŸ¥çœ‹GCçŠ¶æ€</li><li>å¤šæ¬¡ä¸»åŠ¨ç”Ÿæˆdump</li><li>åˆ†æå·¥å…· MAT / VisuaVM / JProfiler</li></ul><h4 id="2-2-1-HeapDumpOnOutOfMemoryErrorï¼ˆå†…å­˜æº¢å‡ºï¼‰">2.2.1 HeapDumpOnOutOfMemoryErrorï¼ˆå†…å­˜æº¢å‡ºï¼‰</h4><p>å½“ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç”³è¯·å¯¹è±¡å†…å­˜è¶…å‡ºå‰©ä½™å¯ç”¨å†…å­˜æ—¶ï¼Œåˆ™ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚<br>å­˜åœ¨å†…å­˜æº¢å‡ºæ—¶ï¼ŒåŸå› ä¸Šæœ‰ä¸€å®šå¯èƒ½ â€”â€” ç¨‹åºä¸­å­˜åœ¨å†…å­˜æ³„éœ²ï¼Œå¯¹è±¡è¢«é”™è¯¯å¼•ç”¨è€Œé€ æˆå§‹ç»ˆæ— æ³•é‡Šæ”¾ã€å æ®å†…å­˜ã€‚</p><p>ä¸€èˆ¬åœ¨ç”Ÿäº§ç¯å¢ƒçš„ <code>JVM Options</code> çš„é…ç½®ä¸­ï¼Œéƒ½ä¼šå¸¦æœ‰å‡ ä¸ªå¦‚ä¸‹é…ç½®ã€‚ï¼ˆå¦‚æœæ²¡æœ‰ï¼ŒåŠ¡å¿…æ·»åŠ ï¼‰</p>  <pre class="line-numbers language-none"><code class="language-none">-XX:+HeapDumpOnOutOfMemoryError-XX:HeapDumpPath=/heapdump/out_of_memory_error/logs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>å«ä¹‰</strong>ï¼š</p><ul><li>åœ¨è¿è¡Œæ—¶å‘ç”Ÿ <code>OutOfMemoryError</code> æ—¶ï¼Œä¼šè¾“å‡ºheapdumpæ–‡ä»¶ï¼Œæ–‡ä»¶åœ°å€ä½äº <code>/heapdump/out_of_memory_error/logs</code> æ­¤è·¯å¾„ä¸‹ã€‚</li></ul><p>å­˜åœ¨å†…å­˜æº¢å‡ºæ—¶ï¼Œæ ¹å› ä¸ä¸€å®šæ˜¯å­˜åœ¨å†…å­˜æ³„éœ²ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯èµ„æºå‹åŠ›é­é‡ç“¶é¢ˆã€‚<br>ç¨‹åºåœ¨æŠ›å‡º OutOfMemryError æ—¶ï¼Œmessageä¸­ä¼šæ³¨æ˜åŸå› ï¼Œæ¯”å¦‚<code>Java heap space</code> ç­‰ã€‚<br>é€šä¿—æ¥è®²ï¼ŒJVMä¼šæŠ›å‡º OutOfMemryError çš„å†…å­˜åŒºï¼Œä¸åªæ˜¯å †ï¼Œä¸€å…±åŒ…å«å †ã€éå †ï¼ˆMetaspaceï¼‰ã€å †å¤–ï¼ˆç›´æ¥å†…å­˜ï¼‰ã€æ ˆå››ä¸ªéƒ¨åˆ†ã€‚</p><p><strong>å…³é”®æ¦‚å¿µ</strong>:<br>JVMå†…å­˜ç»“æ„åˆ’åˆ†ï¼š<br><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-mem.png" alt="JVM å†…å­˜åˆ’åˆ†"></p><p>å®é™…ä¸Šï¼Œé™¤å»ä¸Šé¢6å—ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ã€‚ä½†ç¨‹åºè®¡æ•°å™¨å ç”¨å†…å­˜è¾ƒå°‘ï¼Œå¹¶ä¸”ä¸ä¼šæŠ›å‡ºOutOfMemoryErrorï¼Œè¿™é‡Œå¿½ç•¥ã€‚<br>å½“æŠ›å‡ºOutOfMemoryErroræ—¶ï¼Œä»ç¨‹åºæ—¥å¿—ä¸­è·å–errorMessageï¼Œä»è€Œå¯ä»¥å¿«é€Ÿå®šä½æ˜¯å“ªå—å†…å­˜åŒºåŸŸå‡ºç°äº†é—®é¢˜ã€‚<br>åœ¨ä¸å­˜åœ¨å†…å­˜æº¢å‡ºçš„æƒ…å†µä¸‹ï¼Œå†…å­˜é•¿æœŸå±…é«˜ä¸ä¸‹ï¼Œè¿™æ—¶å¯ä»¥æ ¹æ®ä¸åŒå†…å­˜åŒºåŸŸçš„å†…å­˜ä½¿ç”¨ç‡å’Œå›æ”¶ç‡è¿›è¡Œé¢„åˆ¤ã€‚<br>å¦‚ï¼š</p><ul><li>å›¾ä¸€ï¼Œå †å†…å­˜çš„åˆ©ç”¨é‡é«˜ï¼Œé€ æˆCPUé¢‘ç¹GCã€‚</li><li>å›¾äºŒï¼ŒMetaspace å’Œ å †å¯¹å†…å­˜åˆ©ç”¨é‡æ­£å¸¸ï¼ŒåŒæ—¶CPUå¹¶æ— é¢‘ç¹GCã€‚JVM æ€»å†…å­˜åˆ©ç”¨é‡ä¾ç„¶å¾ˆé«˜ï¼Œè¿™æ—¶éœ€åˆ†ææ ˆå†…å­˜çš„å ç”¨æƒ…å†µã€‚</li><li>å›¾ä¸‰ï¼ŒJVM æ€»å†…å­˜åˆ©ç”¨é‡æ­£å¸¸ï¼ŒCPUæ— é¢‘ç¹GCã€‚åœ¨æ’é™¤äº†éJVMä¹‹å¤–çš„ç¨‹åºå ç”¨å¤–ï¼Œéœ€åˆ†æç›´æ¥å†…å­˜çš„å ç”¨æƒ…å†µã€‚</li></ul><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-mem-gc.png" alt="JVM GCè¶‹åŠ¿å›¾"></p><h4 id="2-2-2-æŸ¥çœ‹GCçŠ¶æ€">2.2.2 æŸ¥çœ‹GCçŠ¶æ€</h4><p>æŸ¥çœ‹GCçŠ¶æ€ï¼Œå¯ä»¥åœ¨æ²¡æœ‰OutOfMemoryErroræ¥æºçš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿå®šä½<code>å †</code>å’Œ <code>MetaSpace</code> çš„å†…å­˜ä½¿ç”¨é‡ã€å›æ”¶æ•ˆæœã€å¹³å‡å¸¸é©»å®¹é‡ç­‰ç­‰ï¼Œä»¥æ­¤æ¥æ¨æ–­å†…å­˜å¯¹è±¡åœ¨æ–°ç”Ÿä»£ã€è€ç”Ÿä»£å’Œ MetaSpace çš„ç”¨é‡å’Œç“¶é¢ˆã€‚<br>ä¸€èˆ¬åœ¨ç”Ÿäº§ç¯å¢ƒçš„<code>JVM Options</code> çš„é…ç½®ä¸­ï¼Œä¼šå¸¦æœ‰å¦‚ä¸‹å‡ ä¸ªGCé…ç½®ã€‚</p>  <pre class="line-numbers language-none"><code class="language-none">-XX:+UseGCLogFileRotation-XX:NumberOfGCLogFiles=10-XX:GCLogFileSize=100M-Xloggc:/heapdump/gc/logs/gc.log-XX:+PrintGCDetails-XX:+PrintGCDateStamps<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å‰ä¸‰è¡Œï¼šGCæ—¥å¿—æ¯ä¸ªæ–‡ä»¶å¤§å°ï¼š100Mï¼Œæœ€å¤šä¿ç•™10ä¸ªæ–‡ä»¶ï¼Œè¶…å‡ºåˆ™ä½¿ç”¨æ›¿æ¢è¦†ç›–çš„ç­–ç•¥ã€‚</li><li><code>-Xloggc:/heapdump/gc/logs/gc.log</code> ï¼ŒGCæ—¥å¿—è·¯å¾„åœ¨<code>/heapdump/gc/logs/</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–‡ä»¶åä»¥<code>gc.log</code>ä¸ºå‰ç¼€ã€‚</li><li>åä¸¤è¡Œï¼šæ‰“å°GCæ—¶çš„è¯¦æƒ…ï¼Œæ‰“å°GCæ—¥å¿—çš„æ—¶é—´æˆ³ã€‚</li></ul><p>æœ‰äº†è¿™äº›é…ç½®ä¹‹åï¼ŒJVMåœ¨å¯åŠ¨ä¹‹åï¼Œä¼šè¾“å‡ºGCæ—¥å¿—ã€‚</p><blockquote><p>2020-12-04T17:13:17.280-0800: 22845.509: [GC (Allocation Failure) [PSYoungGen: 581178K-&gt;16640K(611840K)] 925472K-&gt;909807K(1511936K), 0.5084573 secs] [Times: user=0.36 sys=0.57, real=0.50 secs]</p><p>2020-12-04T17:13:17.789-0800: 22846.017: [Full GC (Ergonomics) [PSYoungGen: 16640K-&gt;16388K(611840K)] [ParOldGen: 893167K-&gt;892384K(1358336K)] 909807K-&gt;908773K(1970176K), [Metaspace: 44412K-&gt;44412K(1091584K)], 0.5756780 secs] [Times: user=2.70 sys=0.19, real=0.58 secs]</p></blockquote><p>å…¶ä¸­æœ€éœ€æ³¨æ„çš„æ˜¯ï¼ŒGCç±»å‹-åŸå› ã€ä¸€æ¬¡GCåå†…å­˜å›æ”¶çš„æ•ˆæœã€GCæ—¶é•¿ã€‚</p><ul><li><p><code>GC (Allocation Failure)</code>ï¼šGCç±»å‹ - Young GCï¼ŒåŸå›  - å†…å­˜åˆ†é…å¤±è´¥ã€‚</p></li><li><p><code>PSYoungGen: 581178K-&gt;16640K(611840K)</code>ï¼šæ–°ç”Ÿä»£ä» 581178K é™åˆ° 16640Kï¼Œå½“å‰æ–°ç”Ÿä»£æ€»å¤§å° 611840Kã€‚</p></li><li><p><code>925472K-&gt;909807K(1511936K)</code>: å †ä» 925472K é™åˆ° 909807Kï¼Œå½“å‰å †æ€»å¤§å° 1511936Kã€‚</p></li><li><p>æ­¤æ¬¡GCæ‰§è¡Œæ—¶é•¿0.5084573ç§’ã€‚æ­¤æ—¶é—´æ˜¯ç‰©ç†æ„ŸçŸ¥çš„ç»å¯¹æ—¶é—´ï¼Œä¸åé¢çš„realç›¸åŒã€‚</p></li><li><p><code>Full GC (Ergonomics)</code> GCç±»å‹ - Full GCï¼ŒåŸå›  - å†…å­˜è°ƒæ•´ï¼Œå…·ä½“ç”±åƒåœ¾å›æ”¶å™¨ç±»å‹å†³å®šã€‚</p></li><li><p><code>ParOldGen: 893167K-&gt;892384K(1358336K)</code>: è€ç”Ÿä»£ä» 893167K é™åˆ° 892384Kï¼Œ å½“å‰è€ç”Ÿä»£æ€»å¤§å° 1358336Kã€‚</p></li><li><p><code>909807K-&gt;908773K(1970176K)</code>: å †ä» 909807K é™åˆ° 908773Kï¼Œå½“å‰å †æ€»å¤§å° 1970176Kã€‚</p></li><li><p><code>Metaspace: 44412K-&gt;44412K(1091584K)</code>: metaspace ä» 44412K æ— ä¸‹é™ï¼Œå½“å‰ metaspace æ€»å¤§å° 1091584Kã€‚</p></li></ul><p>å…³é”®æ¦‚å¿µï¼š</p><ul><li><p>åƒåœ¾å›æ”¶å™¨ç±»å‹ã€‚<br>-XX:UseParallelGC æ˜¯JDK9ä¹‹å‰serveræ¨¡å¼ä¸‹çš„é»˜è®¤å›æ”¶å™¨ï¼Œä½¿ç”¨çš„æ˜¯Parallel Scavenge +  ParOld çš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚<br>å³æ–°ç”Ÿä»£æ˜¯GCå¤šçº¿ç¨‹ã€æ ‡è®°-æ•´ç†çš„GCç®—æ³•ï¼Œè€ç”Ÿä»£æ˜¯GCå¤šçº¿ç¨‹ã€æ ‡è®°-æ•´ç†çš„GCç®—æ³•ã€‚<br>æ­¤æ¬¾åƒåœ¾å›æ”¶å™¨ï¼Œæ˜¯ä»¥ååé‡ä¸ºç›®çš„ï¼Œå³åœ¨æ‰§è¡Œåƒåœ¾å›æ”¶å·¥ä½œçš„åŒæ—¶ï¼Œå°½é‡è®©åº”ç”¨ç³»ç»Ÿè¢«é˜»å¡æ›´çŸ­çš„æ—¶é—´ã€‚<br><code>ååé‡ = ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ï¼‰/ (è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ + è¿è¡Œåƒåœ¾å›æ”¶çš„æ—¶é—´)</code><br>åŒæ—¶ï¼Œåœ¨CMS/G1ä¹‹å‰çš„é€šç”¨åƒåœ¾å›æ”¶å™¨ï¼Œéƒ½æœ‰JVMç”³è¯·å†…å­˜ä¹‹åä¸ä¼šå½’è¿˜ç»™ç³»ç»Ÿçš„é—®é¢˜ã€‚åœ¨CMSå¾—åˆ°ç¼“è§£ï¼ŒG1å·²ç»å¯ä»¥åšåˆ°åŠæ—¶å½’è¿˜ã€‚</p></li><li><p>MinorGCï¼ˆYoungGCï¼‰\ MajorGC(Full GC)ã€‚<br>Full GC å®é™…ä¸Šå¯ä»¥å¯¹å †ï¼ˆæ–°ç”Ÿä»£+è€ç”Ÿä»£ï¼‰ã€metaspaceã€ç›´æ¥å†…å­˜éƒ½äº§ç”Ÿåƒåœ¾å›æ”¶æ•ˆæœã€‚ç‰¹åˆ«æ˜¯ç›´æ¥å†…å­˜ï¼Œè™½ç„¶ç›´æ¥å†…å­˜ä½¿ç”¨çš„æ˜¯JVMå¤–éƒ¨çš„å†…å­˜ç©ºé—´ï¼Œä½†å¯¹è±¡å¥æŸ„å¼•ç”¨æœ€ç»ˆæ˜¯æ”¾åœ¨JVMå †ä¸­ï¼Œå› æ­¤åœ¨full GCé‡Šæ”¾æ‰å †å†…çš„å¯¹è±¡å¼•ç”¨æ—¶ï¼Œä¹Ÿå¯ä»¥é€ æˆç›´æ¥å†…å­˜é‡Šæ”¾çš„æ•ˆæœã€‚</p></li></ul><p>æŸ¥çœ‹GCçŠ¶æ€ä¹Ÿä¸æ˜¯ä»…çœ‹æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§å€¼å°±å¯å¾—å‡ºé—®é¢˜ç»“è®ºï¼Œä¹Ÿéœ€è¦æ²¿ç€æ—¶é—´è½´è§‚å¯Ÿä¸€æ®µæ—¶é—´ä¸‹çš„GCæ•ˆæœã€‚<br>æ¯”å¦‚ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬äºŒæ¬¡Full GCå‡ ä¹æ²¡æœ‰ä»€ä¹ˆå›æ”¶æ•ˆæœï¼ŒèƒŒåå¯èƒ½æ˜¯å¤§é‡è€—è´¹å†…å­˜çš„è¯·æ±‚å‹åŠ›é€ æˆçš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦åœ¨å‹åŠ›å³°å€¼é™ä¸‹æ¥å†æ¬¡è§‚å¯Ÿã€‚</p><p>è¿™æ—¶å€™ï¼Œå¦‚æœæœ‰çº¿ä¸ŠGCçš„çŠ¶æ€ç›‘è§†å·¥å…·ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹æ­¤æ®µäº‹ä»¶çš„GCæ•°æ®ã€‚å¦‚æœæ²¡æœ‰ç›‘è§†å·¥å…· æˆ–è€… GCåˆ†ææ•°æ®ä¸å…¨ï¼Œå¯ä»¥å°†GC logså¯¼å…¥åˆ°æœ¬åœ°çš„ç¦»çº¿åˆ†æå·¥å…·ï¼Œæ¯”å¦‚<a href="https://github.com/chewiebug/GCViewer">GCViewer</a>ã€‚</p><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-gc-viewer.png" alt="gc viewer"></p><p>è¿˜æœ‰ä¸€äº›å·¥å…·æä¾›å®æ—¶ç›‘æ§heapçŠ¶æ€ï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ jstat -gcutil &lt;pid&gt; 1000 100<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å«ä¹‰ï¼š</strong><br>å®æ—¶ç›‘æ§JVM å †ä½¿ç”¨å¤§å°ã€GCçš„æ¬¡æ•°å’Œæ—¶é—´ã€‚æ¯1000æ¯«ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œä¸€å…±åˆ·æ–°100æ¬¡ã€‚</p><p>é€šè¿‡æŸ¥çœ‹GCçŠ¶æ€è·çŸ¥å†…å­˜è¢«å¤§é‡åˆ†é…çš„æ˜¯å“ªå‡ ä¸ªåŒºåŸŸï¼Œå„åŒºåŸŸçš„å¢é•¿é€Ÿç‡ã€gcè§¦å‘çš„é¢‘ç‡å’Œè€—æ—¶ã€‚</p><h4 id="2-2-3-æ‰‹åŠ¨ç”Ÿæˆ-heapdump-æ–‡ä»¶">2.2.3 æ‰‹åŠ¨ç”Ÿæˆ heapdump æ–‡ä»¶</h4><p>å½“æ—  <code>OutOfMemoryError</code> äº§ç”Ÿï¼Œä½†å†…å­˜åˆ©ç”¨ç‡å¼‚å¸¸æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>jcmd</code> æ‰‹åŠ¨ç”Ÿæˆ / è·å–heap dumpæ–‡ä»¶ã€‚</p><p><code>heapdump</code> æ–‡ä»¶æ˜¯å½“å‰JVMå®¹å™¨çš„å†…å­˜åˆ†æå¿«ç…§ï¼Œä¸€èˆ¬å°è¯•åˆ†æå†…å­˜é—®é¢˜æ—¶ï¼Œéœ€è¦åœ¨ä¸åŒç»´åº¦å¤šæ¬¡ç”Ÿæˆ heapdump æ–‡ä»¶ï¼Œç”¨ä»¥æ¨ªå‘å¯¹æ¯”ï¼ˆä¸åŒJVMä¹‹é—´ï¼‰æˆ–è€… çºµå‘å¯¹æ¯”ï¼ˆåŒä¸€JVMä¸åŒæ—¶é—´é˜¶æ®µä¹‹é—´ï¼‰ã€‚</p>  <pre class="line-numbers language-none"><code class="language-none">$ jcmd -l$ jcmd &lt;pid&gt; GC.heap_dump /tmp/java_pid&lt;pid&gt;.hprof <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>å«ä¹‰</strong>ï¼š</p><ul><li><code>jcmd -l</code> å±•ç¤ºæ‰€æœ‰ JVM è¿›ç¨‹ï¼Œé€šè¿‡è¯¥å‘½ä»¤è·å–applicationçš„è¿›ç¨‹idã€‚</li><li>æ ¹æ®pidï¼Œä½¿ç”¨å‘½ä»¤ <code>jcmd GC.heap_dump</code> ç”Ÿæˆheap dumpåˆ°ç›®æ ‡æ–‡ä»¶è·¯å¾„ã€‚<br>è¯¥å‘½ä»¤é»˜è®¤ç”Ÿæˆ <code>live objects</code> çš„æ•°æ®ï¼Œå› æ­¤åœ¨ç”Ÿæˆdumpæ–‡ä»¶å‰ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡full GCã€‚å¦‚æœä¸æƒ³å¼ºåˆ¶æ‰§è¡Œfull GCï¼Œåˆ™å¯ä»¥å¸¦ä¸Šoptions <code>-all</code>, è¿™æ—¶ä¼šç”Ÿæˆæ‰€æœ‰ <code>objects</code> çš„æ•°æ®ã€‚</li></ul><h4 id="2-2-4-åˆ†æHeap-dumpæ–‡ä»¶">2.2.4 åˆ†æHeap dumpæ–‡ä»¶</h4><p>åˆ†æheapdumpæ–‡ä»¶çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†è·å–æœ€æœ‰å«Œç–‘çš„å ç”¨å†…å­˜çš„å¤§å¯¹è±¡ æˆ– å¤šæ•°å¯¹è±¡ä»¥åŠä¸Šä¸‹æ–‡ã€‚</p><p>å¸¸ç”¨çš„å¼€æºå…è´¹å·¥å…·æœ‰ MATã€VisualVMã€JProfilerã€‚</p><ul><li><p>MATï¼ˆMemory Analyzer Toolï¼‰ï¼Œå‡ºè‡ªeclipseï¼Œå¯ä»¥å•ç‹¬å®‰è£…ä½¿ç”¨ï¼›</p></li><li><p>VisualVMï¼Œéƒ¨åˆ†JDKè‡ªå¸¦ã€‚ä¸å¸¦çš„ç‰ˆæœ¬ï¼Œéœ€è¦å¦è¡Œä¸‹è½½å®‰è£…ï¼›</p></li><li><p>JProfilerï¼Œå·²ç»ä¸Intellij IDEAé›†æˆï¼Œå¯ä»¥ç›´æ¥åœ¨Intellij IDEAä¸Šä½¿ç”¨ï¼›</p></li></ul><p>å¯¹äºç¦»çº¿åˆ†æï¼ŒMATä¼˜åŠ¿æ¯”è¾ƒå¤§ï¼Œä¼˜å…ˆæ¨èã€‚MATæä¾›æ›´è¯¦ç»†å’Œç›´è§‚çš„ Leak Suspect report å’Œ Top Components reportï¼Œåœ¨å·¥å…·å°ä¸­è¿˜å¯ä»¥äº¤äº’è¿›è¡Œæ›´ç»†èŠ‚çš„å®šä½ã€‚</p><p><strong>Lead Suspect report</strong> ä¸­ä¸»è¦å…³æ³¨å‡ ä¸ªéƒ¨åˆ†ï¼š</p><p><strong>1. Leak Suspect reportçš„å…¨å±€å›¾</strong></p><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-MAT-leaksuspect-1.png" alt="MAT leaksuspect report"></p><p><strong>å›¾ä¸­å«ä¹‰</strong>:</p><p>åœ¨tomcatçº¿ç¨‹è¿è¡Œæ—¶ï¼Œæœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹ <code>Object[]</code> æ‹¿ä½äº†456Må†…å­˜ï¼Œå ç”¨å †å†…å­˜çš„97.41%ã€‚è¯¥å®ä¾‹ä¸ä¸€å®šæ˜¯å†…å­˜æ³„éœ²ï¼Œä½†ä½œä¸ºæ¶ˆè€—å†…å­˜çš„å¤§å¯¹è±¡ï¼Œä¾ç„¶å€¼å¾—æ’æŸ¥ã€‚</p><p>ç‚¹å‡»æœ€ä¸‹é¢çš„é“¾æ¥ <code>Details &gt;&gt;</code> å¯ä»¥æŸ¥çœ‹åˆ†æè¯¦æƒ…ï¼š</p><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-MAT-leak-suspect-2.png" alt="MAT leaksuspect report details"></p><p><code>Details &gt;&gt;</code> ä¸€èˆ¬åˆ†ä¸ºå‡ é¡¹ï¼š</p><ul><li><p>Shortest Paths To the Accumulation Pointï¼šä»GC roots åˆ°è¾¾ <code>ç´¯ç§¯ç‚¹</code> çš„æœ€çŸ­è·¯å¾„ï¼›</p></li><li><p>Accumulated Objects in Dominator Treeï¼šæ˜¾ç¤ºç´¯ç§¯å¯¹è±¡çš„ <code>Dominator Tree</code> (ç»Ÿæ²»è€…æ ‘)ï¼›</p></li><li><p>Accumulated Objects by Class in Dominator Treeï¼šæ˜¾ç¤ºç´¯ç§¯ç±»çš„ <code>Dominator Tree</code>ï¼ˆç»Ÿæ²»è€…æ ‘ï¼‰ï¼›</p></li><li><p>All Accumulated Objects by Classï¼šæ˜¾ç¤ºç´¯ç§¯ç±»å¯¹åº”çš„å®ä¾‹æ•°é‡å’Œä¸€å…±å ç”¨çš„Shallow Heapã€‚</p></li></ul><p><strong>å…³é”®æ¦‚å¿µï¼š</strong></p><ul><li><p>Shortest paths<br>åœ¨Javaå›æ”¶æœºåˆ¶ä¸­ï¼Œä½¿ç”¨çš„æ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•ã€‚å¯¹è±¡æ˜¯å¦è¦è¢«GCï¼Œéœ€è¦è¿ç®—ä»GC rootså¯¹è±¡å¼€å§‹ï¼Œæœç´¢å¼•ç”¨é“¾ï¼Œä»¥æ­¤è¯æ˜è¯¥å¯¹è±¡ä¸å¯è¾¾ã€‚ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¼šè¢«åƒåœ¾å›æ”¶ï¼Œå¦‚æœè¯¥å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œåˆ™å­˜åœ¨å†…å­˜æ³„éœ²ã€‚</p></li><li><p>Dominator Tree<br>å½“å¯¹è±¡<code>Object B</code> è¢« <code>Object A</code> å¼•ç”¨è€Œé€ æˆæ— æ³•é‡Šæ”¾çš„æƒ…å†µï¼Œè¿™æ—¶å€™<code>Object A</code> å°±æ˜¯ <code>Object B</code> çš„ç»Ÿæ²»è€…ã€‚</p></li><li><p>Shallow Heap &amp; Retained Heap<br>å¯¹è±¡è‡ªèº«å ç”¨çš„å†…å­˜å¤§å°ï¼Œå³æ˜¯Shallow Heapã€‚<br>å¦‚æœï¼šå¯¹è±¡<code>Object B</code> è¢« <code>Object A</code> å¼•ç”¨è€Œé€ æˆæ— æ³•é‡Šæ”¾çš„æƒ…å†µï¼ˆObject B ä¸å†å¼•ç”¨å…¶ä»–å¯¹è±¡ï¼‰ï¼Œè¿™æ—¶å€™<br><code>Object A Retained Heap = Object A Shallow Heap + Object B Shallow Heap</code></p></li></ul><p>å½“è·å–äº†Leak Suspectå¯¹è±¡ä»¥åŠç±»å‹, ä»¥åŠä¸Šé¢çš„ <code>Details</code> é¡¹ï¼Œåœ¨å¯¹è¿™äº›ç±»å‹èƒŒåçš„ä»£ç è·å¾—äº†è§£çš„æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°æ˜¯å“ªéƒ¨åˆ†ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†åå·® â€”â€” æ³¨æ„ï¼Œä»…æ˜¯æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°åå·®ï¼Œä¸ä¸€å®šæ˜¯é—®é¢˜çš„æ ¹å› ã€‚<br>åœ¨JVMä¸­æ‰€æœ‰çº¿ç¨‹å’Œä»»åŠ¡å¯¹äºCPUã€å†…å­˜ã€ç£ç›˜çš„èµ„æºå ç”¨éƒ½æ˜¯å…±äº«çš„ï¼Œå› æ­¤é—®é¢˜çš„æ ¹å› éœ€è¦å†æ¬¡æ¨å¯¼ã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿæœ‰æ¯”è¾ƒç®€å•çš„åœºæ™¯ï¼Œå¯ä»¥åªæŒ‡æ ¹å› çš„ã€‚</p><p><strong>2. Top Customers</strong></p><p>åœ¨MAT  <code>Leak Suspect report</code> ä¸­é™¤äº†å¯ä»¥æŸ¥çœ‹Lead suspect objectsï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>Top Customers</code> ç›®å½•æŸ¥çœ‹æ›´å¤šçš„å†…å­˜æ¶ˆè´¹è€…æ’è¡Œã€‚</p><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-MAT-top-customers.png" alt="Top Customers 1"></p><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-MAT-top-consumers-2.png" alt="Top Customers 2"></p><p><strong>3. è¾…åŠ©æŸ¥çœ‹éƒ¨åˆ†Class Histogramå’ŒThread Overview</strong></p><p><code>class Histogram</code> ç±»ç›´æ–¹å›¾ï¼ŒæŒ‰Retained Heapæ’åºï¼Œä½“ç°JVM classç”Ÿæˆäº†å¤šå°‘å®ä¾‹ï¼Œå¹¶ä¸”å æ®äº†å¤šå°‘å†…å­˜ã€‚</p><p>ç”±äºå±•ç¤ºå›¾çš„é¡¶å±‚å¤§éƒ¨åˆ†æ˜¯Javaå†…éƒ¨ç±»å‹ï¼Œç¼ºå°‘å¿…è¦çš„è¯Šæ–­ä¸Šä¸‹æ–‡ï¼Œå› æ­¤æŒ‰å†…å­˜å ç”¨å¤§å°æŒ¨ä¸ªæŸ¥çœ‹ã€‚<br>åœ¨æœ‰å…·ä½“çš„èšç„¦å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½œä¸ºè¾…åŠ©å·¥å…·æŸ¥çœ‹ã€‚</p><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-MAT-class-histo.png" alt="ç±»ç›´æ–¹å›¾"></p><p>æ¯”å¦‚ï¼Œä¸Šå›¾ä¸­shallow Heapå ç”¨ç‰¹åˆ«å¤§çš„<code>int[]</code>ï¼Œåœ¨MATå·¥å…·ä¸­ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»<code>list objects-&gt; with incoming reference</code>ï¼Œæ˜¾ç¤ºå…¶å®é™…è¢«å“ªé‡Œå¼•ç”¨ï¼Œä»è€ŒæŸ¥æ‰¾åˆ° hold ä½è¿™å—äº›å†…å­˜çš„ç¨‹åºä½ç½®ã€‚<br>ä¸‹å›¾æ˜¯æœ€ç®€å•çš„API controller holdä½å†…å­˜ï¼Œå› æ­¤å®¹æ˜“æŸ¥æ‰¾å’Œå®šä½ã€‚è€Œå¦‚æœæ˜¯è·¨APIçš„æ¡†æ¶å’ŒåŸºç¡€è®¾æ–½ä»£ç ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥çš„åˆ†æå’Œå®šä½ã€‚</p><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-list-incoming-objects.png" alt="list-incoming-objects"></p><p><code>Thread overview</code> çº¿ç¨‹æ€»è§ˆï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çº¿ç¨‹çš„çŠ¶æ€ã€‚<br>ç”±äºå†…å­˜å¯¹è±¡çš„GC rootså¹¶ä¸ä¸€å®šæ˜¯çº¿ç¨‹ï¼Œæ‰€ä»¥æ­¤å›¾ä»…å¯¹å‘ç°<code>Dominator</code>æ˜¯çº¿ç¨‹çš„å¯¹è±¡å†…å­˜æœ‰æ•ˆï¼Œä¸€èˆ¬ä½œä¸ºè¾…åŠ©æŸ¥çœ‹ã€‚<br><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-MAT-thread-overview.png" alt="list-thread"></p><h2 id="3-JVM-CPU-åˆ©ç”¨ç‡é«˜">3. JVM CPU åˆ©ç”¨ç‡é«˜</h2><h3 id="3-1-é¦–å…ˆæŸ¥çœ‹JVMä¸­æ˜¯å“ªäº›çº¿ç¨‹å¯¹CPUçš„å ç”¨ç‡é«˜">3.1 é¦–å…ˆæŸ¥çœ‹JVMä¸­æ˜¯å“ªäº›çº¿ç¨‹å¯¹CPUçš„å ç”¨ç‡é«˜</h3><p>ä½¿ç”¨Topå‘½ä»¤è¡Œï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ top -Hp &lt;pid&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹CPUå ç”¨é«˜çš„çº¿ç¨‹IDï¼Œè®°å½•ä¸‹è¿™äº›çº¿ç¨‹IDã€‚</p><h3 id="3-2-ä½¿ç”¨jcmd-dump-thread">3.2 ä½¿ç”¨jcmd dump thread</h3><p>ä½¿ç”¨jcmdå‘½ä»¤è¡Œï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ jcmd $pid Thread.print &gt; ./manual.tdump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-å°†ä¹‹å‰è®°å½•çš„çº¿ç¨‹IDï¼Œè¿›è¡Œåå…­è¿›åˆ¶è½¬æ¢">3.3 å°†ä¹‹å‰è®°å½•çš„çº¿ç¨‹IDï¼Œè¿›è¡Œåå…­è¿›åˆ¶è½¬æ¢</h3><p>LinuxåŸç”Ÿå‘½ä»¤è¡Œï¼š</p><pre class="line-numbers language-none"><code class="language-none">printf "%x\n" &lt;tid&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-4-å°†Threaddumpæ–‡ä»¶å¯¼å…¥TMDAå·¥å…·">3.4 å°†Threaddumpæ–‡ä»¶å¯¼å…¥<code>TMDA</code>å·¥å…·</h3><p><a href="https://www.ibm.com/support/pages/ibm-thread-and-monitor-dump-analyzer-java-tmda">TMDA</a>å·¥å…·ï¼ŒIBMçº¿ç¨‹ç¦»çº¿åˆ†æå·¥å…·ã€‚</p><p>æ‰“å¼€ <code>Thread Details</code>, ä½¿ç”¨16è¿›åˆ¶çš„ threadID åœ¨<code>NativeID</code>ï¼ˆdumpæºæ–‡ä»¶ä¸­æ˜¯<code>nid</code>ï¼‰å¯¹åº”æŸ¥æ‰¾åˆ°çº¿ç¨‹çŠ¶æ€ã€è°ƒç”¨æ ˆã€‚</p><p><img src="/2021/01/18/docker-jvm-tong-yong-gong-ju-zhen-duan-zhi-nan/image-tmda-stack.png" alt="tmda-stack"></p><p>é€šè¿‡åˆ†æè°ƒç”¨æ ˆï¼Œè·å–ç›¸å…³çº¿ç¨‹æ‰§è¡Œçš„ç¨‹åºä½ç½®ã€‚<br>å½“å¯ç–‘çº¿ç¨‹æ˜¯GCçº¿ç¨‹æ—¶ï¼Œç»“åˆå†…å­˜åˆ†æå·¥å…·ä¸€èµ·è¯Šæ–­ã€‚</p><p>å¦‚æœå•æ¬¡ threaddump åˆ†æç»“æœæ— å¯ç–‘ï¼Œå¯ä»¥é€šè¿‡å¤šæ¬¡ç”Ÿæˆ threaddump æ–‡ä»¶è¿›è¡Œæ—¶é—´ä¸Šçºµå‘å¯¹æ¯”ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡çº¿ä¸Šæ²»ç†ä¹‹ç›‘æ§</title>
      <link href="/2021/01/18/wei-fu-wu-xian-shang-zhi-li-zhi-jian-kong/"/>
      <url>/2021/01/18/wei-fu-wu-xian-shang-zhi-li-zhi-jian-kong/</url>
      
        <content type="html"><![CDATA[<p>å¾®æœåŠ¡æ¶æ„å·²ç»æ˜¯æ—¶ä¸‹åç«¯åº”ç”¨å¼€å‘çš„ä¸»æµæ¶æ„ä¹‹ä¸€ã€‚å¾®æœåŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬<code>å¾®æœåŠ¡æ‹†åˆ†å’Œå®šä¹‰ï¼ˆäº§å“è§„åˆ’ï¼‰</code>ã€<code>å¾®æœåŠ¡ç ”å‘</code>ã€<code>å¾®æœåŠ¡æ„å»ºä¸éƒ¨ç½²</code>ã€<code>ç›‘æ§ä¸è¿ç»´</code>å‡ ä¸ªé˜¶æ®µã€‚</p><p>å¯¹äºä¸€èˆ¬ä¼ä¸šçš„å¾®æœåŠ¡æ”¹é€ è€Œè¨€ï¼Œæå°‘éƒ¨åˆ†ä¼ä¸šè®¤ä¸ºç”¨ä¸Šå¾®æœåŠ¡æ¦‚å¿µ + Spring cloudå¥—ä»¶å°±æ˜¯æ•´æ´»å¾®æœåŠ¡æ¶æ„äº†ï¼›ä¸€éƒ¨åˆ†ä¼ä¸šè¿˜èƒ½è®¤è¯†åˆ°é’ˆå¯¹å¾®æœåŠ¡æ„å»ºå’Œéƒ¨ç½²æ‰€å¿…éœ€çš„DevOpsæµæ°´çº¿æˆ–å¹³å°ï¼›æ¥ç€ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå¼€å§‹æ¥å—æ”¯æŒå¾®æœåŠ¡æ‹†åˆ†å’Œè®¾è®¡æ€æƒ³çš„<code>Domain Driven Design</code>ï¼›åœ¨å®Œæˆå‰ä¸‰æ­¥çš„åŸºç¡€ä¸Šï¼Œæœ€ç»ˆè¿˜æœ‰å°‘éƒ¨åˆ†ä¼ä¸šæ„è¯†åˆ°çº¿ä¸Šåˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥çš„å¤æ‚æ€§ï¼Œéœ€è¦è¿›è¡Œå¾®æœåŠ¡çº¿ä¸Šæ²»ç†â€”â€”åˆ†å±‚æ¬¡çš„ç›‘æ§ã€è¯Šæ–­åŠæœ€ç»ˆçš„æ²»ç†æ–¹æ¡ˆã€‚</p><p>è¿™é‡Œå°±ä¸»è¦ä»å¯è§‚æµ‹æ€§ã€å±‚æ¬¡æ€§ã€æ—¶æ•ˆæ€§ä¸Šï¼ŒèŠèŠå¾®æœåŠ¡çº¿ä¸Šæ²»ç†ä¸­çš„ç›‘æ§ã€‚</p><span id="more"></span><h3 id="1-ç³»ç»Ÿè¿è¡Œæ—¶çš„å¯è§‚æµ‹æ€§">1. ç³»ç»Ÿè¿è¡Œæ—¶çš„å¯è§‚æµ‹æ€§</h3><p>å¾®æœåŠ¡çº¿ä¸Šæ²»ç†çš„å‰æâ€”â€”é‡‡é›†çº¿ä¸Šè¿è¡Œæ—¶æ•°æ®ï¼Œè®©ç³»ç»ŸçŠ¶æ€ä¸æµç¨‹å¯è¢«å®æ—¶åº¦é‡å’Œç›‘æ§ã€‚</p><p>ç®¡ç†å­¦ä¹‹â½—å¾·é²å…‹æ›¾ç»è¯´è¿‡:â€œå¦‚æœä½ æ— æ³•åº¦é‡å®ƒï¼Œå°±æ— æ³•æ”¹è¿›å®ƒã€‚â€</p><p>ç„¶è€Œå¯¹äºä»Šå¤©â€”â€”åœ¨å„ç³»ç»Ÿå­˜åœ¨å„ç§äº”èŠ±å…«é—¨ã€å„å¼å„æ ·ã€å¤§é‡æŒ‡æ ‡æ•°æ®çš„å½“ä¸‹ï¼Œå¦‚ä½•æ•´åˆè¿™äº›æŒ‡æ ‡ï¼Œåœ¨åº¦é‡çš„åŒæ—¶ï¼Œæå‡æ•´ä¸ªç³»ç»Ÿè¿è¡Œæ—¶çš„å¯è§‚æµ‹æ€§ï¼Œä»¥è¾¾åˆ°åŠæ—¶åœ°å‘ç°é—®é¢˜ã€å®šä½é—®é¢˜çš„ç›®çš„ï¼Œæ‰æ˜¯å¾®æœåŠ¡çº¿ä¸Šæ²»ç†çš„åŸºç¡€ã€‚</p><p>ç†è®ºä¸Šï¼Œé—®é¢˜è¶Šæ—©å‘ç°ã€è¶Šæ—©ä¿®å¤ï¼Œå¯ä»¥è¶ŠèŠ‚çœç ”å‘æˆæœ¬ã€‚ä¸€äº›å¾®æœåŠ¡çš„é—®é¢˜ï¼Œåœ¨è§„åˆ’ã€ç ”å‘ã€æ„å»ºç­‰é˜¶æ®µï¼Œå¯ä»¥é€šè¿‡çº¿ä¸‹å¾®æœåŠ¡æ²»ç†çš„æ–¹å¼æå‰è§£å†³æ‰ã€‚</p><p>ç„¶è€Œï¼Œå¯¹äºå¾®æœåŠ¡èƒ½åŠ›ä¸åŒã€æˆ–è€…ç†è§£ä¸åŒçš„å„ä¼ä¸šå’Œå›¢é˜Ÿæ¥è¯´ï¼Œéƒ¨åˆ†å›¢é˜Ÿéœ€è¦ç­‰åˆ°ç³»ç»Ÿè¢«éƒ¨ç½²åˆ°çº¿ä¸Šè¿è¡Œæ—¶æ‰èƒ½çœŸæ­£å‘ç°å’Œæ­£è§†é—®é¢˜ã€‚</p><p>å½“ä½ é¢ä¸´çš„å›¢é˜Ÿï¼Œä¸è¿½æ±‚clean architectureã€ä¸å†™æµ‹è¯•ã€ä¸åšæŒé‡æ„ã€æ²¡æœ‰æ€§èƒ½æµ‹è¯•å’Œè”è°ƒæµ‹è¯•ã€ç”šè‡³æ²¡æœ‰å¤ªå¤šæœ‰ç»éªŒçš„å¼€å‘ï¼Œè¿™æ—¶å€™ï¼Œçº¿ä¸Šç³»ç»Ÿç›‘æ§å°†æˆä¸ºæœ€åçš„åé¦ˆå ¡å’ã€‚</p><p>å› æ­¤ï¼Œå¸¦æœ‰è§‚æµ‹æ€§çš„çº¿ä¸Šç›‘æ§èƒ½åŠ›æ˜¯å„ä¸ªå¾®æœåŠ¡å›¢é˜Ÿå¿…ä¸å¯å°‘çš„â€œçœ‹å®¶â€å·¥å…·ä¹‹ä¸€ã€‚</p><p>ä¸šå†…èƒ½åšåˆ°çº¿ä¸Šç›‘æ§çš„å¼€æºäº§å“å’Œå•†ä¸šäº§å“ä¸ä¸€è€Œè¶³ã€‚å¤§å®¶å¯èƒ½è§è¿‡ä¸‹é¢è¿™æ ·çš„ï¼ˆç›‘æ§å¾®æœåŠ¡çŠ¶æ€ã€å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨ç­‰ï¼‰ï¼š<br><img src="/2021/01/18/wei-fu-wu-xian-shang-zhi-li-zhi-jian-kong/image-spring_boot_dashboard.png" alt="å›¾1"><br><em>ï¼ˆå›¾ 1ï¼‰</em></p><p>æˆ–è€…æ˜¯ï¼Œç›‘æ§ æœåŠ¡å¯¹èµ„æºCPUã€å†…å­˜ã€ç£ç›˜ç­‰åˆ©ç”¨ç‡è¶‹åŠ¿ï¼š</p><p><img src="/2021/01/18/wei-fu-wu-xian-shang-zhi-li-zhi-jian-kong/image-grafana_jvm_dashboard.png" alt="å›¾2"><br><em>ï¼ˆå›¾ 2ï¼‰</em></p><p>ä¹Ÿæœ‰APIè°ƒç”¨é‡ã€å¤±è´¥ç‡ã€å»¶æ—¶æ—¶é•¿çš„TopNç»Ÿè®¡ï¼š</p><p><img src="/2021/01/18/wei-fu-wu-xian-shang-zhi-li-zhi-jian-kong/image-app_api.png" alt="å›¾3"><br><em>ï¼ˆå›¾ 3ï¼‰</em></p><p>æˆ–è€…ï¼Œæ˜¯åŸºäºåŠ¨æ€é“¾è·¯æŠ€æœ¯å®ç°çš„é“¾è·¯å›¾ï¼š</p><p><img src="/2021/01/18/wei-fu-wu-xian-shang-zhi-li-zhi-jian-kong/image-dynamic_invoking_graph.png" alt="å›¾4"><br><em>ï¼ˆå›¾ 4ï¼‰</em></p><h3 id="2-ç›‘æ§éœ€è¦åˆ†å±‚æ¬¡">2. ç›‘æ§éœ€è¦åˆ†å±‚æ¬¡</h3><p>çœ‹è¿‡ä¸Šé¢å››ç§ç›‘æ§ç¤ºä¾‹å›¾ï¼Œç›¸ä¿¡æœ‰ä¸å°‘åšè¿‡çº¿ä¸Šé—®é¢˜è¯Šæ–­çš„åŒäº‹ä¼šè®¤ä¸ºï¼šä¸å°‘æŒ‡æ ‡è¿‡äºç»†ï¼Œæˆ–è€…è¿‡äºåº•å±‚ï¼Œå¯¹äºå‘ç°å®é™…é—®é¢˜å’Œå®šä½é—®é¢˜æ¯«æ— å¸®åŠ©ã€‚</p><p>å½“ç»è¿‡è¯¦ç»†è°ƒç ”åˆ†æå’Œä½¿ç”¨ä¹‹åï¼Œæœ¬äººå‘ç°è¿™äº›ç›‘æ§æ¨¡å‹æ˜¯åº”è¯¥åˆ†å±‚æ¬¡æ¥ç†è§£å’Œä½¿ç”¨çš„ã€‚</p><p><img src="/2021/01/18/wei-fu-wu-xian-shang-zhi-li-zhi-jian-kong/image-layers.png" alt="å›¾5"></p><p>ä¸€å…±åˆ†ä¸º<code>åŸºç¡€çŠ¶æ€å±‚</code>ã€<code>èµ„æºå ç”¨å±‚</code>ã€<code>APIå±‚</code>ã€<code>é“¾è·¯å±‚</code>ã€‚</p><ul><li>åŸºç¡€çŠ¶æ€å±‚ï¼šå„å¾®æœåŠ¡å’ŒåŸºç¡€è®¾æ–½æœåŠ¡ï¼ˆæ¯”å¦‚æ•°æ®åº“ï¼‰çš„ç”Ÿæ•ˆé…ç½®åŠå®æ—¶çŠ¶æ€ï¼Œå¦‚å¥åº·åº¦ã€ç†”æ–­å™¨çŠ¶æ€ã€é™æµé˜€çŠ¶æ€ã€ç°åº¦çŠ¶æ€ç­‰ç­‰ã€‚ï¼ˆç¤ºä¾‹å›¾1ï¼‰</li><li>èµ„æºå ç”¨å±‚ï¼šå„å¾®æœåŠ¡å’ŒåŸºç¡€è®¾æ–½æœåŠ¡å¯¹èµ„æºçš„å ç”¨ï¼Œæ¯”å¦‚å¾®æœåŠ¡å¯¹ç³»ç»ŸCPUã€å†…å­˜ã€ç£ç›˜ç­‰çš„å ç”¨ç‡ï¼Œå¾®æœåŠ¡å†…éƒ¨å †æ ˆå¯¹å†…å­˜çš„åˆ©ç”¨ç‡ç­‰ç­‰ã€‚ï¼ˆç¤ºä¾‹å›¾2ï¼‰</li><li>APIå±‚ï¼šå„å¾®æœåŠ¡çš„APIæ€§èƒ½ï¼ŒAPIæ–¹å¼åŒ…æ‹¬ä¸”ä¸é™äºhttp restful APIã€messageQueue consumerç­‰ç­‰ï¼›åŒæ—¶ï¼ŒåŸºç¡€è®¾æ–½æœåŠ¡ï¼Œæ¯”å¦‚æ•°æ®åº“ï¼ŒSQLæœ¬èº«å¯ä»¥ç†è§£ä¸ºä¸€ç§ç‰¹æ®Šçš„APIï¼Œå› æ­¤æ…¢SQLç»Ÿè®¡å’Œç›‘æ§ï¼Œä¹Ÿå¯ä»¥ç®—å…¥APIå±‚ã€‚ï¼ˆç¤ºä¾‹å›¾3ï¼‰</li><li>é“¾è·¯å±‚ï¼šç»Ÿè®¡å’Œè¿½è¸ªç”±æœåŠ¡è¯·æ±‚å‘èµ·çš„æ•´ä¸ªç³»ç»Ÿå†…éƒ¨é“¾è·¯çš„æµè½¬ï¼ŒåŒ…æ‹¬å¾®æœåŠ¡ä¹‹é—´ã€å¾®æœåŠ¡ä¸åŸºç¡€è®¾æ–½æœåŠ¡ä¹‹é—´çš„é“¾è·¯ã€‚å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ–¹å¼åŒ…æ‹¬ä¸”ä¸é™äºhttp restfulã€messageQueueç­‰ç­‰ã€‚ï¼ˆç¤ºä¾‹å›¾4ï¼‰</li></ul><p>è¶Šé è¿‘<code>æŠ€æœ¯åº•å±‚</code>ï¼ŒæŒ‡æ ‡è¶Šå­¤ç«‹ï¼Œå¯¹æœåŠ¡çš„å½±å“é¢è¶Šå¹¿ï¼Œè¶Šéš¾ç›´æ¥å®šä½é—®é¢˜ï¼›</p><p>è¶Šé è¿‘<code>åº”ç”¨å±‚</code>ï¼ŒæŒ‡æ ‡è¶Šå…·è±¡ï¼Œå½±å“é¢è¶Šå°ï¼Œè¶Šå®¹æ˜“å®šä½é—®é¢˜ã€‚</p><p>å½“ç„¶ä¹Ÿæœ‰äººä¼šè®¤ä¸ºï¼Œåœ¨è¿™ç§åˆ†å±‚ç»“æ„ä¸­ï¼Œåº”è¯¥å°†åŸºç¡€è®¾æ–½æœåŠ¡å•ç‹¬æ‹å‡ºæ¥ä½œä¸ºä¸€ä¸ªå•ç‹¬åˆ†ç±»  â€”â€” çš„ç¡®ä¹Ÿæ˜¯æ— ä¸å¯ï¼Œé™¤äº†é“¾è·¯å±‚ä»¥å¤–ï¼ŒåŸºç¡€è®¾æ–½æœåŠ¡å¯ä»¥ç‹¬ç«‹å®Œæˆå¦å¤–ä¸‰å±‚çš„çºµå‘åˆ‡ç‰‡ã€‚</p><h3 id="3-ç›‘æ§éœ€è¦æ—¶æ•ˆæ€§">3. ç›‘æ§éœ€è¦æ—¶æ•ˆæ€§</h3><p>åœ¨æ­å»ºç›‘æ§å·¥å…· æˆ–è€… æ¥å…¥ç›‘æ§å¹³å°æ—¶ï¼Œé¢å¯¹äºé‡‡é›†æ—¥å¿—ã€æŒ‡æ ‡çš„å®æ—¶è¿ç®—æ–¹å¼ï¼Œå¤§å¤šæ•°æƒ…å†µå›¢é˜Ÿéƒ½é»˜è®¤ç›‘æ§æ˜¯å®æ—¶çš„ â€”â€” è¿™æ ·èƒ½åŠæ—¶å‘ç°å’Œå“åº”é—®é¢˜ã€‚</p><p>å¹¶ä¸”å¤§éƒ¨åˆ†ç›‘æ§å·¥å…·ï¼Œåšåˆ°äº†ç›‘æ§è‡ªåŠ¨åŒ–ï¼Œè¿›è¡Œå®æ—¶é¢„è­¦ï¼ŒåŠæ—¶é€šçŸ¥åˆ°ç›¸å…³äººå‘˜å¤„ç†é—®é¢˜ï¼›æˆ–è€…ï¼Œæœ‰éƒ¨åˆ†DevOpsç›‘æ§å¹³å°ç”šè‡³å¯ä»¥åšåˆ°è‡ªåŠ¨åŒ–AIç®¡æ§ï¼Œé’ˆå¯¹<code>åŸºç¡€çŠ¶æ€å±‚</code>ã€<code>èµ„æºå ç”¨å±‚</code>å‡ºç°çš„é—®é¢˜ï¼Œä½¿ç”¨èµ„æºä¸´æ—¶æ‰©å®¹ã€èµ„æºåˆ‡æ¢/é‡å¯ç­‰ç­–ç•¥è¿›è¡Œçº¿ä¸Šè‡ªåŠ¨æ¢å¤ã€‚</p><p>ç„¶è€Œï¼Œéšç€Q/TPSã€æ•°æ®é‡çš„å¢é•¿ï¼Œç›‘æ§æœåŠ¡èµ„æºå‡çº§çš„æ»å æˆ– æ¶æ„çš„ä¸åˆç†ï¼Œç›‘æ§å»¶æ—¶çš„è¯¯å·®ä¼šè¶Šæ¥è¶Šå¤§ã€‚</p><p>å½“ç›‘æ§çš„æ—¶æ•ˆæ€§è¶Šæ¥è¶Šåç¦»å®æ—¶ï¼Œå›¢é˜Ÿå¯¹äºç³»ç»Ÿè¿è¡Œæ—¶å¿«é€Ÿå‘ç°å’Œå“åº”é—®é¢˜çš„æ•ˆç‡å°†å¤§æ‰“æŠ˜æ‰£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡æ²»ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®æœåŠ¡æ²»ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL InnoDB èšé›†ç´¢å¼•æ•°æ®ç»“æ„</title>
      <link href="/2020/12/27/mysql-innodb-ju-ji-suo-yin-shu-ju-jie-gou/"/>
      <url>/2020/12/27/mysql-innodb-ju-ji-suo-yin-shu-ju-jie-gou/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿçš„ä¸–ç•Œæ˜¯éå¸¸å¤æ‚çš„ â€”â€” å¦‚æœæˆ‘ä»¬æ€è€ƒä¸€ä¸‹æˆ‘ä»¬éœ€è¦åšå“ªäº›äº‹æƒ…æ‰èƒ½æ»¡è¶³SQLè¯­å¥çš„æŸ¥è¯¢éœ€æ±‚ï¼Œå°±èƒ½æ„è¯†åˆ°è¿™ç§å¤æ‚æ˜¯å¿…ç„¶çš„ã€‚ä½†å…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼Œä¹¦å†™SQLæ˜¯å¦‚æ­¤ç®€å•ï¼Œè¡¨ã€è¡Œä¸åˆ—çš„æ¦‚å¿µä¹Ÿéå¸¸å®¹æ˜“ç†è§£ã€‚</p><p>â€‹â€”â€” ã€Šæ•°æ®åº“ç´¢å¼•è®¾è®¡å’Œä¼˜åŒ–ã€‹</p></blockquote><span id="more"></span><h3 id="1-é¡µ-Page">1. é¡µ (Page)</h3><p>é¡µï¼Œæ˜¯æ•°æ®åº“æ•°æ®å­˜å‚¨æ–¹å¼çš„é€»è¾‘ç»“æ„ã€‚</p><p>Innodb é‡‡ç”¨å°†å­˜å‚¨æ•°æ®æŒ‰è¡¨ç©ºé—´ï¼ˆtablespaceï¼‰çš„æ–¹å¼è¿›è¡Œå­˜æ”¾ã€‚å¦‚æœæ²¡æœ‰å¼€å¯ <code>innodb_file_per_table</code> è®¾ç½®ï¼Œæ–°çš„è¡¨çš„åˆ›å»ºä¼šä¿å­˜è¿›é»˜è®¤çš„ç³»ç»Ÿå…±äº«è¡¨ç©ºé—´ã€‚</p><pre class="line-numbers language-none"><code class="language-none">mysql&gt; show variables like 'innodb_file_per_table';+-----------------------+-------+| Variable_name         | Value |+-----------------------+-------+| innodb_file_per_table | ON    |+-----------------------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ <code>innodb_file_per_table</code> ç­‰äº <code>ON</code> æ—¶ï¼Œä¼šç»™æ¯ä¸ªè¡¨åˆ›å»ºç‹¬ç«‹çš„æ•°æ®æ–‡ä»¶ã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨æ•°æ®åº“ <code>test</code> ä¸­åˆ›å»ºä¸€ä¸ªè¡¨ <code>show_index</code> ï¼Œåœ¨mysql çš„ dataDirectory ç›®å½•ä¸‹å°±å›å‡ºç°ä¸€ä¸ªåä¸º <code>show_index.ibd</code> çš„æ•°æ®æ–‡ä»¶ã€‚</p><p>åœ¨å•ä¸ªè¡¨çš„æ•°æ®æ–‡ä»¶ä¸­ï¼Œæ•°æ®å°±æ˜¯ä»¥å¤šä¸ªé¡µçš„å½¢å¼è¿›è¡Œæ’åˆ—ã€‚MySQLé»˜è®¤é…ç½®ä¸‹ï¼Œæ¯16Kï¼Œå³ä¸ºä¸€ä¸ªé¡µã€‚</p><p>å€Ÿç”¨äº†ã€ŠMySQLæŠ€æœ¯å†…å¹•Innodbå­˜å‚¨å¼•æ“ã€‹ä½œè€…çš„å·¥å…·<code>py_innodb_page_type.py</code>ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å•è¡¨æ•°æ®æ–‡ä»¶çš„é¡µç»„æˆï¼š</p><p><img src="/2020/12/27/mysql-innodb-ju-ji-suo-yin-shu-ju-jie-gou/image-py-innodb-page-info.png" alt="å›¾1 file_per_table tablespaceç»“æ„å›¾"></p><p>MySQLä¸­æ•°æ®é¡µå’Œç´¢å¼•é¡µï¼Œéƒ½è¢«å½’ç±»ä¸ºB Tree Nodeç±»å‹ï¼Œä¸¥æ ¼æ¥è¯´åº”è¯¥æ˜¯B+ Tree Nodeã€‚</p><h3 id="2-B-Tree-Node">2. B+ Tree Node</h3><p>B+ Treeæ¦‚å¿µï¼Œéœ€è¦åŒºåˆ†äºŒå‰æ ‘ï¼ˆBinary Treeï¼‰ã€äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBSTï¼‰ã€B-Treeï¼ˆB: Balanceï¼‰ã€‚</p><p>åœ¨MySQL innodbä¸­ï¼Œå¶å­èŠ‚ç‚¹é¡µçš„page levelä¸º0ï¼Œéå¶å­èŠ‚ç‚¹é¡µçš„page level &gt; 0ã€‚</p><p><img src="/2020/12/27/mysql-innodb-ju-ji-suo-yin-shu-ju-jie-gou/image-B+tree.png" alt="å›¾2 èšé›†ç´¢å¼•çš„B+ Treeå›¾"></p><p>ä¸Šå›¾æ˜¯ä¸€ä¸ªèšé›†ç´¢å¼•çš„B+ Treeå›¾ã€‚</p><p>1ä¸ªB+ Tree Nodeï¼Œå æ®ä¸€ä¸ªé¡µã€‚</p><ul><li>åœ¨ç´¢å¼•é¡µï¼Œé¡µçš„ä¸»è¦è®°å½•éƒ¨åˆ†(<code>User Records</code>)å­˜æ”¾çš„<code>Record</code> = <code>record header</code> + <code>index key</code> + <code>page pointer</code>ã€‚</li><li>åœ¨æ•°æ®é¡µï¼Œåˆ™æ˜¯æŒ‰è¡¨åˆ›å»ºæ—¶çš„<code>row_format</code>ç±»å‹å­˜æ”¾å®Œæ•´æ•°æ®è¡Œè®°å½•ã€‚<br>row_formatç±»å‹åˆ†åˆ«æœ‰ï¼š<code>Compact</code>ã€<code>Redundant</code>ã€<code>Compressed</code>å’Œ<code>Dynamic</code>ã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨èšé›†ç´¢å¼•ä¸­ï¼Œéå¶å­èŠ‚ç‚¹éƒ½ä¸ºç´¢å¼•é¡µï¼Œå¶å­èŠ‚ç‚¹ä¸ºæ•°æ®é¡µï¼›</p><p>åœ¨è¾…åŠ©ç´¢å¼•ä¸­ï¼Œéå¶å­èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½ä¸ºç´¢å¼•é¡µã€‚ä¸åŒçš„æ˜¯ï¼Œå¶å­èŠ‚ç‚¹é‡Œè®°å½•çš„æ˜¯èšé›†ç´¢å¼•ä¸­çš„ä¸»é”®IDå€¼ã€‚</p><p>æ³¨æ„ï¼Œåœ¨ç´¢å¼•é¡µçš„Recordä¸­çš„<code>page pointer</code>ï¼ŒæŒ‡å‘çš„æ˜¯é¡µï¼Œè€Œéå…·ä½“çš„è®°å½•è¡Œã€‚å¹¶ä¸”Recordçš„<code>index key</code>ï¼Œä¸ºæŒ‡å‘çš„page recordsçš„èµ·å§‹é”®å€¼ã€‚</p><h4 id="2-1-èšé›†ç´¢å¼•-Cluster-index">2.1. èšé›†ç´¢å¼• (Cluster index)</h4><p>MySQLå°†æ•°æ®å­˜æ”¾åœ¨èšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œç”±ç´¢å¼•è¿›è¡Œç»„ç»‡ã€‚å› æ­¤ä¹Ÿå¯ç§°ä¸ºï¼Œæ•°æ®å³ç´¢å¼•ï¼Œç´¢å¼•å³æ•°æ®ï¼Œåœ¨æ•´ä¸ªé¡µåˆ†ç±»ä¸­ï¼Œéƒ½è¢«åˆ—ä¸º<code>B+ Tree Node</code>ã€‚</p><p>å›¾2 å³æ˜¯ä¸€ä¸ªå®Œæ•´çš„èšé›†ç´¢å¼•çš„B+ Treeç»“æ„å±•ç°ã€‚</p><p>åœ¨å¶å­èŠ‚ç‚¹æ˜¯å¦‚ä½•å®ç°åŒå‘é“¾æ¥çš„ç»“æ„ï¼Œå¯ä»¥è¯¦ç»†çœ‹ä¸‹é¡µå†…çš„ç»„ç»‡åˆ†å¸ƒã€‚</p><p>åœ¨è¡¨ç©ºé—´æ–‡ä»¶çš„ä¸€ä¸ªé¡µçš„ç»“æ„ä¸Šï¼Œå†…å®¹å¸ƒå±€ä¸ºï¼š</p><p><img src="/2020/12/27/mysql-innodb-ju-ji-suo-yin-shu-ju-jie-gou/image-page-structure.png" alt="å›¾3 é¡µçš„ç»“æ„ç»„æˆå›¾"></p><p>åœ¨èšé›†ç´¢å¼•ä¸­ï¼Œæ•°æ®é¡µå†…é™¤äº†æŒ‰ç…§ä¸»é”®å¤§å°è¿›è¡Œè®°å½•å­˜æ”¾ä»¥å¤–ï¼Œåœ¨<code>File header</code>ä¸­ï¼Œæœ‰ä¸¤ä¸ªå­—æ®µï¼š<code>fil_page_prev</code> å’Œ<code>fil_page_next</code>, åˆ†åˆ«è®°å½•äº†ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µçš„åç§»é‡ï¼ˆoffsetï¼‰ï¼Œç”¨ä»¥å®ç°æ•°æ®é¡µåœ¨B+ Treeå¶å­ä½ç½®çš„åŒå‘é“¾è¡¨ç»“æ„ã€‚</p><h3 id="3-æ•°æ®æ£€ç´¢">3. æ•°æ®æ£€ç´¢</h3><p>é€šè¿‡B+ Treeç»“æ„ï¼Œå¯ä»¥æ˜æ˜¾çœ‹åˆ°ï¼Œé€šè¿‡B+ TreeæŸ¥æ‰¾ï¼Œå¯ä»¥å®šä½åˆ°ç´¢å¼•æœ€åæŒ‡å‘çš„æ•°æ®é¡µï¼Œå¹¶ä¸èƒ½æ‰¾åˆ°å…·ä½“çš„è®°å½•æœ¬èº«ã€‚</p><p>è¿™æ—¶ï¼Œæ•°æ®åº“ä¼šå°†è¯¥é¡µåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åé€šè¿‡<code>Page Directory</code>è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚</p><h4 id="3-1-Page-Directory">3.1. Page Directory</h4><p><code>Page Directory</code>æ˜¯è¯¥é¡µå­˜æ”¾çš„<code>User Records</code>çš„ä¸€ä¸ªç¨€ç–ç›®å½•ï¼Œå­˜æ”¾çš„å†…å®¹æ˜¯Recordåœ¨é¡µå†…çš„ç›¸å¯¹ä½ç½®ã€‚æ¯ä¸¤ä¸ªå­—èŠ‚ï¼Œè®°å½•ä¸€ä¸ªç›¸å¯¹ä½ç½®ï¼Œä»é‚»è¿‘<code>File Trailer</code>çš„ä½ç½®å¼€å§‹å€’æ’å­˜æ”¾ã€‚</p><p><img src="/2020/12/27/mysql-innodb-ju-ji-suo-yin-shu-ju-jie-gou/image-page-directory.png" alt="image-20210107214107410"></p><p><code>Page Directory</code>ä¸­æ¯ä¸¤ä¸ªå­—èŠ‚ï¼Œä»£è¡¨ä¸€ä¸ªç›®å½•æ§½ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œä¸€å…±æœ‰6ä¸ªæ§½ã€‚</p><p>åœ¨é¡µé¦–çš„<code>Page Header</code>éƒ¨åˆ†æœ‰ä¸€ä¸ª<code>Page_N_Dir_Slots</code>çš„å­—æ®µ â€”â€” åŒæ ·è®°å½•äº†ç›®å½•æ§½çš„æ•°é‡ã€‚</p><p>ä¸€ä¸ªç›®å½•æ§½ï¼Œå¯¹åº”æŒ‰åºçš„å¤šæ¡è®°å½•ã€‚è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ŒæŒ‡å‘è¿™æ‰¹è®°å½•çš„ç¬¬ä¸€æ¡è®°å½•ã€‚</p><p>æ¯æ¡è®°å½•éƒ½æœ‰<code>Record header</code>, ä½†ç›®å½•æ§½ æŒ‡å‘çš„ç¬¬ä¸€æ¡è®°å½•çš„<code>Record Header</code>ä¸­ç¬¬4~8ä½ï¼ˆbitsï¼‰ï¼Œæ˜¯<code>n_owned</code>å€¼ï¼Œä»£è¡¨è¯¥ç›®å½•æ§½ä¸­æ‹¥æœ‰çš„è®°å½•æ•°é‡ã€‚</p><p><code>Record header</code>çš„ç»„ç»‡ç»“æ„ï¼š</p><p><img src="/2020/12/27/mysql-innodb-ju-ji-suo-yin-shu-ju-jie-gou/image-record-header.png" alt="image-20210107214322598"></p><p>æ¯”å¦‚ä¸‹å›¾ï¼Œä¸€å…±æœ‰6ä¸ªç›®å½•æ§½ï¼Œå¤§éƒ¨åˆ†ç›®å½•æ§½ä¸­æœ‰4æ¡è®°å½•ã€‚</p><p><img src="/2020/12/27/mysql-innodb-ju-ji-suo-yin-shu-ju-jie-gou/image-page-slots.png" alt="image-20210107204730744"></p><h3 id="4-æ€»ç»“">4. æ€»ç»“</h3><p>MySQL Innodbé€šè¿‡é¡µç»„ç»‡æˆçš„B+ Tree Nodesç»“æ„ å’Œ Page Directoryï¼Œå®Œæˆäº†å…·ä½“è®°å½•çš„æ£€ç´¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç ”å‘æ•ˆèƒ½ä¹‹å±‚çº§æµ‹è¯•</title>
      <link href="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/"/>
      <url>/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/</url>
      
        <content type="html"><![CDATA[<p>ç ”å‘æ•ˆèƒ½ä¸ç­‰äºç ”å‘æ•ˆç‡ã€‚</p><p>åœ¨æˆ‘å¸çš„<code>ç ”å‘å¹³å°è§£å†³æ–¹æ¡ˆ</code>çš„å®šä¹‰ä¸­ï¼Œç ”å‘æ•ˆèƒ½ = å¯æŒç»­å¿«é€Ÿäº¤ä»˜ä»·å€¼çš„èƒ½åŠ› = æ•ˆç‡ + è´¨é‡ + ç”¨æˆ·ä»·å€¼ã€‚</p><p>å¦‚æœä¸èƒ½è¾¾åˆ°ç›¸åº”çš„è´¨é‡æ ‡å‡†å’Œç”¨æˆ·ä»·å€¼ï¼Œå†é«˜çš„ç ”å‘æ•ˆç‡ä¹Ÿæ˜¯æ‰ç„¶ã€‚</p><p>è¿™é‡Œæˆ‘ä¸“é—¨èŠä¸€ä¸‹æ•ˆç‡å’Œè´¨é‡ä¹‹é—´çš„ç»“åˆä¸€ä¸ªç‚¹ã€‚</p><h3 id="1-åœ¨å¯¹è´¨é‡çš„è¿½æ±‚ä¸­ï¼Œå¦‚ä½•ä¼˜åŒ–ç ”å‘æ•ˆç‡ï¼Ÿ">1. åœ¨å¯¹è´¨é‡çš„è¿½æ±‚ä¸­ï¼Œå¦‚ä½•ä¼˜åŒ–ç ”å‘æ•ˆç‡ï¼Ÿ</h3><span id="more"></span><p>åœ¨æ•æ·å›¢é˜Ÿé‡Œï¼Œå¼€å‘äººå‘˜å¾€å¾€è¢«è¦æ±‚ç¼–å†™å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€å¥‘çº¦æµ‹è¯•ç­‰ç­‰è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¹¶ä¸”åœ¨ CI æµæ°´çº¿ä¸Šåˆ›å»ºå¯¹åº”çš„<code>test stage</code>ï¼Œé€šè¿‡æ¯æ¬¡æäº¤ä»£ç åé‡å¤è¿è¡Œ â€”â€” æ¥è·å–æµ‹è¯•æƒ…å†µï¼Œä»¥æ­¤æ¥å¢æ·»äº¤ä»˜è´¨é‡çš„ä¿è¯ã€‚</p><p><img src="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/CI%E6%B5%81%E6%B0%B4%E7%BA%BF.png" alt="CIæµæ°´çº¿"></p><p>CI æµæ°´çº¿ä¸Šè¿è¡Œçš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¤§å®¶ä¸€å®šä¸é™Œç”Ÿ â€”â€” ä¸€æ¬¡ç¼–å†™ã€é‡å¤è¿è¡Œã€å˜æ›´æ—¶åŠæ—¶ç»´æŠ¤ã€‚</p><p>å¯¹å›¢é˜Ÿè€Œè¨€ï¼Œ<strong>å¯è§†åŒ–</strong>ã€æœ€ç›´è§‚çš„å°±æ˜¯ï¼Œæµ‹è¯•çš„è¿è¡Œæ•ˆç‡ã€è¿è¡Œæ—¶é•¿ã€‚</p><p>å› æ­¤ï¼Œå›¢é˜Ÿä¼šå°½é‡ç¼©çŸ­æµ‹è¯•é›†çš„è¿è¡Œæ—¶é•¿ï¼Œä»¥è¾¾åˆ°å¿«é€Ÿåé¦ˆå’Œæé«˜æµæ°´çº¿çš„åŠæ—¶ä½¿ç”¨ç‡ã€‚</p><p>åŒæ—¶ï¼Œå¿«é€Ÿçš„æµ‹è¯•è¿è¡Œæ•ˆç‡ï¼Œä¹Ÿå¯ä»¥ç¼©çŸ­å¼€å‘äººå‘˜è¿›è¡Œä»£ç é¢„æäº¤çš„æ£€æŸ¥æ—¶é—´ã€‚</p><p>åœ¨ä¸€èˆ¬__ä¸å¯è§†åŒ–__çš„è§’è½ï¼Œå…¶å®è¿˜æœ‰æ—¥å¸¸çš„æµ‹è¯•ç¼–å†™å’Œç»´æŠ¤çš„æ•ˆç‡ã€‚</p><p>å½“å›¢é˜Ÿè¦æ±‚è¾ƒé«˜çš„ä»£ç è¦†ç›–ç‡æ—¶ï¼Œå¾€å¾€ä¸€ä¸ª story çš„å¼€å‘æ—¶é—´ä¸­ï¼Œå¯èƒ½æœ‰ä¸€åŠå·¦å³ç”¨ä»¥ç¼–å†™ä¸Šè¿°è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ç ”å‘æ•ˆèƒ½åº¦é‡ä¸­ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ•ˆç‡åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p><img src="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E7%9A%84%E6%95%88%E7%8E%87.png" alt="è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ•ˆç‡"></p><p>ä¸ä»…è¦ä¼˜åŒ–æµ‹è¯•é›†çš„è¿è¡Œæ•ˆç‡ï¼ŒåŒæ—¶è¿˜è¦ä¼˜åŒ–æµ‹è¯•ç¼–å†™çš„æ•ˆç‡ã€‚</p><h3 id="2-æµ‹è¯•é‡‘å­—å¡”æ˜¯ä¸ªåˆé€‚çš„ç­–ç•¥">2. æµ‹è¯•é‡‘å­—å¡”æ˜¯ä¸ªåˆé€‚çš„ç­–ç•¥</h3><p><a href="https://martinfowler.com/bliki/TestPyramid.html">æµ‹è¯•é‡‘å­—å¡”</a>ä¸»å¯¼æ€æƒ³å°±æ˜¯ï¼Œé€šè¿‡ä¸åŒçš„æµ‹è¯•ç±»å‹ç»„åˆï¼Œæ¥è¾¾åˆ°è´¨é‡ä¸æŠ•å…¥äº§å‡ºæ¯”çš„ä¸€ä¸ªå¹³è¡¡å–èˆ â€”â€” ä»¥åˆé€‚çš„æŠ•å…¥äº§å‡ºæ¯”ï¼Œæ¥è·å–ä¸€ä¸ªè¾ƒé«˜çš„è´¨é‡ã€‚</p><p>é™¤å¼€ç¡¬ä»¶èµ„æºçš„æŠ•å…¥ï¼ˆå¦‚ CI èµ„æºï¼‰ï¼ŒæŠ•å…¥äº§å‡ºæ¯”ä¸ç ”å‘æ•ˆç‡æ˜¯çº¿æ€§çš„å…³ç³»ã€‚</p><p>æµ‹è¯•é‡‘å­—å¡”ä¸­ï¼Œåº•å±‚çš„å•å…ƒæµ‹è¯•æ‹¥æœ‰åé¦ˆå¿«ã€ä»£ä»·ä½ã€å•ä¸€èŒè´£çš„ç‰¹ç‚¹ï¼Œå› æ­¤ä½œä¸ºåŸºæ•°æœ€å¤§çš„åŸºå±‚æµ‹è¯• â€”â€” ç”¨ä»¥è¦†ç›–ç»å¤§éƒ¨åˆ†ä»£ç é€»è¾‘ã€‚</p><p>åŸºäºå•å…ƒæµ‹è¯•ä¸Šçš„å…¶ä»–ä¸Šå±‚æµ‹è¯•ï¼Œä¸»è¦ä»¥å…¶ä»–è§’åº¦å¼¥è¡¥å•å…ƒæµ‹è¯•çš„ä¸è¶³ï¼Œå¦‚ç»„ä»¶å®Œæ•´æ€§ç­‰ç­‰ï¼ŒåŒæ—¶å®ƒä»¬é¢ä¸´çš„é—®é¢˜è¶Šæ¥è¶Šå¤æ‚ã€èŒƒå›´è¶Šæ¥è¶Šå¹¿ï¼Œå¯åŠ¨å’Œè¿è¡Œçš„è¿‡ç¨‹ä¹Ÿä¼šè¶Šæ¥è¶Šé‡ï¼Œç¼–å†™å’Œç»´æŠ¤æˆæœ¬ä¹Ÿè¶Šé«˜ã€‚</p><p>å› æ­¤ï¼Œè¿ç”¨æµ‹è¯•é‡‘å­—å¡”ï¼Œåˆ©ç”¨å¤§é‡çš„åº•å±‚å•å…ƒæµ‹è¯•æ¥å°½é‡è¦†ç›–ä»£ç é€»è¾‘ï¼Œæ˜¯åŒæ—¶ä¼˜åŒ–<code>æµ‹è¯•ç¼–å†™æ•ˆç‡</code>å’Œ<code>æµ‹è¯•é›†è¿è¡Œæ•ˆç‡</code>çš„ä¸€æŠŠæœ‰åˆ©é’¥åŒ™ã€‚</p><h3 id="3-å•å…ƒæµ‹è¯•è¦†ç›–æ‰€æœ‰ä»£ç é€»è¾‘-â€”â€”-ä¸å¯èƒ½åšåˆ°ï¼Ÿ">3. å•å…ƒæµ‹è¯•è¦†ç›–æ‰€æœ‰ä»£ç é€»è¾‘ â€”â€” ä¸å¯èƒ½åšåˆ°ï¼Ÿ</h3><p>ä»¥æœåŠ¡æ¶æ„ä¸¾ä¾‹ï¼Œä»ä¼ ç»Ÿçš„åˆ†å±‚æ¶æ„è¯´èµ·ã€‚ï¼ˆä»£ç æœ¯è¯­ä»¥Java/Springä¸ºèƒŒæ™¯ã€‚ï¼‰<br><img src="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/%E4%BC%A0%E7%BB%9F%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84.png" alt="ä¼ ç»Ÿåˆ†å±‚æ¶æ„"></p><p>ä»æŠ€æœ¯å®ç°è§’åº¦æ¥è®²ï¼Œåªæœ‰å…¶ä¸­çš„ application å±‚å’Œ domain å±‚å¯ä»¥å®ç°çœŸæ­£æ„ä¹‰çš„å•å…ƒæµ‹è¯• â€”â€” åªæµ‹è¯•å•å…ƒæœ¬èº«ï¼Œä»…ä½¿ç”¨ Junit + mokitoï¼Œæµ‹è¯•åé¦ˆæ€»æ—¶é•¿åœ¨ç§’çº§ä»¥å†…ã€‚</p><p>ä»ä»£ç å®ç°æ¥çœ‹ï¼Œuser interfaces å’Œ persistence å…¶å®ä¹Ÿå¯ä»¥ä»…ä½¿ç”¨ Junit + mokito æ¥ç¼–å†™å•å…ƒæµ‹è¯•ã€‚<br>ä½†é—®é¢˜æ˜¯ï¼šè¿™ä¸¤å±‚åªä½¿ç”¨å•å…ƒæµ‹è¯•æ¥æµ‹æ–¹æ³•ä½“æœ¬èº«ï¼Œæ²¡æœ‰æ„ä¹‰ã€‚</p><h4 id="3-1-æ˜¯å¦è¦å•ç‹¬æµ‹è¯•-user-interfaces-å’Œ-persist-å±‚ï¼Ÿ">3.1. æ˜¯å¦è¦å•ç‹¬æµ‹è¯• user interfaces å’Œ persist å±‚ï¼Ÿ</h4><p>è¿™é‡Œæœ‰å—ç¤ºä¾‹ä»£ç ï¼Œè§ä¸‹ã€‚<br>user interfaces é‡Œé¢å®šä¹‰çš„åŸºäº Spring MVC çš„ controllerï¼Œçœ‹èµ·æ¥æ–¹æ³•ä½“å†…åªæœ‰ä¸€ä¸¤è¡Œä»£ç ï¼ŒåŒæ—¶ä¸‹å±‚ applicationService å’Œ mapper é€»è¾‘å·²ç»ç”±è‡ªèº«å•å…ƒæµ‹è¯•è¦†ç›–äº†ã€‚</p><pre class="line-numbers language-none"><code class="language-none">@GetMapping("/customers/{customerId}/projects/{projectId}")@PreAuthorize("hasRole('USER')")@ResponseStatus(HttpStatus.OK)Set&lt;LatestPipelineInfoResponse&gt; fetchLatestUploadInfo(@PathVariable @Min(0) Long customerId, @PathVariable Long projectId){    Set&lt;LatestPipelineInfoDTO&gt; dtos = this.service.fetchLatestUploadInfo(customerId, projectId);    return LatestPipelineInfoResponseMapper.MAPPER.fromDto(dtos);}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä½¿ç”¨å•å…ƒæµ‹è¯•ï¼Œä»…ä»…æµ‹çš„æ˜¯ controller å¯¹ service å’Œ mapper çš„æˆåŠŸè°ƒç”¨ï¼Œæ„ä¹‰å¾ˆå°ã€‚</p><p>æˆ‘ä»¬è¿™çœ‹ä¸€ä¸‹ä¸Šé¢è¿™ä¸ªcontroller methodèƒŒåè¦†ç›–äº†å¤šå°‘é€»è¾‘ï¼š</p><ul><li><p>ç›‘å¬http request</p></li><li><p>å°†http requestä¸­çš„æ•°æ®ååºåˆ—åŒ–è½¬æ¢æˆJava objects, æ³¨å…¥åˆ°æ–¹æ³•è°ƒç”¨çš„å…¥å‚ä¸­</p></li><li><p>éªŒè¯å…¥å‚</p></li><li><p>éªŒè¯ security æƒé™</p></li><li><p>è°ƒç”¨ä¸šåŠ¡é€»è¾‘</p></li><li><p>å°†ä¸šåŠ¡é€»è¾‘è¿”å›çš„Java objectsåºåˆ—åŒ–è¿”å›åˆ°responseä¸­</p></li><li><p>å¤„ç†ä»¥ä¸Šç¯èŠ‚ä¸­å‘ç”Ÿçš„å¼‚å¸¸</p><p>ä¸€å…±7é¡¹ï¼Œè™½ç„¶ä»£ç å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œè¿™æ˜¯å› ä¸º Spring æ¡†æ¶å¸®å¼€å‘äººå‘˜ç®€åŒ–äº†å¾ˆå¤šä»£ç é‡ã€‚<br>å•ç‹¬æµ‹è¯•user interfaceså±‚ï¼Œå¹¶ä¸æ˜¯è¯´è¦æµ‹ Spring æä¾›çš„æ¡†æ¶èƒ½åŠ›ï¼Œè€Œæ˜¯è¦æµ‹è¿™å—å®šåˆ¶ä»£ç æœ€ç»ˆå®ç°çš„æ˜¯ â€”â€” â€œæ­£å¦‚ä½ æ‰€æ„¿â€ã€‚</p></li></ul><p>ç›¸åŒé“ç†ï¼Œåœ¨persistå±‚ï¼Œå¦‚æœä»£ç é‡Œæœ‰å¤æ‚çš„é€»è¾‘ï¼Œæ¯”å¦‚åŠ¨æ€æŸ¥è¯¢ï¼Œæˆ–è€…ç›´æ¥HSQLã€SQLã€‚å¦‚ï¼š</p><pre class="line-numbers language-none"><code class="language-none">public interface PipelineHistoryJpaRepository extends        JpaRepository&lt;PipelineHistory, String&gt; {    @Query(nativeQuery = true, value = "SELECT * FROM pipeline_histories p, " +            "(SELECT max(id) AS id FROM pipeline_histories " +            "GROUP BY customer_id, project_id, pipeline_name) tmp " +            "WHERE p.id = tmp.id " +            "ORDER BY customer_id, project_id, pipeline_name")    public List&lt;PipelineHistory&gt; fetchAllExistsPipeline();}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>persistå±‚é€»è¾‘ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨æµ‹è¯•è¦†ç›–ã€‚<br>å½“ç„¶ï¼Œå¦‚æœæ˜¯JPAè‡ªåŠ¨ç”Ÿæˆçš„findByã€saveç­‰ç­‰ç³»åˆ—ï¼Œä¸åœ¨è¿™å—èŒƒå›´ä¹‹å†…ã€‚</p><h4 id="3-2-å¦‚ä½•å•ç‹¬æµ‹-user-interfaces-å’Œ-persist-å±‚ï¼Ÿ">3.2. å¦‚ä½•å•ç‹¬æµ‹ user interfaces å’Œ persist å±‚ï¼Ÿ</h4><p>user interfaces å’Œ persist å±‚å› ä¸ºæ¡†æ¶å’Œå·¥å…·çš„åŸå› ï¼Œåªèƒ½å¸¦ä¸ŠSpring application contextä¸€èµ·å¯åŠ¨æµ‹è¯•ã€‚<br>æ­£å¸¸æ¥è¯´ï¼Œå®ƒä»¬å·²ç»ç®—æ˜¯é›†æˆæµ‹è¯•äº†ï¼Œé›†æˆäº† Spring å®¹å™¨ã€‚</p><p>ç”¨è¿‡ @SpringBootTest çš„äººï¼Œä¸€å®šå¯¹å…¶é€ æˆçš„æµ‹è¯•ç¼–å†™æ•ˆç‡å’Œè¿è¡Œæ•ˆç‡å°è±¡æ·±åˆ» â€”â€” å¯èƒ½åªæ˜¯æ·»åŠ äº†å‡ ä¸ª Beanï¼Œå°±ä¼šè®© context çš„å¯åŠ¨æ—¶é—´å»¶é•¿å‡ ç§’ï¼Œä¸æ°å½“åœ°ä½¿ç”¨æŸäº›test annotationä¹Ÿä¼šé€ æˆcontextçš„é‡æ–°åŠ è½½å’Œåˆ·æ–°ã€‚</p><p>æœ¬äººä¹Ÿç”¨è¿‡å¾ˆé•¿ä¸€æ®µæ—¶é—´ â€”â€” é€šè¿‡ API è°ƒç”¨æ•´ä¸ªç»„ä»¶ï¼ˆ<code>controller </code>-&gt; <code>servcie</code>-&gt;<code>repository</code>-&gt;<code>memory db</code>ï¼‰, ä»¥å®ç°å¯¹user interfaces å’Œ persist å±‚çš„è¦†ç›–ã€‚å³ä½¿åœ¨æˆåŠŸä¼˜åŒ–SpringåŠ è½½æœºåˆ¶ â€”â€” æ¯æ¬¡æ‰¹é‡è¿è¡Œæµ‹è¯•ç”¨ä¾‹ä»…åŠ è½½ä¸€æ¬¡ application contextï¼Œä½†æ¯æ¬¡ç¼–å†™æ–°çš„APIæµ‹è¯•ã€ä¿®å¤APIæµ‹è¯•ä»ç„¶ç—›è‹¦ä¸å·² â€”â€” æ¯æ¬¡è¿è¡Œå•æ¡æµ‹è¯•è¿›è¡Œåé¦ˆæ—¶ï¼Œä¾ç„¶è¦ç­‰å¾…ä¸€æ¬¡å®Œæ•´çš„ context å¯åŠ¨ã€‚</p><p>å› æ­¤ï¼Œè¿™é‡Œæ¨èä½¿ç”¨Springæä¾›çš„åˆ‡ç‰‡æµ‹è¯•å·¥å…·ï¼ˆTests Slicesï¼‰: @WebMvcTestã€@DataJpaTestã€‚å…¶åŸç†æ˜¯ä»…åˆ›å»ºç®€åŒ–çš„application contextï¼Œå°‘é‡çš„beanï¼Œä½¿ç”¨è½»é‡çº§ã€æœ‰é’ˆå¯¹æ€§èŒƒå›´çš„æ–¹å¼ï¼Œé™ä½åé¦ˆæ—¶é—´ã€æå‡æµ‹è¯•æ€§èƒ½ã€‚<br>åœ¨ç¼–å†™æµ‹è¯•ã€è¿è¡Œæµ‹è¯•çš„æ€§èƒ½ä¸Šï¼Œåˆ‡ç‰‡æµ‹è¯•çš„åé¦ˆæ•ˆç‡çš„ç¡®èµ¶ä¸ä¸Šå•å…ƒæµ‹è¯•ï¼Œä½†å¯¹æ¯” @SpringBootTest åŠ è½½å‡ ä¹å®Œæ•´ context çš„æƒ…å†µå·²ç»ä¼˜åŒ–ä¸å°‘ã€‚</p><h4 id="3-3-æœ€ç»ˆçš„ç›®çš„ï¼šåˆ©ç”¨åŸºå±‚çš„æµ‹è¯•æ¥æ•´ä½“è¦†ç›–ä»£ç é€»è¾‘">3.3. æœ€ç»ˆçš„ç›®çš„ï¼šåˆ©ç”¨åŸºå±‚çš„æµ‹è¯•æ¥æ•´ä½“è¦†ç›–ä»£ç é€»è¾‘</h4><p>å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼šæŠ€æœ¯æ„ä¹‰ä¸Šçš„å•å…ƒæµ‹è¯•çš„ç¡®ä¸èƒ½è¦†ç›–æ‰€æœ‰ä»£ç é€»è¾‘ã€‚</p><p>ä½†ï¼Œ<code>å•å…ƒæµ‹è¯•</code> + <code>è½»é‡çº§çš„ã€å¿«é€Ÿåé¦ˆçš„ slice tests</code> å¯ä»¥å°½é‡è¦†ç›–åˆ°æ‰€æœ‰ä»£ç é€»è¾‘ã€‚</p><p>å› ä¸º<code>å•å…ƒæµ‹è¯• + slice tests</code>çš„ç›®æ ‡æ˜¯ä¸ºäº†å®Œæˆåˆ†å±‚æ¶æ„å†…çš„é€»è¾‘æµ‹è¯•ï¼Œä¸ºäº†é¿å…è¯­ä¹‰ä¸Šçš„å†²çªï¼Œå› æ­¤è¿™é‡Œå°†ä¸¤è€…ä¸€èµ·ç§°ä¸º<code>å±‚çº§æµ‹è¯•</code>ã€‚<br>é™¤äº†ä¼ ç»Ÿçš„åˆ†å±‚æ¶æ„ï¼Œä¹Ÿæ¥çœ‹çœ‹å…­è¾¹å½¢æ¶æ„ã€æˆ–è€…å«æ¥å£é€‚é…å™¨æ¶æ„æ˜¯ä¸æ˜¯é€‚åˆè¿›è¡Œ<code>åˆ†å±‚æµ‹è¯•</code>å‘¢ï¼Ÿ<br>å…¶å®ä¸ç„¶ï¼Œå…­è¾¹å½¢æ¶æ„åœ¨å®è§‚æ„ä¹‰ä¸Šï¼Œå…¶å®å¯ä»¥çœ‹æˆæ˜¯â€œä¸¤å±‚â€ â€”â€” domain å’Œ infrastructureã€‚<br><img src="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/%E5%85%AD%E8%BE%B9%E5%BD%A2%E6%9E%B6%E6%9E%84.png" alt="å…­è¾¹å½¢æ¶æ„"><br>æ­£å¥½å¯¹ç…§äº† unit tests å’Œ slice tests çš„åˆ†ç•Œã€‚<br>è€Œè¿™ä¸¤å±‚çš„åŒºåˆ«ï¼Œåœ¨äº unit tests æµ‹è¯•çš„æ˜¯ç³»ç»Ÿä¸­ç¨³å®šçš„ä¸šåŠ¡å±‚ï¼Œå¯ä»¥å°½é‡å¤šçš„è¿½æ±‚ä»£ç è¦†ç›–ç‡ï¼›è€Œslice tests æµ‹è¯•çš„æ˜¯å¯¹åŸºç¡€è®¾æ–½çš„ä¾èµ–é€‚é…å’Œå®šåˆ¶é€»è¾‘ï¼Œè¿½æ±‚å®šåˆ¶é€»è¾‘çš„åŠŸèƒ½è¦†ç›–ã€‚<br>æœ€ç»ˆåŒæ ·å¾—ä»¥å®Œæˆå¯¹ â€ä»£ç é€»è¾‘â€œ çš„æ•´ä½“æµ‹è¯•è¦†ç›–ã€‚</p><h3 id="é¢˜å¤–ï¼š">é¢˜å¤–ï¼š</h3><h4 id="1-APIé›†æˆæµ‹è¯•ï¼ˆAPI-Integration-Testsï¼‰">1. APIé›†æˆæµ‹è¯•ï¼ˆAPI Integration Testsï¼‰</h4><p><img src="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/API%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95.png" alt="APIé›†æˆæµ‹è¯•"><br>åœ¨å®Œæˆå‰é¢çš„å±‚çº§æµ‹è¯•ã€è¦†ç›–äº†æ‰€æœ‰é€»è¾‘ç»†èŠ‚ä¹‹åï¼Œå°±è½®åˆ°è·¨å±‚çº§çš„è¿é€šæ€§æµ‹è¯•äº†ã€‚<br>è¿™é‡Œè™½ç„¶å‘½åä¸ºâ€œAPIé›†æˆæµ‹è¯•â€ï¼Œå…¶å®ä¹Ÿå«â€œç»„ä»¶æµ‹è¯•â€ã€‚ç”±äºç³»ç»Ÿæ¶æ„ç”±æ¥å·²ä¹…ï¼Œåˆ°å¾®æœåŠ¡æ¶æ„çš„æ—¶å€™ï¼Œä¸€ä¸ªç»„ä»¶çš„è¾¹ç•Œå·²ç»æ˜¯ä¸€ä¸ªå¾®æœåŠ¡çš„è¾¹ç•Œï¼Œé’ˆå¯¹å¾®æœåŠ¡çš„APIç‰¹æ€§, è¿™ç¯‡æ–‡ç« é‡Œç§°å…¶ä¸ºâ€œAPIé›†æˆæµ‹è¯•â€ã€‚</p><p>åŸºäºæµ‹è¯•è¿è¡Œçš„å¯é‡å¤æ€§ï¼ŒAPIé›†æˆæµ‹è¯•ä¸­éœ€è¦é™ä½å¯¹å¤–ç•Œçš„ä¾èµ–ï¼Œæ¯”å¦‚å¾®æœåŠ¡åœ¨çœŸå®ç¯å¢ƒä¸­å¯¹æ•°æ®åº“ã€å¤–éƒ¨æœåŠ¡çš„ä¾èµ–ã€‚</p><p>æ•°æ®åº“å¯ä»¥æ›¿æ¢æˆèƒ½åŠ›ç›¸åŒçš„å†…å­˜å¼ã€æˆ–åµŒå…¥å¼æ•°æ®åº“ï¼Œæ¯”å¦‚ç”Ÿäº§mysql\mariaDB å¯æ›¿æ¢æˆ mariadb4j å®ç°åµŒå…¥å¼æ•°æ®åº“ï¼›å¤–éƒ¨æœåŠ¡ä¾èµ–ï¼Œä½¿ç”¨æœåŠ¡è¾¹ç•Œmockè¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚</p><p>å€Ÿç”¨**<a href="http://github.com/tobyclemson">Toby Clemson</a>** çš„ä¸€å¼ å¾®æœåŠ¡ç»„ä»¶æµ‹è¯•çš„å›¾ï¼Œæ©™è‰²çš„è™šçº¿æ­£æ˜¯ç»„ä»¶æµ‹è¯•çš„è¾¹ç•Œã€‚<a href="https://martinfowler.com/articles/microservice-testing/">åŸå›¾æ¥æº</a></p><p><img src="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/%E7%BB%84%E4%BB%B6%E6%B5%8B%E8%AF%95.png" alt="ç»„ä»¶æµ‹è¯•"></p><p>ä½¿ç”¨ API é›†æˆæµ‹è¯•å®ç°ç»„ä»¶å†…éƒ¨çš„è¿é€šæ€§æµ‹è¯•ï¼Œä¸€èˆ¬æµ‹è¯•è·¯å¾„é€‰æ‹©è¦†ç›–å±‚çº§å®Œæ•´çš„ happy pathï¼Œä¸è¦ä¼å›¾å»æµ‹è¯•å„é€»è¾‘åˆ†æ”¯ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>ä¸€èˆ¬å†™APIé›†æˆæµ‹è¯•çš„æ—¶å€™ï¼Œå¸¸ä¼šé‡åˆ°å±‚çº§é—´â€œä¼ é€’å‚æ•°ç¼ºå°‘æ ¡éªŒâ€œçš„é—®é¢˜ï¼Œå¦‚ controller è°ƒç”¨ applicationService æ—¶ï¼Œå…¥å‚ä¼ é€’äº†ä¸€ä¸ªæœªé¢„æ–™çš„<code>null</code> å€¼ï¼Œè¿™ä¸ª<code>null</code>å€¼çš„æ ¡éªŒï¼Œåº”è¯¥ç”±å…·ä½“ä»£ç  controller ä¸ applicationService ä¹‹é—´è¿›è¡Œçº¦å®šï¼šå¯ä»¥æ˜¯æ¥æ”¶æ–¹ç¼–å†™é˜²å¾¡æ€§æ ¡éªŒï¼Œä¹Ÿå¯ä»¥ç”±è°ƒç”¨æ–¹å‰ç»æ€§æ ¡éªŒã€‚</p><p>å› æ­¤ï¼Œæ­¤å¤„<code>null</code>å€¼æ ¡éªŒçš„é€»è¾‘å®Œå…¨æ˜¯å¯ä»¥åœ¨ Layer testsä¸­ç”±æµ‹è¯•è¦†ç›–ã€‚ä¸è¦è¯•å›¾åœ¨APIé›†æˆæµ‹è¯•ä¸­è¦†ç›–è¿™ä¸ª<code>null</code>å’Œ<code>énull</code>åˆ†æ”¯ã€‚</p><h4 id="2-å¥‘çº¦æµ‹è¯•-Contract-Tests">2. å¥‘çº¦æµ‹è¯•(Contract Tests)</h4><p>ä¹‹å‰æµ‹å®Œå„å±‚çº§é€»è¾‘ã€ç»„ä»¶å†…çš„è°ƒç”¨è¿é€šæ€§ï¼Œæ¥ç€æ¥çœ‹ä¸€ä¸‹å¾®æœåŠ¡è¾¹ç•Œçš„å¥‘çº¦æµ‹è¯•ã€‚</p><p><img src="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/%E5%A5%91%E7%BA%A6%E6%B5%8B%E8%AF%95.png" alt="å¥‘çº¦æµ‹è¯•"></p><h5 id="å¥‘çº¦-vs-API">å¥‘çº¦ vs API</h5><p>å¯¹äºå¥‘çº¦æµ‹è¯•ï¼Œé¦–å…ˆè¦é¿å…è¿›å…¥ â€”â€” ä¸€æ¡APIå°±åº”è¯¥æ˜¯ä¸€ä¸ªå¥‘çº¦çš„è¯¯åŒºã€‚</p><p>è®°ä½ï¼Œå¥‘çº¦æµ‹è¯•æœ‰ä¸ªâ€œé¦–è¦ç²¾ç¥â€œï¼š<code>æ¶ˆè´¹è€…é©±åŠ¨å¥‘çº¦ï¼ˆConsumer Driven Contractsï¼‰</code>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p><img src="/2020/06/30/yan-fa-xiao-neng-zhi-ceng-ji-ce-shi/%E5%A5%91%E7%BA%A6.png" alt="å¥‘çº¦"></p><p>æœåŠ¡producerï¼Œæœ¬èº«å®ç°äº†ä¸€æ¡APIï¼Œè¿”å›èµ„æº â€”â€” æ¯ä¸ªä¼šå‘˜çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š<code>id</code>ã€<code>age</code>ã€<code>name</code>ã€‚</p><p>æœåŠ¡consumer Iã€IIã€IIIçŸ¥é“ producer æœåŠ¡å¯ä»¥æä¾›ä¼šå‘˜ä¿¡æ¯èµ„æºï¼Œäºæ˜¯åˆ†åˆ«æ¥ä¸producerè°ˆéœ€æ±‚ã€è°ˆé›†æˆï¼Œæœ€ç»ˆå½¢æˆä¸¤ä»½éœ€æ±‚çº¦å®šï¼Œè§ä¸Šå›¾ã€‚</p><p>å·®åˆ«æ˜¯ï¼šä¸€ä»½çº¦å®šå¿…é¡»è¿”å›<code>id</code>å’Œ<code>age</code>å­—æ®µï¼Œå¦ä¸€ä»½çº¦å®šå¿…é¡»è¿”å›<code>id</code>å’Œ<code>name</code>å­—æ®µã€‚</p><p>è¿™ä¹Ÿå°±å½¢æˆäº†ä¸¤ä»½å¥‘çº¦ â€”â€” æ˜¯æ ¹æ®æ¶ˆè´¹è€…çš„éœ€æ±‚ç›´æ¥é©±åŠ¨çš„ã€‚</p><p>ä» consumer è§’åº¦æ¥çœ‹ï¼Œæ ¹æœ¬ä¸å…³å¿ƒ producer çš„APIæ˜¯å¦æ˜¯å¤ç”¨ï¼Œè¿™é‡Œåªæ˜¯æ°å¥½å¤šä¸ªå¥‘çº¦å¯ä»¥å…±ç”¨ä¸€æ¡APIè€Œå·²ï¼Œå› æ­¤æ¯ä¸ªconsumerçš„åŸºæœ¬è¯‰æ±‚å°±æ˜¯ â€”â€” æ— è®ºä¹‹åAPIçš„å®ç°å¦‚ä½•å˜åŠ¨ï¼Œéƒ½ä¸èƒ½å½±å“è‡ªå·±å¥‘çº¦å†…çš„æ•°æ®ã€‚</p><p>æ¥ç€åœ¨éœ€æ±‚å‘å¸ƒä»¥åï¼Œconsumer IIIçš„éœ€æ±‚éœ€è¦å˜åŠ¨ â€”â€” å°†è¿”å›çš„<code>name</code>å­—æ®µï¼Œåˆ†åˆ‡æˆ<code>firstName</code>å’Œ<code>lastName</code>ï¼Œè¿™æ—¶å€™å°±å½¢æˆäº†ç¬¬ä¸‰ä»½<code>å¥‘çº¦C</code>ã€‚æ— è®ºå…·ä½“APIå¦‚ä½•å˜æ›´ï¼Œéƒ½æœ‰ä¸¤ä¸ªåŸºæœ¬çš„å®‰å…¨æ ¡éªŒé˜€åœ¨é‚£é‡Œï¼š<code>å¥‘çº¦A</code>å’Œ<code>å¥‘çº¦B</code>ã€‚</p><p>ä¹Ÿè®¸æœ‰äººä¼šè¯´ä¸éœ€è¦<code>å¥‘çº¦C</code>ï¼Œä¸ºäº†çœäº‹å„¿consumer IIIæ‹¿ä¸Š<code>name</code>å­—æ®µè‡ªå·±æ‹†å˜›ã€‚è¿™ç§æ€è·¯åœ¨ç°å®è°ˆéœ€æ±‚ã€è°ˆé›†æˆä¸­å…¶å®ç»å¸¸ä¼šç¢°åˆ°ã€‚ è¿™é‡Œä¸€ä¸ªå°çš„ç©ç¬‘ï¼šè¯·å‘Šè¯‰æˆ‘ï¼Œä½ è§‰å¾—â€é‡‘åŸæ­¦â€œæ˜¯å§“â€é‡‘åŸâ€œï¼Œè¿˜æ˜¯å§“â€é‡‘â€œï¼Ÿ</p><h5 id="å¥‘çº¦æµ‹è¯•éœ€è¦åŒæ–¹ç»´æŠ¤">å¥‘çº¦æµ‹è¯•éœ€è¦åŒæ–¹ç»´æŠ¤</h5><p><code>å¥‘çº¦ï¼ˆcontractï¼‰</code>ä»¥æ»¡è¶³consumeréœ€æ±‚ä¸ºç›®çš„ï¼Œä»¥consumerå®šä¹‰ä¸ºä¸»å¯¼ï¼Œä½† producer / customer åŒæ–¹éƒ½æœ‰æ ¡éªŒå¥‘çº¦äº¤ä»˜ç‰©çš„æƒåˆ©å’Œä¹‰åŠ¡ ã€‚</p><p><code>å¥‘çº¦æµ‹è¯•</code>ï¼Œé¦–å…ˆè¿è¡Œåœ¨producerçš„<code>auto test</code>ä¸­ï¼Œä»¥ä¿è¯ä»»ä½•æ—¶å€™ producer ä»£ç å˜æ›´ä¹‹åéƒ½æ»¡è¶³å¥‘çº¦ã€‚</p><p>åŒæ—¶è¯¥å¥‘çº¦éœ€è¦ç”Ÿæˆstubï¼Œæä¾›ç»™ consumer ä»¥ä½œä¸ºtest doubleï¼Œconsumer ä¾èµ–æ­¤å¥‘çº¦çš„åœºæ™¯ä½¿ç”¨æµ‹è¯•è¦†ç›–ï¼Œä»¥ä¿è¯å¥‘çº¦è¢«å˜æ›´æ—¶ consumer èƒ½å¤ŸåŠæ—¶è·çŸ¥ã€‚</p><h5 id="ä¸è¦æ»¥ç”¨å¥‘çº¦æµ‹è¯•">ä¸è¦æ»¥ç”¨å¥‘çº¦æµ‹è¯•</h5><p>å¥‘çº¦ä¸­ä¸»è¦çº¦å®šæ˜¯ä¸‰éƒ¨åˆ†ï¼š<code>è°ƒç”¨æ–¹å¼</code>ã€<code>æ•°æ®ç±»å‹</code>ã€<code>æ•°æ®æ ¼å¼</code>ã€‚å› æ­¤å¥‘çº¦æµ‹è¯•ä¸»è¦æ ¡éªŒçš„æ˜¯è¿™ä¸‰éƒ¨åˆ†ï¼Œä¸åŒ…æ‹¬æ•°æ®å€¼ã€‚</p><p>å¹¶ä¸”æ¯ä¸€ä»½å¥‘çº¦çš„å½¢æˆå’Œå˜æ›´ï¼Œéƒ½ä¼šæ¶‰åŠåˆ°ä¸¤æ–¹å›¢é˜Ÿçš„æ²Ÿé€šã€åè®®å’Œå®ç°ï¼Œæ¯”å•å…ƒæµ‹è¯•ã€API é›†æˆæµ‹è¯• â€”â€” ä»£ä»·é«˜ï¼Œæ•ˆç‡ä½ã€‚</p><p>å› æ­¤ï¼Œå¥‘çº¦æµ‹è¯•åœ¨æµ‹è¯•é‡‘å­—å¡”ä¸­ä½äº API é›†æˆæµ‹è¯•ä¸Šæ–¹ã€‚</p><p>é™¤äº†<code>è°ƒç”¨æ–¹å¼</code>ã€<code>æ•°æ®ç±»å‹</code>ã€<code>æ•°æ®æ ¼å¼</code>å¤–ï¼Œéœ€è¦ä½¿ç”¨å•å…ƒæµ‹è¯•ã€API é›†æˆæµ‹è¯•çš„æ–¹å¼è¦†ç›–ã€‚</p><h4 id="3-E2Eæµ‹è¯•">3. E2Eæµ‹è¯•</h4><p>åœ¨è½¯ä»¶ç ”å‘é˜¶æ®µçš„ E2E æµ‹è¯•ï¼Œä¸€ç›´æœ‰<code>æ— æ³•ç¨³å®šé‡å¤è¿è¡Œ</code>ã€<code>ä»£ä»·é«˜</code>ã€<code>æ•ˆç‡ä½</code>ç­‰ç­‰é—®é¢˜ï¼Œå› æ­¤ä¸€ç›´è¢«æ”¾åœ¨æµ‹è¯•é‡‘å­—å¡”çš„é¡¶ç«¯ã€‚</p><p>åœ¨å¾®æœåŠ¡æ¶æ„ã€å¤šå¾®æœåŠ¡ç¯å¢ƒéƒ¨ç½²ä¸­ï¼Œåœ¨ E2E æ˜¯åŸºäºç¯å¢ƒã€è¿è¡Œæ—¶çš„æƒ…å†µä¸‹ï¼Œè¿™äº›é—®é¢˜å°±æ›´åŠ çªå‡ºã€‚</p><p>å› æ­¤ï¼ŒE2E æµ‹è¯•çš„ç›®æ ‡å’ŒèŒƒå›´åœ¨å›¢é˜Ÿä¸­éœ€è¦ä»”ç»†çš„è¢«å®šä¹‰ã€‚</p><p>åœ¨æœ¬æ–‡çš„ä¸Šä¸‹æ–‡â€”â€”ç ”å‘é˜¶æ®µçš„è´¨é‡å†…å»ºï¼Œæ¨èä»…å°† E2E æµ‹è¯•ä½œä¸ºåŸºäºå‡ ä¸ªå…³é”®ä¸šåŠ¡åœºæ™¯çš„æœåŠ¡è¿é€šæ€§æµ‹è¯•ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœå›¢é˜Ÿæœ‰ä¸€ç¥¨ä¸“é—¨æ¥å†™E2Eæµ‹è¯•çš„äººæ‰‹ï¼Œæ„¿æ„æ‰¿æ‹…é«˜ä»£ä»·çš„æˆæœ¬ã€è§‰å¾—è¿™ç§ROIå¯ä»¥æ¥å—ï¼Œä¹Ÿæ˜¯å¯ä»¥å¤šå†™å†™E2Eæµ‹è¯•çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•æ·ç²¾ç›Šè½¯ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•æ·æµ‹è¯• </tag>
            
            <tag> ç ”å‘æ•ˆèƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨gradleç®¡ç†å¯å…±äº«çš„ä¾èµ–ç‰ˆæœ¬ç®¡ç†</title>
      <link href="/2020/06/05/zai-gradle-guan-li-ke-gong-xiang-de-yi-lai-ban-ben/"/>
      <url>/2020/06/05/zai-gradle-guan-li-ke-gong-xiang-de-yi-lai-ban-ben/</url>
      
        <content type="html"><![CDATA[<p>â€œå¯å…±äº«çš„ä¾èµ–ç‰ˆæœ¬ç®¡ç†â€ â€”â€” ç”¨è¿‡ Maven çš„å°ä¼™ä¼´ä»¬å¯èƒ½è¯´ï¼Œè¿™ä¸å°±æ˜¯BOMä¹ˆã€‚<br>å¯¹ï¼Œè¿™é‡ŒèŠçš„å°±æ˜¯å¦‚ä½•ä½¿ç”¨ gradle å®ç° BOM ç”Ÿæˆå’Œå¯¼å…¥ã€‚<br>æ²¡ç”¨è¿‡ Maven çš„å°ä¼™ä¼´ä»¬ä¹Ÿä¸ç”¨è¢«åŠé€€ï¼Œæƒ³æƒ³åœ¨ä½¿ç”¨Spring plugin <code>io.spring.dependency-management</code>æ—¶ï¼Œ<br><code>imports.mavenBom</code>åˆ°åº•åœ¨åšä»€ä¹ˆï¼Œæœ‰æ²¡æœ‰æƒ³è¦äº†è§£ä¸€ä¸‹ï¼Ÿ</p><span id="more"></span><h3 id="1-BOMæ˜¯ä»€ä¹ˆï¼Ÿ">1. BOMæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>åœ¨è¯´ BOM ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹ Maven çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚<br>Maven <strong>POM</strong>ï¼Œå…¨å <code>Project Object Model</code>, æ˜¯ Maven ä½¿ç”¨ä¸­çš„é‡è¦é…ç½®æ–‡ä»¶ï¼Œxmlæ ¼å¼ï¼Œä¸»è¦ç”¨æ¥å¯¼å…¥ä¾èµ–å’Œè¿›è¡Œé¡¹ç›®æ„å»ºã€‚<br>Maven <strong>BOM</strong>ï¼Œå…¨å <code>Bill Of Materials</code>, æ˜¯ä¸€ç§ç‰¹æ®Šçš„ POMï¼Œä¸»è¦ç”¨æ¥é›†ä¸­ç®¡ç†é¡¹ç›®ä¾èµ–çš„ç‰ˆæœ¬ï¼Œæ›´åŠ çµæ´»åœ°ç»´æŠ¤æ‰€æœ‰ä¾èµ–çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚<br>é…ç½®å¥½çš„ BOMï¼Œå¯ä»¥æ”¾åœ¨å•ä¸ªé¡¹ç›®ä¸­è‡ªç”¨ï¼Œä¹Ÿå¯ä»¥ä¼ é˜…å’Œåˆ†äº«ç»™å…¶ä»–é¡¹ç›®è¿›è¡Œå…¬ç”¨ã€‚</p><p>è®²çš„ç›´è§‚ä¸€ç‚¹ï¼Œæ•ˆæœå°±æ˜¯ï¼ˆè§ä¸‹å›¾ï¼‰ï¼š<br><img src="/2020/06/05/zai-gradle-guan-li-ke-gong-xiang-de-yi-lai-ban-ben/Spring-dependencies-management.png" alt="Spring-dependencies-management"><br>dependenciesä¸­ä¾èµ–çš„é‚£äº›åº“ä¸ºä½•å¯ä»¥ä¸ç”¨æ ‡æ˜ç‰ˆæœ¬ï¼Ÿ<br>æ­£æ˜¯å› ä¸ºä½¿ç”¨äº†<em>dependency-management</em> æ’ä»¶ï¼Œå½“ gradle plugin <em>org.springframework.boot</em> æ£€æµ‹åˆ°æ­¤æ’ä»¶å¯ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¼å…¥Spring boot dependencies BOMï¼Œè¿™æ ·ä¾èµ–åº“ä»¬ä¼šä¸»åŠ¨ä½¿ç”¨ BOM ä¸­æ¨èçš„ç‰ˆæœ¬ã€‚<a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html/#managing-dependencies">é“¾æ¥</a></p><p>ä¸‹é¢æ˜¯Spring Cloud BOMçš„ä¸€éƒ¨åˆ†å±•ç¤º(å®Œæ•´è§<a href="https://github.com/spring-cloud/spring-cloud-release/blob/vHoxton.SR5/spring-cloud-dependencies/pom.xml">é“¾æ¥</a>)ï¼š</p><p><img src="/2020/06/05/zai-gradle-guan-li-ke-gong-xiang-de-yi-lai-ban-ben/Spring-cloud-dependencies.png" alt="Spring-cloud-dependencies"></p><p>çœ‹åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯è§‰å¾—æœ‰ BOM çš„æƒ…å†µä¸‹ä¾¿æ·ä¸å°‘ï¼Œå†ä¹Ÿä¸ç”¨ä¸€æ¡æ¡dependencyåˆ†åˆ«æŸ¥é˜…ã€é€‰æ‹©å’Œç»´æŠ¤ç‰ˆæœ¬äº†ï¼Ÿ<br>æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å·²ç»è§è¯†è¿‡äº†Spring boot / Spring Cloud /junit è¿™äº›å¸¸ç”¨ BOMsã€‚</p><p>å½“æœ‰äº†å·²ç»è¢«éªŒè¯è¿‡çš„ä¾èµ–ç‰ˆæœ¬ç®¡ç†ï¼Œsetup projectsæ—¶å€™ç›´æ¥æ‹¿æ¥å¤ç”¨ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰çœäº‹ä¸å°‘ï¼Ÿ<br>åŒæ—¶ BOM ä¸å¯é¿å…åœ°è¿˜æ”¯æŒç‰ˆæœ¬å‡çº§ã€‚<br>ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•åœ¨ gradle ä¸­å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ BOMã€‚</p><h3 id="2-gradle-Java-platform-plugin">2. gradle Java platform plugin</h3><p><code>gradle Java platform plugin</code>æ˜¯ gradle å¯¹å®šä¹‰ã€å‘å¸ƒ BOM æä¾›çš„ä¸€æ¬¾å®ç”¨æ’ä»¶ã€‚<br>å¼•å…¥å®ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹åŠ¨æ‰‹å·¥ä½œäº†ã€‚<a href="https://docs.gradle.org/5.6.3/userguide/java_platform_plugin.html#header">å®˜æ–¹é“¾æ¥</a></p><p><em><code>build.gradle</code></em></p><pre class="line-numbers language-none"><code class="language-none">plugins {    id 'maven-publish'    id 'java-platform'}version '0.1.1-SNAPSHOT'javaPlatform {    allowDependencies()}dependencies {    api platform('org.springframework.boot:spring-boot-dependencies:2.2.6.RELEASE')    api platform('org.springframework.cloud:spring-cloud-dependencies:Greenwich.SR3')    api platform('org.springframework.cloud:spring-cloud-contract-dependencies:2.2.3.RELEASE')    api platform('org.junit:junit-bom:5.3.2')    constraints {        api 'com.google.guava:guava:27.0.1-jre'        api 'ch.vorburger.mariaDB4j:mariaDB4j-springboot:2.4.0'        api 'org.mariadb.jdbc:mariadb-java-client:2.2.5'        api 'org.mockito:mockito-core:2.22.0'        api 'org.mockito:mockito-junit-jupiter:2.22.0'        api 'org.assertj:assertj-core:3.11.1'    }}publishing {    repositories {        maven {            credentials {                username = 'jfrog'                password = 'jfrog123456'            }            def releasesRepoUrl = 'http://localhost:8082/artifactory/libs-release/'            def snapshotsRepoUrl = 'http://localhost:8082/artifactory/libs-snapshot/'            url = version.endsWith('SNAPSHOT') ? snapshotsRepoUrl : releasesRepoUrl        }    }    publications {        myPlatform(MavenPublication) {            from components.javaPlatform        }    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶, ä½œä¸ºä¸€ä¸ªæœåŠ¡çº§çš„ BOMï¼Œè‡ªç„¶æ— éœ€ä»é›¶å¼€å§‹é€æ¡å®šä¹‰ï¼Œå¯ä»¥ç›´æ¥å…ˆ import æ¡†æ¶çº§çš„ BOMsï¼Œå¦‚ä¸Šä¾‹ä¸­çš„Spring boot / Spring cloud / Spring cloud contract / Junitã€‚<br>ä½†ç”±äºéœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹platform bom, åˆ™ä¸å¾—ä¸æ‰“å¼€é…ç½®çº¦æŸ â€”â€”<code>javaPlatform.allowDependencies</code>ã€‚å…·ä½“ä½¿ç”¨è¯·è§<a href="https://docs.gradle.org/5.6.3/userguide/java_platform_plugin.html#sec:java_platform_bom_import">å®˜æ–¹é“¾æ¥</a></p><p>è¿™é‡Œï¼Œé€šè¿‡gradleç”Ÿæˆçš„ BOM ä¼šå‘å¸ƒåˆ°ä¸€ä¸ªæˆ‘æœ¬åœ°è‡ªå·±æ­å»ºçš„JFrog artifactory OSSä¸­ã€‚<br>(ä¸ºä»€ä¹ˆä¸åœ¨äº‘ä¸Šæ­ä¸€ä¸ªï¼Ÿå•Šå“ˆå“ˆï¼Œå› ä¸ºJFrog artifactory OSSæœ€ä½é¢„é…æ˜¯4æ ¸4Gå†…å­˜ï¼Œè‡ªå·±æé’±å°±æ‰‹çŸ­äº†ã€‚ã€‚)<br>å½“ç„¶,ä¹Ÿå¯ä»¥ç”Ÿæˆæœ¬åœ°çš„ POM æ–‡ä»¶ï¼Œæ‰‹åŠ¨å¤åˆ¶ä¼ é˜…ï¼Œä½†è¿™æ ·å°±ä¸å®¹æ˜“è¿›è¡Œåç»­çš„ç‰ˆæœ¬ç®¡ç†å’Œä¿æŒæ›´æ–°äº†ã€‚</p><p>maven publish æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥ä½¿ç”¨ BOM å¯¼å…¥ä¾èµ–ç‰ˆæœ¬äº†ã€‚</p><h3 id="3-gradle-platform">3. gradle platform</h3><p>å¯¼å…¥æ–¹å¼ä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥ä½¿ç”¨platformç»„ä»¶å³å¯ã€‚<a href="https://docs.gradle.org/current/userguide/platforms.html">å®˜æ–¹é“¾æ¥</a></p><p>åˆ›å»ºä¸€ä¸ªexampleé¡¹ç›®è¯•ä¸€ä¸‹, ç¼–å†™<code>build.gradle</code>æ–‡ä»¶ã€‚</p><pre class="line-numbers language-none"><code class="language-none">repositories {    maven {        credentials {            username = "jfrog"            password = "jfrog123456"        }        url "http://localhost:8082/artifactory/libs-snapshot/"    }}dependencies {    implementation platform('com.ellendan.service.template:dependencies-bom:0.1.1-SNAPSHOT')    implementation 'org.springframework.boot:spring-boot-starter-web'    implementation 'org.springframework.boot:spring-boot-starter-security'}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹ï¼Œå°±æ˜¯ä½¿ç”¨platform()å¼•å…¥å³å¯ã€‚</p><p>ä¹Ÿè®¸æœ‰äººä¼šé—®ï¼šå¤§å®¶ç”¨ spring-dependency-management ä¹ æƒ¯äº†ï¼Œè¿™ä¸ª BOM æ˜¯å¦æ”¯æŒ spring-dependency-management çš„ <code>imports.mavenBom</code>ã€‚<br>ç†è®ºä¸Šæ˜¯æ”¯æŒçš„ã€‚<br>ä½†æœ¬äººåœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œå‘ç°è‡ªå®šä¹‰ BOM ä¸­spring boot dependencies BOM æ— æ³•è¢«æˆåŠŸå¼•å…¥ï¼Œè€Œå…¶ä»– BOMs éƒ½æ²¡æœ‰æ­¤é—®é¢˜ã€å¯ä»¥æˆåŠŸå¯¼å…¥ã€‚<br>å› æ­¤ï¼Œæˆ‘è¿™é‡Œå¹¶ä¸æ¨èé€šè¿‡spring-dependency-managementçš„<code>imports.mavenBom</code>æ¥å¯¼å…¥ã€‚</p><h3 id="4-ä¸ºä»€ä¹ˆè¦åšâ€œå¯å…±äº«çš„ä¾èµ–ç‰ˆæœ¬ç®¡ç†â€">4. ä¸ºä»€ä¹ˆè¦åšâ€œå¯å…±äº«çš„ä¾èµ–ç‰ˆæœ¬ç®¡ç†â€</h3><p>è¿™è¿˜è¦ä»æœ¬äººæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡è¯´èµ·ã€‚<br>ä»»åŠ¡æœ¬èº«æ˜¯åš â€”â€” â€œå¯åŠ¨æ¨¡æ¿â€ã€‚<br>ä½†â€œå¯åŠ¨æ¨¡æ¿â€ï¼Œè¿™å››ä¸ªå­—ï¼Œæ€ä¹ˆçœ‹éƒ½è§‰å¾—éå¸¸çš„é™æ€ã€‚<br>ç»“åˆRebeccaã€Šæ¼”è¿›å¼æ¶æ„ã€‹ä¸­â€œæœåŠ¡æ¨¡æ¿â€çš„æ¦‚å¿µï¼ˆè™½ç„¶â€œæ¨¡æ¿â€è¿™å‘½åè¿˜æ˜¯æ€ä¹ˆçœ‹æ€ä¹ˆé™æ€ï¼‰ã€‚åœ¨æ„å»ºæœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†é˜²æ­¢æœ‰å®³çš„é‡å¤ï¼Œå¦‚æœæŠ€æœ¯ä¸Šçš„é€‚å½“è€¦åˆé¿å…ä¸äº†ï¼Œé‚£å°±å°½é‡è®©å…¶é»‘ç›’å¤ç”¨ã€‚</p><blockquote><p>é€šè¿‡åœ¨æœåŠ¡æ¨¡æ¿ä¸­å®šä¹‰é€‚å½“çš„æŠ€æœ¯æ¶æ„è€¦åˆç‚¹ï¼Œå¹¶è®©åŸºç¡€è®¾æ–½å›¢é˜Ÿç®¡ç†è¿™äº›è€¦åˆï¼Œå°±èƒ½ä½¿å„ä¸ªæœåŠ¡å›¢é˜Ÿå…äºè¿™äº›è‹¦æ¼ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œè¿™é‡Œå†³å®šå°è¯•åšä¸€ä¸ªâ€œæœåŠ¡æ¨¡æ¿â€ã€‚<br>ä¾èµ–ç‰ˆæœ¬ç®¡ç†åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå°çš„éƒ¨åˆ†, å¹¶ä¸”ä½¿ç”¨ gradle æ¥å®ç°ä¹Ÿéå¸¸ç®€å•ã€‚<br>å…·ä½“ä»£ç åœ°å€ï¼š<a href="https://github.com/ellendan000/service_template">https://github.com/ellendan000/service_template</a></p><h3 id="PS-åºŸè¯ç¯‡">PS. åºŸè¯ç¯‡</h3><p>çœ¼çœ‹2020å°±è¦è¿‡åŠï¼Œç”±äº2020å¼€å±€ä¹±æ¥ï¼Œå—ç§ç§å› ç´ å½±å“ï¼Œè®¡åˆ’ä¸€å›¢æ··ä¹±å˜æ›´ã€‚<br>ä¸€é¼“ä½œæ°”ï¼Œå†è€Œè¡°ï¼Œä¸‰è€Œç«­ï¼Œå„ç§è®¡åˆ’ç›®æ ‡å€ºã€‚æœŸæœ›2020ååŠæ®µèƒ½èµ°å¥½å§~</p><h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html/#managing-dependencies">https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html/#managing-dependencies</a></li><li><a href="https://docs.gradle.org/5.6.3/userguide/java_platform_plugin.html#header">https://docs.gradle.org/5.6.3/userguide/java_platform_plugin.html#header</a></li><li><a href="https://docs.gradle.org/current/userguide/platforms.html">https://docs.gradle.org/current/userguide/platforms.html</a></li><li><a href="https://docs.spring.io/dependency-management-plugin/docs/current/reference/html/#introduction">https://docs.spring.io/dependency-management-plugin/docs/current/reference/html/#introduction</a></li><li><a href="https://www.baeldung.com/spring-maven-bom">https://www.baeldung.com/spring-maven-bom</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Gradle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ¦‚å¿µæ¦‚è§ˆ</title>
      <link href="/2020/02/09/ddd-gai-nian-gai-lan/"/>
      <url>/2020/02/09/ddd-gai-nian-gai-lan/</url>
      
        <content type="html"><![CDATA[<p>è½¯ä»¶çš„æ ¸å¿ƒï¼Œæ˜¯ä¸ºå…¶ç”¨æˆ·è§£å†³é¢†åŸŸç›¸å…³é—®é¢˜çš„èƒ½åŠ›ã€‚</p><h3 id="1-ä½•ä¸ºDDD">1. ä½•ä¸ºDDD</h3><p>DDDæ˜¯Domain Driven Designçš„ç®€ç§°ã€‚<strong>é¢†åŸŸé©±åŠ¨è®¾è®¡</strong>ï¼Œâ€œ<strong>é¢†åŸŸ</strong>â€æŒ‡ä¸šåŠ¡é¢†åŸŸï¼Œâ€œ<strong>è®¾è®¡</strong>â€æŒ‡è½¯ä»¶è®¾è®¡ã€‚<br>DDDå¯ä»¥çœ‹æˆä¸€ç§å¼€å‘æ€æƒ³ä½“ç³»ï¼Œä¿ƒæˆäº†ä¸€ç§æ–°çš„ä»¥é¢†åŸŸä¸ºä¸­å¿ƒçš„æ€ç»´æ–¹å¼ï¼Œä½¿å¾—å›¢é˜Ÿå¯ä»¥é«˜æ•ˆç®¡ç†â€”â€”ç”¨äºå¤æ‚é—®é¢˜åŸŸçš„è½¯ä»¶çš„æ„é€ å’Œç»´æŠ¤ã€‚</p><span id="more"></span><h3 id="2-ä¸ºä»€ä¹ˆDDD">2. ä¸ºä»€ä¹ˆDDD</h3><p>å¯¹äºä¸€ä¸ªå¤æ‚ä¸šåŠ¡ç³»ç»Ÿï¼Œæ— è§†ä¸šåŠ¡å¤æ‚åº¦è€Œå‰²è£‚å¼åœ°è¿›è¡Œè½¯ä»¶è®¾è®¡ï¼Œå¾€å¾€ä¼šé€ æˆè½¯ä»¶çš„<strong>å¤§æ³¥çƒæ¨¡å¼ï¼ˆBBoMï¼‰</strong>ï¼Œåæœå°±æ˜¯ï¼š</p><ol><li>å¯¹ç»Ÿä¸€è¯­è¨€å’Œé—®é¢˜åŸŸçŸ¥è¯†ç¼ºä¹é‡è§†ï¼Œå¯¼è‡´ä»£ç åº“å¯ç”¨ä½†æ— æ³•æ­ç¤ºä¸šåŠ¡æ„å›¾ã€‚</li><li>ç¼ºä¹åŸºäºé—®é¢˜åŸŸæ¨¡å‹çš„åº”ç”¨ç¨‹åºè®¾è®¡çš„é‡è§†ï¼Œè®©ä»£ç åº“ç¼ºä¹ä¸ä¸šåŠ¡è¡Œä¸ºçš„ååŒæ•ˆåº”ï¼Œå½“æœ‰åç»­åŠŸèƒ½çš„æ‰©å±•å°±ä¼šå˜å¾—æ£˜æ‰‹ã€‚é¢†åŸŸå¤æ‚æ€§å’ŒæŠ€æœ¯å¤æ‚æ€§æ··åˆåœ¨äº†ä¸€èµ·ã€‚</li><li>ä¼šæ‰¼æ€å¼€å‘ã€‚å¯¹å¼€å‘äººå‘˜æ¥è¯´ï¼Œè½¯ä»¶æ‚ä¹±ã€å˜æ›´æ˜“å‡ºé”™ã€‚å¯¹ä¼ä¸šæ¥è¯´ï¼Œé™ä½äº†è½¯ä»¶å¿«é€Ÿå®ç°å•†ä¸šä»·å€¼çš„èƒ½åŠ›ã€‚</li><li>ç¼ºä¹å¯¹é—®é¢˜åŸŸçš„å…³æ³¨å’Œæ­£ç¡®è®¤è¯†ï¼Œæ„å»ºå‡ºæ¥çš„è½¯ä»¶ç³»ç»Ÿå¾€å¾€ä¼šå¤±è´¥ã€‚<br>æ³¨ï¼š<strong>é—®é¢˜åŸŸ</strong> ï¼Œæ¶‰åŠä½ å½“å‰æ­£åœ¨æ„å»ºè½¯ä»¶çš„ä¸»é¢˜é¢†åŸŸã€‚æ˜¯ç¡®å®šè½¯ä»¶ä»·å€¼çš„å…³é”®ç‚¹ã€‚</li></ol><h3 id="3-DDDæ¨¡å¼">3. DDDæ¨¡å¼</h3><p>DDDå…·æœ‰ä¸¤ç§æ¨¡å¼ç±»å‹ï¼šæˆ˜ç•¥æ¨¡å¼å’Œæˆ˜æœ¯æ¨¡å¼ã€‚<br>æˆ˜ç•¥æ¨¡å¼å½±å“çš„æ˜¯è§£å†³æ–¹æ¡ˆï¼Œæˆ˜æœ¯æ¨¡å¼ç”¨äºå®ç°å¯Œé¢†åŸŸæ¨¡å‹ã€‚<br><img src="/2020/02/09/ddd-gai-nian-gai-lan/ddd-summary.png" alt="Domain Drive Design Summary.png"></p><h4 id="3-1-DDDæˆ˜ç•¥æ¨¡å¼">3.1. DDDæˆ˜ç•¥æ¨¡å¼</h4><p>é¢†åŸŸé©±åŠ¨è®¾è®¡çš„æˆ˜ç•¥æ¨¡å¼ä¼šæç‚¼é—®é¢˜åŸŸå¹¶å¡‘é€ åº”ç”¨ç¨‹åºçš„æ¶æ„ã€‚</p><ol><li>æç‚¼é—®é¢˜åŸŸä»¥æ­ç¤ºé‡è¦ä¹‹å¤„æ˜¯ä»€ä¹ˆ â€”â€” æ ¸å¿ƒå­åŸŸã€‚æ ¸å¿ƒåŸŸæ˜¯ç¼–å†™è½¯ä»¶çš„åŸå› ï¼Œä¿ç•™æœ€å¤§ä»·å€¼çš„å…³é”®åŒºåŸŸï¼Œå†³å®šè½¯ä»¶æˆåŠŸä¸å¦çš„å…³é”®ã€‚å¹¶éä¸€ä¸ªç³»ç»Ÿçš„æ‰€æœ‰éƒ¨åˆ†éƒ½éœ€è¦è¢«ç²¾å¿ƒè®¾è®¡ï¼Œå›¢é˜Ÿå¯ä»¥æ›´ä¸“æ³¨äºæ ¸å¿ƒé¢†åŸŸã€‚</li><li>åœ¨è§£ç©ºé—´æ„å»ºä¸€ä¸ªè½¯ä»¶æ¨¡å‹ï¼Œä»¥å¤„ç†é¢†åŸŸé—®é¢˜å¹¶è®©è½¯ä»¶ä¸ä¸šåŠ¡ä¿æŒä¸€è‡´ã€‚</li><li>è¿ç”¨ç»Ÿä¸€è¯­è¨€ï¼ˆUbiquitous Languageï¼‰ï¼Œå¼€å¯å»ºæ¨¡åä½œã€‚é¦–å…ˆï¼Œç¡®ä¿çš„æ˜¯é¢†åŸŸä¸“å®¶å’Œå¼€å‘å›¢é˜Ÿåä½œå·¥ä½œï¼Œå…¶æ¬¡ï¼Œæ˜¯å°†åˆ†ææ¨¡å‹ç»‘å®šåˆ°ä»£ç æ¨¡å‹ï¼Œä»¥ä¾¿å¼€å‘å›¢é˜Ÿå’Œé¢†åŸŸä¸“å®¶èƒ½å¤Ÿåœ¨æ¨¡å‹è®¾è®¡æ–¹é¢è¿›è¡Œåä½œã€‚</li><li>é™ç•Œä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰ï¼Œå®šä¹‰äº†æ¨¡å‹çš„é€‚ç”¨æ€§å¹¶ç¡®ä¿ä¿ç•™å…¶å®Œæ•´æ€§å’Œç‹¬ç«‹å‘å±•çš„èƒ½åŠ›ã€‚ç»Ÿä¸€è¯­è¨€å’Œæ¨¡å‹çš„é€‚ç”¨è¾¹ç•Œåº”è¯¥æ˜¯è¦åœ¨å…·ä½“çš„é™ç•Œä¸Šä¸‹æ–‡å†…ã€‚</li><li>ä¸Šä¸‹æ–‡æ˜ å°„ï¼ˆContext Mapï¼‰ã€‚ä¸Šä¸‹æ–‡æ˜ å°„æä¾›äº†æ•´ä¸ªç³»ç»Ÿå„ä¸Šä¸‹æ–‡è¾¹ç•Œä¹‹é—´çš„å®è§‚çŠ¶å†µï¼Œæ­ç¤ºäº†ä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³»å’Œäº¤äº’æ–¹å¼ï¼ŒåŒæ—¶è¡¨ç°å‡ºå„ä¸Šä¸‹æ–‡å†…æ¨¡å‹çš„æœ‰å¤šå°‘å·®å¼‚ï¼Œä»¥åŠå®ƒä»¬çš„äº¤æ¢å“ªäº›æ•°æ®æ¥å®ç°ä¸šåŠ¡å¤„ç†è¿‡ç¨‹ã€‚</li></ol><p><strong>é—®é¢˜ç©ºé—´ &amp; è§£ç©ºé—´</strong><br>æˆ˜ç•¥æ¨¡å¼ä¸­å¼ºè°ƒé—®é¢˜ç©ºé—´å’Œè§£ç©ºé—´çš„åŒºåˆ«ã€‚åªæœ‰æ˜ç¡®ç¡®å®šäº†é—®é¢˜ç©ºé—´ï¼Œæ‰èƒ½åˆ†æå‡ºå¯¹åº”çš„è§£ç©ºé—´ï¼Œæœ€ç»ˆæ‰èƒ½æ„å»ºå‡ºæ»¡è¶³è§£å†³ä¸šåŠ¡é—®é¢˜çš„æˆåŠŸè½¯ä»¶ã€‚<br>ä¸Š1ï¼Œæ˜¯è§£å†³é—®é¢˜ç©ºé—´å¤æ‚åº¦çš„ç®¡ç†æ¨¡å¼ã€‚é—®é¢˜ç©ºé—´å°†é—®é¢˜æç‚¼æˆæ›´å¤šå¯ç®¡ç†çš„å­åŸŸã€‚<br>ä¸Š2ã€3ã€4ã€5ï¼Œ æ˜¯è§£ç©ºé—´çš„ç®¡ç†æ¨¡å¼ã€‚</p><p>æˆ˜ç•¥æ¨¡å¼å¼ºè°ƒäº†DDDçš„ä¾§é‡ç‚¹æ˜¯ï¼šçŸ¥è¯†æ¶ˆåŒ–ã€çŸ¥è¯†æç‚¼ã€åä½œæ²Ÿé€šã€ç»Ÿä¸€è¯­è¨€ã€ä¸Šä¸‹æ–‡ã€æ¨¡å‹æŒç»­å‘å±•ã€‚<br>åé¢æˆ˜æœ¯æ¨¡å¼ï¼Œå…¶å®åªæ˜¯æ”¯æŒå…¶å®ç°è€Œæ¨èçš„æ‰‹æ®µã€‚</p><h4 id="3-2-DDDæˆ˜æœ¯æ¨¡å¼">3.2. DDDæˆ˜æœ¯æ¨¡å¼</h4><p>DDDçš„æˆ˜æœ¯æ¨¡å¼ï¼ˆä¹Ÿç§°æ¨¡å‹æ„é€ å—ï¼‰æ˜¯ä¸€ä¸ªå¸®åŠ©åˆ›å»ºç”¨äºå¤æ‚æœ‰ç•Œä¸Šä¸‹æ–‡çš„æœ‰æ•ˆæ¨¡å‹çš„æ¨¡å¼é›†åˆã€‚<br>è®¸å¤šæ¨¡å¼éƒ½æ—©äºDDDæ¦‚å¿µçš„å‡ºç°ï¼Œä½†ä¾ç„¶æœ‰ä¸€äº›è¢«æ¨èä¸ºDDDæˆ˜æœ¯çš„æ ‡å‡†æ¨¡å¼ã€‚<br>åœ¨æˆ˜ç•¥æ¨¡å¼æä¾›çš„æ¶æ„å’ŒåŸåˆ™çš„åŸºç¡€ä¸Šï¼Œå…±ç”¨è¿™äº›æ ‡å‡†æ¨¡å¼å¯ä»¥è®©è®¾è®¡æœ‰åºè¿›è¡Œï¼Œä¹Ÿä½¿é¡¹ç›®ç»„æˆå‘˜èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°äº†è§£å½¼æ­¤çš„å·¥ä½œå†…å®¹ã€‚</p><ol><li>å®ä½“ï¼ˆEntityï¼‰</li><li>å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰</li><li>é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰</li><li>å·¥å‚(Factory)å’ŒéªŒè¯å™¨(Validator)</li><li>èšåˆ(Aggregation)</li><li>èµ„æºåº“(Repository)</li><li>é¢†åŸŸäº‹ä»¶(Domain Event)</li><li>æ¨¡å—(Module)</li><li>é›†æˆé™ç•Œä¸Šä¸‹æ–‡</li><li>å…­è¾¹å½¢æ¶æ„</li></ol><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol><li>ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šè½¯ä»¶æ ¸å¿ƒå¤æ‚æ€§åº”å¯¹ä¹‹é“ã€‹ï¼ŒEric Evans è‘—</li><li>ã€Šå®ç°é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ï¼ŒVaughn Vemon è‘—</li><li>ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡æ¨¡å¼ã€åŸç†ä¸å®è·µã€‹ï¼ŒScott Millett / Nick Tune è‘—</li></ol>]]></content>
      
      
      <categories>
          
          <category> DDD </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»ç²¾ç›Šæ¥çœ‹ä»·å€¼äº¤ä»˜æ˜¯ä»€ä¹ˆ</title>
      <link href="/2020/02/08/cong-jing-yi-lai-kan-jie-zhi-jiao-fu-shi-shi-me/"/>
      <url>/2020/02/08/cong-jing-yi-lai-kan-jie-zhi-jiao-fu-shi-shi-me/</url>
      
        <content type="html"><![CDATA[<p>å‰ä¸€æ®µæ—¶é—´åœ¨åšUå†…çš„ä»·å€¼äº¤ä»˜ã€‚<br>ä¸ªäººä¹Ÿä»æœ€å¼€å§‹çš„å¯æ„ä¼šä¸å¯è¨€ä¼ çš„çŠ¶æ€ï¼Œåˆ°åæ¥å¯ä»¥èŠäº›æ¦‚å¿µå’Œæªæ–½çš„é˜¶æ®µã€‚</p><p>è€å®è¯´ï¼Œæ›¾ç»åœ¨æˆ‘å¸ç»å¸¸å¬åˆ°Dev challenge BAï¼šâ€œä½ è¿™ä¸ªéœ€æ±‚çš„ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿâ€ç°åœ¨åè€Œå¬åˆ°è¶Šæ¥è¶Šå°‘ã€‚<br>æ›¾ç»æˆ‘ä»¬åšæŒè¦å»åšæœ‰ä»·å€¼çš„äº‹æƒ…ï¼Œç›´åˆ°æˆ‘ä»¬ç°åœ¨ä¸å¾—ä¸ highlight å‡º <code>ä»·å€¼äº¤ä»˜</code> è¿™ä¸ªæ ‡é¢˜ã€‚<br>å¹¶ä¸”å¸¸å¸¸ä¼šè¢«é—®åˆ° â€”â€” ä»·å€¼äº¤ä»˜ï¼Œå®ƒåˆ°åº•æŒ‡ä»€ä¹ˆï¼Ÿ</p><span id="more"></span><h2 id="1-â€œä»·å€¼äº¤ä»˜æ˜¯ä»€ä¹ˆï¼Ÿâ€">1. â€œä»·å€¼äº¤ä»˜æ˜¯ä»€ä¹ˆï¼Ÿâ€</h2><p>é¦–å…ˆï¼Œæˆ‘ä¸ä¼šå°è¯•ç›´æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚<br>ä½œä¸ºä¸€ä¸ªäº¤ä»˜å‹Uï¼Œæˆ‘ä»¬å…ˆä»ä¸€äº›è€³ç†Ÿèƒ½è¯¦çš„ç†è®ºå’Œæ–¹æ³•å®è·µä¸­ï¼Œå°è¯•æ‰¾åˆ°â€œä»·å€¼â€è¿™ä¸ªè¯ã€‚</p><ol><li>æ•æ·è½¯ä»¶å¼€å‘å®£è¨€</li></ol><blockquote><p>æˆ‘ä»¬ä¸€ç›´åœ¨å®è·µä¸­æ¢å¯»æ›´å¥½çš„è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œèº«ä½“åŠ›è¡Œçš„åŒæ—¶ä¹Ÿå¸®åŠ©ä»–äººã€‚<br>ç”±æ­¤æˆ‘ä»¬å»ºç«‹äº†å¦‚ä¸‹ä»·å€¼è§‚ï¼š</p><p>ä¸ªä½“å’Œäº’åŠ¨ é«˜äº æµç¨‹å’Œå·¥å…·<br>å·¥ä½œçš„è½¯ä»¶ é«˜äº è¯¦å°½çš„æ–‡æ¡£<br>å®¢æˆ·åˆä½œ é«˜äº åˆåŒè°ˆåˆ¤<br>å“åº”å˜åŒ– é«˜äº éµå¾ªè®¡åˆ’</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡å³é¡¹æœ‰å…¶ä»·å€¼ï¼Œ<br>æˆ‘ä»¬æ›´é‡è§†å·¦é¡¹çš„ä»·å€¼ã€‚</p></blockquote><ol start="2"><li>ç›¸äº’ä¾èµ–å£°æ˜ï¼ˆæ•æ·é¡¹ç›®ç®¡ç†å®£è¨€ï¼‰</li></ol><blockquote><p>æ•æ·å’Œè‡ªé€‚åº”çš„æ–¹æ³•æŠŠäººã€é¡¹ç›®å’Œä»·å€¼è”ç³»èµ·æ¥<br>æˆ‘ä»¬æ˜¯ä¸€ç¾¤èƒ½å¤Ÿéå¸¸æˆåŠŸåœ°äº¤ä»˜æˆæœçš„é¡¹ç›®é¢†å¯¼è€…æ‰€ç»„æˆçš„å›¢ä½“ã€‚ä¸ºäº†èƒ½æˆåŠŸäº¤ä»˜ï¼š</p><p>æˆ‘ä»¬é€šè¿‡å…³æ³¨æŒç»­çš„ä»·å€¼æµï¼Œä»¥æ­¤æ¥æé«˜æŠ•èµ„å›æŠ¥ç‡ã€‚<br>æˆ‘ä»¬é€šè¿‡ä¸å®¢æˆ·çš„é¢‘ç¹äº¤äº’å’Œåˆ†äº«æ‰€æœ‰æƒï¼Œä»¥æ­¤æ¥äº¤ä»˜å¯é çš„ç»“æœã€‚<br>æˆ‘ä»¬é¢„å…ˆè€ƒè™‘ä¸ç¡®å®šæ€§çš„å› ç´ ï¼Œå¹¶é€šè¿‡è¿­ä»£ã€é¢„é˜²å’Œé€‚åº”çš„æ–¹å¼ç®¡ç†å®ƒã€‚<br>æˆ‘ä»¬æ‰¿è®¤ä¸ªäººæ˜¯ä»·å€¼çš„æœ€ç»ˆæºæ³‰ï¼ŒåŠªåŠ›å»ºç«‹ä¸€ä¸ªäººå°½å…¶æ‰çš„ç¯å¢ƒï¼Œä»¥æ­¤é‡Šæ”¾åˆ›é€ åŠ›å’Œåˆ›æ–°åŠ›ã€‚<br>æˆ‘ä»¬é€šè¿‡å›¢é˜Ÿç»“æœé—®è´£åˆ¶ä»¥åŠå›¢é˜Ÿè´£ä»»åˆ†äº«åˆ¶ï¼Œä»¥æ­¤æ¥æå‡ç»©æ•ˆã€‚<br>æˆ‘ä»¬æŒ‰ç…§å…·ä½“æƒ…å†µåˆ¶å®šç­–ç•¥ã€è¿‡ç¨‹å’Œå®è·µï¼Œä»¥æ­¤æ¥æé«˜æ•ˆç‡å’Œå¯é æ€§ã€‚</p></blockquote><ol start="3"><li>ç²¾ç›Š<br>å¥½å§ã€‚æ— è®ºæ˜¯ç²¾ç›Šè½¯ä»¶å¼€å‘7åŸåˆ™ï¼Œè¿˜æ˜¯ä¸°ç”°ç²¾ç›Šæ–¹æ³•çš„14åŸåˆ™éƒ½æ²¡æœ‰æåˆ°â€œä»·å€¼â€è¿™ä¸¤ä¸ªå­—ã€‚<br>ä½†æ˜¯ï¼Œåœ¨ã€Šç²¾ç›Šæ€æƒ³ã€‹è¿›è¡Œäº†è¿™æ ·çš„æ€»ç»“ â€”â€” 5ä¸ªåŸåˆ™ï¼š</li></ol><blockquote><p>ç²¾ç¡®åœ°å®šä¹‰ç‰¹æ€§äº§å“çš„ä»·å€¼ï¼›<br>è¯†åˆ«å‡ºæ¯ç§äº§å“çš„ä»·å€¼æµï¼›<br>ä½¿ä»·å€¼ä¸é—´æ–­åœ°æµåŠ¨ï¼›<br>è®©å®¢æˆ·ä»ç”Ÿäº§è€…æ–¹é¢æ‹‰åŠ¨ä»·å€¼ï¼›<br>æ°¸è¿œè¿½æ±‚å°½å–„å°½ç¾ã€‚</p></blockquote><p>ä»å‰ä¸¤ç»„æ¦‚å¿µ â€”â€” æ•æ·å’Œæ•æ·é¡¹ç›®ç®¡ç†ï¼Œæ¥ç›´æ¥è¿½æº¯ä»·å€¼äº¤ä»˜ï¼Œçœ‹èµ·æ¥æ€»æ˜¯æœ‰äº›åˆ»æ„ã€‚<br>è€Œç²¾ç›Šæ€æƒ³çš„ç¬¬ä¸€åŸåˆ™â€œç²¾ç¡®åœ°å®šä¹‰ç‰¹æ€§äº§å“çš„ä»·å€¼â€ï¼Œç›´æ¥ä»ç”¨æˆ·å—ä¼—çš„è§’åº¦å…¥æ‰‹ï¼Œå°±çœ‹èµ·æ¥ç›´è§‚çš„å¤šï¼Œå› æ­¤æˆ‘è¿™é‡Œå°±ç›´æ¥ä»ç²¾ç›Šæ¥çœ‹ä»·å€¼äº¤ä»˜æ˜¯ä»€ä¹ˆã€‚</p><h3 id="1-1-ä»·å€¼äº¤ä»˜çš„å…·è±¡äº§å‡ºéƒ¨åˆ†-â€”â€”-äº§å“">1.1. ä»·å€¼äº¤ä»˜çš„å…·è±¡äº§å‡ºéƒ¨åˆ† â€”â€” äº§å“</h3><p>è¯´åˆ°ç²¾ç›Šï¼Œå¦‚æœç”¨ä¸€å¥è¯æ¥æè¿°å®ƒæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„è¯ï¼Œé‚£åº”è¯¥æ˜¯ï¼š<code>æœç»æµªè´¹ï¼Œé™æœ¬å¢æ•ˆã€‚</code><br>å½“ç„¶ï¼Œå¦‚æœæåˆ°å®ƒè¯ç”Ÿçš„èƒŒæ™¯çš„è¯ï¼Œå®ƒè§£å†³äº†å·¥ä¸šåŒ–å¤§ç”Ÿäº§ä¸­çš„æå‰æ‰¹é‡æ€§ç”Ÿäº§ã€ç”Ÿäº§æ—¶é—´å‘¨æœŸè¿‡é•¿ã€ç”Ÿäº§å¯é¢„æµ‹æ€§ä¸å‡†ç­‰é—®é¢˜ï¼Œä½†è§£å†³é—®é¢˜çš„ç»ˆææ€è·¯å°±æ˜¯ï¼š<code>åœ¨ä¿è¯ä»·å€¼çš„åŒæ—¶ï¼ŒæŒç»­ä¸æ–­ã€ç¨³å®šåœ°æ¶ˆé™¤æµªè´¹ï¼Œä»è€Œé™ä½æˆæœ¬æå‡æ•ˆèƒ½ã€‚</code></p><p>è¯´åˆ°â€œæµªè´¹â€ï¼šä¸°ç”°æ¨¡å¼ä¸­ï¼Œå°†ç”Ÿäº§æ´»åŠ¨ä¸­çš„å„ç¯èŠ‚åˆ†ä¸º3ç±»æ­¥éª¤ï¼š</p><ul><li>æ˜ç¡®èƒ½åˆ›é€ ä»·å€¼çš„æ­¥éª¤</li><li>è™½ç„¶ä¸èƒ½åˆ›é€ ä»·å€¼ï¼Œä½†æ˜¯åœ¨ç°æœ‰æŠ€æœ¯å’Œç”Ÿäº§æ¡ä»¶ä¸‹ä¸å¯é¿å…çš„æ­¥éª¤ï¼ˆ<strong>1å‹æµªè´¹</strong>ï¼‰</li><li>ä¸åˆ›é€ ä»·å€¼ï¼Œå¹¶ä¸”å¯ä»¥å»æ‰çš„æ­¥éª¤ï¼ˆ<strong>2å‹æµªè´¹</strong>ï¼‰<br>é’ˆå¯¹äº§å“åˆ¶é€ çš„ç¬¬ä¸€è¦åŠ¡å°±æ˜¯é¦–å…ˆå®šä¹‰ä»·å€¼ï¼Œä»è€Œè¯†åˆ«æ•´ä¸ªç”Ÿäº§æ´»åŠ¨ä¸­èƒ½å¤Ÿåˆ›é€ ä»·å€¼çš„æ­¥éª¤ã€1å‹æµªè´¹å’Œ2å‹æµªè´¹ã€‚ç„¶åæ¶ˆé™¤2å‹æµªè´¹ï¼Œå¹¶å°†1å‹æµªè´¹é€æ¸è½¬åŒ–æˆ2å‹æµªè´¹ä»æ¥æœ€ç»ˆæ¶ˆé™¤ã€‚</li></ul><h4 id="1-1-1-é¦–å…ˆå®šä¹‰ä»·å€¼">1.1.1 é¦–å…ˆå®šä¹‰ä»·å€¼</h4><p><img src="/2020/02/08/cong-jing-yi-lai-kan-jie-zhi-jiao-fu-shi-shi-me/value.png" alt="ä»·å€¼"></p><p>åŒæ ·çš„é“ç†ï¼Œåœ¨è½¯ä»¶äº¤ä»˜ä¸­ï¼Œé¦–å…ˆçš„å‡ºå‘ç‚¹å°±æ˜¯ä»·å€¼ï¼Œå¹¶ä¸æ˜¯ä¸€å †ä¸€å †çš„åŠŸèƒ½é›†ã€features æˆ–è€… çœ‹èµ·æ¥éå¸¸ fashion ä½†ä¸è§£å†³è‡ªèº«é—®é¢˜çš„å‰æ²¿æ–¹æ¡ˆã€‚</p><p>ç„¶è€Œæ— è®ºæ˜¯åˆ¶é€ ä¸šè¿˜æ˜¯è½¯ä»¶ä¸šï¼Œä»·å€¼åªèƒ½ç”±äº§å“çš„ä½¿ç”¨è€… â€”â€” æœ€ç»ˆç”¨æˆ·æ¥ç¡®å®šã€‚<br>ä¸€èˆ¬åœ¨äº¤ä»˜å›¢é˜Ÿä¸­ï¼Œä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å®¢æˆ·å°±æ˜¯ç”¨æˆ·</li><li>å®¢æˆ·åªæ˜¯å°è¯•è®¾è®¡äº§å“ï¼Œç”¨æˆ·æ˜¯å¦å¤–çš„ç¾¤ä½“ã€‚<br>åœ¨å®¢æˆ·ä¸æ˜¯ç”¨æˆ·çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå®¢æˆ·å¹¶æ²¡æœ‰æ”¶é›†å’Œåˆ†æç”¨æˆ·çš„çœŸå®éœ€æ±‚ï¼Œæ•´ä¸ªäº¤ä»˜è¿‡ç¨‹å°±ä¼šå˜æˆ â€”â€” æå‰ç”Ÿäº§ã€æ²¡æœ‰ä»¥éœ€æ±‚æ¥æ‹‰åŠ¨ç”Ÿäº§ï¼Œæœ€ç»ˆä»·å€¼äº¤ä»˜ç‰©æ˜¯å¦èƒ½äº§ç”Ÿä»·å€¼åªèƒ½å‡­ç„å­¦çš„åœ°æ­¥ã€‚ä¸€æ—¦ä¸èƒ½äº§ç”Ÿä»·å€¼ï¼Œå°±å˜æˆäº†æœ€å¤§çš„æµªè´¹ã€‚<br><img src="/2020/02/08/cong-jing-yi-lai-kan-jie-zhi-jiao-fu-shi-shi-me/pull-push.png" alt="ç”¨æˆ·æ‹‰åŠ¨ vs æå‰ç”Ÿäº§åæ¨åŠ¨"></li></ul><p>äº¤ä»˜ä»·å€¼ï¼Œåªæœ‰åœ¨ç”¨ â€”â€” <code>å…·æœ‰ç‰¹å®šä»·æ ¼ã€èƒ½åœ¨ç‰¹å®šæ—¶é—´å†…æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„ç‰¹å®šäº§å“</code>ï¼ˆæ— è®ºå•†å“æˆ–è€…æœåŠ¡ï¼‰æ¥è¡¨è¾¾æ—¶æ‰æœ‰æ„ä¹‰ã€‚<br>æ‰€ä»¥ï¼Œåœ¨äº¤ä»˜ä¹‹å‰ï¼Œå…ˆç¡®å®šäº§å“çš„ä»·å€¼ â€”â€” å¼€å‘çš„äººåŠ›æˆæœ¬ã€æ—¶é—´æˆæœ¬ã€æœºä¼šæˆæœ¬ï¼Œå’Œæœ€é‡è¦çš„ä¸€ç‚¹ â€”â€” è¿™æ˜¯å¦è§£å†³äº†ç”¨æˆ·çš„çœŸå®é—®é¢˜å—ï¼Ÿä»¥åŠæ˜¯å¦â€œæ›´å¥½åœ°â€è§£å†³äº†ç”¨æˆ·çš„çœŸå®é—®é¢˜ï¼Ÿ<br>ä¸ºä»€ä¹ˆè¿™é‡Œæœ‰â€œæ›´å¥½åœ°â€ä¸€è¯´ï¼Ÿ<br>å°±æ¯”å¦‚åŒæ ·æ˜¯å‘˜å·¥æ‰“å¡ç³»ç»Ÿï¼Œåœ¨å¼€å‘å„æˆæœ¬æŠ•å…¥äº§å‡ºæ¯”ç›¸ä¼¼çš„æƒ…å†µä¸‹ï¼Œä¸ŠAIäººè„¸è¯†åˆ« â€”â€” è‡ªç„¶æ˜¯æ¯”æ‰‹å·¥ç­¾åˆ°çš„ä»·å€¼è¦å¤§çš„ã€‚</p><p>ä¹Ÿè®¸æœ‰äººä¼šè¯´ï¼Œâ€œæˆ‘ä»¬ä½¿ç”¨æ•æ·ï¼Œå°±æ˜¯å› ä¸ºå½“ä¸‹æ— æ³•å®šä¹‰å‡ºæ˜ç¡®äº§ç”Ÿä»·å€¼çš„éœ€æ±‚ï¼Œæ‰ä½¿ç”¨æ•æ·è½¯ä»¶äº¤ä»˜ â€”â€” å®ç°å¢é‡æ€§å‘å¸ƒã€å¿«é€Ÿå®éªŒå’Œåé¦ˆã€‚â€<br>è¿™é‡Œè¦åˆ†ä¸¤ç§æƒ…å†µæ¥çœ‹è¿™ä¸ªé—®é¢˜ï¼š</p><ul><li>ç¬¬ä¸€ç§æƒ…å†µï¼šåªæ˜¯çŸ­è§†çš„ä¸€ç§å€Ÿå£ã€‚æ‡’äºã€æˆ–è€…èƒ½åŠ›ä¸è¶³ç›´æ¥æ”¾å¼ƒåŠªåŠ›ï¼Œé€ æˆæ— æ³•é€šè¿‡é—®é¢˜æ”¶é›†ã€éœ€æ±‚åˆ†æå’Œå•†ä¸šæ´è§å¯¹å„ç§ä¸šåŠ¡æ–¹æ¡ˆè¿›è¡Œè¿‡æ»¤ï¼Œä»æºå¤´ä¸Šå°±å¼€å§‹äº§ç”Ÿè½¯ä»¶å¼€å‘çš„å¤§é‡æµªè´¹ã€‚</li><li>ç¬¬äºŒç§æƒ…å†µï¼šå·²ç»æœ‰äº†éœ€æ±‚æ”¶é›†å’Œåˆ†ææ¸ é“ï¼Œä½†è¡Œä¸šæ–¹æ¡ˆè¾ƒæ–°ï¼Œæ— æ³•å®Œå…¨é¿å…äº§å“å®éªŒå¼€å‘çš„æµªè´¹ã€‚è¿™ç§ï¼Œåœ¨æ›´ä¸‹æ¸¸ã€æ›´é è¿‘ç”¨æˆ·çš„åœ°æ–¹ï¼Œæ˜¯å¦å»ºç«‹äº†æœ‰æ•ˆçš„ç”¨æˆ·åé¦ˆã€ä»·å€¼è¿½è¸ªå’Œæ ¸å®šæœºåˆ¶ â€”â€” å®éªŒçš„æ•ˆæœæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œç”Ÿæˆäº†å“ªäº›ä»·å€¼ï¼Œæ˜¯å¦å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°é€æ¸å½¢æˆä»·å€¼å®šä¹‰ï¼Ÿ</li></ul><p>å®ç°å®Œä»·å€¼å®šä¹‰ä¹‹åï¼Œæˆ‘ä»¬é’ˆå¯¹å½“å‰ä»·å€¼å®šä¹‰æ¥çœ‹çœ‹â€œäº¤ä»˜â€è¿™ä¸ªåŠ¨ä½œã€‚</p><h4 id="1-1-2-ä»éœ€æ±‚åˆ°äº§å“çš„å¿«é€Ÿç ”å‘èƒ½åŠ›">1.1.2. ä»éœ€æ±‚åˆ°äº§å“çš„å¿«é€Ÿç ”å‘èƒ½åŠ›</h4><h5 id="â€œè¯†åˆ«å‡ºæ¯ç§äº§å“çš„ä»·å€¼æµâ€">â€œè¯†åˆ«å‡ºæ¯ç§äº§å“çš„ä»·å€¼æµâ€</h5><p>ç”¨è¿‡ Scrum æˆ–è€… Kanban board çš„äººåº”è¯¥éƒ½ç†è§£ï¼Œä¸€å¼ å¡ï¼ˆæ— è®º EPIC å¡è¿˜æ˜¯ story å¡ï¼‰ï¼Œå…¶æ‰¿è½½çš„å°±æ˜¯ä¸€ä¸ªä»·å€¼ç‚¹ï¼ˆè¿™é‡Œä¸æ¶‰åŠåˆ°ä¼°ç®—ï¼‰ã€‚</p><p>è€Œå°† board ä¸Šçš„å„ä¸ª columns å¯¹åº”çš„æ­¥éª¤è¿æ¥èµ·æ¥ï¼Œå…¶å®å°±ç»„æˆäº†å®Œæˆæ­¤ç±»å¡çš„ä¸€æ¡ç²—ç²’åº¦çš„â€œä»·å€¼æµâ€ã€‚å…¶ä¸­ï¼Œæœ‰äº§ç”Ÿä»·å€¼çš„In Devã€In QAç­‰ï¼Œä¹Ÿæœ‰1å‹æµªè´¹Dev Done / Ready for QA ç­‰ç­‰ï¼Œå½“ç„¶ä¸ªåˆ«å›¢é˜Ÿå¯èƒ½è¿˜å­˜åœ¨2å‹æµªè´¹çš„ columnsã€‚<br>ä»·å€¼æµçš„ç›®æ ‡å°±æ˜¯è®©å›¢é˜Ÿè¯†åˆ«å‡ºæµç¨‹æ­¥éª¤ï¼Œä¸ºä¹‹åæ¶ˆé™¤è¿™äº›æµªè´¹åšå‡†å¤‡ï¼Œæœ€ç»ˆé™ä½å¼€å‘æˆæœ¬ã€ç¼©çŸ­lead timeã€‚<br>é‚£ä»è¿™ç§ç²—ç²’åº¦çš„â€ä»·å€¼æµâ€œä¸­å¦‚ä½•é€æ¸æš´éœ²æµªè´¹å’Œæ‰§è¡Œæ”¹è¿›å‘¢ï¼Ÿ</p><h5 id="â€œä½¿ä»·å€¼ä¸é—´æ–­åœ°æµåŠ¨â€">â€œä½¿ä»·å€¼ä¸é—´æ–­åœ°æµåŠ¨â€</h5><p>ä¹Ÿè®¸æœ‰äººä¼šè§‰å¾—è¿™å¥è¯ç†è§£èµ·æ¥å¾ˆéš¾ï¼Œå…¶å®åœ¨éƒ¨åˆ†å›¢é˜Ÿå†…éå¸¸å¸¸è§ã€‚<br>æ¯”å¦‚ï¼šè§è¿‡ä¸€äº›å®¢æˆ·å›¢é˜Ÿï¼Œæ‰€æœ‰ story çš„å¼€å‘åªè¦å¼€å‘äººå‘˜å¼€å‘å®Œæ¯•ï¼Œå°±æ¨è¿›Dev Done column ä¸­ï¼Œç­‰åˆ°æ•´ä½“åŠŸèƒ½å¼€å‘çš„å·®ä¸å¤šäº†ï¼Œæ‰å¼•å…¥ QA æ¥å¼€å§‹æµ‹è¯•ï¼Œåœ¨æ­¤ä¹‹å‰ QA èµ„æºå¯èƒ½åœ¨å¿™äºå¦ä¸€ä¸ªå›¢é˜Ÿçš„æµ‹è¯•å·¥ä½œã€‚ä¸€ç§ç±»ä¼¼åˆ¶é€ ä¸šæ‰¹é‡åŒ–ç”Ÿäº§çš„æ¨¡å¼ï¼Œç”Ÿäº§æ­¥éª¤ä¹‹é—´å­˜åœ¨å¤§é‡åº“å­˜ï¼Œæ‰¹é‡æ»¡é¢ä¹‹åï¼Œæ‰ä¼šæ¨è¿›åˆ°ä¸‹ä¸€ä¸ªç”Ÿäº§ç¯èŠ‚ã€‚<br>ä¹Ÿæœ‰ä¸€äº›æ•æ·å›¢é˜Ÿï¼Œç”±äº QA èµ„æºä¸è¶³ï¼Œå‡ºç°ç›¸åŒçš„Dev Doneä¹‹ååœ¨Ready for QAä¸­å½¢æˆæ‰¹é‡ç­‰å¾…ï¼Œå§‹ç»ˆæ— äººè§£å†³ï¼Œç”šè‡³å¤§å®¶å¯¹æ­¤å·²ç»ä¹ ä»¥ä¸ºå¸¸ â€”â€” QAä¼šåœ¨ä¸‹ä¸€ä¸ªsprintæ•´ä½“æµ‹è¯•è¿™æ‰¹å¡ã€‚<br>â€œä½¿ä»·å€¼ä¸é—´æ–­åœ°æµåŠ¨â€ï¼Œå…¶å®ä¸ä»…æ˜¯è¡ŒåŠ¨ã€æ›´æ˜¯ä»æ€æƒ³å’Œæ„è¯†ä¸Šè®¤è¯†åˆ° â€”â€” ä»·å€¼è¦æµåŠ¨èµ·æ¥ã€‚å°±åƒæœ€åé‚£äº›æ•æ·å›¢é˜Ÿçš„ä¾‹å­ï¼Œå³ä½¿ä½¿ç”¨äº†æ•æ·æµç¨‹å’Œå·¥å…·ï¼Œæ€æƒ³å’Œæ„è¯†ä¸åˆ°ä½ï¼Œä¾ç„¶ç”¨å‡ºäº†æ‰¹é‡çš„æ ·å­ã€‚</p><p>æœ‰äººä¼šè¯´ï¼šâ€œè¿™ç§æ‰¹é‡æœ‰ä»€ä¹ˆä¸å¥½ï¼Ÿå›¢é˜Ÿä¸Šæ‰€æœ‰çš„äººéƒ½åœ¨å·¥ä½œï¼Œå¹¶æ²¡æœ‰ç©ºè½¬ï¼ŒäººåŠ›æ²¡æœ‰è¢«æµªè´¹ã€‚â€œ<br>å¦‚æœä¸€å®šè¦ä»é¡¹ç›®äººåŠ›è¿è¥çš„çŸ¥è¯†åŸŸä¸­æ¥çœ‹ä»·å€¼äº¤ä»˜ï¼Œæˆ‘åªæƒ³è¯´ï¼šæ˜¯çš„ï¼Œå¤§å®¶çœ‹èµ·æ¥éƒ½å¿™å¿™ç¢Œç¢Œï¼Œè¡Œè‰²åŒ†åŒ†ï¼ŒåŠªåŠ›â€œåšäº‹â€ï¼Œä½†æ˜¯äººåŠ›èŠ±å®Œå°±ä»£è¡¨åˆ›é€ äº†ä»·å€¼ä¹ˆï¼Ÿ<br>å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä¹Ÿå¯ä»¥ä»â€æµ‹è¯•å‰ç½®â€œã€â€ä¸€æ¬¡æ€§æŠŠäº‹æƒ…åšå¥½â€œã€â€ç¼ºé™·è¶Šæ™šä¿®å¤ï¼Œä¿®å¤çš„æˆæœ¬è¶Šé«˜â€œã€â€å¼€å‘å‘¨æœŸè¶Šé•¿ï¼Œè¶Šå®¹æ˜“è¿”å·¥â€œç­‰ç­‰æ–¹é¢æ¥èŠä¸€èŠä¸å…³æ³¨ä»·å€¼æµä¼šé€ æˆçš„ç§ç§äººåŠ›æˆæœ¬ã€æ—¶é—´æˆæœ¬ã€æœºä¼šæˆæœ¬ä¸Šçš„æµªè´¹ã€‚</p><p>åªæœ‰è®©ä»·å€¼å°½é‡ä¸é—´æ–­åœ°æµåŠ¨èµ·æ¥ï¼Œä»éœ€æ±‚åˆ°ç”Ÿäº§ï¼Œæ‰ä¼šæš´éœ²é—®é¢˜ â€”â€” è®©å›¢é˜Ÿè§‚å¯Ÿå’Œæ€è€ƒè¿™ç§ç«¯åˆ°ç«¯çš„æ•´æ¡ä»·å€¼ç”Ÿäº§æ´»åŠ¨ä¸­ï¼Œå“ªäº›æ˜¯äº§ç”Ÿä»·å€¼çš„ï¼Œå“ªäº›æ˜¯æµªè´¹ï¼ŸæŒç»­åœ°é€æ¸ä¼˜åŒ–å’Œæ¶ˆé™¤æµªè´¹åï¼Œé™ä½å¼€å‘æˆæœ¬ã€æå‡ç ”å‘æ•ˆèƒ½ã€‚</p><h5 id="â€œè®©å®¢æˆ·ä»ç”Ÿäº§è€…æ–¹é¢æ‹‰åŠ¨ä»·å€¼â€">â€œè®©å®¢æˆ·ä»ç”Ÿäº§è€…æ–¹é¢æ‹‰åŠ¨ä»·å€¼â€</h5><p>å½“ç ”å‘æ•ˆèƒ½æå‡ã€å•ä¸ªä»·å€¼ç‚¹èƒ½è¢«å¿«é€Ÿå®Œæˆç«¯åˆ°ç«¯äº¤ä»˜æ—¶ï¼Œæå‰é¢„æµ‹æ€§è´¨çš„åŠŸèƒ½è®¾è®¡ï¼ˆæ˜¯å¦èƒ½æœ€ç»ˆäº§ç”Ÿä»·å€¼é ç„å­¦çš„é‚£ç§ï¼‰å°±å¯ä»¥å®Œå…¨è¢«é¿å…ï¼Œç”±æœ€ä¸‹æ¸¸çš„ç»ˆç«¯ç”¨æˆ·ç›´æ¥æå‡ºéœ€æ±‚ï¼Œä»æ¥æ‹‰åŠ¨äº¤ä»˜ã€‚</p><h4 id="1-1-3-æ–¹æ¡ˆã€æŠ€æœ¯å…ˆè¿›æ€§çš„åŠ æŒ">1.1.3 æ–¹æ¡ˆã€æŠ€æœ¯å…ˆè¿›æ€§çš„åŠ æŒ</h4><p>åœ¨å‰é¢æˆ‘è®²boardä¸Šé¢çš„ä»·å€¼æµçš„æ—¶å€™ï¼Œå§‹ç»ˆç‰¹æŒ‡å…¶æ˜¯â€ç²—ç²’åº¦â€œçš„ä»·å€¼æµã€‚<br>ä¸ºä½•ï¼Ÿ<br>å› ä¸ºæ— æ³•ä»è¿™äº›columnsä¸­çœ‹åˆ°ï¼šç”¨Aæ¡†æ¶å¼€å‘ä¼šæ¯”BèŠ‚çœå¤šå°‘å¼€å‘æˆæœ¬ã€ä½¿ç”¨æŸä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆå¯ä»¥èŠ‚çœå¤šå°‘æµ‹è¯•æˆæœ¬ï¼Œè¯¸å¦‚æ­¤ç±»çš„â€œç»†ç²’åº¦â€çš„ä»·å€¼æµæ‰ä¼šå‘ç°çš„æµªè´¹å¯¹æ¯”ã€‚<br>è¿™ç§æ—¶å€™ï¼Œå„å›¢é˜Ÿé¢ä¸´çš„é—®é¢˜å„ä¸ç›¸åŒï¼Œéœ€è¦å›¢é˜Ÿä¸€çº¿äººå‘˜è‡ªèº«çš„æ–¹æ¡ˆå’ŒæŠ€æœ¯èƒ½åŠ›å»æ‰©å±•ä¼˜åŠ¿ã€æ¶ˆé™¤æµªè´¹ï¼Œä¸å†å±€é™äºæ•æ·è½¯ä»¶å¼€å‘æµç¨‹ã€scrum / kanban boardæ¥å®è§‚æŒ‡å¯¼å’Œæè¿°å¼€å‘æµç¨‹ã€‚</p><p>è¿™é‡Œå°±æ¶‰åŠåˆ°ç²¾ç›Šæ€æƒ³çš„æœ€åä¸€ä¸ªåŸåˆ™ï¼š<em>â€œæ°¸è¿œè¿½æ±‚å°½å–„å°½ç¾â€</em>ã€‚</p><h3 id="1-2-ä»·å€¼äº¤ä»˜çš„åœŸå£¤-â€”â€”-å›¢é˜Ÿèƒ½åŠ›-å­¦ä¹ å‹ç»„ç»‡">1.2. ä»·å€¼äº¤ä»˜çš„åœŸå£¤ â€”â€” å›¢é˜Ÿèƒ½åŠ› / å­¦ä¹ å‹ç»„ç»‡</h3><p>ç²¾ç›Šæ€æƒ³å‰å››å¤§åŸåˆ™éƒ½åªæ˜¯åœ¨è®² â€”â€” å¦‚ä½•æ¶ˆé™¤äº§å“ç”Ÿäº§è¿‡ç¨‹çš„æµªè´¹ï¼Œæœ€ç»ˆå½¢æˆé«˜æ•ˆæœ‰ä»·å€¼çš„ç”Ÿäº§æµç¨‹ã€‚ä¸€èˆ¬å®Œæˆå‰å››åŸåˆ™ï¼ŒåŸºæœ¬å¯ä»¥æ”¶è· <code>çªç ´æ€§æ”¹å–„</code>ï¼ˆæŒ‡åˆæ¬¡æ”¹é©ï¼Œè°ƒæ•´ç”Ÿäº§æ´»åŠ¨åï¼Œä¸€æ¬¡æ€§è·å–åˆ°çš„æ”¹å–„æ•ˆæœï¼‰ã€‚<br>ç²¾ç›Šæ€æƒ³ç”¨æœ€åä¸€ä¸ªåŸåˆ™<code>â€œæ°¸è¿œè¿½æ±‚å°½å–„å°½ç¾â€</code>ï¼Œæ‰æåˆ°äº†å¦‚ä½• <code>æŒç»­æ€§æ”¹å–„</code> ã€‚</p><p>è€Œã€Šä¸°ç”°æ¨¡å¼ã€‹ç”¨äº†ä¸€æ•´æœ¬ä¹¦ï¼Œæ¥è®²å¦‚ä½•å®ç°â€œè¿½æ±‚å°½å–„å°½ç¾â€ã€å®ç°â€œæŒç»­æ€§æ”¹å–„â€ â€”â€” å³ä½¿å®Œæˆäº†å‰é¢å››ä¸ªåŸåˆ™ï¼Œæˆ–ç”¨äº†å¤§é‡çš„ç²¾ç›Šå·¥å…·å’Œå®è·µï¼Œåªè¦æ²¡è¾¾åˆ°ä¸€ç‚¹ï¼Œå°±ä¸æ˜¯ç²¾ç›Šã€‚ç²¾ç›Š â€”â€” <code>æ‰“é€ ä¸€ä¸ªçœŸæ­£çš„å­¦ä¹ å‹ç»„ç»‡ã€‚</code></p><p>è¿™ä¸ªâ€œå­¦ä¹ å‹ç»„ç»‡â€ï¼Œä¸æ˜¯è¯´ â€”â€” åªæ˜¯åœ¨ç»„ç»‡å†…åŸ¹å…»å­¦ä¹ æ°›å›´ï¼Œä»Šå¤©å»å­¦å‡ ç§å¯¹ä»·å€¼æµæ¯«æ— å¸®åŠ©çš„è¯­è¨€æˆ–æ¶æ„ï¼Œæ˜å¤©å»åšä¸€äº›å¯¹å½“å‰ä¸»ä¸šåŠ¡æ¯«æ— æ‰©å±•çš„ç¤¾åŒºæ´»åŠ¨ã€‚ä¹Ÿä¸æ˜¯è¯´ï¼Œå½“æŸä¸ªå›¢é˜Ÿéœ€è¦ä¸€ä¸ªå¤§æ•°æ®å·¥ç¨‹å¸ˆæ—¶ï¼Œéœ€è¦ä»é›¶å¼€å§‹åŸ¹å…»ï¼Œå½“ç¬¬äºŒä¸ªå›¢é˜Ÿåˆéœ€è¦ä¸€ä¸ªå¤§æ•°æ®å·¥ç¨‹å¸ˆæ—¶ï¼Œå†æ¬¡å¦å¤–åŸ¹å…»ã€‚<br>è€Œæ˜¯è¯´ â€”â€” åŸ¹å…»å­¦ä¹ æ°›å›´ã€è¿‡ç¨‹ä¸­ä¸æ–­åˆ›å»ºâ€œæ ‡å‡†åŒ–â€ä»¥è¾¾åˆ°â€œç¨³å®šâ€ï¼Œç„¶åè®©æˆå‘˜å‘æŒ¥åˆ›é€ æ€§æ€ç»´å’Œåˆ›æ–°èƒ½åŠ›ä»¥æŒç»­æ”¹è¿›ä»·å€¼æµçš„ç»„ç»‡ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´â€œå›¢é˜Ÿèƒ½åŠ›/å­¦ä¹ å‹ç»„ç»‡â€æ˜¯ä»·å€¼äº¤ä»˜çš„åœŸå£¤å‘¢ï¼Ÿ<br>å‡è®¾æŸå›¢é˜Ÿå‰å››åŸåˆ™èƒŒåçš„å·¥ä½œå¹¶ä¸æ˜¯å›¢é˜Ÿè‡ªå‘å½¢æˆå®Œæˆçš„ï¼Œæ˜¯ç”±ä¸€ä¸ªå¤–éƒ¨äººå‘˜å¼•å…¥å¹¶ç£ä¿ƒå®è·µå®Œæˆï¼Œæœ¬å›¢é˜Ÿå¹¶æ²¡æœ‰æŒæ¡å…¶èƒ½åŠ›ã€‚å½“ç”¨æˆ·éœ€æ±‚æ‹‰åŠ¨ç”Ÿäº§è¶Šæ¥è¶Šå¿«æ—¶ï¼Œå¿…ç„¶ä¼šæš´éœ²è¿›ä¸€æ­¥éœ€è¦è§£å†³çš„ç“¶é¢ˆå’Œæµªè´¹ï¼Œè¿™æ—¶å€™å›¢é˜Ÿç¦»å¼€äº†å¤–éƒ¨äººå‘˜æ ¹æœ¬æ— åŠ›ç»§ç»­æŒç»­æ”¹è¿›ä»è€Œç¨³å®šäº¤ä»˜ä»·å€¼ã€‚</p><p>ä¸ºäº†çœŸæ­£å®ç°ç²¾ç›Šçš„æŒä¹…æ€§æ”¹å–„å’Œä»·å€¼äº¤ä»˜ï¼Œè¿™éœ€è¦ä¸€ä¸ªè‡ªä¸‹è€Œä¸Šçš„è¿‡ç¨‹ã€‚<br>ä»…é ä¸Šçº§åˆ¶å®šå‡ ä¸ªè¡¡é‡æŒ‡æ ‡ï¼Œæ²¡æœ‰åŸ¹å…»å›¢é˜Ÿçš„å­¦ä¹ å’Œè‡ªç»„ç»‡èƒ½åŠ›ï¼Œä½ æ°¸è¿œä¹Ÿæƒ³åƒä¸åˆ°çœŸæ­£å®è·µæ—¶ä¼šé•¿æˆä»€ä¹ˆæ ·å­ã€‚<br>å°†å›¢é˜Ÿçš„æŒ‡æ ‡å‘ˆç°æƒ³åƒæˆåœ°ä¸Šçš„æ ‘ï¼Œå¦‚ä¸‹å›¾ã€‚<br>ä¸Šçº§ä¹Ÿè®¸æœŸæœ›æ˜¯æ‰æ ¹ä»·å€¼äº¤ä»˜ã€æŒç»­æ€§æ”¹è¿›æŒ‡æ ‡èƒŒåçš„é—®é¢˜ã€‚ä½†å›¢é˜Ÿä¹Ÿè®¸åªæ˜¯åšäº†ä¸€äº›æµäºè¡¨é¢çš„å·¥ä½œè®©æŒ‡æ ‡å˜å¾—å¥½çœ‹ã€‚<br><img src="/2020/02/08/cong-jing-yi-lai-kan-jie-zhi-jiao-fu-shi-shi-me/how-tree-grow.png" alt="ä½ ä»¥ä¸ºå’Œå®é™…çš„åŒºåˆ«"></p><h2 id="2-æœ€å">2. æœ€å</h2><p>ä½•ä¸ºä»·å€¼äº¤ä»˜ï¼Ÿ<br>ä»¥æ‰“é€ å­¦ä¹ å‹ç»„ç»‡æˆ–å›¢é˜Ÿä¸ºåŸºçŸ³ â€”â€” ç²¾ç¡®å®šä¹‰äº§å“ç”¨æˆ·ä»·å€¼ï¼Œå°½å¯èƒ½ä»¥è¿½æ±‚ä»·å€¼å“è¶Šä¸ºç›®æ ‡ï¼Œä»éœ€æ±‚æå‡ºå¼€å§‹åˆ°äº§å“ä¸Šçº¿è¢«ç»ˆç«¯ä½¿ç”¨ï¼ŒæŒç»­æ¶ˆé™¤æˆ–è€…å‡å°‘é˜»ç¢äº§å“ç ”å‘çš„æµªè´¹ï¼Œæœ€ç»ˆå®ç°äº§å“ä»·å€¼ã€‚</p><p>çœ‹èµ·æ¥ï¼Œç²¾ç›Šè´¯ç©¿å§‹ç»ˆã€‚<br>å†å›æ¥çœ‹çœ‹ã€Šæ•æ·å®£è¨€ã€‹å’Œã€Šç›¸äº’ä¾èµ–å£°æ˜ã€‹ï¼Œå‘ç°å’Œç²¾ç›Šå¾ˆå¤šæ–¹é¢éƒ½å¾ˆç›¸ä¼¼ã€‚åªä¸è¿‡åœ¨æˆ‘çœ‹æ¥ï¼Œç²¾ç›Šå¯ä»¥æ›´å¥½çš„ç«¯åˆ°ç«¯æè¿°æ•´ä¸ªä»·å€¼æµæ€è·¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•æ·ç²¾ç›Šè½¯ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»·å€¼äº¤ä»˜ </tag>
            
            <tag> ç²¾ç›Š </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆè¶Šèº«å¤„å›¢é˜Ÿè¶Šéš¾æ”¹è¿›</title>
      <link href="/2020/01/16/wei-shi-me-yue-shen-chu-tuan-dui-yue-nan-gai-jin/"/>
      <url>/2020/01/16/wei-shi-me-yue-shen-chu-tuan-dui-yue-nan-gai-jin/</url>
      
        <content type="html"><![CDATA[<p>â€œä¸ºä»€ä¹ˆè¶Šèº«å¤„å›¢é˜Ÿè¶Šéš¾æ”¹è¿›ï¼Ÿâ€</p><p>æœ€å¼€å§‹æˆ‘æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œé‚£æ—¶å€™æˆ‘è¯»äº†ä¸€æœ¬å«ã€Šå’¨è¯¢çš„å¥¥ç§˜ã€‹çš„ä¹¦ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªâ€œæ™®é›·æ–¯ç§‘ç‰¹è…Œé»„ç“œåŸåˆ™â€ã€‚<br>å¥½å§ï¼Œä¸è¦è¾ƒçœŸï¼Œä¸è¦è®°ä½è¿™ä¸ªåˆ«æ‰­çš„åŸåˆ™åå­—ã€‚åå­—æ ¹æœ¬æ— å…³ç´§è¦ï¼Œè¿™æœ¬ä¹¦çš„é£æ ¼æ˜¯åœ¨è®²æ•…äº‹ï¼Œé‡Œé¢çš„åè¯å¤§éƒ¨åˆ†å¯¹åº”çš„æ•…äº‹å™äº‹ä¸»é¢˜ã€‚<br>è¿™ä¸ªåŸåˆ™çš„åå­—ï¼Œå¹¶æ²¡æœ‰åˆ†äº«æ€§ï¼Œæ›´æ²¡æœ‰Brookâ€™s Lawè¿™æ ·å¸¦æœ‰æ˜ç¡®çš„ç†è®ºä½“ç³»ã€‚<br>å› æ­¤ï¼Œæ¯æ¬¡æˆ‘æåˆ°å®ƒçš„æ—¶å€™ï¼Œåªè¯´æˆâ€œè…Œé»„ç“œåŸåˆ™â€ã€‚</p><span id="more"></span><h5 id="è…Œé»„ç“œåŸåˆ™">è…Œé»„ç“œåŸåˆ™</h5><p><em>æ•…äº‹å¤§ä½“æ˜¯è¿™æ ·çš„ï¼š</em></p><blockquote><p><em>ä»å‰æœ‰ä¸€æ ¹å€”å¼ºçš„é»„ç“œï¼Œè¢«æ™®é›·æ–¯ç§‘ç‰¹çˆ·çˆ·æ”¾åœ¨äº†å¤æ°´æ¡¶é‡Œã€‚å®ƒçœ‹äº†çœ‹å…¶ä»–çš„é»„ç“œï¼Œå¯¹å®ƒä»¬èº«ä¸Šå‘ç”Ÿçš„äº‹æƒ…ååˆ†åŒæ¶ã€‚</em><br><em>â€œçœŸæ˜¯è¦äº†å‘½äº†â€ï¼Œå®ƒéª‚é“ï¼Œâ€œä½ ä»¬è¿™å¸®é»„ç“œéƒ½æ€ä¹ˆå•¦ï¼Ÿä¸€ç‚¹éª¨æ°”éƒ½æ²¡äº†å—ï¼Ÿæœ‰è‡ªå°Šçš„é»„ç“œä¸ä¼šéšéšä¾¿ä¾¿ä¸ç»è¿‡æŠ—äº‰å°±è¢«è…Œäº†ã€‚â€</em><br><em>â€œé‚£æˆ‘ä»¬èƒ½åšå•¥å‘¢ï¼Ÿâ€é»„ç“œä»¬é—®åˆ°ã€‚</em><br><em>â€œä½ å¯ä»¥æŠµæŠ—å•Šï¼Œè¿™å°±æ˜¯ä½ èƒ½åšçš„ã€‚è¿™ä¹Ÿæ˜¯æˆ‘è¦åšçš„ï¼Œæˆ‘ä¸ä¼šè®©å¤æ°´è¿›å…¥æˆ‘çš„çš®è‚¤çš„ã€‚â€</em></p><p><em>è€Œè‹¥å¹²æ—¶é—´ä¹‹åï¼Œæ™®é›·æ–¯ç§‘ç‰¹çˆ·çˆ·çš„è…Œé»„ç“œå°±åšæˆäº†ã€‚</em><br><em>â€œå­©å­ï¼Œåˆ«å‚»äº†ã€‚å¦‚æœä½ åœ¨å¤æ°´é‡Œå‘†å¾—å¤Ÿä¹…ï¼Œå°±å˜æˆè…Œé»„ç“œäº†ã€‚â€</em></p></blockquote><p><em>è¿™ä¸ªæ•…äº‹çš„æœ€åï¼Œä¹¦ä¸­ç»™äº†ä¸€ä¸ªæ€»ç»“ï¼š</em></p><blockquote><p><em>é»„ç“œè¢«å¤æ°´è…Œçš„å¤šï¼Œå¤æ°´è¢«é»„ç“œæŸ“çš„å°‘ã€‚</em><br><em>å¦‚æœå°ç³»ç»Ÿè¯•å›¾é€šè¿‡é•¿æœŸå’ŒæŒç»­æ¥è§¦æ¥æ”¹å˜å¤§ç³»ç»Ÿï¼Œé‚£ä¹ˆæœ€åæ›´å¯èƒ½æ˜¯è‡ªå·±å‘ç”Ÿå˜åŒ–ã€‚</em></p></blockquote><p><em>æ‰€ä»¥ï¼Œä½œä¸ºå’¨è¯¢é¡¾é—®ï¼Œè¦æ—¶ä¸æ—¶åœ°è·³å‡ºå®¢æˆ·çš„ç¯å¢ƒï¼Œä¸è¦è®©è‡ªå·±è¢«â€œè…Œâ€ã€‚</em></p><p>çœ‹åˆ°è¿™ä¸€æ®µçš„æ—¶å€™ï¼Œæˆ‘æœ¬äººæ­£èº«å¤„äºç»å¯¹çš„äº¤ä»˜ä¸€çº¿ä¸­ï¼Œå¹¶ä¸èƒ½åƒå’¨è¯¢é¡¾é—®ä¸€æ ·ï¼Œæ—¶ä¸æ—¶è·³å‡ºé¡¹ç›®ç¯å¢ƒã€‚<br>å› æ­¤ï¼Œé‚£æ—¶å€™æˆ‘æ€»æ˜¯æ¸´æœ›æœ‰å‡ ä¸ªæ–°çš„â€œæ–°é²œé»„ç“œâ€œè¿›æ¥ï¼Œæ…åŠ¨è¿™æ¡¶å¤æ°´ï¼Œæˆ‘ä»¬è¿™äº›â€èº«æ®‹å¿ƒä¸æ®‹çš„é»„ç“œä»¬â€œä¹Ÿé¡ºåŠ¿å¯ä»¥åšä¸€äº›é¡¹ç›®å’Œå›¢é˜Ÿæ”¹è¿›çš„äº‹æƒ…ã€‚</p><p>ä¹Ÿè®¸æœ‰äººè¦é—®ï¼šâ€œä¸ºä»€ä¹ˆä¸æ¸´æœ›çš„æ˜¯ä¸€ä¸ªå¤–éƒ¨çš„å’¨è¯¢é¡¾é—®è¿‡æ¥ï¼Œæ…åŠ¨ä½ ä»¬ä»è€Œå®Œæˆæ”¹è¿›ï¼Ÿâ€<br>ä½œä¸ºä¸€ä¸ªä¸“ä¸šæœåŠ¡ä»¥åŠå’¨è¯¢å…¬å¸ä¸­çš„ä¸€å‘˜ï¼Œæˆ‘æ·±çŸ¥åœ¨æ‰€æœ‰çš„æ”¹è¿›å’ŒæŒç»­å®Œå–„ä¸­ï¼ŒçœŸæ­£èƒ½ä¾èµ–ã€æœ€åè½åœ°çš„ â€”â€” å…¶å®æ˜¯å†²åœ¨ä¸€çº¿çš„è¿™ä¸ªå›¢é˜Ÿæˆå‘˜ä»¬è‡ªèº«ã€‚<br>äºæ˜¯ï¼Œè¿™ä¸ªâ€œå¤æ°´æ•ˆåº”â€ï¼Œä»¿ä½›è®©è‡ªæˆ‘æ•‘èµå˜æˆäº†ä¸€ä¸ªä¸å¯èƒ½å®Œæˆçš„äº‹å®ã€‚</p><p>å†åæ¥çš„ä¸€æ®µæ—¶é—´ï¼Œæˆ‘çœŸçš„è·å–åˆ°äº†è·³å‡ºâ€œå¤æ°´â€çš„æœºä¼šï¼Œæ¥è§¦åˆ°äº†æœ‰æ„æ€çš„ç¯å¢ƒå’Œæœºä¼šã€‚å½“å†æ¬¡å›å¤´æ¥åšæ”¹è¿›çš„äº‹æƒ…çš„æ—¶å€™ï¼Œæˆ‘åˆè¯»åˆ°äº†ã€Šä¸°ç”°æ¨¡å¼ã€‹ã€‚<br>åœ¨å…¶â€œæ‹¨äº‘è§æ—¥â€ä¸­ï¼Œæåˆ°äº†äººç±»çš„é€‚åº”èƒ½åŠ›ã€‚</p><h5 id="äººç±»çš„é€‚åº”èƒ½åŠ›">äººç±»çš„é€‚åº”èƒ½åŠ›</h5><p><em>ä¹¦ä¸­æœ‰è¿™æ ·ä¸€æ®µï¼ˆæºè‡ªç« èŠ‚â€œæ‹¨äº‘è§æ—¥â€ï¼‰ï¼š</em></p><blockquote><p><em>ä¹ä¸€çœ‹åˆ°æŸä¸ªä½œä¸šæµç¨‹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°†æ‰€çœ‹åˆ°çš„æ™¯è±¡ä¸æœ‰ç›Šçš„æˆ–å¿…éœ€ï¼ˆåˆ›é€ ä»·å€¼ï¼‰çš„å·¥ä½œæ··ä¸ºä¸€è°ˆã€‚äººä»¬éƒ½åœ¨å¿™ç¢Œï¼Œä»–ä»¬è¡Œè‰²åŒ†åŒ†ï¼Œä»–ä»¬åŠªåŠ›â€œåšäº‹â€ï¼Œå› æ­¤çœ‹æ¸…ä»–ä»¬çš„çœŸå®çŠ¶æ€ç»éæ˜“äº‹ã€‚</em></p><p><em>å¦‚æœä½œä¸šæµç¨‹æ··ä¹±ä¸å ªï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¯¹çœŸå®çš„çŠ¶å†µã€ä»€ä¹ˆå¯ä»¥åšåˆ°åŠä»€ä¹ˆä¸å¯ä»¥åšåˆ°å¾—å‡ºé”™è¯¯çš„ç»“è®ºã€‚é€‚åº”å‘¨å›´ç¯å¢ƒçš„èƒ½åŠ›æ˜¯äººç±»ç”Ÿå­˜å¿…éœ€çš„ç‰¹å¾ä¹‹ä¸€ï¼Œæ‰€å¹¸æˆ‘ä»¬éƒ½å…·å¤‡è¿™ä¸€èƒ½åŠ›ï¼Œç„¶è€Œï¼Œæ­£æ˜¯è¿™ç§é€‚åº”èƒ½åŠ›ï¼Œä½¿åˆ›å»ºç²¾ç›Šæµç¨‹çš„å·¥ä½œå¼‚å¸¸è‰°éš¾ã€‚</em></p><p><em>ä»æœ¬è´¨ä¸Šè€Œè¨€ï¼Œæˆ‘ä»¬ä¼šé€‚åº”å‘¨å›´çš„ç¯å¢ƒï¼Œå¹¶åœ¨å¾ˆçŸ­çš„æ—¶é—´é‡Œæ¥å—ç¯å¢ƒï¼Œå¹¶è§†ä¹‹ä¸ºâ€œæ­£å¸¸â€è€Œä¸å†äºˆä»¥è€ƒè™‘ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠè¿™ç§æƒ…å†µå½“åšæˆ‘ä»¬â€œåº”è¯¥åšçš„äº‹æƒ…â€ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‘†è„±è¿™ç§æ¨¡å¼ï¼Œå½“ä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥çœ‹å¾…è¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬çš„ç†è§£ä¾¿ä¼šæ›´æ·±ä¸€æ­¥ã€‚è¿ç”¨ç²¾ç›Šç†å¿µå’Œå·¥å…·å°†è¿«ä½¿æˆ‘ä»¬ä»ä¸åŒçš„è§†è§’é‡æ–°å®¡è§†ç¯å¢ƒã€‚å¦‚æœæˆ‘ä»¬çš„å¤´è„‘èƒ½å¤Ÿæ¥å—æ–°çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆçœŸæ­£çš„è½¬å˜å°±å¯èƒ½å‘ç”Ÿã€‚</em></p></blockquote><p><em>è¿˜æœ‰ç›¸ä¼¼çš„è¿™æ ·ä¸€æ®µï¼ˆæºè‡ªç« èŠ‚â€œç«™åœ¨åœ†åœˆå†…çš„ç»ƒä¹ â€ï¼‰</em></p><blockquote><p><em>å…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼Œå¦‚æœä½ å¯¹ç»ƒä¹ ä¸­çš„æµç¨‹å·²ååˆ†ç†Ÿæ‚‰ï¼Œé‚£ä¹ˆè¿™é¡¹ç»ƒä¹ çš„éš¾åº¦å°±æ›´å¤§ã€‚å› ä¸ºï¼Œä½ å·²äº†è§£æµªè´¹å­˜åœ¨çš„â€œåŸå› â€ï¼Œæ‰€ä»¥ä½ æ›´å€¾å‘äºä½¿å…¶åˆç†åŒ–ï¼Œå¹¶å¾—å‡ºæ— æ³•æ”¹è¿›çš„ç»“è®ºã€‚åœ¨ç»ƒä¹ ä¸­ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯æ‰¿è®¤å­˜åœ¨æµªè´¹ï¼Œè€Œæ— é¡»å¯¹å…¶åšå‡ºè§£é‡Šæˆ–æ€è€ƒè§£å†³ä¹‹æ³•ã€‚</em></p></blockquote><p>ä¹¦ä¸­è¿™ä¸¤å¤„æè¿°çš„åœºæ™¯ï¼Œçœ‹èµ·æ¥è·Ÿå‰é¢â€œè…Œé»„ç“œçš„å¤æ°´æ•ˆåº”â€æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ã€‚ç„¶è€Œï¼Œã€Šä¸°ç”°æ¨¡å¼ã€‹è¿™æœ¬ä¹¦è®²è¿°çš„è·Ÿã€Šå’¨è¯¢çš„å¥¥ä¹‰ã€‹ä¸åŒçš„æ­£æ˜¯ â€”â€” ä¸åªæ˜¯è‡ªå·±è·³å‡ºå¤æ°´ä¹‹å¤–ï¼Œè€Œæ˜¯èº«å¤„ç¯å¢ƒä¸­å¦‚ä½•å®Œæˆè‡ªæˆ‘æ•‘èµçš„äº‹ã€‚</p><p>æ‰€ä»¥ï¼Œå½“æ·±å¤„å›¢é˜Ÿä¸­æ”¹è¿›ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿâ€œä¸åŒçš„è§†è§’é‡æ–°å®¡è§†ç¯å¢ƒâ€ï¼Œæ‰¾åˆ°æ­£ç¡®çš„ç†å¿µå’Œå·¥å…·ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç³»åˆ—æ•´ä½“ä¼˜åŒ–ç­‰åç»­ã€‚è™½ç„¶æˆ‘æœ€è¿‘çš„èƒŒæ™¯ä¸»è¦æ˜¯åœ¨ä»·å€¼äº¤ä»˜ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘å°±ä¸å»¶ä¼¸è®²äº†ã€‚ç¨å¾®å¤§ç™½è¯æ¥è¯´çš„è¯ï¼Œå°±æ˜¯â€œä¸ä»…è¦ä½å¤´åšäº‹ï¼Œè¿˜è¦æŠ¬å¤´çœ‹è·¯â€ï¼›ç²¾ç›Šä¸€ç‚¹ï¼Œå°±æ˜¯â€œè¦å®šä¹‰ä»·å€¼ï¼Œæ¶ˆé™¤æµªè´¹â€ã€‚</p><p>ä¹Ÿè®¸ï¼Œæœ‰äººè¯´åˆ° â€”â€” è¿™ç¯‡æ–‡ç« å‰é¢è®²åˆ°çš„æˆ‘éƒ½æ‡‚ï¼Œä½†å½“å†²åœ¨ä¸€çº¿çš„æ—¶å€™ï¼Œå¾€å¾€é‚£å·¨å¤§çš„å‹åŠ›å°±æ˜¯æ²¡åŠæ³•ã€ä¹Ÿæ²¡æœ‰æ—¶é—´å»åšå¥½ä»·å€¼å®šä½ã€æ”¹å–„çš„äº‹æƒ…ï¼Œé‚£äº›æ€»æ˜¯æ’ä¸ä¸Šä¼˜å…ˆçº§ã€‚<br>å¥½å§ï¼Œæˆ‘è¿™é‡Œå†æ¬¡å€Ÿç”¨æ›¾ç»çœ‹è¿‡çš„å¦ä¸€æœ¬ä¹¦ä¸­çš„ä¸€ä¸ªç†è®ºï¼šé¦–å…ˆæ”¯ä»˜è‡ªå·±ã€‚ï¼ˆç”±äºä¸æ˜¯è·Ÿè½¯ä»¶å¼€å‘çš„ä¹¦ç±ï¼Œè¿™é‡Œå°±ä¸å¼•ç”¨äº†ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ä½¿ç”¨å…³é”®è¯æŸ¥è¯¢ï¼‰<br>è¿™é‡Œå€Ÿé‰´ä¸€ä¸‹ï¼Œæ”¹ä¸ºâ€œé¦–å…ˆæŠ•èµ„è‡ªå·±â€ã€‚</p><h5 id="é¦–å…ˆæŠ•èµ„è‡ªå·±">é¦–å…ˆæŠ•èµ„è‡ªå·±</h5><p><em>åŸæœ¬â€œé¦–å…ˆæ”¯ä»˜è‡ªå·±â€çš„æ•…äº‹æ˜¯è¿™æ ·çš„ï¼šï¼ˆæ˜¯ä¸€æ¡è´¢å¯Œçš„å¢é•¿æ€è·¯ï¼‰</em></p><p><em>æ¯ä¸ªæœˆçš„è–ªèµ„å‘ä¸‹æ¥çš„æ—¶å€™ï¼Œäººä»¬ä¹ æƒ¯äºå…ˆè¿˜ä¿¡ç”¨å¡ã€ç¼´æˆ¿ç§Ÿã€ç¼´å„ç§è´¹ç”¨ã€æ”¯ä»˜ï¼Œæœ€åå‰©ä¸‹æ¥çš„æ‰è€ƒè™‘æŠ•èµ„ã€ç†è´¢ã€‚è€Œå¾€å¾€æœ€åå´å‰©ä¸‹çš„å¯èƒ½åªæ˜¯ç©ºæ°”ï¼Œè¿™æ ·æœˆå¤ä¸€æœˆã€å¹´å¤ä¸€å¹´ï¼Œé€‰æ‹©è¿™æ ·åšçš„äººä»¬ä»ç„¶æ˜¯é ç€æ¯æœˆè–ªèµ„åº¦æ—¥ï¼Œæ°¸è¿œä¸èµ„æœ¬æ€§ç›ˆåˆ©å¢é•¿ç»ç¼˜ï¼Œä¸€æ—¦å¤±å»å·¥ä½œï¼ŒåŸºæœ¬å‡ ä¸ªæœˆæ–­ç²®ï¼Œæˆ–è€…åƒå­˜æ¬¾çš„ä»½å„¿ã€‚<br>å› æ­¤ï¼Œä¸ºäº†é¿å…äººä»¬æ˜¯ä¸ºäº†ç”Ÿå­˜è€Œå·¥ä½œï¼Œæ—¥å¤ä¸€æ—¥åˆ«æ— é€‰æ‹©ï¼Œå°±æå‡ºäº†â€œé¦–å…ˆæ”¯ä»˜è‡ªå·±â€çš„æ€è·¯ã€‚<br>ä¹Ÿå°±æ˜¯ï¼Œåœ¨æ¯ä¸ªæœˆè–ªèµ„å‘ä¸‹æ¥çš„æ—¶å€™ï¼Œå…ˆåˆ’å‡ºä¼˜å…ˆæŠ•èµ„ã€ç†è´¢çš„é‚£éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„æ‰è€ƒè™‘è¿˜æ¬¾ã€ç¼´è´¹ã€æ”¯ä»˜ã€‚ä¸ä»…å¯ä»¥ä¿éšœé•¿æœŸçš„è´¢åŠ¡æŠ•èµ„çš„åŒæ—¶ï¼Œåœ¨å‰©ä¸‹çš„é’±ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥æ¿€åŠ±äººå»åˆ›é€ æ›´å¤šçš„ä»·å€¼ç›ˆåˆ©ã€‚</em></p><p>è¿™é‡Œå€Ÿé‰´ä¸€ä¸‹ã€‚<br>åœ¨ä¸€çº¿çš„æ—¶å€™ï¼Œå›¢é˜Ÿæ€»æ˜¯è¢«ç›²ç›®åœ°BUã€storiesã€bugsè¿½ç€è·‘ï¼Œè€—æ‰äº†å¤§éƒ¨åˆ†çš„æ—¶é—´ï¼Œæ€»è¯´ç”¨å‰©ä¸‹çš„æ—¶é—´æ¥åšä»·å€¼å®¡è§†å’Œæ”¹è¿›ã€‚å¾€å¾€æœ€åå‰©ä¸‹çš„æ—¶é—´å¯èƒ½éƒ½æ˜¯è´Ÿæ•°ï¼Œå¼•ä»¥ä¸ºå‚²çš„æ•æ·ã€ç²¾ç›Šã€ä»·å€¼äº¤ä»˜éƒ½è¢«æŠ›ä¹‹è„‘åã€‚å›¢é˜Ÿåœ¨å…»æ´»è‡ªå·±çš„è¾¹ç¼˜æŒ£æ‰ï¼Œæ¯æ—¥å¿™å¿™ç¢Œç¢Œã€è¡Œè‰²åŒ†åŒ†ã€â€œåŠªåŠ›â€åšäº‹ï¼Œæœ€åæˆ‘ä»¬æŠŠè‡ªå·±ä»ä¸“ä¸šæœåŠ¡åšæˆäº†å¤–åŒ…ï¼Œæ—¥å¤ä¸€æ—¥åˆ«æ— é€‰æ‹©ã€‚å›¢é˜Ÿé‡Œçš„å®¢æˆ·ä¹ŸæŠŠè‡ªå·±ä»ä¼ä¸šæ•°å­—åŒ–æ–¹æ¡ˆæ¨åŠ¨è€…åšæˆäº†å¤–åŒ…äººå‘˜managerã€‚<br>æ‰€ä»¥ï¼Œå½“æœ‰å‹åŠ›æ¥çš„æ—¶å€™ï¼Œè¯·å…ˆæŠ—ä½å‹åŠ›ï¼Œç¡®ä¿æœ‰æ•ˆçš„æ—¶é—´æ¥æŠ•èµ„å›¢é˜Ÿå’Œä»·å€¼ä½“ç³»ã€‚</p><h4 id="æ€»ç»“">æ€»ç»“</h4><p>å…‹æœâ€è…Œé»„ç“œåŸåˆ™â€œï¼Œå…‹æœâ€äººç±»çš„é€‚åº”èƒ½åŠ›â€œï¼Œä¿è¯â€é¦–å…ˆæŠ•èµ„è‡ªå·±â€œã€‚<br>è‡³äºæ€ä¹ˆåšï¼Ÿè¿™ä¸æ˜¯æœ¬ç¯‡æ–‡ç« çš„èŒƒå›´ï¼Œä¹Ÿè®¸ä¸‹ä¸€ç¯‡æ¶‰åŠä»·å€¼äº¤ä»˜çš„æ–‡ç« ä¸­æåŠã€‚</p><p>æœ€åæ”¾ä¸€å¼ æœ¬äººæœ€è¿‘ç”»çš„å›¢é˜Ÿæ”¹è¿›å›¾ â€”â€” å€Ÿé‰´è‡ªâ€ç²¾ç›ŠæŒç»­æ”¹è¿›çš„èºæ—‹å¾ªç¯å›¾â€œã€‚<br>éšä¾¿çœ‹çœ‹ï¼Œè¿™é‡Œä¸ä¼šæœ‰è¯´æ˜ã€‚å°±æ˜¯ä¸ºäº†å‡‘å›¾æ¥çš„ ğŸ˜<br><img src="/2020/01/16/wei-shi-me-yue-shen-chu-tuan-dui-yue-nan-gai-jin/continuous_improvement_spiral_graph.png" alt="ç²¾ç›ŠæŒç»­æ”¹è¿›çš„èºæ—‹å¾ªç¯å›¾"></p>]]></content>
      
      
      <categories>
          
          <category> å’¨è¯¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŒç»­æ”¹è¿› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•æ·æµ‹è¯•å››è±¡é™ä¹‹ä¸‰å››</title>
      <link href="/2019/12/01/min-jie-ce-shi-si-xiang-xian-zhi-san-si/"/>
      <url>/2019/12/01/min-jie-ce-shi-si-xiang-xian-zhi-san-si/</url>
      
        <content type="html"><![CDATA[<p>æ¥ç€ä¸Šç¯‡ã€Šæ•æ·æµ‹è¯•å››è±¡é™ä¹‹ä¸€äºŒã€‹ï¼Œè¿™é‡Œä¸»è¦è®²ä¸‹å‰©ä¸‹çš„ä¸‰å››è±¡é™ã€‚<br>è¿™ç¯‡å°±æ²¡æœ‰ä¸Šç¯‡é‚£äº›åæ§½ç”Ÿæ´»ä¸­çš„å°ä¾‹å­äº†ã€‚</p><p><img src="/2019/12/01/min-jie-ce-shi-si-xiang-xian-zhi-san-si/agile_testing_quadrant.png" alt="æ•æ·æµ‹è¯•å››è±¡é™"></p><p>åœ¨å››è±¡é™å›¾çš„å³è¾¹éƒ¨åˆ†ï¼ŒåŒºåˆ«äºâ€œæ”¯æŒå›¢é˜Ÿâ€ï¼Œä¸»è¦ç›®çš„æ˜¯æ¥â€œè¯„ä»·äº§å“â€ã€‚<br>æ‰€è°“è¯„ä»·äº§å“ï¼Œå°±æ˜¯ä»¥ç”¨æˆ·ä½“éªŒçš„è§’åº¦å»æµ‹è¯•ç³»ç»Ÿ â€”â€” åœ¨æµ‹è¯•ä¸­å°½é‡é‡ç°æœ€ç»ˆç”¨æˆ·çš„å®é™…ä½“éªŒï¼Œæˆ–è€…å¦‚betaæµ‹è¯•ï¼Œç›´æ¥é‚€è¯·ç»ˆç«¯ç”¨æˆ·å‚ä¸æµ‹è¯•ã€‚</p><span id="more"></span><h4 id="1-ç¬¬ä¸‰è±¡é™ï¼Œâ€œé¢å‘ä¸šåŠ¡â€ã€â€œè¯„ä»·äº§å“â€çš„æµ‹è¯•">1. ç¬¬ä¸‰è±¡é™ï¼Œâ€œé¢å‘ä¸šåŠ¡â€ã€â€œè¯„ä»·äº§å“â€çš„æµ‹è¯•</h4><p>é¢å‘ä¸šåŠ¡çš„æµ‹è¯•å®ä¾‹å¸®åŠ©å›¢é˜Ÿè®¾è®¡æœŸæœ›çš„äº§å“ï¼Œä½†å¯èƒ½ä¸šåŠ¡æŸäº›æµ‹è¯•å®ä¾‹æœ¬èº«æ˜¯é”™è¯¯çš„ â€”â€” ä¸šåŠ¡ä¸“å®¶å¯èƒ½é—æ¼äº†æŸäº›åŠŸèƒ½ï¼›æˆ–è€…æ˜¯å› ä¸ºè¯¥åŠŸèƒ½ä¸æ˜¯ä»–ä»¬çš„å®é™…é¢†åŸŸã€å¹¶æ²¡æœ‰æ­£ç¡®çš„äº†è§£è¿™ä¸ªåŠŸèƒ½ï¼›å›¢é˜Ÿè¯¯è§£äº†æŸäº›å®ä¾‹ï¼›å¼€å‘ç¼–å†™çš„ä»£ç å¯ä»¥é€šè¿‡ä¹‹å‰ä¸€äºŒè±¡é™çš„æµ‹è¯•ï¼Œä½†å¹¶æ²¡æœ‰äº§ç”Ÿå®¢æˆ·æƒ³è¦çš„ä¸œè¥¿ï¼Œç­‰ç­‰ã€‚<br>è¿™å°±æ˜¯ä½¿ç”¨ç¬¬ä¸‰è±¡é™æµ‹è¯•çš„åœ°æ–¹ã€‚</p><p>ç¬¬ä¸‰è±¡é™ä¸­æµ‹è¯•çš„ä¸»ä½“ï¼Œæ˜¯æ‰‹åŠ¨å®Œæˆã€‚<br>å½“ç„¶ï¼Œå¦‚æœæ²¡æœ‰å°†è±¡é™ä¸€å’Œè±¡é™äºŒä¸­çš„æµ‹è¯•å®ç°è‡ªåŠ¨åŒ–ï¼Œé‚£ä¹ˆæµ‹è¯•äººå‘˜æ ¹æœ¬æ²¡æœ‰æ—¶é—´è¿›è¡Œç¬¬ä¸‰è±¡é™çš„æµ‹è¯•ã€‚<br>è€Œå¯¹äºç¬¬ä¸‰è±¡é™çš„æµ‹è¯•ï¼Œå®ç°è‡ªåŠ¨åŒ–æ˜¯å¾ˆå›°éš¾çš„ï¼Œå› ä¸ºè¿™ç±»æµ‹è¯•ä¾èµ–äºäººä»¬çš„æ™ºåŠ›ã€ç»éªŒå’Œç›´è§‰ã€‚</p><p>æ¯”å¦‚ï¼Œæ¢ç´¢æ€§æµ‹è¯•ï¼Œå°±æ˜¯æ•æ·æµ‹è¯•ä¸­ï¼Œå¯¹äºç”¨æˆ·æ•…äº‹æµ‹è¯•å’Œè‡ªåŠ¨åŒ–å›å½’æµ‹è¯•é›†çš„é‡è¦è¡¥å……ã€‚<br>ä½¿ç”¨æ¢ç´¢æ€§æµ‹è¯•æ—¶ï¼Œé¦–å…ˆï¼Œæµ‹è¯•äººå‘˜å¯¹ç°å­˜ç³»ç»Ÿæœ‰æ•´ä½“äº†è§£ï¼Œç„¶åï¼Œä¸æŒ‰ç…§åŸæœ‰çš„éªŒæ”¶æµ‹è¯•é¡¹å‰§æœ¬ï¼Œå°†â€œæµ‹è¯•è®¾è®¡â€ã€â€œæµ‹è¯•æ‰§è¡Œâ€å’Œâ€œå­¦ä¹ â€åŒæ—¶è¿›è¡Œã€‚æœ€ç»ˆèƒ½è®¾è®¡æ–°çš„æµ‹è¯•ï¼Œå¹¶èƒ½å¼•å‡ºä¸å°‘å¯¹æ–°ç‰¹æ€§çš„æƒ³æ³•ï¼Œè€Œè¿™äº›æ–°ç‰¹æ€§å¾€å¾€ä¼šæ¼”å˜æˆæ–°çš„æ•…äº‹ã€‚</p><p>å¯ç”¨æ€§æµ‹è¯•ã€‚æ³¨æ„è¿™é‡Œæ˜¯Usabilityï¼Œä¸æ˜¯availabilityã€‚åç«¯å¼€å‘äººå‘˜ä¼°è®¡ç¬¬ä¸€ååº”æ˜¯åè€…ã€‚<br>è¿™é‡Œçš„ç¬¬ä¸‰è±¡é™çš„å¯ç”¨æ€§æµ‹è¯•ï¼Œæ˜¯æŒ‡å¯¹äºç”¨æˆ·æ¥è¯´çš„å¯ç”¨æ€§ï¼ŒåŒ…æ‹¬ â€”â€” æ˜¯å¦æ˜“äºå­¦ä¹ ã€è®°å¿†ã€æ“ä½œï¼Œæ˜¯å¦æå‡ç”¨æˆ·æ•ˆç‡ç­‰ç­‰ã€‚</p><p>UATã€alphaã€beta æµ‹è¯•ï¼Œéƒ½ç®—æ˜¯ç”¨æˆ·éªŒæ”¶æµ‹è¯•ï¼ŒåŸºäºç³»ç»Ÿçš„å…¨é‡è¯„æµ‹ï¼Œå‘ç°å¹¶åé¦ˆé—®é¢˜ï¼Œä¿®å¤æˆ–è€…è·å–æ–°çš„ç”¨æˆ·æ•…äº‹æƒ³æ³•æ¥ä»¥æ­¤æ”¹è¿›ã€‚<br>ç”±äºæœ¬äººä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜ï¼Œå‚ä¸çš„ä¸å¤šï¼Œå°±ä¸ä»”ç»†æè¿°äº†ã€‚</p><h4 id="2-ç¬¬å››è±¡é™ï¼Œè·¨åŠŸèƒ½æ€§éœ€æ±‚æµ‹è¯•">2. ç¬¬å››è±¡é™ï¼Œè·¨åŠŸèƒ½æ€§éœ€æ±‚æµ‹è¯•</h4><p>ç¬¬å››è±¡é™çš„ç›®çš„æ˜¯è¯„ä»·äº§å“çš„è·¨åŠŸèƒ½æ€§éœ€æ±‚ï¼Œæ¯”å¦‚æ€§èƒ½ã€å®‰å…¨ã€å¯é æ€§ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªæ•æ·å¼€å‘æ¯”è¾ƒå®¹æ˜“å¿½è§†çš„æµ‹è¯•ç»´åº¦ã€‚<br>ä¸ºä»€ä¹ˆä¼šå¿½è§†å‘¢ï¼Ÿ<br>å…¶ä¸­ä¸€éƒ¨åˆ†åŸå› æ˜¯ â€”â€” æ•æ·æµç¨‹ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„æ­¥éª¤æ˜¯ï¼Œè®©ä¸šåŠ¡ï¼ˆPOï¼‰ç¼–å†™ç”¨æˆ·æ•…äº‹å¹¶å¯¹å…¶ä¼˜å…ˆçº§æ’åºã€‚ä¸€èˆ¬éæŠ€æœ¯çš„ä¸šåŠ¡å›¢é˜Ÿæˆå‘˜é€šå¸¸ä¼šâ€œå‡å®šâ€å¼€å‘äººå‘˜ä¼šè€ƒè™‘æ€§èƒ½ã€å®‰å…¨ç­‰å› ç´ ï¼Œä½†å¼€å‘ä»¬åªæ˜¯ä¸“æ³¨äºå®¢æˆ·ç»™å‡ºçš„ä¼˜å…ˆçº§é«˜çš„åŠŸèƒ½ã€‚<br>è€Œæœ‰æ—¶å€™è·¨åŠŸèƒ½éœ€æ±‚å¯èƒ½æ¯”å®é™…çš„åŠŸèƒ½æ›´é‡è¦ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªåœ¨çº¿å•†åŸçš„å“åº”æ—¶é—´æ˜¯ä¸€åˆ†é’Ÿï¼Œé‚£ä¹ˆå®¢æˆ·å°†ä¸ä¼šç­‰å¾…æ¬£èµå®ƒçš„ä»»ä½•åŠŸèƒ½ã€‚<br>å› æ­¤ï¼Œåº”è¯¥åœ¨å¼€å‘å‘¨æœŸçš„æ¯ä¸€æ­¥éƒ½è¦è€ƒè™‘è¯„ä»·äº§å“çš„é¢å‘æŠ€æœ¯çš„æµ‹è¯•ï¼Œè€Œä¸æ˜¯ç•™åˆ°æœ€åã€‚ä¸ç„¶ï¼Œå¯èƒ½ä¼šå¤ªè¿Ÿè€Œä¸èƒ½ä¿®æ­£è¿™äº›é—®é¢˜ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè¿™äº›æµ‹è¯•ç”šè‡³åº”è¯¥åœ¨åŠŸèƒ½æµ‹è¯•ä¹‹å‰è¿›è¡Œï¼Œæ¯”å¦‚æ€§èƒ½æŒ‡æ ‡çš„ä¸åŒï¼Œä¼šé©±åŠ¨å‡ºä¸åŒçš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆã€‚</p><p>è·¨åŠŸèƒ½æ€§éœ€æ±‚ï¼Œæœ€å¥½å‡†å¤‡ä¸€ä¸ªæ ¸å¯¹çš„è¡¨å•ï¼Œè®©å›¢é˜Ÿå¯¹å…¶æœ‰æ‰€äº†è§£ï¼ŒåŒæ—¶ä¹Ÿèƒ½è®© PO ç»™å‡ºæ¯é¡¹çš„é‡è¦çº§åˆ«ã€‚å¼€å‘å›¢é˜Ÿæœ‰ä¹‰åŠ¡è§£é‡Šæ¸…æ¥šä¸é‡è§†è¿™äº›è·¨åŠŸèƒ½éœ€æ±‚æ‰€å¯¼è‡´çš„åæœï¼ŒPO åº”è¯¥ä»”ç»†æ€è€ƒæ‰€æœ‰è¿™äº›é‡è¦è´¨é‡å› ç´ å¹¶è¿›è¡Œæƒè¡¡ï¼Œå¿…è¦æ—¶å€™ï¼Œåœ¨æ¶‰åŠçš„åŠŸèƒ½ã€ç”¨æˆ·æ•…äº‹ä¸Šå¯¹å…¶è¿›è¡Œç‰¹åˆ«å¼ºè°ƒã€‚</p><p>æœ€åï¼Œå…·ä½“ç¬¬å››è±¡é™çš„æ‰§è¡Œï¼Œå›¢é˜Ÿå¯èƒ½éœ€è¦å€ŸåŠ©å›ºå®šä¸“å®¶çš„å¸®åŠ©ï¼Œæ¯”å¦‚DBAã€å®‰å…¨å°ç»„ç­‰ï¼ŒåŒæ—¶ä¹Ÿä¼šä½¿ç”¨ä¸€äº›å¼€æºæˆ–è€…éœ€è´­ä¹°çš„å·¥å…·æ¥å®Œæˆã€‚</p><h4 id="3-æœ€å">3. æœ€å</h4><p>ç»ˆäºå°†æ•æ·æµ‹è¯•å››ä¸ªè±¡é™å†™å®Œäº†ã€‚<br>è‡³äºä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜ï¼Œä¸ºå•¥ä¼šè·‘å»å†™ä¸€ç¯‡æµ‹è¯•çš„åšæ–‡ã€è¿˜è·‘å»æŠŠã€Šæ•æ·è½¯ä»¶æµ‹è¯•ã€‹è¿™æœ¬ä¹¦ç¿»äº†ä¸€éã€‚<br>å…¶ä¸­æœ€ä¸»è¦çš„ä¸€ä¸ªåŸå› æ˜¯ï¼Œæƒ³è¦è®©å¼€å‘äººå‘˜å……åˆ†äº†è§£â€œè´¨é‡â€çš„é‡è¦æ€§ï¼Œä¸“æ³¨äºè´¨é‡ã€‚<br>è€Œâ€œè´¨é‡â€ï¼Œå¯¹äºå¼€å‘å›¢é˜Ÿæ¥è¯´ï¼Œæ˜¯ç”¨æ¥è·å–å®¢æˆ·ä¿¡ä»»çš„ä¸€ä¸ªé‡è¦æ”¿æ²»èµ„æœ¬ã€‚<br>å¦å¤–ï¼Œæ•æ·æµ‹è¯•æ¯ä¸ªè±¡é™å…¶å®æ‰¿æ‹…äº†ä¿æŒâ€œæŠ€æœ¯å€ºâ€åœ¨ä¸€ä¸ªå¯ç®¡ç†çš„æ°´å“çš„è§’è‰²ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•æ· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•æ·æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•æ·æµ‹è¯•å››è±¡é™ä¹‹ä¸€äºŒ</title>
      <link href="/2019/11/28/min-jie-ce-shi-si-xiang-xian-zhi-yi-er/"/>
      <url>/2019/11/28/min-jie-ce-shi-si-xiang-xian-zhi-yi-er/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¥è¿™ç¯‡åšæ–‡æˆ‘æ˜¯æƒ³è¿™æ ·å¼€å¤´çš„ï¼š</p><p>ä¹Ÿè®¸æœ‰äººçœ‹è§è¿™ç¯‡æ–‡ç« çš„æ ‡é¢˜ä¼šè§‰å¾— â€”â€” è¿™è·Ÿå¼€å‘äººå‘˜æ— å…³ã€‚<br>ä¸ï¼Œä½ é”™äº†ï¼Œè¿™è·Ÿå¼€å‘äººå‘˜æœ‰å…³ï¼Œå¹¶ä¸”æœ‰éƒ¨åˆ†å·¥ä½œæ˜¯éœ€è¦å¼€å‘äººå‘˜å»åšçš„ã€‚</p><p>ä½†ï¼Œæœ€è¿‘é‡åˆ°äº†ä¸€äº›äº‹æƒ…ï¼Œæˆ‘æƒ³æ¢ä¸€ä¸ªå¼€å¤´æ–¹å¼ï¼š</p><p>äººåœ¨å·¥ä½œå’Œç”Ÿæ´»ä¸­ï¼Œé£å¹³æµªé™æ—¶ï¼Œå°±åƒåœ¨å®ç° storiesã€‚è€Œé‚£äº›çªå¦‚å…¶æ¥çš„ã€æ‰“æ–­é£å¹³æµªé™çš„å±€é¢çš„äº‹æƒ…ï¼Œå°±åƒä¸€ä¸ªä¸ª bugsã€‚ä½œä¸ºä¸€ä¸ª Techï¼Œæˆ‘å·²ç»ä¹ æƒ¯äº†å»è§£å†³è¿™äº› â€bugsâ€œï¼Œä½†åˆä¸å…å†…å¿ƒä¼šåæ§½ï¼Œè¿™äº›çªå¦‚å…¶æ¥çš„é—®é¢˜ï¼Œä½œä¸ºäº§å“å’ŒæœåŠ¡æä¾›å•†ï¼Œå°±ä¸èƒ½é‡è§†ä¸€ä¸‹è´¨é‡å»ºè®¾ï¼Ÿ</p><p>è¯´åˆ°è´¨é‡å»ºè®¾ï¼Œå°±ä¸å¾—ä¸æ¥çœ‹ä¸€ä¸‹æ•æ·æµ‹è¯•å››è±¡é™ã€‚ï¼ˆè¿™ä¸ªè½¬æ¥æ˜¯ä¸æ˜¯è¿˜è›®ä¸æ»‘é¡ºç•…çš„ï¼‰</p><p><img src="/2019/11/28/min-jie-ce-shi-si-xiang-xian-zhi-yi-er/agile_testing_quadrant.png" alt="æ•æ·æµ‹è¯•å››è±¡é™"></p><p>å››è±¡é™å·¦è¾¹éƒ¨åˆ†ï¼Œç”¨ä»¥â€æ”¯æŒå›¢é˜Ÿâ€œ â€”â€” å¸®åŠ©å›¢é˜Ÿå¼€å‘äº§å“ã€‚<br>ä¸å·¦è¾¹ç›¸å¼‚çš„å³è¾¹éƒ¨åˆ†ï¼Œç”¨ä»¥â€è¯„ä»·äº§å“â€œ â€”â€” å¯¹äº¤ä»˜çš„äº§å“å¢é‡è¿›è¡Œè¯„æµ‹ã€‚</p><p>å››è±¡é™ä¸‹è¾¹éƒ¨åˆ†ï¼Œç”¨ä»¥â€é¢å‘æŠ€æœ¯â€œ â€”â€” é¢å‘æŠ€æœ¯é¢†åŸŸã€‚<br>ä¸ä¸‹è¾¹ç›¸å¼‚çš„ä¸Šè¾¹è¾¹éƒ¨åˆ†ï¼Œç”¨ä»¥â€é¢å‘ä¸šåŠ¡â€œ â€”â€” é¢å‘ä¸šåŠ¡é¢†åŸŸã€‚</p><p>å…ˆå£°æ˜ï¼Œæ•æ·æµ‹è¯•å››è±¡é™å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæ¨¡å‹ï¼Œæˆ–è€…å·¥å…·ï¼Œå¤§å®¶å‚ç…§å®ƒæ¥åˆ’åˆ†å’Œæ­å»ºé¡¹ç›®ä¸­çš„æµ‹è¯•â€œæ¶æ„â€ã€‚å› æ­¤ï¼Œå¯¹äºå…·ä½“çš„é¡¹ç›®è€Œè¨€ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½å¿…é¡»é‡‡ç”¨å’Œæ‰§è¡Œï¼Œä½†è‡³å°‘ä¸è¦æ¼æ‰çœŸæ­£éœ€è¦çš„ç»´åº¦å’Œå®è·µã€‚</p><span id="more"></span><h4 id="1-ç¬¬ä¸€è±¡é™ï¼Œå¼€å‘ä»¬æœ€ç†Ÿæ‚‰çš„éƒ¨åˆ†">1. ç¬¬ä¸€è±¡é™ï¼Œå¼€å‘ä»¬æœ€ç†Ÿæ‚‰çš„éƒ¨åˆ†</h4><p>å››è±¡é™ä¸­å·¦ä¸‹æ–¹çš„è±¡é™ä»£è¡¨äº†æµ‹è¯•é©±åŠ¨å¼€å‘ã€‚<br>ä¼°è®¡æœ‰äººä¼šè¯´ï¼Œæ˜æ˜è±¡é™å›¾ä¸Šé¢å†™çš„åªæ˜¯â€å•å…ƒæµ‹è¯•â€œã€â€ç»„ä»¶æµ‹è¯•â€œï¼Œæ€ä¹ˆæ‰¯åˆ°æµ‹è¯•é©±åŠ¨å¼€å‘ä¸Šå»äº†ï¼Ÿ<br>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œå¯ä»¥åˆ†ç‹­ä¹‰ï¼ˆTDDï¼‰å’Œå¹¿ä¹‰ï¼Œç‹­ä¹‰æ˜¯æŒ‡å¼€å‘æ—¶å°æ­¥å¼€å‘ã€å…ˆå†™æµ‹è¯•ã€å†å†™å®ç°çš„å¼€å‘æ–¹å¼ï¼›å¹¿ä¹‰æ˜¯æŒ‡ï¼ŒåŠ ä¸Šä¸šåŠ¡ã€æµ‹è¯•å‚ä¸ï¼Œä»¥ç»ˆä¸ºå§‹ï¼Œå›¢é˜Ÿæ˜ç¡®æœ€ç»ˆäº¤ä»˜éªŒæ”¶æµ‹è¯•é¡¹ï¼Œä½¿ç”¨æµ‹è¯•å‰ç½®ç­–ç•¥ï¼Œä»¥æ­¤å‡ºå‘è¿›è¡ŒåŠŸèƒ½è®¾è®¡ã€å¼€å‘å’Œæ„å»ºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚å½“ç„¶ï¼Œå¦‚æœè®¤å¯äº†ç‹­ä¹‰å’Œå¹¿ä¹‰ä¸¤ç§æ–¹å¼ä¹‹åï¼Œä¼šè§‰å¾—å¹¶æ— åŒºåˆ«ï¼Œå°±æ˜¯â€æµ‹è¯•é©±åŠ¨å¼€å‘â€œã€‚å½“ç„¶è¾ƒçœŸä¸€ç‚¹çš„ï¼Œä¼šè§‰å¾—å¹¿ä¹‰ä¸­å…¶å®è¿˜åŒ…å«äº†ATDDã€BDDç­‰ã€‚</p><p>è€å®è¯´ï¼Œæ—©æœŸçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿè®¤ä¸ºå…ˆå†™æµ‹è¯•ï¼Œè¿˜æ˜¯åå†™æµ‹è¯•ï¼ˆæˆ‘ä¸æ˜¯æŒ‡å¼€å‘å®Œäº†ä¹‹åè¡¥æµ‹è¯•ï¼‰ï¼Œæ²¡æœ‰æ˜æ˜¾çš„åŒºåˆ«ã€‚<br>ä½†ç»å†äº†æ›´å¤šé¡¹ç›®ä¹‹åï¼Œæ·±åˆ»åœ°æ„Ÿå—åˆ° â€”â€” è¦ä½¿ä¸€ä¸ªå›¢é˜Ÿï¼ˆå¯¹ï¼Œæˆ‘è¯´çš„å¹¶ä¸æ˜¯ç‰¹æŒ‡çš„æŸä¸ªäººï¼Œæˆ‘æŒ‡çš„æ˜¯å›¢é˜Ÿï¼‰ï¼Œèƒ½å†™å‡ºæœ‰æ•ˆã€é«˜è´¨é‡çš„æµ‹è¯•ï¼Œé‚£è¿˜æ˜¯ä¸€èµ·æ¥ç”¨TDDå§ã€‚<br>é¦–å…ˆï¼Œä»¥æµ‹è¯•å…ˆè¡Œçš„æ–¹å¼å¼€å‘çš„ä»£ç ï¼Œè‡ªç„¶ä¼šè¢«è¦æ±‚è®¾è®¡ä¸ºå¯æµ‹è¯•çš„ã€‚<br>å¹¶ä¸”ï¼Œä¼´éšç€å¼€å‘è¿‡ç¨‹ä¸­ç¼–å†™çš„æµ‹è¯•ï¼Œåœ¨å¸®åŠ©è®¾è®¡å¼€å‘ã€ä¿è¯è´¨é‡çš„åŒæ—¶ï¼Œåœ¨å¼€å‘å®Œæˆä»¥åè¿™äº›æµ‹è¯•ä¹Ÿæ‰¿æ‹…ç€é¢‘ç¹å›å½’å’Œé‡æ„å®‰å…¨ç½‘çš„ä½œç”¨ã€‚<br>æœ€åï¼Œå½“ç„¶é™„åŠ ä½œç”¨å°±æ˜¯è¿™äº›æµ‹è¯•æ˜¯ä¸€ä»½äº§å“ä»£ç çš„ä½¿ç”¨æŒ‡å—ã€‚</p><p>è‡³äºå¼€å‘å®Œäº†ä¹‹åè¡¥æµ‹è¯•è¿™ç§ â€”â€” é¦–å…ˆå®ƒé¡¶å¤šæ˜¯åªèƒ½ç®—æ˜¯ä¸€ç§å›å½’æµ‹è¯•ï¼Œè¡¥ä¸Šçš„æµ‹è¯•ä¸€èˆ¬ä¼šåˆ†æ”¯è¦†ç›–ä¸å…¨ï¼›å°±ç®—æœ€å¥½çš„æƒ…å†µï¼Œåˆ†æ”¯éƒ½è¦†ç›–å…¨äº†ï¼Œå®ƒé¡¶å¤šä¹Ÿåªèƒ½ç®—å¦ä¸€ç§ç™½ç›’æµ‹è¯•ï¼Œå¯¹â€œæ”¯æŒå›¢é˜Ÿè¿›è¡Œäº§å“å¼€å‘â€ä¸­çš„è®¾è®¡å’Œå¼€å‘å¹¶æ— åé¦ˆå’ŒæŒ‡å¯¼ä½œç”¨ã€‚æ›´åˆ«è¯´ï¼Œå¤§éƒ¨åˆ†å¼€å‘ä¼šâ€äº§å“ä»£ç éƒ½å†™å®Œäº†ï¼Œèµ¶ç´§è¡¥å®Œæµ‹è¯•åï¼Œèµ¶å»ä¸‹ä¸€ä¸ªstoryâ€çš„æ•·è¡æ„Ÿã€‚æˆ–è€…ï¼Œåªè¦æ²¡æœ‰å¼ºåˆ¶è¦æ±‚ï¼Œâ€œä»¥ååŠ æµ‹è¯•â€ â€”â€” åªæ˜¯ä¸€å¥è‡ªå·±éª—è‡ªå·±çš„è°è¨€ã€‚</p><p>å› æ­¤ç§ç§ï¼Œæ•æ·æµ‹è¯•ç¬¬ä¸€è±¡é™ä¸­ï¼Œæµ‹è¯•é©±åŠ¨å¼€å‘æ„å»ºå‡ºçš„å•å…ƒæµ‹è¯•ã€ç»„ä»¶æµ‹è¯•ï¼Œç”¨ä»¥ç¡®ä¿äº§å“ä»£ç çš„å†…éƒ¨è´¨é‡ã€‚<br>å†…éƒ¨è´¨é‡ï¼Œä¸æ˜¯é€šè¿‡å®¢æˆ·åˆ¤æ–­çš„ï¼Œæ˜¯ç”±å¼€å‘ä»¬å®šä¹‰çš„ã€‚å½“å†…éƒ¨è´¨é‡ä¸‹é™æ—¶ï¼Œç›´è§‚çš„å¯è§æŸå¤±æ¯”å¦‚ï¼šå¼€å‘é€Ÿç‡è¶Šæ¥è¶Šæ…¢ï¼Œè¶Šæ¥è¶Šå¤šçš„bugséœ€è¦ä¿®å¤ï¼Œä¸æ–­è¢«æ¨è¿Ÿçš„ç´§æ€¥é‡æ„ç­‰ç­‰ã€‚å½“ç„¶ï¼Œå¦‚æœé™¤äº†ç¬¬ä¸€è±¡é™å¤–çš„å…¶ä»–è±¡é™æµ‹è¯•ä¹Ÿéƒ½åŒæ—¶ç¿»è½¦ï¼Œè¿™äº›äº§å“è´¨é‡ç¼ºé™·å°†ä¼šè¢«ç”¨æˆ·æ„ŸçŸ¥ã€‚</p><blockquote><p>ä¸¾ä¸ªç°å®ç”Ÿæ´»ä¸­æœ‰è¶£çš„ä¾‹å­ï¼šæœ¬äººæœ€è¿‘ä½¿ç”¨äº†æ”¯æŸå®åŠç†ETCï¼ŒETCè®¾å¤‡è¢«é‚®å¯„è¿‡æ¥æ”¶åˆ°ä¹‹åï¼Œéœ€è¦è½¦ä¸»å®‰è£…ã€æ¿€æ´»ã€‚<br>æˆ‘æ‰“å¼€äº§å“è¯´æ˜ä¹¦ï¼Œä½¿ç”¨æ”¯æŸå®æ¿€æ´»å¼•å¯¼å°ç¨‹åºè¿›è¡Œå®‰è£…å’Œæ¿€æ´»ã€‚<br>å½“åˆ°è¾¾æ¿€æ´»è¿™ä¸ªæ­¥éª¤çš„æ—¶å€™ï¼Œæç¤ºâ€œOBUè®¾å¤‡æ•…éšœï¼Œè¯·è”ç³»å®¢æœå¤„ç†â€ã€‚<br>æ‰¾åˆ°å®¢æœï¼Œå®¢æœç›´æ¥å‘ŠçŸ¥ï¼šå¯„å›æ›´æ¢è®¾å¤‡ã€‚<br>ä¾æ ·å¯„å›ï¼Œè¿‡äº†ä¸¤ä¸‰å¤©åï¼Œæ‰‹æœºçªç„¶æ”¶åˆ°ä¸€æ¡æç¤º â€”â€” ETCå·²æˆåŠŸæ¿€æ´»ï¼Ÿè¿™æ˜¯åœ¨åšçº¿ä¸Šdebugï¼Ÿ<br>è”ç³»å®¢æœï¼Œå®¢æœè¯´æ˜¯æŠ€æœ¯äººå‘˜åœ¨æ£€ä¿®è®¾å¤‡ã€‚â€œæ£€ä¿®â€è®¾å¤‡ã€‚<br>è¿‡äº†ä¸¤å¤©ï¼Œå¿«é€’æ”¶åˆ°ä¹‹å‰é‚£å°è®¾å¤‡ï¼Œå·²è¢«æ¿€æ´»ã€‚<br>æ€»ç»“ä¸€å¥ï¼šè®¾å¤‡å‡ºå‚æœ‰ç¼ºé™·ï¼Œæ–°å“å¯„å›ä»…æ£€ä¿®ï¼Œçº¿ä¸Šdebugæ¿€æ´»ï¼Œç”¨æˆ·æ”¶åˆ°è®¾å¤‡ä»ç„¶ä¸€è„¸è’™åœˆ â€”â€” â€œè´¦å·â€ä¸ä»…è¢«çº¿ä¸Šdebugè¿›è¡Œäº†å†™æ“ä½œï¼Œåˆ°åº•ä¿®å¥½æ²¡æœ‰è¿˜éœ€ç”¨æˆ·è‡ªå·±å¼€å»ä¸€ä¸ªETCå…¥å£æ£€éªŒã€‚<br>çœ‹ï¼Œä½œä¸ºä¸€ä¸ªç”¨æˆ·ï¼Œæˆ‘è™½ç„¶çœ‹ä¸åˆ°å†…éƒ¨è´¨é‡ï¼Œä½†åŒæ—¶æˆ‘ä¹Ÿæ²¡æœ‰çœ‹åˆ°ä»»ä½•è´¨é‡æ„å»ºå‘æŒ¥ä½œç”¨ã€‚</p></blockquote><p>æ”¯æŒå›¢é˜Ÿå¼€å‘è¿‡ç¨‹çš„é¢å‘æŠ€æœ¯æµ‹è¯•ï¼Œæ˜¯æ‰€æœ‰å°†è¦è¿›è¡Œçš„æµ‹è¯•çš„é‡è¦åŸºç¡€ã€‚å¦‚æœå›¢é˜Ÿæ²¡æœ‰å¯¹è¿™ä¸ªè±¡é™ä¸­çš„æµ‹è¯•åšè¶³å¤Ÿå¤šçš„å·¥ä½œï¼Œå…¶ä»–ç±»å‹çš„æµ‹è¯•å°†ä¼šæ›´åŠ å›°éš¾ã€‚å› ä¸ºå›¢é˜Ÿçš„ä»£ç ç¼ºå°‘å†…éƒ¨è´¨é‡ï¼Œæ¯é¡¹ä»»åŠ¡å°†éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚</p><p>psï¼šç¬¬ä¸€è±¡é™çš„å†…å®¹å¹¶éåªæœ‰å•å…ƒæµ‹è¯•ã€ç»„ä»¶æµ‹è¯•ï¼Œåªè¦æ˜¯â€œæ”¯æŒå›¢é˜Ÿå¼€å‘è¿‡ç¨‹çš„é¢å‘æŠ€æœ¯æµ‹è¯•â€éƒ½å¯ä»¥æ”¾åœ¨å…¶å†…ï¼Œæ¯”å¦‚ï¼šå¥‘çº¦æµ‹è¯•ã€‚<br>ç¬¬ä¸€è±¡é™çš„æµ‹è¯•æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œæ”¯æŒå¿«é€Ÿåé¦ˆçš„ã€‚</p><h4 id="2-ç¬¬äºŒè±¡é™ï¼Œæ›´é«˜å±‚æ¬¡çš„æ”¯æŒå›¢é˜Ÿå¼€å‘">2. ç¬¬äºŒè±¡é™ï¼Œæ›´é«˜å±‚æ¬¡çš„æ”¯æŒå›¢é˜Ÿå¼€å‘</h4><p>ç¬¬äºŒè±¡é™ä¹Ÿå¯ä»¥å«é¢å‘ç”¨æˆ·çš„æµ‹è¯•ï¼Œå®ƒä»¬ç¡®å®šå¤–éƒ¨è´¨é‡å’Œç”¨æˆ·éœ€è¦çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬éªŒè¯ç”¨æˆ·æ•…äº‹ã€åŠŸèƒ½ã€ç•Œé¢ã€äº¤äº’ç­‰ç­‰ã€‚<br>ä½†æ—¢ç„¶æ˜¯æ•æ·æµ‹è¯•ï¼Œè¿™é‡Œå¼ºè°ƒçš„å°±åˆæ˜¯ â€”â€” æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œåªä¸è¿‡æ˜¯ä»ä¸€ä¸ªæ›´é«˜çš„å±‚æ¬¡ä¸Šï¼ŒåŒ…å«äº†ATDDã€BDDã€‚</p><p>ç¬¬äºŒè±¡é™éœ€è¦æµ‹è¯•äººå‘˜å‚ä¸ï¼Œå¼€å‘äººå‘˜æä¾›æŠ€æœ¯æ”¯æŒï¼Œäº§å“äººå‘˜æä¾›ä¸šåŠ¡å’Œç”¨æˆ·æ•…äº‹ã€‚<br>æµ‹è¯•äººå‘˜éœ€è¦å¯¹äº§å“ç³»ç»Ÿæœ‰å…¨é¢çš„äº†è§£ã€å…³æ³¨å…¨å±€ã€æ•…äº‹çš„ä¸šåŠ¡å’ŒæŠ€æœ¯æ–¹é¢ï¼Œè€Œä¸”å§‹ç»ˆè€ƒè™‘æœ€ç»ˆç”¨æˆ·ä½“éªŒï¼Œä»¥æ¿€å‘å’Œæ­ç¤ºéœ€æ±‚ä¸­çš„è¾¹ç•Œå’Œéšè—å‡å®šï¼Œæœ€ç»ˆåŒä¸šåŠ¡å’Œå¼€å‘ä»¬æ˜ç¡®éªŒæ”¶æµ‹è¯•é¡¹ï¼Œä»¥æ­¤æ¥å¸®åŠ©å›¢é˜Ÿå¼€å‘æ­£ç¡®çš„éœ€æ±‚ã€‚<br>åœ¨å¿…è¦æƒ…å†µä¸‹ï¼Œæµ‹è¯•äººå‘˜ä½¿ç”¨ä¸šåŠ¡é¢†åŸŸè¯­è¨€DSLå°†éªŒæ”¶æµ‹è¯•è½¬åŒ–ä¸ºèƒ½å¤Ÿæ‰§è¡Œçš„æµ‹è¯•ä»£ç ï¼Œå®ç°BDDï¼Œä»¥é©±åŠ¨å¼€å‘ã€‚ä¸€äº›è¾ƒå¸¸è§çš„å·¥å…·æ¯”å¦‚cucumberã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœæœ‰äººè¯´ï¼Œå›¢é˜Ÿæµ‹è¯•äººå‘˜å¿™çš„æ²¡æ—¶é—´ï¼Œåªèƒ½åœ¨å¼€å‘æ•´ä½“å®Œæˆäº†ä¹‹åæ‰èƒ½ä»¥â€œæµ‹è¯„â€ã€â€œæŸ¥bugsâ€çš„å½¢å¼è¿›è¡Œç”¨æˆ·æ•…äº‹æµ‹è¯•ã€åŠŸèƒ½æµ‹è¯•ã€‚<br>é‚£æˆ‘åªèƒ½é€ä¸¤è€è¯ï¼š<br>â€œä½ æ— æ³•æŠŠè´¨é‡æµ‹è¯•è¿›äº§å“ä¸­â€ã€â€œä¸€æ¬¡æ€§æŠŠäº‹æƒ…åšå¥½ï¼Œå¯ä»¥æœç»æµªè´¹â€ã€‚<br>ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯æµ‹è¯•äººå‘˜å‘ç°äº†bugsï¼Œè¿˜æ˜¯éœ€è¦è¿”å·¥ç»™å¼€å‘äººå‘˜ä¿®å¤ï¼Œå¼€å‘ä¿®å¤åï¼Œæµ‹è¯•äººå‘˜å†é‡æµ‹ï¼Œæ›´ä½•å†µbugså‘ç°çš„è¶Šæ™šï¼Œä¿®å¤çš„æˆæœ¬è¶Šé«˜ã€‚è¿™äº›ç§ç§ï¼Œå…¶å®é€ æˆä¸€äº›æ—¶é—´å’Œæ•ˆèƒ½çš„æµªè´¹ï¼Œæ— æ³•å®ç°åŠæ—¶çš„æ”¯æŒå›¢é˜Ÿå¼€å‘ã€‚</p><blockquote><p>å†ä¸¾ä¸€ä¸ªæœ€è¿‘ç”Ÿæ´»ä¸­ç¢°åˆ°çš„æœ‰è¶£çš„ä¾‹å­ï¼šæœ¬äººæœ€è¿‘ç”³è¯·äº†æŸè®¯ç‹å¡å‡çº§5Gçš„ä¸šåŠ¡ã€‚<br>10æœˆ31æ—¥å‡ºçš„æŸè®¯ç‹å¡5Gå®£ä¼ ï¼Œæœ¬äººæ»¡è¶³ä¸Šé¢æ‰€æœ‰å‰ç½®æ¡ä»¶ï¼Œçœ‹ç€å¹¿å‘Šä¸Š11æœˆ30æ—¥ä¹‹å‰åŠç†å¯ä»¥åŠå¹´æœˆç§Ÿäº«å—7æŠ˜çš„ä¼˜æƒ ï¼ŒåŒæ—¶æƒ³æ”¯æŒä¸€æŠŠ5Gäº‹ä¸šï¼Œ<br>äºæ˜¯æœæ–­ä¹°äº†5Gæ‰‹æœºï¼Œæ¥ç€ç‚¹å‡»äº†ç‹å¡åŠ©æ‰‹çš„ç”³è¯·å‡çº§5Gã€‚<br>ç»“æœï¼Œç¬¬ä¸€æ¬¡çŸ­ä¿¡åé¦ˆï¼Œç”³è¯·å¤±è´¥ â€”â€” å› ä¸ºæœ‰ä¸€ä¸ªç‹å¡ç¦åˆ©0å…ƒ1Gæµé‡åŒ…ã€‚<br>æ‰‹åŠ¨ä¸Šè”é€šappæ³¨é”€äº†è¯¥ä¸šåŠ¡ï¼Œæ˜¾ç¤ºæµé‡åŒ…å°†åœ¨11æœˆ30æ—¥å¤±æ•ˆã€‚<br>å†æ¬¡ç‚¹å‡»ç”³è¯·å‡çº§ï¼Œç¬¬äºŒæ¬¡çŸ­ä¿¡åé¦ˆï¼Œç”³è¯·å¤±è´¥ â€”â€” å› ä¸ºè¿™ä¸ªæµé‡åŒ…å¤±æ•ˆæ—¶é—´åœ¨11æœˆ30æ—¥ï¼Œå› æ­¤åªèƒ½åœ¨12æœˆæ‰èƒ½åŠç†ã€‚<br>ä¸€çœ‹ï¼Œå“ªæœ‰è¿™æ ·çš„è¯´æ³•ï¼Œè¿™è¦æ˜¯å¼€é€šä¸äº†ï¼Œä¸ç­‰äºå¹¿å‘Šè™šå‡å®£ä¼ ä¹ˆï¼Œäºæ˜¯é©¬ä¸Šè”ç³»äº†ç‹å¡å®¢æœå’Œè”é€šå®¢æœã€‚<br>å†ç»3å¤©çš„æ²Ÿé€šå’Œåä½œï¼Œæœ€åç‹å¡å®¢æœ + æˆ‘ + è”é€šç”µè¯å®¢æœï¼Œæ‰æˆåŠŸå®Œæˆè¿™æ¬¡5Gå¥—é¤çš„å‡çº§ã€‚<br>ä¸»è¦åŸå›  â€”â€” ç‹å¡å®¢æœçš„è´¦å·æƒé™æ ¹æœ¬å®Œæˆä¸äº†è¿™äº›æµé‡åŒ…çš„ç«‹å³å–æ¶ˆå¤±æ•ˆï¼Œä¹Ÿå°±æ— æ³•åœ¨å¹¿å‘Šä¼˜æƒ æœŸå†…å®ŒæˆåŠç†5Gå¥—é¤ã€‚<br>æœ€åæ˜¯ä¾é è”ç³»è”é€šç”µè¯å®¢æœè¿™æ¡workaroundæ‰å®ŒæˆåŠç†5Gå¥—é¤ã€‚<br>çœ‹çœ‹ï¼Œæ•´ä¸ªåŠŸèƒ½æµ‹éƒ½æ²¡æœ‰æµ‹è¯•ï¼Œå°±ä¸Šçº¿äº†ã€‚è™½ç„¶å¯¹äº5Gåˆšå•†ç”¨ï¼Œå¿…ç„¶æœ‰äº›æ‰‹å¿™è„šä¹±è¡¨ç¤ºç†è§£ï¼Œä½†å¦ä¸€è§’åº¦ä¹Ÿè¯´æ˜â€œé¢å‘ä¸šåŠ¡â€çš„æµ‹è¯•æœ‰å¤šé‡è¦ã€‚<br>å½“ç„¶èƒ½åšåˆ°æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œå°±æ›´æ•æ·äº†ã€‚</p></blockquote><p>ç¬¬äºŒè±¡é™çš„æµ‹è¯•ä¸€èˆ¬æ˜¯è‡ªåŠ¨ + æ‰‹åŠ¨ï¼ŒBDDçš„æµ‹è¯•å¯ä»¥å®ç°è‡ªåŠ¨ï¼Œå¦å¤–åŸºäºç•Œé¢çš„End to Endã€æˆ–è€…æ˜¯åªåŸºäºAPIçš„é‡å¤æ€§å›å½’æµ‹è¯•éƒ½å°½é‡è‡ªåŠ¨åŒ–ï¼Œå°†æ‰‹åŠ¨æµ‹è¯•æ”¾åœ¨åˆ†æ æˆ–è€… å…¶ä»–è‡ªåŠ¨æµ‹è¯•å¼¥è¡¥ä¸äº†çš„å·¥ä½œä¸Šã€‚å¹¶ä¸”æ‰‹åŠ¨æµ‹è¯•æ—¶çš„å‰ç½®æ¡ä»¶ã€æµ‹è¯•æ•°æ®å‡†å¤‡ç­‰ç­‰ï¼Œå…¶å®ä¹Ÿå¯ä»¥å€ŸåŠ©è‡ªåŠ¨åŒ–å®Œæˆä»¥æé«˜æ•ˆç‡ã€‚</p><h4 id="3-æœ€å">3. æœ€å</h4><p>è¿™ç¯‡æ–‡ç« é‡Œé¢çš„ä¸¤ä¸ªç”Ÿæ´»ä¸­æœ‰è¶£çš„ä¾‹å­ï¼Œæ”¾åœ¨ç¬¬ä¸€è±¡é™ã€ç¬¬äºŒè±¡é™æœ‰äººä¹Ÿè®¸ä¼šè§‰å¾—æœ‰äº›ç¡¬é çš„æ„Ÿè§‰ã€‚<br>æˆ‘æƒ³è¯´ â€”â€” æ²¡é”™ğŸ¤£ã€‚è¿™ä¸¤ä¸ªä¾‹å­ç¡¬å†™è¿›æ¥ï¼Œå°±æ˜¯æƒ³åä¸‹æ§½ä»–ä»¬ä¸ºå•¥ä¸å¥½å¥½åšæµ‹è¯•ï¼Ÿ</p><blockquote><p>æˆ‘è¿™è¿˜æœ‰ç¬¬ä¸‰ä¸ªä¾‹å­ï¼š<br>åœ¨å®‰å’ŒæŸåº·åšä½“æ£€é¢„çº¦ï¼Œå°ç¨‹åºå¡«å…¥å·¥å·åï¼Œæ¥æ”¶æ‰‹æœºéªŒè¯ç è¿›è¡Œç™»å½•ã€‚<br>ç¬¬ä¸€æ¬¡ç™»å½•æˆåŠŸï¼Œå®Œæˆé¢„çº¦ï¼Œä¹‹åå‡ å¤©tokenå¤±æ•ˆäº†ã€‚å†è¿›è¡Œç™»å½•ï¼Œæ‰‹æœºå°±å†ä¹Ÿæ¥æ”¶ä¸åˆ°éªŒè¯ç äº†ã€‚<br>åé¦ˆç»™å®‰å’ŒæŸåº·å®¢æœï¼Œå®¢æœè”ç³»äº†æŠ€æœ¯éƒ¨ï¼Œæœ€åå°±æ‰”ç»™æˆ‘ä¸€ä¸ªç³»ç»Ÿå†…éƒ¨æ—¥å¿—ï¼Œå‘ŠçŸ¥æˆ‘å·²ç»å‘é€æˆåŠŸã€‚ã€‚<br>ç”±äºæƒ³è§£å†³é—®é¢˜ï¼Œæœ¬äººæ„¿æ„ååŠ©ä»–ä»¬çº¿ä¸Šdebugï¼Œå¹¶è”ç³»è”é€šå®¢æœæ’é™¤äº†æ‰‹æœºå’Œè”é€šè®¾ç½®çš„ä¸€åˆ‡é—®é¢˜ï¼Œç¬¬äºŒæ¬¡å®‰å’ŒæŸåº·æŠ€æœ¯éƒ¨è¿˜æ˜¯æ‰”ç»™æˆ‘ä¸€ä¸ªç³»ç»Ÿå†…éƒ¨æ—¥å¿—ã€‚ã€‚<br>æˆ‘æ˜¯ä¸€ä¸ªç”¨æˆ·ï¼Œä¸å…¶ä¹‹é—´éš”äº†ç”µä¿¡ä¾›åº”å•†ã€çŸ­ä¿¡æ¸ é“å•†ã€ä¹‹åå¯èƒ½æ‰åˆ°å®‰å’Œåå°ï¼Œç»™æˆ‘çœ‹åå°å†…éƒ¨æ—¥å¿—ã€‚ã€‚<br>æœ€åè¿˜æ˜¯å®¢æœäººå‘˜ä¸Šåœºï¼Œè¯¢é—®æˆ‘æ˜¯å¦å®Œæˆäº†é¢„çº¦ï¼Œæ²¡æœ‰å®Œæˆå¯ä»¥äººå·¥å¸®æˆ‘çš„å“Ÿ~ æ”¶ä¸åˆ°çŸ­ä¿¡éªŒè¯ç ï¼Œä¹Ÿå¯ä»¥åå°äººå·¥æŸ¥çš„å“Ÿ~<br>åŸºäºå®‰å’ŒæŸåº·è²Œä¼¼åªæ˜¯ä¸ªä½“æ£€èµ„æºåè°ƒæœåŠ¡å…¬å¸ï¼Œå¯èƒ½ç§‘æŠ€ä¸æ˜¯ä»–ä»¬çš„æ ¸å¿ƒé¢†åŸŸï¼Œç›´åˆ°æœ€åæˆ‘ä¾ç„¶æ— æ³•å†ç™»å½•ï¼Œé‚£ä¹Ÿåªèƒ½è¿™æ ·äº†ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•æ· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•æ·æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JIRA æŠ¥è¡¨ä½¿ç”¨æµ…æ</title>
      <link href="/2019/11/22/jira-bao-biao-shi-yong-qian-xi/"/>
      <url>/2019/11/22/jira-bao-biao-shi-yong-qian-xi/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆï¼Œè´´ä¸€ä¸‹å®˜æ–¹æŠ¥è¡¨çš„è¯´æ˜æ–‡æ¡£çš„é“¾æ¥ï¼š<a href="https://confluence.atlassian.com/jirasoftwareserver084/reporting-979406465.html">è·³è½¬</a><br>æœ€è¿‘è¯»äº†ä¸€æœ¬ä¹¦ï¼Œä¹¦ä¸­æœ‰ä¸€å¥è¯ï¼Œå¤§è‡´æ„æ€æ˜¯ï¼šæ–‡ç« å¤ªé•¿æ—¶ï¼Œå¤§éƒ¨åˆ†äººå…¶å®éƒ½ä¸ä¼šè¯»å®Œå®ƒã€‚<br>è§‰å¾—å¾ˆæœ‰é“ç†ï¼Œä½†æ˜¯è¿™ç¯‡JIRAè¿˜æ˜¯æ²¡åŠæ³•çš„å†™äº†å¾ˆé•¿ã€‚<br>å¸Œæœ›è¿™æ˜¯æœ¬äººæœ€åä¸€ç¯‡JIRAçš„åšæ–‡ã€‚è€¶ã€‚</p><p><img src="/2019/11/22/jira-bao-biao-shi-yong-qian-xi/JIRA-1.png" alt="JIRA"></p><h3 id="ä¸Scrum-sprintç›¸å…³çš„æŠ¥è¡¨">ä¸Scrum sprintç›¸å…³çš„æŠ¥è¡¨</h3><h4 id="1-Velocity-Chart">1. Velocity Chart</h4><p><img src="/2019/11/22/jira-bao-biao-shi-yong-qian-xi/JIRA-2.png" alt="Velocity Chart"><br>è¯¥æŠ¥è¡¨ä¼šåœ¨å¯¹åº” sprint complete ä¹‹åç”Ÿæˆå‡ºå¯¹åº”çš„ sprint velocity æ€»å€¼ã€‚<br>ä¸»è¦çš„ä½œç”¨æ˜¯ç»Ÿè®¡å†å² sprint velocityï¼Œç”¨ä»¥å¯¹å°†æ¥çš„ sprint plan æä¾› velocity ä¸Šçš„æŒ‡å¯¼å’Œå‚è€ƒã€‚<br>ä»¥åŠåœ¨ velocity è¶‹åŠ¿æ³¢åŠ¨çš„æ—¶å€™ï¼Œç»“åˆæ•°æ®å’Œå®é™…æƒ…å†µè¿›è¡Œåˆ†æ â€”â€” æ³¢åŠ¨äº§ç”Ÿçš„åŸå› ï¼Œç”¨ä»¥è°ƒæ•´å›¢é˜Ÿåœ¨å°†æ¥ sprint ä¸­çš„å·¥ä½œã€‚<br>æ³¨æ„ï¼švelocity æœ¬èº«åŸºäºçš„ä¼°ç®—ï¼Œæœ¬èº«å¹¶ä¸èƒ½ä½œä¸ºä¸€ä¸ª sprint å·¥ä½œé‡çš„æ‰¿è¯ºã€‚</p><p><strong>Commitmentï¼ˆæŸ±ï¼‰:</strong> ä»£è¡¨ sprint start çš„æ—¶å€™ï¼Œsprint plan çš„æ‰€æœ‰ issues ä¼°ç®—å€¼çš„æ€»å€¼ã€‚<br><strong>Completedï¼ˆæŸ±ï¼‰:</strong> ä»£è¡¨ sprint complete çš„æ—¶å€™ï¼Œå®é™…å®Œæˆçš„ issues ä¼°ç®—å€¼çš„æ€»å€¼ã€‚<br>**å½“å•æ¬¡Commitmentæ¯”Completedé«˜æ—¶ï¼Œ**ä»£è¡¨æœªå®Œæˆè®¡åˆ’çš„ issues scopeã€‚<br>**å½“å•æ¬¡Completedæ¯”Commitmenté«˜æ—¶ï¼Œ**ä»£è¡¨ sprint ä¸­ issues scope å‘ç”Ÿäº†å˜åŒ–ã€‚<br>psï¼šå½“ç„¶å¦‚æœä½ çš„å›¢é˜Ÿæ€»æ˜¯æ— æ³•åœ¨ sprint å¼€å¯çš„æ—¶å€™ï¼Œç¡®å®šå¥½ issues scopeï¼Œé‚£ Commitment æŸ±åŸºæœ¬ä¸Šæ˜¯å¸®ä¸äº†ä½ äº†ã€‚</p><p>velocity chart æ˜¯ board-specificâ€“ çš„ï¼Œæ„æ€æ˜¯è¯´ â€”â€” å¦‚æœæœ‰ä¸¤ä¸ª board ä½¿ç”¨åŒä¸€ä¸ª sprintï¼Œå½“å‰ board çš„ velocity chartåªä¼šè®¡ç®—å½“å‰ board scopeï¼ˆæ ¹æ®board configure Filterï¼‰ã€‚</p><h4 id="2-Burndown-Chart">2. Burndown Chart</h4><p><img src="/2019/11/22/jira-bao-biao-shi-yong-qian-xi/JIRA-3.png" alt="Burndown Chart"></p><p>è¯¥æŠ¥è¡¨ä¸éœ€è¦ç­‰åˆ° sprint complete ä¹‹åæ‰èƒ½çœ‹ã€‚<br>å…¶æ ¹æ®æ—¶é—´è½´ï¼Œæ¯å½“sprintå†…æœ‰ issue ä¼°ç®—å€¼å˜åŒ–çš„æ—¶å€™ï¼Œå°±ä¼šæ˜¾ç¤ºå¯¹åº”å˜åŒ–ã€‚<br>Burndown Chart ä¸»è¦çš„ä½œç”¨æ˜¯åœ¨sprintè¿‡ç¨‹ä¸­å®æ—¶è·Ÿè¸ªsprintçš„è¿›åº¦ï¼Œå½“ issues scope change é€ æˆ burnupï¼Œå½“ issue completed å burndown,<br>ä»¥åŠè§‚å¯Ÿå›¢é˜Ÿçš„å½“å‰ sprint å‰©ä½™å·¥ä½œé‡ã€ç¦»æœ€ç»ˆçš„æ•´ä½“ burndown çš„ç›®æ ‡è¿˜æœ‰å¤šè¿œï¼Œæ˜¯å¦è¦é‡‡å–ä¸€äº›å…¶ä»–çš„è¡ŒåŠ¨æ”¹è¿›ä»¥è¾¾åˆ°æœ€ç»ˆ burndownç›®æ ‡ç­‰ç­‰ã€‚</p><p>Burndown Chartä¹Ÿæ˜¯ board-specificâ€“ çš„ï¼ŒåŸºäºå½“å‰ board filterï¼š</p><ul><li>Scope change - Issue added to sprintï¼ˆå…·ä½“åŸå› ï¼‰: ä¸€ä¸ª issue åŠ å…¥äº†æ­¤ active sprintã€‚å…·ä½“åŸå› æœ‰å¤šç§ï¼Œæ¯”å¦‚â€œEstimate of 1 has been added"æ·»åŠ ä¼°ç®—ï¼Œâ€œEstimate changed from 3 to 2â€ä¿®æ”¹ä¼°ç®—ï¼Œç­‰ç­‰å…¶ä»–ã€‚</li><li>Burndown - Issue completed: ä¸€ä¸ªissueè¢«å®Œæˆã€‚â€œå®Œæˆâ€çš„å®šä¹‰æ˜¯åŸºäºboard columnçš„ï¼Œå½“issueè¢«æŒªåˆ°active boardæœ€å³çš„columnï¼Œå³è®¤ä¸ºcompleteã€‚</li></ul><h4 id="3-Release-Burndown-EPIC-Burndown">3. Release Burndown / EPIC Burndown</h4><p><img src="/2019/11/22/jira-bao-biao-shi-yong-qian-xi/JIRA-4.png" alt="Release Burndown"></p><p>Release Burndown / EPIC Burndown æ˜¯ä» Release version å’Œ EPIC çš„ç»´åº¦ï¼Œæ¥çœ‹æ¶‰åŠåˆ°çš„ sprint issues çš„burndownæ€»é‡ã€‚<br>æ¯”å¦‚ä¸Šå›¾ï¼š<br>é¦–å…ˆåœ¨å·¦ä¸Šè§’ä¸‹æ‹‰æ¡†é€‰æ‹©è¦æŸ¥çœ‹çš„ release versionï¼ŒæŠ¥è¡¨è¿›è¡Œæ˜¾ç¤ºã€‚<br>å›¾ä¸­ï¼Œè¯¥ release è®¡åˆ’äº¤ä»˜çš„ issues ä¼°ç®—å€¼æ€»æ•°102ã€‚ç»¿è‰²ä»£è¡¨ sprint å®Œæˆçš„é‡ï¼Œæ·±è“è‰²ä»£è¡¨ scope change, æµ…è“ä»£è¡¨å‰©ä½™çš„å·¥ä½œã€‚<br>å‡è®¾åŸè®¡åˆ’æ˜¯5ä¸ª sprint åå®Œæˆæ‰€æœ‰ issuesï¼Œé‚£ä¹ˆè¯¥å›¾è¡¨æ˜è¿›åº¦å·²ç» delayï¼Œå‰©ä½™ issues ä¼°ç®—å€¼28ï¼Œå·²ç»åœ¨å ç”¨åç»­ releaseçš„sprint 6 çš„æ—¶é—´ï¼Œå¹¶ä¸”åœ¨ sprint 6 ä¸­å‡å°‘äº†5ä¸ªä¼°ç®—å€¼çš„ scopeã€‚</p><h3 id="ä¸Scrum-sprintæ— å…³çš„æŠ¥è¡¨">ä¸Scrum sprintæ— å…³çš„æŠ¥è¡¨</h3><h4 id="1-Control-Chart">1. Control Chart</h4><p><img src="/2019/11/22/jira-bao-biao-shi-yong-qian-xi/JIRA-5.png" alt="Control Chart"><br>ä¸»è¦ä½œç”¨æ˜¯æ¥æŸ¥çœ‹é¡¹ç›®çš„cycle timeï¼ˆor lead timeï¼‰ã€‚<br>cycle timeä»£è¡¨issuesåœ¨å…·ä½“çš„columnå¯¹åº”çš„çŠ¶æ€ä¸Šè€—è´¹çš„æ—¶é—´ã€‚<br>lead timeä»£è¡¨æ•´ä¸ªå›¢é˜Ÿå¯¹issues â€”â€” ä»å¯¹åº”çš„éœ€æ±‚æå‡ºåˆ°å®ç°å®Œæˆè€—è´¹çš„æ—¶é—´ã€‚</p><p>å…ˆä»å›¾ä¸ŠæŒ‰é¡ºåºæ¥çœ‹ä¸€ä¸‹ï¼š<br>â‘  æŒ‡å‘çš„ç»¿è‰²ç©ºå¿ƒç‚¹ï¼Œä»£è¡¨ä¸€ä¸ª issueã€‚å¦‚æœæ˜¯ä¸€ä¸ªå¤§çš„ç»¿å®å¿ƒç‚¹ï¼Œä»£è¡¨ä¸€å †å¾ˆæ¥è¿‘çš„ issuesã€‚<br>â‘¡ æŒ‡å‘çš„æ˜¯ï¼Œå¯è‡ªå®šä¹‰çš„æŠ¥è¡¨ xæ¨ªè½´ æ—¶é—´åŒºé—´ã€‚<br>â‘¢ è¡¨ç¤ºï¼Œåœ¨æŠ¥è¡¨ä¸Šä½¿ç”¨é¼ æ ‡æ‚¬æµ®æ»‘åŠ¨ï¼Œå¯ä»¥æŸ¥çœ‹å›ºå®šæ—¶é—´ç‚¹çš„å€¼ä¿¡æ¯ã€‚<br>â‘£ æŒ‡å‘çš„æ˜¯ï¼ŒRefine reportï¼Œæ­¤æŠ¥è¡¨æœ€é‡è¦çš„ä¸€å— â€”â€” é’ˆå¯¹ issues scope çš„é€‰æ‹©ã€‚<br>æŠ¥è¡¨æœ€ä¸Šé¢æ˜¯ç»Ÿè®¡ä¿¡æ¯<code>cycle time</code>ã€<code>issues count</code>ã€‚</p><p><strong>Refine report</strong><br><code>Columns</code> / <code>Swimlanes</code> / <code>Quick Filter</code> ä¸‰ä¸ªè¿‡æ»¤æ¡ä»¶æ˜¯ â€œä¸&amp;â€ çš„å…³ç³»ã€‚</p><ul><li><code>Columns</code>ï¼šåŸºäºboard columnsï¼Œæä¾›å¤šé€‰ã€‚å‹¾é€‰ä¸Šçš„ columnsï¼ŒæŠ¥è¡¨ä¼šè®¡ç®—å‡º issues å¤„äºè¢«å‹¾é€‰çš„ columns çš„æ€» cycle timeï¼Œå¹¶è¿›è¡Œæ˜¾ç¤ºã€‚<br>è€ŒæŠ¥è¡¨å›¾ä¸Šçš„issueç»¿ç‚¹çš„æ¨ªå‘åæ ‡ï¼Œä»£è¡¨è¯¥ issue â€œç»ˆæ­¢â€è¯¥ç»„ columns çš„æ—¶é—´ç‚¹ã€‚çºµåæ ‡ä»£è¡¨è¯¥ issue çš„cycle timeã€‚</li><li><code>Swimlanes</code>: åŸºäºboard configure Swimlanesè®¾ç½®çš„JQL filterè¿›è¡Œissues scopeè¿‡æ»¤ã€‚</li><li><code>Quick filter</code>: åŸºäº board configure Quick Filters è®¾ç½®çš„ JQL filter è¿›è¡Œ issues scope è¿‡æ»¤ã€‚</li></ul><p>Swimlanes ä¸€èˆ¬æ˜¯åŸºäºboardè®¡ç®—çš„ï¼Œå˜åŠ¨ä¸ä¼šå¤ªå¤§å’Œé¢‘ç¹ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡éšæ—¶å®šåˆ¶ Quick filterï¼Œæ¥è¿›è¡Œ Control chart æŠ¥è¡¨åˆ†ææ—¶çš„è¿‡æ»¤ã€‚<br>æ¯”å¦‚æ·»åŠ ä¸€ä¸ª Quick filter â€”â€” ä¸ºäº†è¿‡æ»¤å‡ºæŸä¸€ä¸ª sprint æˆ–è€… release çš„ issuesï¼›è¿˜æ¯”å¦‚å®˜æ–¹æ¨èäº†ä¸€ä¸ªå»é™¤<code>æ²¡æœ‰å‚è€ƒä»·å€¼çš„å¼‚å¸¸issue</code> çš„æ–¹æ³•ï¼Œå°±æ˜¯é€šè¿‡åœ¨å…·ä½“çš„å¼‚å¸¸ issue label ä¸Šè¿›è¡Œæ ‡è®°ï¼Œç„¶åå®šåˆ¶ Quick filter è¿›è¡Œè¿‡æ»¤çš„æ–¹å¼ï¼Œåœ¨ Control Chart ç»Ÿè®¡æ—¶æ’é™¤å¼‚å¸¸ issuesã€‚</p><p><strong>Include non-working days in calculations</strong><br>æŠ¥è¡¨å³ä¸‹è§’æœ‰ä¸€ä¸ªviewing optionï¼Œ<code>Include non-working days in calculations</code>ä¸å‹¾é€‰æ—¶ï¼Œcycle time çš„è®¡ç®—ä¸ä¼šåŒ…å«éå·¥ä½œæ—¥ã€‚<br>è‡³äº Control Chart ä¸Šç»Ÿè®¡æ•°æ®<code>cycle time</code>ï¼ŒåŒ…æ‹¬average\median\min\maxçš„æ—¶é—´æ˜¾ç¤ºï¼Œå•ä½w/d/hä¸­ï¼Œ<code>1w = 7 working days</code>ï¼Œä»…æ˜¯ä¸€ç§ç®€å•çš„å•ä½æ¢ç®—ï¼Œä¸è¦äº§ç”Ÿè¯¯åŒºã€‚</p><p><strong>æŸ¥çœ‹lead time</strong><br>å¦‚æœé¡¹ç›®è®¾å®š issue ä» <code>ready for dev</code> åˆ° <code>In dev</code> åˆ° <code>Dev Done</code> åˆ° <code>In QA</code> åˆ° <code>QA Done</code>ï¼Œæ˜¯ä¸€ä¸ªéœ€æ±‚ä»æå‡ºåˆ°å®Œæˆå®ç°çš„æ•´ä¸ªæµç¨‹çš„è¯ï¼Œå°† columns å‹¾é€‰ä¸Š <code>ready for dev</code> \ <code>In dev</code> \ <code>Dev Done</code> \ <code>In QA</code> 4ä¸ªçŠ¶æ€ï¼Œåˆ™å¯ä»¥ç»Ÿè®¡å’Œç»˜åˆ¶å‡º lead time å’Œç›¸å…³ issuesã€‚<br>å¦‚æœæƒ³åˆ†æ â€”â€” åˆ°å¼€å‘ä»¬å®Œæˆå¡çš„è¿™æ®µ cycle timeï¼Œå¯ä»¥ä»…å‹¾é€‰<code>ready for dev</code> \ <code>In dev</code> 2ä¸ªçŠ¶æ€ï¼Œå³å¯æŸ¥çœ‹ã€‚æ³¨æ„ï¼Œä¸è¦å°†æœ€åçš„ç¼“å†²é˜Ÿåˆ— <code>Dev Done</code> è¯¯å‹¾é€‰è¿›å»ã€‚</p><p><strong>rolling cycle time</strong><br>rolling cycle timeæ˜¯æ ¹æ®<code>å½“å‰issue + å‰é¢xä¸ªissue + åé¢xä¸ªissue</code>çš„å¹³å‡cycle timeã€‚x æ˜¯åŸºäºæ—¶é—´è½´ä¸Šçš„issueæ€»æ•°çš„ä¸€ä¸ªå–å€¼ã€‚<br>ç›®çš„æ˜¯ä¸ºäº†å±•ç¤ºcycle timeçš„ä¸€ä¸ªå…·ä½“èŒƒå›´è¶‹åŠ¿ â€”â€” average cycle timeå°±æ˜¯ä¸€æ¡æ°´å¹³çº¿ã€‚<br>æŠ¥è¡¨ä¸Šçš„è“è‰²é˜´å½±åŒºï¼Œä»£è¡¨issue cycle timeå’Œrolling cycle timeçš„æ ‡å‡†åå·®å€¼ï¼Œè“è‰²åŒºåŸŸè¶Šçª„ï¼Œä»£è¡¨issue cycle timeæ›´æ¥è¿‘å‘¨è¾¹çš„issues cycle timeï¼Œè¿™æ®µrolling cycle timeç½®ä¿¡å€¼è¶Šé«˜ï¼›è¶Šå®½çš„åŒºåŸŸï¼Œissueå¼‚å¸¸æƒ…å†µè¶Šå¤šï¼Œrolling cycle timeç½®ä¿¡å€¼è¶Šä½ã€‚rolling cycle timeç½®ä¿¡å€¼è¶Šä½ï¼Œä»£è¡¨è¯¥æ—¶é—´æ®µé™„è¿‘issueå¼‚å¸¸è¶Šå¤šã€‚</p><p>å¦ç±»ä½¿ç”¨å°tipsï¼šcolumnså•é€‰ä¹‹åï¼Œæ¯”å¦‚In Devï¼Œè®¡ç®—å‡ºæ¥çš„Average cycle * issues countï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ­¤columnå†…å¯¹åº”issuesçš„æ—¶é—´æŠ•å…¥ç¨‹åº¦ï¼ˆå‰æï¼Œå›¢é˜Ÿæœ‰æŒ‰çœŸå®æƒ…å†µåŠæ—¶æŒªå¡ï¼‰ã€‚</p><h4 id="2-Cumulative-Flow-Diagram">2. Cumulative Flow Diagram</h4><p><img src="/2019/11/22/jira-bao-biao-shi-yong-qian-xi/JIRA-6.png" alt="Cumulative Flow Diagram"></p><p>Cumulative Flow Diagram å…¶å®éå¸¸ç®€å•ï¼Œæ¨ªè½´æ˜¯æ—¶é—´è½´ï¼Œçºµè½´æ˜¯ issue æ•°é‡ã€‚<br>ä¸åŒçš„è‰²å¸¦ï¼Œä»£è¡¨ä¸åŒçš„ columnï¼Œè‰²å¸¦ä¸Šè¾¹ç•Œå€¼ä»£è¡¨è¯¥æ—¶é—´ç‚¹è¿›å…¥è¿‡ï¼ˆå¤„äºè¯¥column + å·²ç»transferåˆ°åç»­columnï¼‰çš„ issue æ€»æ•°å€¼ï¼Œè‰²å¸¦çš„çºµå‘å®½åº¦å³æ˜¯ â€œå¤„äºè¯¥columnâ€ çš„ issue æ€»æ•°ã€‚<br>Cumulative Flow Diagram ä¸»è¦ç”¨æ¥åˆ†æ issues æµé‡è¶‹åŠ¿æ˜¯å¦æ­£å¸¸ã€å›¢é˜Ÿæ˜¯å¦å­˜åœ¨ç“¶é¢ˆã€‚<br>æ¯”å¦‚ï¼š<br>åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µå†…ï¼ŒDev done è‰²å¸¦åœ¨çºµå‘ä¸Šé€æ¸å˜å®½ï¼Œä»£è¡¨ç­‰å¾… QA æµ‹è¯•çš„ issues å †ç§¯è¶Šæ¥è¶Šå¤šï¼ŒQA å­˜åœ¨ç“¶é¢ˆï¼›<br>åœ¨æŸä¸€ä¸ªæ—¶é—´ç‚¹ï¼ŒIn Dev è‰²å¸¦ä¸Šè¾¹ç•Œå€¼æœ‰ä¸‹é™è¶‹åŠ¿ï¼Œä»£è¡¨æœ‰éƒ¨åˆ† issues ä» In dev çŠ¶æ€è¢«é‡ç½®å›ä¸Šæ¸¸ columnï¼Œä»£è¡¨ issue å†…å®¹å¯èƒ½è¢«è¿”å·¥ï¼›<br>åœ¨æŸä¸€ä¸ªæ—¶é—´ç‚¹ï¼ŒIn Dev è‰²å¸¦åœ¨çºµå‘ä¸Šçš„å®½åº¦æ¯”æ­£å¸¸æ—¶çª„ï¼Œè¯´æ˜åœ¨åˆ¶å“åœ¨å‡å°‘ï¼Œå¦‚æœå¼€å‘äººå‘˜å¹¶æ²¡æœ‰å‡å°‘æ—¶ï¼Œä»£è¡¨éƒ¨åˆ†å¼€å‘äººå‘˜åœ¨ç©ºè½¬ï¼›<br>åœ¨ä¸€ä¸ª sprint æ—¶é—´æ®µå†…ï¼ŒPreparing é«˜åº¦ä»ç„¶åœ¨ä¸Šå‡ï¼Œè¯´æ˜ sprint scope åœ¨å¢åŠ ï¼›<br>æ‰€æœ‰ in progress çš„ columns è‰²å¸¦ï¼Œåœ¨æ¨ªå‘å®½åº¦ä¸Šå˜å®½ï¼Œè¯´æ˜ lead time åœ¨é€æ¸å˜é•¿ã€‚</p><p><strong>Refine report</strong><br>ä¸ Control Chart ç›¸åŒï¼Œå¯¹ issues scope è¿›è¡Œè¿‡æ»¤ã€‚å‚ç…§Control Chart Refine reportã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•æ·å¼€å‘ç®¡ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•æ·å¼€å‘ç®¡ç† </tag>
            
            <tag> JIRA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scrumå½¢å¤–ä¹‹ç¥</title>
      <link href="/2019/10/23/scrum-xing-wai-zhi-shen/"/>
      <url>/2019/10/23/scrum-xing-wai-zhi-shen/</url>
      
        <content type="html"><![CDATA[<p>ä»€ä¹ˆæ˜¯Scrum?<br>Scrumæ˜¯æ•æ·è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„ä¸€ç§æ¡†æ¶ï¼Œç”¨ä»¥å®ç°è¿­ä»£å¼å¢é‡å¼€å‘ã€‚<br>å¥½å§ï¼Œå¾ˆæŠ½è±¡ã€‚</p><p>é‚£æ˜¯ä¸æ˜¯ â€”â€” åªè¦æœ‰äº†sprintã€IPMã€Showcaseã€Retrospectiveã€å¯è§†åŒ–å¡å¢™ã€æ¯æ—¥ç«™ä¼šï¼Œè¿™äº›æµç¨‹å’Œå·¥å…·ï¼Œå°±å·²ç»å®ç°Scrumäº†å‘¢ï¼Ÿ<br>ä¹Ÿè®¸æœ‰äººä¼šè¯´æ˜¯ã€‚è¿™çœ‹èµ·æ¥åŸºæœ¬å°±æ˜¯ä¸€ä¸ªScrumçš„MVP(Minimum viable product)ã€‚</p><p>å¥½ï¼Œé‚£å‡è®¾æˆ‘ä»¬çš„å›¢é˜Ÿå·²ç»å®ç°äº†Scrumæµç¨‹çš„MVPã€‚<br>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è¿›è¡Œä¸€ä¸‹æ¯æ—¥ç«™ä¼šã€‚è¯·æ¯ä¸ªäººä¾æ¬¡å¯¹ä¸‰ä¸ªé—®é¢˜è¿›è¡Œæè¿°ã€‚<br>ä¸‰ä¸ªé—®é¢˜ï¼Œå“ªä¸‰ä¸ªé—®é¢˜ï¼Ÿ</p><ol><li>ä½ æ˜¨å¤©åšäº†ä»€ä¹ˆï¼Ÿ</li><li>ä»Šå¤©è®¡åˆ’åšä»€ä¹ˆï¼Ÿ</li><li>é‡åˆ°ä»€ä¹ˆé˜»ç¢æˆ–é—®é¢˜ï¼Ÿ<br>ä¸€èˆ¬å¤§å®¶éƒ½è®¤ä¸ºæ˜¯è¿™ä¸‰ä¸ªé—®é¢˜æ˜¯ä¸æ˜¯ï¼Ÿ</li></ol><p>å¾ˆå¤šäººéƒ½å®¹æ˜“æŠŠæ¯æ—¥ç«™ä¼šè§†ä¸ºä¸€ä¸ªç®€å•çš„ä¸ªäººæŠ¥å‘Šä¼šã€‚<br>ä½†å…¶å®ï¼ŒScrumçš„åŸç‰ˆä¸‰ä¸ªé—®é¢˜æ˜¯ï¼š</p><ol><li>ä½ æ˜¨å¤©åšäº†ä»€ä¹ˆå»å¸®åŠ©å›¢é˜Ÿå®Œæˆå†²åˆºï¼Ÿ</li><li>ä»Šå¤©ä½ æ‰“ç®—åšä»€ä¹ˆæ¥å¸®åŠ©å›¢é˜Ÿå®Œæˆå†²åˆºï¼Ÿ</li><li>ä»€ä¹ˆå› ç´ é˜»ç¢äº†å›¢é˜Ÿçš„å‰è¿›ä¹‹è·¯ï¼Ÿ<br>è¯·æ³¨æ„ï¼Œæœ‰ä¸¤ä¸ªå­—åœ¨è¿™ä¸‰ä¸ªé—®é¢˜ä¸­ä¸€å†å‡ºç° â€”â€” â€œå›¢é˜Ÿ/å›¢é˜Ÿ/å›¢é˜Ÿâ€ã€‚<br>ä¹Ÿè®¸æœ‰äººä¼šè®¤ä¸ºåŒºåˆ«ä¸å¤§ â€”â€” æ¯ä¸ªäººåšå¥½è‡ªå·±çš„å·¥ä½œï¼Œå°±æ˜¯åœ¨æ¨è¿›å›¢é˜Ÿæ•´ä½“çš„è¿›åº¦ã€‚</li></ol><span id="more"></span><h3 id="1-å›¢é˜Ÿä¹‹åŠ›">1. å›¢é˜Ÿä¹‹åŠ›</h3><p>å®è¡Œscrumçš„ç›®æ ‡ä¹‹ä¸€ï¼Œæå‡å›¢é˜Ÿèƒ½æ•ˆï¼Œé¡¹ç›®è¿›å±•é€Ÿåº¦åº”è¯¥æ˜¯è¶Šæ¥è¶Šå¿«çš„ã€‚</p><h4 id="1-1-å›¢é˜Ÿå­¦ä¹ å’ŒçŸ¥è¯†å…±äº«">1.1. å›¢é˜Ÿå­¦ä¹ å’ŒçŸ¥è¯†å…±äº«</h4><p>å‡è®¾æœ‰ä¸€å †3ä¸ªæœˆä»¥ä¸Šå·¥ä½œé‡storyå¡ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ol><li>åˆ†ç»™5ä¸ªå·¥ç¨‹å¸ˆï¼Œä»–ä»¬å„è‡ªéƒ½æœ‰å……è¶³çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡æ¥å¼€å‘ï¼Œä½†è¿™5ä¸ªå·¥ç¨‹å¸ˆç›¸äº’ä¹‹é—´éƒ½ä¸åœ¨åŒä¸€ä¸ªteamï¼Œéœ€è¦æ¯äººç‹¬ç«‹å®Œæˆå·¥ä½œã€‚</li><li>åˆ†ç»™ä¸€ä¸ªæœ‰5ä¸ªå·¥ç¨‹å¸ˆçš„teamï¼Œå›¢é˜Ÿæ€§å®Œæˆå·¥ä½œã€‚<br>ä»åšå¡é€Ÿç‡æ¥è€ƒè™‘ï¼Œä½ ä¼šå€¾å‘äºå“ªä¸€ç§é€‰æ‹©ï¼Ÿ</li></ol><p>ä¼°è®¡åœ¨æœ‰çš„PMçœ‹æ¥ï¼Œå¦‚æœè¿™äº›å·¥ç¨‹å¸ˆçš„æŠ€èƒ½Leveléƒ½ç›¸åŒçš„è¯ï¼Œè¿™ä¸¤ç§é€‰æ‹©æ ¹æœ¬æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚<br>ä½†æ˜¯å…¶å®ä¸ç„¶ã€‚</p><p>å¦‚æœå¯ä»¥é€‰æ‹©ï¼Œå°†è¿™é‡Œçš„å·¥ç¨‹å¸ˆéƒ½æ›¿æ¢æˆ10å€æ•ˆç‡å·¥ç¨‹å¸ˆï¼Œé€‰æ‹©ä¸€çš„æ•´ä½“åšå¡é€Ÿåº¦ä¼šæå‡10å€ï¼›è€Œé€‰æ‹©äºŒä¸­å³ä½¿æ›¿æ¢æˆ5å€æ•ˆç‡å·¥ç¨‹å¸ˆï¼Œæ•´ä¸ªå›¢é˜Ÿæ•´ä½“åšå¡é€Ÿåº¦ä¹Ÿä¼šè¿œè¿œå¤§äº10å€ã€‚<br>ä¸ºä»€ä¹ˆï¼Ÿ</p><p>ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼šå‡è®¾storyå¡ä¸­æ¶‰åŠåˆ°æ–°çš„æŠ€æœ¯çŸ¥è¯†ï¼Œé€‰æ‹©ä¸€ï¼Œæ•´ä½“èŠ±è´¹çš„ä»é›¶å¼€å§‹ç‹¬ç«‹çš„å­¦ä¹ æ—¶é—´æ˜¯5äººä»½ï¼›è€Œé€‰æ‹©äºŒï¼Œåªéœ€è¦å›¢é˜Ÿä¸­ä¸€ä¸ªäººä»é›¶å¼€å§‹å­¦ä¹ ï¼Œç„¶åé€šè¿‡æœ‰æ•ˆçš„çŸ¥è¯†åˆ†äº«å’Œä¼ é€’ï¼Œå¿«é€Ÿçš„è®©æ•´ä¸ªå›¢é˜Ÿæ‰€æœ‰äººæŒæ¡æ­¤é¡¹æŠ€æœ¯ã€‚</p><h4 id="1-2-æ¶ˆé™¤å•äººè¿›åº¦çš„ç“¶é¢ˆ">1.2. æ¶ˆé™¤å•äººè¿›åº¦çš„ç“¶é¢ˆ</h4><p>å½“ç„¶ä¹Ÿä¸åªæ˜¯å­¦ä¹ æ–°æŠ€æœ¯çš„åœºæ™¯ï¼Œè”æƒ³ä¸€ä¸‹å¹³æ—¶æœ‰æ²¡æœ‰è¿™æ ·çš„åœºæ™¯ï¼š<br>Aå·¥ç¨‹å¸ˆåœ¨ç«™ä¼šä¸Šè¡¨ç¤ºå½“å‰è¿›åº¦è¢«ä¸€ä¸ªæŠ€æœ¯æ€§é—®é¢˜å›°æ‰°ï¼Œæ­£å¥½Bæœ‰ç›¸å…³ç»éªŒï¼Œäºæ˜¯Bä¸»åŠ¨è¡¨ç¤ºä»Šå¤©ä¼šè·ŸA pairæ¥ä¸ºå…¶åŠ é€Ÿå’Œä¼ é€’ç›¸å…³çŸ¥è¯†ã€‚</p><p>æ¯ä¸ªä¸ªä½“éƒ½æœ‰é•¿çŸ­æ¿å’Œç“¶é¢ˆï¼Œå›¢é˜Ÿæ­£æ˜¯ç›¸äº’ä¹‹é—´ä»¥å·±ä¹‹é•¿ã€è¡¥å½¼ä¹‹çŸ­ã€‚<br>å³ä½¿å¾ˆä¸å·§ï¼Œä¸€ä¸ªå›¢é˜Ÿä¸­é•¿çŸ­æ¿éƒ½ç›¸åŒï¼Œè¿™é‡Œå¯ä»¥æƒ³è±¡ä¸€ä¸‹é¸£äººåˆ©ç”¨å½±åˆ†èº«å­¦ä¹ çš„åœºæ™¯â€”â€”â€”â€”å¤šçº¿ç¨‹ä¸åŒè§’åº¦çš„è¯•é”™ï¼Œå†é€šè¿‡äº¤æµå’ŒçŸ¥è¯†å…±äº«ï¼Œæœ€ç»ˆè¿˜æ˜¯èƒ½è®©å›¢é˜Ÿå¿«é€Ÿå…‹æœç“¶é¢ˆã€è·å¾—æ›´å…¨é¢çš„æˆé•¿ã€‚</p><h4 id="1-3-å°è§„æ¨¡çš„åŠ æŒ">1.3. å°è§„æ¨¡çš„åŠ æŒ</h4><p>ä»ä¸Šé¢ä¸¤ç‚¹å¯ä»¥è§‚å¯Ÿåˆ°å›¢é˜Ÿä¹‹ä¸­ç›¸äº’ä¹‹é—´ä¿¡æ¯é€æ˜ã€æ²Ÿé€šäº¤æµéå¸¸é‡è¦ã€‚<br>Scrumå›¢é˜Ÿä¸­ï¼Œæ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»çŸ¥é“å…¶ä»–äººåœ¨åšä»€ä¹ˆã€‚åŒæ—¶æ¯ä¸ªäººè‡ªå·±æ­£åœ¨åšä»€ä¹ˆå·¥ä½œï¼Œæ­£é¢ä¸´ç€å“ªäº›æŒ‘æˆ˜ï¼Œå–å¾—äº†å“ªäº›è¿›æ­¥ç­‰ç­‰ï¼Œéƒ½å¿…é¡»é€æ˜ï¼Œè®©åˆ«äººçŸ¥é“ã€‚<br>è¿™é‡Œå…¶å®ä¼šèŠ±è´¹ä¸€äº›æ²Ÿé€šæˆæœ¬ï¼Œå¦‚æœå›¢é˜Ÿè¿‡å¤§ï¼Œå›ºç„¶æ˜¯ä¼šè®©æ²Ÿé€šæˆæœ¬å¢åŠ ï¼ŒåŒæ—¶ä¼šç»™æ¯ä¸ªæˆå‘˜å…³æ³¨çš„æ²Ÿé€šæ¸ é“æ•°å¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚<br>å›¢é˜Ÿæˆå‘˜å¢åŠ ä¹‹åï¼Œç›¸äº’ä¹‹é—´æ²Ÿé€šæ¸ é“å°±ä¼šå¤§å¹…å¢åŠ ã€‚</p><pre class="line-numbers language-none"><code class="language-none">å›¢é˜Ÿæ€»æ²Ÿé€šæ¸ é“æ•° = n * (n - 1) / 2# nä¸ºæˆå‘˜æ•°é‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœæ˜¯7äººï¼Œå›¢é˜Ÿæ€»æ²Ÿé€šæ¸ é“æ•°æ˜¯21ï¼Œ9äººæ˜¯36ï¼Œ10äººåˆ™æ˜¯45ã€‚<br>äººç±»çš„å¤§è„‘å¯èƒ½æ ¹æœ¬æ— æ³•åº”ä»˜è¿™ä¹ˆå¤šçš„æ²Ÿé€šæ¸ é“ã€‚<br>ç›¸ä¿¡å¤§å®¶éƒ½åœ¨ç«™ä¼šå’Œcode reviewçš„æ—¶å€™æœ‰è¿™æ ·çš„æ„Ÿè§‰ï¼Œå½“äººæ•°ä¸Šå‡ä¹‹åï¼Œè¶Šæ¥è¶Šä¸èƒ½å……è¶³çš„äº†è§£å…¶ä»–æˆå‘˜æ­£åœ¨å¹²ä»€ä¹ˆï¼Œæ›´åˆ«è¯´ä¸»åŠ¨å‘ç°å¹¶ç»™äºˆå¸®åŠ©äº†ã€‚</p><h3 id="2-å¿«é€Ÿåé¦ˆå’Œæ”¹è¿›ä¹‹åŠ›">2. å¿«é€Ÿåé¦ˆå’Œæ”¹è¿›ä¹‹åŠ›</h3><p>Scrumçš„ç›®æ ‡æ˜¯ä¸ºäº†å®ç°è¿­ä»£å¢é‡å¼€å‘ï¼Œä»è€Œäº§ç”Ÿåé¦ˆï¼Œä»ä¸­å­¦ä¹ ï¼Œä¹‹åè°ƒæ•´æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ä¸œè¥¿å’Œæˆ‘ä»¬çš„æ„å»ºæ–¹å¼ã€‚<br>sprintä¸ºå›¢é˜Ÿæä¾›äº†ç›¸åº”çš„æœºåˆ¶ã€‚</p><p>æˆ‘ä»¬å…ˆè¿‡ä¸€ä¸‹sprintæ•´ä½“æµç¨‹ã€‚<br><code>sprintä¹‹åˆ â€”â€” IPM</code>ï¼šåœ¨æ¯æ¬¡å†²åˆºä¹‹åˆï¼Œéƒ½ä¼šä¸¾è¡Œä¸€æ¬¡ä¼šè®®ï¼Œäº§å“è´Ÿè´£äººè®²è§£éœ€æ±‚ï¼Œå¹¶ç”±å¼€å‘å›¢é˜Ÿè§„åˆ’å†²åˆºå†…å®¹ï¼Œå³åœ¨æœªæ¥ä¸¤å‘¨å†…èƒ½å®Œæˆå¤šå°‘å·¥ä½œï¼Œæ˜ç¡®sprintç»“æŸæ—¶å¯äº¤ä»˜çš„äº§å“å¢é‡ç›®æ ‡ã€‚<br><code>sprintè¿è¡Œä¸­</code>ï¼šåœ¨sprintä¸­ï¼Œå›¢é˜Ÿæœ‰ä¸¤é¡¹å·¥ä½œï¼šå®Œæˆåœ¨å½“å‰sprintè®¡åˆ’çš„å·¥ä½œä»¥åŠå‡†å¤‡ä¸‹ä¸€ä¸ªsprintã€‚<br><code>sprintç»“æŸä¹‹å‰ â€”â€” reviewï¼ˆshowcaseï¼‰</code>: ä¸å±•ç¤ºæˆæœï¼Œå°±æ²¡æœ‰æ•ˆæœã€‚æ¯æ¬¡sprintçš„äº¤ä»˜ç‰©åº”è¯¥æ˜¯æ½œåœ¨å¯äº¤ä»˜çš„äº§å“å¢é‡ï¼Œåœ¨showcaseä¸Šå±•ç¤ºå·²æ˜ç¡®å®Œæˆçš„å¢é‡æˆæœï¼Œä¸sprintå¼€å§‹ä¹‹å‰çš„å®Œæˆç›®æ ‡è¿›è¡Œå¯¹æ¯”ï¼Œæ¥å—è¯„å®¡åé¦ˆã€‚<br><code>sprintæœ€å â€”â€” team Retrospective</code>: å›¢é˜Ÿå›é¡¾ä¼šè®®ï¼Œåœ¨ä¼šè®®ä¸­å›é¡¾æ•´ä¸ªsprintè¿‡ç¨‹ï¼Œåæ€è¿‡å»ä»¥æ”¹å–„å°†æ¥çš„sprintã€‚</p><h4 id="2-1-å¿«é€Ÿåé¦ˆ">2.1. å¿«é€Ÿåé¦ˆ</h4><p>æ¯ä¸ªsprintå¯çœ‹åšæ˜¯ä¸€ç§å®éªŒã€‚<br>é€šè¿‡è¿­ä»£sprintè¿™ç§çŸ­æœŸçš„time-boxï¼Œæ¯ä¸€æ¬¡sprintç»“æŸä¹‹åï¼Œæ½œåœ¨å¯äº¤ä»˜çš„äº§å“å¢é‡å¯ä»¥è®©å®¢æˆ·å’Œå›¢é˜Ÿå¿«é€Ÿè¯„ä¼°è¯¥å®éªŒï¼Œè·å¾—åé¦ˆã€‚<br>ä»–ä»¬å¯ä»¥æ ¹æ®åœ¨ä¸Šä¸€ä¸ªsprintä¸­çš„å‘ç°æ¥åˆ¤æ–­è‡ªå·±çš„å‰è¿›æ–¹å‘æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠåˆ¤æ–­ä»–ä»¬ä¸‹ä¸€æ­¥æ‰“ç®—åšçš„äº‹æƒ…æ˜¯ä¸æ˜¯æ°å½“çš„ã€‚<br>å¤±è´¥å¾—å¿«ï¼Œæ‰èƒ½è¿…é€Ÿæ”¹æ­£ã€‚</p><h4 id="2-2-æ£€æŸ¥å’Œè°ƒæ•´">2.2. æ£€æŸ¥å’Œè°ƒæ•´</h4><p>Scrumçš„ä¸€ä¸ªé‡è¦æ„ä¹‰å°±æ˜¯æ”¹å˜å›¢é˜Ÿå¯¹æ—¶é—´çš„çœ‹æ³•ã€‚å®è¡Œsprintå’Œæ¯æ—¥ç«™ä¼šä¸€æ®µæ—¶é—´ä¹‹åï¼Œå›¢é˜Ÿå°±ä¸ä¼šå†æŠŠæ—¶é—´çœ‹æˆä¸€æ”¯å¾„ç›´é£å‘æœªæ¥çš„ç®­ï¼Œè€Œæ˜¯ä»å‘¨æœŸæ€§çš„è§†è§’å»çœ‹å¾…æ—¶é—´ã€‚</p><p>åˆ©ç”¨è¿™ä¸€ä¸ªä¸ªå‘¨æœŸï¼Œå½¢æˆæˆ´æ˜PDCAå¾ªç¯ï¼ˆPlan-Do-Check-Actionï¼‰ã€‚<br>Reviewå’ŒRetrospectiveï¼Œå°±æ˜¯scrumä¸­å½¢æˆæ£€æŸ¥å’Œè°ƒæ•´çš„ä¸€ç¯ã€‚<br>ä¸åªæ˜¯â€æ£€æŸ¥å’Œè°ƒæ•´â€œå›¢é˜Ÿæ„å»ºçš„ä¸œè¥¿ï¼Œè¿˜è¦â€æ£€æŸ¥å’Œè°ƒæ•´â€œå›¢é˜Ÿæ„å»ºçš„è¿‡ç¨‹ã€‚</p><p>æ¯ç»è¿‡ä¸€æ¬¡sprintï¼Œæ£€éªŒä¸€ä¸‹å›¢é˜Ÿåšçš„äº‹æƒ…ï¼Œçœ‹çœ‹æ˜¯å¦æœç€æ­£ç¡®çš„æ–¹å‘å‰è¿›ï¼Ÿç»“æœæ˜¯ä¸æ˜¯çœŸæ­£å¸Œæœ›çœ‹åˆ°çš„ï¼Ÿæ˜¯å¦æœ‰ä»€ä¹ˆåŠæ³•èƒ½æ”¹å–„ç›®å‰æ­£åœ¨åšçš„äº‹æƒ…ï¼Ÿå¦‚ä½•æ‰èƒ½åšå¾—æ›´å¿«æ›´å¥½ï¼Ÿå­˜åœ¨å“ªäº›æ½œåœ¨çš„éšœç¢ï¼Ÿè¿™ä¸€ç‚¹çœ‹ä¼¼å®¹æ˜“ï¼Œåšèµ·æ¥å¹¶éæ˜“äº‹ï¼Œéœ€è¦æœ‰æ€æƒ³ï¼Œå–„äºè‡ªçœï¼Œæœ‰å®äº‹æ±‚æ˜¯åŸºäºäº‹å®çš„æ•°æ®å’Œä¾æ®ã€è‡ªæˆ‘çº¦æŸçš„æ„è¯†ã€‚</p><p>æœ‰äººæ›¾ç»å‘é—®ï¼šå¦‚æœå›¢é˜Ÿæˆå‘˜éƒ½ä¸æƒ³å¼€Retrospectiveï¼Œä½œä¸ºPMä½ æ‰“ç®—æ€ä¹ˆåŠï¼Ÿ<br>å½“æ—¶çš„ä¸€ä¸ªç­”æ¡ˆæ˜¯ï¼šå…¶å®æ•æ·å®è·µæ–½äºå›¢é˜Ÿï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®å›¢é˜Ÿå®é™…æƒ…å†µè¿›è¡Œå‰ªè£çš„ã€‚å¦‚æœå›¢é˜Ÿè§‰å¾—æ²¡æœ‰å¿…è¦å¼€ï¼Œé‚£å°±å¯ä»¥ä¸å¼€ã€‚<br>ä½†æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå¯¹äºScrumï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–æ‰‹æ®µå½¢æˆå‘¨æœŸæ€§æœ€åçš„â€æ£€æŸ¥å’Œè°ƒæ•´â€œé—­ç¯ï¼Œé‚£Retrospectiveå°±ä¸€å®šè¦å¼€ã€‚å³ä½¿æ˜¯å›¢é˜Ÿæˆå‘˜å¯¹äºå½“å‰çš„SprintçŠ¶æ€ã€é€Ÿåº¦ã€æ­¥è°ƒéå¸¸æ»¡æ„ï¼Œå› ä¸º â€”â€” å³ä½¿æ˜¯è¿™ç§æƒ…å†µï¼Œåœ¨Retrospective meetingä¸Šï¼Œå›¢é˜Ÿä¹Ÿè¦å›ç­”ä¸€ä¸ªé‡è¦é—®é¢˜ï¼šâ€ä½ ä»¬å¦‚ä½•æ‰èƒ½åšå¾—æ›´å¥½ï¼Ÿâ€œ</p><h3 id="3-çŸ­æœŸè¯¦ç»†è®¡åˆ’ï¼Œæ¶ˆé™¤æµªè´¹ä¹‹åŠ›">3. çŸ­æœŸè¯¦ç»†è®¡åˆ’ï¼Œæ¶ˆé™¤æµªè´¹ä¹‹åŠ›</h3><p>åœ¨æœ€æ—©çš„è½¯ä»¶å¼€å‘æ–¹æ³• â€”â€” ç€‘å¸ƒå¼è½¯ä»¶å¼€å‘ä¸­ï¼Œå‰æœŸä¼šåšå¤§é‡çš„åˆ†æã€è®¾è®¡å’Œè®¡åˆ’ï¼Œç¼–å†™å¤§é‡è¯¦ç»†çš„æ–‡æ¡£æ–‡æ¡£ã€ç»˜åˆ¶å¤§é‡çš„ç”˜ç‰¹å›¾æŠ¥å‘Šä¼å›¾ä½“ç°å’Œæ§åˆ¶è½¯ä»¶çš„å¼€å‘è¿›åº¦ã€‚è€Œå½“ç°å®è¿›åº¦ä¸è®¡åˆ’æŠ¥å‘Šæœ‰çŸ›ç›¾æ—¶ï¼Œè®¤ä¸ºå¾€å¾€è®¤ä¸ºé—®é¢˜å‡ºåœ¨ç°å®ä¸Šï¼Œè®¤ä¸ºå›¾è¡¨æ˜¯æ­£ç¡®çš„ã€‚<br>æœ¬èº«è¿™ç§é•¿æœŸè®¡åˆ’å’Œè¿›åº¦æ§åˆ¶åŠæ³•ï¼Œå»ºç«‹çš„è¿™ç§åˆ¶åº¦ â€”â€” æ— å¼‚äºå¼ºè¿«è‡ªå·±ä¸€å‘³åœ°ç©ºæƒ³ã€‚<br>é¦–å…ˆï¼Œè¿™ç§ä»˜å‡ºå¤§é‡åŠªåŠ›å»è§„åˆ’ç»†èŠ‚ï¼Œé™åˆ¶æ½œåœ¨å˜åŒ–ï¼Œå¹¶é¢„çŸ¥æœªçŸ¥å› ç´ çš„é•¿æœŸè®¡åˆ’ï¼Œæœ€åå¾€å¾€ä¼šå¾’åŠ³æ— åŠŸã€‚æ¯ä¸€ä¸ªé¡¹ç›®åœ¨å¼€å‘è¿‡ç¨‹ä¸­éƒ½éœ€è¦äººä»¬å»å‘ç°æ–°é—®é¢˜ï¼Œå»æ¿€å‘è‡ªå·±çš„çµæ„Ÿã€‚<br>å…¶æ¬¡ï¼Œä¼å›¾å›é¿ç°å®çš„ä¸ç¡®å®šæ€§ã€‚<br>å¦å¤–ï¼Œæ— æ³•å“åº”å¤–åœ¨ç¯å¢ƒå’Œå•†ä¸šçš„ä¸æ–­å˜åŒ–ã€‚<br>æœ€åï¼Œæ˜¯éå¸¸ç°å®çš„ä¸€ä¸ªé—®é¢˜ â€”â€” äººç±»å…¶å®éå¸¸ä¸æ“…é•¿äºé¢„æµ‹ä¸€ä»¶äº‹æƒ…éœ€è¦è€—è´¹çš„æ—¶é—´ã€‚</p><p>è€Œåœ¨scrumä¸­å›¢é˜Ÿåªéœ€è¦å¯¹ä¸‹ä¸€ä¸ªsprintåšè¯¦ç»†è®¡åˆ’ï¼Œä½¿ç”¨çŸ­å‘¨æœŸæ¥å¢åŠ ç¡®å®šæ€§ã€åº”å¯¹å˜åŒ–ã€å¿«é€Ÿåé¦ˆã€‚èŠ‚çœé•¿æœŸè®¡åˆ’ä¸­èµ·ä¸åˆ°ä½œç”¨çš„åˆ†æã€è®¾è®¡ã€æ²Ÿé€šåè°ƒçš„æ—¶é—´ã€‚</p><h3 id="4-ä¸“æ³¨ç›®æ ‡ã€å¯æŒç»­çš„æ­¥è°ƒä¹‹åŠ›">4. ä¸“æ³¨ç›®æ ‡ã€å¯æŒç»­çš„æ­¥è°ƒä¹‹åŠ›</h3><p>sprintä¹‹æ‰€ä»¥å«å†²åˆºï¼Œæ˜¯å¯ä»¥è®©äººäº§ç”Ÿä¸€ç§ç´§å¼ æ¿€çƒˆçš„æ„Ÿè§‰ã€‚<br>ä½†å®ƒå¼ºè°ƒçš„å¹¶ä¸æ˜¯ â€”â€” é•¿è·‘é©¬æ‹‰æ¾å§‹ç»ˆä»¥æœ€å200ç±³å†²åˆºçš„ä¸å¯æŒç»­çš„èŠ‚å¥è¿›è¡Œå¼€å‘ï¼Œåè€Œååˆ†å¼ºè°ƒå¯æŒç»­æ€§å¼€å‘èŠ‚å¥ã€‚</p><p>é¦–å…ˆï¼Œä¸è¦æ”¹å˜å½“å‰sprintçš„ç›®æ ‡ã€‚<br>ä¸€æ—¦ä¸€ä¸ªå›¢é˜Ÿå†³å®šè¦å®ŒæˆæŸäº›ä»»åŠ¡ï¼Œé‚£ä¹ˆè¿™äº›ä»»åŠ¡å°±é”å®šäº†ï¼Œå›¢é˜Ÿä¹‹å¤–çš„ä»»ä½•äººéƒ½ä¸èƒ½å†ç»™ä»–ä»¬å¢åŠ ä»»åŠ¡ï¼Œå¹²é¢„å’Œæ‰°ä¹±å›¢é˜Ÿåªä¼šå¤§å¹…æ”¾ç¼“å›¢é˜Ÿçš„å·¥ä½œè¿›åº¦ã€‚<br>å³ä½¿ä¸€äº›äººè´¨é—®æ•æ·ä¸å°±æ˜¯è¦æ‹¥æŠ±å˜åŒ–å—ï¼ŸScrumçš„æ‹¥æŠ±å˜åŒ–ä¸æ„å‘³ç€å¯ä»¥åœ¨åŒä¸€ä¸ªsprintå†…è¿›è¡Œæ”¹å˜ã€‚<br>å…¶å®ï¼Œå¾ˆå°‘æœ‰ä¼ä¸šèº«å¤„â€œå˜åŒ–è¿…çŒ›ä»¥è‡³äºä¼ä¸šä¸èƒ½åœ¨2å‘¨sprintçš„å¼€å§‹å°±è®¾å®šä¼˜å…ˆçº§ç„¶åä¿æŒè¿™äº›ä¼˜å…ˆçº§ä¸å˜â€è¿™æ ·çš„è¡Œä¸šä¸­ã€‚è®¸å¤šä¼ä¸šä¹Ÿè®¸è®¤ä¸ºä»–ä»¬å°±å¤„äºé‚£æ ·çš„ç¯å¢ƒï¼Œä½†äº‹å®ä¸Šä¸ç„¶ã€‚<br>è¦è¾¾åˆ°ä¸è¦è½»æ˜“æ”¹å˜å½“å‰sprintçš„ç›®æ ‡ï¼Œè¿™é€šå¸¸è¦æ±‚æˆ‘ä»¬æ…¢æ…¢ä¹ æƒ¯äºâ€œæå‰æ€è€ƒâ€ï¼Œä¸è¦â€œç¼ºä¹è¿œè§â€ã€‚</p><p>å…¶æ¬¡ï¼Œä¸è¦å°çƒçŸ­è·‘ã€‚<br>å°çƒçŸ­è·‘æŒ‡ï¼Œå›¢é˜Ÿåˆšå®Œæˆä¸€ä¸ªsprintï¼Œè¿˜æ²¡å‡†å¤‡å¼€å§‹ä¸‹ä¸€ä¸ªï¼Œä¸‹ä¸€ä¸ªsprintåˆå¼€å§‹å¯åŠ¨ã€‚ç¬¬äºŒä¸ªsprintç»å¸¸åªæ˜¯æ‰€è°“çš„å¼€å§‹ï¼Œå®é™…ä¸Šå›¢é˜Ÿè¿˜æ ¹æœ¬æ²¡æœ‰å‡†å¤‡å¥½åšè¿™ä¸ªsprintçš„å·¥ä½œï¼Œä»¥è‡´äºä»–ä»¬ä¸å¾—ä¸èŠ±è´¹å‡ å¤©æ—¶é—´å­¦ä¼šè¦å¹²ä»€ä¹ˆã€‚<br>è¦è®°ä½ï¼Œåœ¨å½“å‰sprintä¸­ï¼Œå›¢é˜Ÿæœ‰ä¸¤ä¸ªç›®æ ‡ï¼šå®Œæˆåœ¨å½“å‰sprintè®¡åˆ’çš„å·¥ä½œä»¥åŠå‡†å¤‡ä¸‹ä¸€ä¸ªsprintã€‚<br>ç‰¹åˆ«POã€UEDè¿™äº›å›¢é˜Ÿå¯¹å…¶æœ‰å‰ç½®ä¾èµ–çš„è§’è‰²ï¼Œéœ€è¦åŠæ—¶æå‰å‡†å¤‡ä¸‹ä¸€ä¸ªsprintã€‚è¿™æ ·å¯ä»¥è®©æ•´ä¸ªå›¢é˜Ÿçš„äº¤ä»˜æ­¥ä¼ä¸€ç›´å¤„äºé¡ºç•…ã€å¯æŒç»­çš„çŠ¶æ€ã€‚</p><h3 id="5-å¯é¢„æµ‹ä¹‹åŠ›">5. å¯é¢„æµ‹ä¹‹åŠ›</h3><p>å›¢é˜Ÿå†…ï¼Œéœ€è¦çŸ¥é“è‡ªå·±çš„é€Ÿåº¦ã€‚<br>æ¯ä¸ªå›¢é˜Ÿéƒ½åº”è¯¥å‡†ç¡®çŸ¥é“è‡ªå·±åœ¨æ¯ä¸ªsprinté˜¶æ®µä¸­å®Œæˆäº†å¤šå°‘å·¥ä½œï¼Œå¹¶ä¸”åº”è¯¥çŸ¥é“å¦‚ä½•ä»¥æ›´åŠ èªæ˜çš„æ–¹æ³•å»æ¶ˆé™¤éšœç¢ï¼ŒåŠ å¿«å·¥ä½œé€Ÿåº¦ã€‚<br>çŸ¥é“è‡ªå·±çš„å·¥ä½œé€Ÿåº¦ä¹‹åï¼Œå°±èƒ½è®¡ç®—å‡ºäº¤ä»˜æ—¥æœŸï¼Œ<code>é€Ÿåº¦ Ã— sprintæ¬¡æ•°ï¼äº¤ä»˜å·¥ä½œé‡</code>ã€‚</p><p>å›¢é˜Ÿå¤–ï¼Œç¨³å®šã€çŸ­æœŸçš„äº¤ä»˜é¢‘æ¬¡ï¼Œå¯ä»¥å¸¦ç»™å®¢æˆ·æ˜ç¡®çš„â€å¯é¢„æµ‹æ€§â€œ â€”â€” åŸºæœ¬ä¸Šæå‡ºçš„éœ€æ±‚å’Œé—®é¢˜åªè¦ç­‰å¾…ä¸€ä¸ªå›ºå®šå‘¨æœŸå°±å¯ä»¥ä¸Šçº¿ã€‚<br>å½“ç„¶å¦‚æœå®¢æˆ·åœ¨æ˜çŸ¥â€å¯é¢„æµ‹æ€§â€œçš„åŸºç¡€ä¸Šï¼Œä»ç„¶æ€»æ˜¯è¦æ±‚â€å¿«é€Ÿå“åº”â€œï¼Œæ²¡æœ‰è€å¿ƒç­‰å¾…ä¸€ä¸ªå›ºå®šå‘¨æœŸæ—¶é—´è¿‡å»ï¼Œé‚£å°±å¯ä»¥è€ƒè™‘ç¼©çŸ­è¿™ä¸ªå›ºå®šå‘¨æœŸçš„æ—¶é—´é•¿åº¦ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ˜¯2æ¬¡sprintæ‰releaseä¸€æ¬¡ï¼Œåˆ™å¯ä»¥è€ƒè™‘æ˜¯å¦èƒ½1æ¬¡sprintå°±releaseã€‚</p><h3 id="6-æ€»ç»“">6. æ€»ç»“</h3><p>å­¦ä¹ Scrumæ¡†æ¶ï¼Œä½¿ç”¨å…¶è¿›è¡Œè½¯ä»¶å¼€å‘è¿‡ç¨‹ç®¡ç†ï¼Œå¾€å¾€å¾ˆå®¹æ˜“ã€‚<br>ä½†ï¼Œæ˜¯ä¸æ˜¯æ€»æœ‰é‚£ä¹ˆä¸€äº›å›¢é˜Ÿï¼Œæ˜æ˜ç”¨äº†Scrumä»ç„¶æ¯æ—¥ç–²äºå¥”å‘½ï¼Ÿ<br>æ˜¯å¦æ˜¯åªè§Scrumå…¶å½¢ï¼Œä¸è§å…¶ç¥å‘¢ï¼Ÿ<br>å¦‚æœæ˜¯ï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰ å…¶ç¥ä¸­æœªå‘æŒ¥å‡ºæ¥çš„åŠ›é‡ï¼Ÿ<br>å¦‚æœæ˜¯ï¼Œå¯èƒ½å›¢é˜Ÿéœ€è¦è€ƒè™‘æœ‰ä¸€ä½ä¸“èŒçš„Scrumå®ˆæŠ¤è€… â€”â€” Scrum masterã€‚</p><h3 id="7-å‚è€ƒæ–‡çŒ®">7. å‚è€ƒæ–‡çŒ®</h3><ol><li>ã€Šæ•æ·é©å‘½ã€‹ï¼ŒJeff Sutherland è‘—</li><li>ã€ŠScrum æ•æ·è½¯ä»¶å¼€å‘ã€‹ï¼ŒMike Cohn è‘—</li><li>ã€Šç¡çƒŸä¸­çš„ Scrumå’Œ XPã€‹ï¼ŒHenrik Kniberg è‘—</li></ol><p><img src="/2019/10/23/scrum-xing-wai-zhi-shen/cover.png" alt="å°é¢"></p>]]></content>
      
      
      <categories>
          
          <category> æ•æ· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•æ· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆä¸é¼“åŠ±åŠ ç­</title>
      <link href="/2019/10/15/wei-shi-me-bu-gu-li-jia-ban/"/>
      <url>/2019/10/15/wei-shi-me-bu-gu-li-jia-ban/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆï¼Œæ­¤ç¯‡æ–‡ç« æœ‰ä¸ªå¤§å‰æï¼Œä¸»è¦é’ˆå¯¹çŸ¥è¯†æ€§å·¥ä½œã€‚<br>â€œçŸ¥è¯†æ€§å·¥ä½œâ€ä¸â€œå¯é‡å¤æ€§çš„ç”Ÿäº§æ´»åŠ¨â€å¯¹ç«‹ã€‚</p><p>çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜çš„æ—¶å€™ï¼Œå¤§æ¦‚å¾ˆå¤šäººéƒ½ä¼šæƒ³â€”â€”è¿™æ˜¯ä¸€ç¯‡996å‘˜å·¥ ICU çš„è½¯æ–‡ï¼šä¸é¼“åŠ±åŠ ç­ï¼Œæ˜¯ä¸ºäº†è®©å‘˜å·¥è¿‡å¹³è¡¡çš„ç”Ÿæ´»ã€‚<br>æ¬§ç¾ä¸å°‘å…¬å¸ä¸é¼“åŠ±åŠ ç­ï¼Œæ˜¯å› ä¸ºâ€”â€”ä»–ä»¬é‡è§†å‘˜å·¥çš„å·¥ä½œå’Œç”Ÿæ´»ã€‚<br>æˆ‘åªæƒ³è¯´ï¼šå›¾æ ·å›¾æ£®ç ´ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä»…ä»…æ˜¯å…¬å¸ä¸æƒ³ä»˜åŠ ç­è´¹ã€‚</p><p>Scrum ä¹‹çˆ¶æ°å¤«Â·è¨ç‘Ÿå…° ï¼Œç›´æ¥æŒ‡å‡ºï¼šâ€œ<strong>å·¥æ—¶è¶Šé•¿ï¼Œæ•ˆç‡è¶Šä½ã€‚</strong>â€<br>åœ¨ä¸€äº›ç®¡ç†è€…çœ¼ä¸­ï¼šåŠ ç­åŠ ç‚¹åœ°å·¥ä½œä¸æ˜¯æ•¬ä¸šçš„æ ‡å¿—ï¼Œè€Œæ˜¯å¤±è´¥çš„æ ‡å¿—ã€‚è®©å‘˜å·¥æ—©ç‚¹ä¸‹ç­ï¼Œä¸æ˜¯æƒ³è®©ä»–ä»¬è¿‡ä¸€ç§å¹³è¡¡çš„ç”Ÿæ´»ï¼Œè€Œæ˜¯ä¸ºäº†ä»–ä»¬å¯ä»¥å®Œæˆæ›´å¤šçš„å·¥ä½œã€‚</p><span id="more"></span><h3 id="1-å·¥æ—¶è¶Šé•¿ï¼Œæ•ˆç‡è¶Šä½">1. å·¥æ—¶è¶Šé•¿ï¼Œæ•ˆç‡è¶Šä½</h3><p>è¿™ä¸ªè§‚ç‚¹çœ‹èµ·æ¥è²Œä¼¼æ²¡æœ‰æ ¹æ®ï¼Œæ˜¯ä¸æ˜¯ï¼Ÿ<br>å½“ç„¶ï¼Œæœ‰äººä¼šæœ‰é¢„è§æ€§åœ°è¯´ï¼šå®ŒæˆçŸ¥è¯†æ€§å·¥ä½œçš„ä¸»ä½“æ˜¯äººï¼Œä¸€å¤©ä¸­äººçš„é›†ä¸­åŠ›æ˜¯æœ‰é™çš„ã€‚å³ä½¿å½“å¤©å·¥æ—¶å»¶é•¿ï¼Œæ€»çš„é›†ä¸­åŠ›çš„æ—¶é•¿å¹¶ä¸ä¼šç›¸åº”å»¶é•¿ã€‚<br>è¯´çš„ä¸é”™ã€‚</p><p>åŒæ—¶ï¼ŒçŸ¥è¯†æ€§å·¥ä½œä¸­ï¼Œå…¶å®ä¼´éšç€å¤§é‡çš„å†³ç­–ã€‚æœ‰ä»¤äººä¸å®‰çš„è¯æ®æ˜¾ç¤ºï¼Œäººä»¬åšå†³ç­–çš„èƒ½åŠ›å¾ˆæœ‰é™ï¼Œç²¾åŠ›æ¶ˆè€—å¾—è¶Šå¤šï¼Œä¼‘æ¯æ—¶é—´è¶ŠçŸ­ï¼Œåšå‡ºçš„å†³ç­–å°±ä¼šè¶Šç³Ÿç³•ã€‚<br>åœ¨ Scrum ä¹‹çˆ¶çš„ã€Šæ•æ·é©å‘½ã€‹ä¸­æœ‰è¿™æ ·ä¸€ä¸ªæœ‰è¶£çš„ä¸¾è¯ï¼š</p><blockquote><p>2011å¹´4æœˆï¼Œä»¥è‰²åˆ—ä¸€ç»„ç§‘ç ”äººå‘˜åœ¨ã€Šç¾å›½ç§‘å­¦é™¢é™¢æŠ¥ã€‹ä¸Šå‘è¡¨äº†ä¸€ç¯‡å…³äºå†³ç­–ç§‘å­¦çš„è®ºæ–‡ï¼Œéå¸¸å€¼å¾—å…³æ³¨ã€‚ä»–ä»¬çš„è®ºæ–‡é¢˜ç›®æ˜¯ã€Šå¸æ³•è£å†³ä¸­çš„å¤–éƒ¨å› ç´ ã€‹ã€‚</p><p>è¿™ç¯‡è®ºæ–‡åˆ†æäº†8åä»¥è‰²åˆ—æ³•å®˜åšå‡ºçš„1000å¤šé¡¹å¸æ³•åˆ¤å†³ã€‚è¿™8åæ³•å®˜ä¸»æŒç€ä¸¤ä¸ªä¸åŒçš„å‡é‡Šè£å†³å§”å‘˜ä¼šã€‚ä»–ä»¬è£å†³çš„çŠ¯äººæœ‰ç”·æ€§ä¹Ÿæœ‰å¥³æ€§ï¼Œæœ‰çŠ¹å¤ªè£”ä»¥è‰²åˆ—äººä¹Ÿæœ‰é˜¿æ‹‰ä¼¯è£”ä»¥è‰²åˆ—äººã€‚æ‰€çŠ¯ç½ªè¡ŒåŒ…æ‹¬è´ªæ±¡å…¬æ¬¾ç½ªã€æ•…æ„ä¼¤å®³ç½ªã€è°‹æ€ç½ªå’Œå¼ºå¥¸ç½ªã€‚æ³•å®˜ä»¬æ‰€å®¡ç†çš„ç»å¤§å¤šæ•°æ¡ˆå­éƒ½æ˜¯å‡é‡Šç”³è¯·ã€‚</p><p>è¿™ç±»å·¥ä½œä¼¼ä¹å¾ˆç®€å•ï¼Œå¯¹å—ï¼Ÿè¿™äº›å—äººå°Šæ•¬çš„æ³•å®˜è¿ç”¨è‡ªå·±å¤šå¹´æ¥çš„ç»éªŒå’Œæ™ºæ…§åšå‡ºè‡³å…³é‡è¦çš„å†³å®šï¼Œä¸ä»…å½±å“çŠ¯äººä¸å—å®³è€…çš„ç”Ÿæ´»ï¼Œè¿˜ä¼šå½±å“æ•´ä¸ªç¤¾ä¼šçš„ç¦ç¥‰ã€‚ä»–ä»¬æ¯å¤©éƒ½ä¼šå®¡ç†14~35ä¸ªæ¡ˆä»¶ã€‚</p><p>ä»¥è‰²åˆ—çš„ç ”ç©¶äººå‘˜åˆ†æäº†æ³•å®˜åšå‡ºè£å†³çš„æ—¶é—´ã€æ˜¯å¦æ‰¹å‡†å‡é‡Šä»¥åŠä¸Šä¸€æ¬¡åƒç‚¹å¿ƒçš„æ—¶é—´ã€‚å¦‚æœæ³•å®˜åˆšåƒå®Œç‚¹å¿ƒä¼‘æ¯å¥½ï¼Œæˆ–è€…åˆšåƒå®Œåˆé¤åå¼€å§‹ä¸Šç­ï¼Œé‚£ä¹ˆï¼Œæœ‰åˆ©äºçŠ¯äººçš„è£å†³å°±ä¼šå åˆ°60%ï¼›ä½†æ˜¯å¿«åˆ°ä¸‹ä¸€è½®ä¼‘æ¯æ—¶é—´æ—¶ï¼Œæœ‰åˆ©äºçŠ¯äººçš„è£å†³æ¯”ä¾‹å°±ä¼šä¸‹é™åˆ°é›¶ã€‚</p><p>åŸºæœ¬ä¸Šï¼Œåœ¨çŸ­æš‚ä¼‘æ¯åï¼Œæ³•å®˜çš„æ€åº¦éƒ½ä¼šæ¯”è¾ƒç§¯æï¼Œä¹Ÿæ¯”è¾ƒå®¹æ˜“åšå‡ºå®½å¤§çš„è£å†³ã€‚å¯¹äºè¿™ä¸ªä¸–ç•Œå‘ç”ŸçŠ¯ç½ªè¡Œä¸ºçš„å¯èƒ½æ€§ä»¥åŠçŠ¯äººæ”¹è¿‡è‡ªæ–°çš„å¯èƒ½æ€§ï¼Œä»–ä»¬ä¼šè¡¨ç°å‡ºè¾ƒå¤šæƒ³è±¡åŠ›ä¸åŒ…å®¹å¿ƒã€‚ä½†éšç€ç²¾åŠ›é€æ¸è€—å°½ï¼Œç»´æŒç°çŠ¶çš„è£å†³ä¾¿è¶Šæ¥è¶Šå¤šã€‚</p><p>æˆ‘æ•¢è‚¯å®šï¼Œå¦‚æœä½ é—®è¿™äº›æ³•å®˜æ˜¯å¦ç›¸ä¿¡è‡ªå·±æ¯æ¬¡éƒ½èƒ½åšå‡ºåŒæ ·è‰¯å¥½çš„è£å†³ï¼Œä»–ä»¬å°±ä¼šè§‰å¾—å—åˆ°äº†ä¾®è¾±ï¼Œä½†æ•°æ®ä¸ä¼šæ’’è°ã€‚å½“æˆ‘ä»¬ç²¾åŠ›è€—å°½çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“åšå‡ºè’è°¬çš„å†³å®šã€‚</p><p>è¿™ç§ç°è±¡è¢«ç§°ä¸ºâ€œè‡ªæˆ‘æŸè€—â€ï¼Œæ„æ€å°±æ˜¯ï¼Œåšå‡ºä»»ä½•é€‰æ‹©éƒ½éœ€è¦è€—è´¹ä¸€å®šçš„ç²¾åŠ›ã€‚è¿™æ˜¯ä¸€ç§å¥‡æ€ªçš„æŸè€—ï¼Œå› ä¸ºä½ æ„Ÿè§‰ä¸åˆ°èº«ä½“çš„ç–²æƒ«ï¼Œä½†åšå‡ºè‰¯å¥½å†³å®šçš„èƒ½åŠ›ä¼šä¸‹é™ã€‚ä½ çš„è‡ªæˆ‘æ§åˆ¶èƒ½åŠ›ã€è‡ªæˆ‘çº¦æŸèƒ½åŠ›ã€æ€è€ƒèƒ½åŠ›ä»¥åŠé¢„è§èƒ½åŠ›ç­‰éƒ½ä¼šè¶‹äºå‡å¼±ã€‚</p></blockquote><p>æ˜¯ä¸æ˜¯è”æƒ³ä¸€ä¸‹å¹³æ—¶æ—¥å¸¸ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œä¼šæœ‰ä¸€äº›æ„ŸåŒèº«å—ï¼Ÿ<br>å¾ˆå¤šæ—¶å€™ï¼Œå»¶é•¿å·¥æ—¶å¹¶ä¸èƒ½ç»§ç»­å¢åŠ äº§å‡ºâ€”â€”<code>æ­£å¸¸ä¸åŠ ç­æ—¶çš„æ•ˆç‡</code> x <code>å»¶é•¿çš„å·¥æ—¶</code>ã€‚</p><p>è®°å¾—è¿™æ¬¡åœ¨åä¸€ä¹‹å‰ï¼Œä¸æˆ‘æ–¹é¡¹ç›®é›†æˆçš„ä¸€ä¸ªä¹™æ–¹ teamï¼Œç”±äºè¿›åº¦è½åçš„åŸå› ï¼Œè®¸è¯ºç”²æ–¹ä¼šåä¸€åŠ ç­ 7 å¤©ã€‚<br>è€å®è¯´ï¼Œåˆšå¬åˆ°è¿™ä¸ªæ¶ˆæ¯çš„æ—¶å€™æˆ‘æƒŠå‘†äº†â€”â€”è¿™ç§ä¼¤å…¶å›¢é˜Ÿæ ¹æœ¬çš„å†³ç­–ï¼Œéƒ½æœ‰å‹‡æ°”å»åšã€‚<br>åæ¥åä¸€å‡æœŸä¹‹åï¼Œæˆ‘æ–¹é¡¹ç›®ä¸å…¶é›†æˆè”è°ƒï¼Œå¾—åˆ°æ¶ˆæ¯ â€”â€” å½¼æ–¹è¿™ 7 å¤©å¯¹äºè¿›åº¦æ¥è¯´ï¼Œå¹¶æ²¡æœ‰æ˜¾è‘—æ•ˆæœæ”¹å–„ã€‚</p><h3 id="2-å·¥æ—¶è¶Šé•¿ï¼Œè‡ªæˆ‘æ”¹è¿›çš„æ ‡å‡†è¶Šä½">2. å·¥æ—¶è¶Šé•¿ï¼Œè‡ªæˆ‘æ”¹è¿›çš„æ ‡å‡†è¶Šä½</h3><p>è¿™é‡Œä¸»è¦æ˜¯ï¼Œæƒ³èŠä¸€ä¸‹çŸ¥è¯†æ€§å·¥ä½œä¸­çš„è½¯ä»¶å¼€å‘è¿™ä¸ªè¡Œä¸šã€‚<br>æŒç»­æ”¹è¿›ï¼Œæ˜¯è½¯ä»¶å¼€å‘ä¸­æ•æ·é¡¹ç›®çš„ä¸€å¤§ç‰¹è‰²ã€‚</p><p>å½“æ¯æ—¥äº¤ä»˜å·¥æ—¶ç”±äºfeatureå»¶é•¿æ—¶ï¼Œå¯¹äºé™ˆæ—§æˆ–è€…ä¸åˆç†åœ°æµç¨‹è®¾è®¡ã€æ¶æ„è®¾è®¡ã€è´¨é‡æå‡ã€å¯é‡æ„çš„ä»£ç ç­‰æ”¹è¿›å†³ç­–ã€åˆ›æ–°å†³ç­–ï¼Œé¡¹ç›®å¾€å¾€ä¼šé‡‡å–ä¿å®ˆçš„æ€åº¦ã€æ›´å€¾å‘äºå…ˆç»´æŒç°çŠ¶ã€‚<br>ç›´è‡³äºâ€”â€”è‡ªæˆ‘æ”¹è¿›çš„æ ‡å‡†é™ä½åˆ°ä¸è§â€”â€”èƒ½å®ŒæˆfeatureåŠŸèƒ½äº¤ä»˜å°±ä¸é”™äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•æ· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python bumpvesion ä½¿ç”¨</title>
      <link href="/2019/10/04/python-bumpvesion-shi-yong/"/>
      <url>/2019/10/04/python-bumpvesion-shi-yong/</url>
      
        <content type="html"><![CDATA[<p>python library projectå‡çº§ç‰ˆæœ¬çš„å·¥å…·ã€‚<br><a href="https://pypi.org/project/bumpversion/">å¼€å‘è€…ä¸Šæ‰‹è¯´æ˜</a></p><p>è¿™é‡ŒæŒ‰ source version controlçš„é¡¹ç›®é…ç½®è¿›è¡Œè¯´æ˜ã€‚</p><ol><li>å®‰è£… bumpverson</li></ol><pre class="line-numbers language-none"><code class="language-none">pipenv install bumpversion --dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>æ·»åŠ é…ç½®æ–‡ä»¶<code>.bumpversion.cfg</code>ï¼Œå¹¶åŠ å…¥ç‰ˆæœ¬ç®¡ç†ã€‚<br>é…ç½®æ–‡ä»¶å†…å®¹ï¼š</li></ol><pre class="line-numbers language-none"><code class="language-none">[bumpversion]current_version = 0.1.1commit = Truetag = True[bumpversion:file:setup.py][bumpversion:file:package_name/__init__.py]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢ä¸€ä¸ª[]ä¸‹é¢æ˜¯é’ˆå¯¹ä¸€ä¸ª section çš„è¯¦ç»†é…ç½®ã€‚<br>å¦‚ï¼Œæœ‰ä¸¤ä¸ªéœ€è¦æ§åˆ¶ verion num çš„åœ°æ–¹ï¼Œåˆ™è¦é…ç½®ä¸¤ä¸ª[bumpversion:file:â€¦] sectionã€‚<br><code>current_version = 0.1.1</code> è®°å½•å½“å‰çš„ç‰ˆæœ¬æ˜¯ 0.0.1ã€‚<br><code>commit = True</code> bump çš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€æ¡ commitã€‚å¯ä»¥é…ç½® commit msg æ ¼å¼ã€‚<br><code>tag = True</code> bump çš„æ—¶å€™è‡ªåŠ¨æ‰“ tagã€‚<br>å…·ä½“æ¯ä¸€é¡¹è¯¦ç»†é…ç½®å¯è§å®˜æ–¹è¯´æ˜ã€‚</p><ol start="3"><li>è¿è¡Œ bumpversion å‘½ä»¤ã€‚</li></ol><pre class="line-numbers language-none"><code class="language-none">pipenv shellbumpversion &lt;part&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>part é»˜è®¤ä¸»è¦æ˜¯ <strong>major</strong>ã€<strong>minor</strong>ã€<strong>patch</strong>ã€‚<br>è¾“å…¥å¯¹åº”çš„ partï¼Œbumpversion ä¼šå¯¹åº”çš„è¿›è¡Œ version å‡çº§ã€‚<br>æ¯”å¦‚ï¼š<code>bumpversion major</code>, æŒ‰ä¸Šé¢çš„é…ç½®ï¼Œversion ä¼šç”±<code>0.1.1</code>å‡çº§ä¸º<code>1.0.0</code>ã€‚</p><ol start="4"><li>push commits/tagsã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å• JIRA Scrum Board å§¿åŠ¿</title>
      <link href="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/"/>
      <url>/2019/09/12/jian-dan-jira-scrum-board-zi-shi/</url>
      
        <content type="html"><![CDATA[<p>è€å®è¯´ï¼Œåˆšå¼€å§‹è¦å†™è¿™ç¯‡åšæ–‡çš„æ—¶å€™ï¼Œæˆ‘åœ¨æƒ³ï¼šæˆ‘æ˜¯è°ï¼Ÿæˆ‘åœ¨å“ªé‡Œï¼Ÿæˆ‘åœ¨å¹²ä»€ä¹ˆï¼Ÿ</p><p>ç›®æ ‡ï¼š</p><ol><li>ä¸ºäº†è®©JIRA board ownerå’Œadminåˆ›å»ºå‡ºæ¥çš„Scrum boardæ›´è§„èŒƒï¼›ä¸ºäº†ä½¿JIRA useråœ¨æŒªå¡çš„æ—¶å€™ï¼Œæœ‰æ•ˆä¿¡æ¯èƒ½è¢«èƒ½å¥½çš„trackï¼›ä¸ºäº†ç”¨ä»¥ç»Ÿè®¡åˆ†æã€è·Ÿè¸ªçš„reportsèƒ½æ›´å¥½çš„ä¸ºé¡¹ç›®æœåŠ¡ã€‚</li><li>ä¸ºäº†åœ¨team Retrospective meetingä¸­ï¼Œèƒ½æ›´å¥½åœ°å¯¹Sprintè¿›è¡Œå›é¡¾ï¼Œä»æ•°æ®ä¸Šæä¾›æ›´å¥½çš„äº‹å®æ”¯æ’‘å’Œå…·ä½“åˆ†æï¼›ä¸ºäº†åœ¨ä»¥åçš„Sprintè¿›è¡Œé€æ­¥è‰¯æ€§æ”¹å–„ã€‚</li></ol><p>æœ€åè‡ªå·±å¿ƒé‡Œè¿˜æ˜¯é»˜å¿µï¼šæˆ‘æ˜¯ä¸ªTechï¼Œæˆ‘æ˜¯ä¸ªTechï¼Œæˆ‘æ˜¯ä¸ªTechã€‚</p><h3 id="JIRAæ¦‚å¿µæ€§æ¨¡å‹">JIRAæ¦‚å¿µæ€§æ¨¡å‹</h3><p><strong><code>Project</code></strong>: å¯ä»¥ç†è§£ä¸ºIssuesæ‰€å±çš„é›†åˆã€å‘½åç©ºé—´ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¯ä»¥ä¸€ä¸ªsoftware projectæ¥åˆ›å»ºå…¶å¯¹åº”çš„JIRA projectã€‚<br><strong><code>Issue</code></strong>: å¯ä»¥å…·è±¡ç†è§£ä¸ºå¡ç‰‡ï¼Œä¸€ä¸ªissueå°±æ˜¯ä¸€å¼ å¡ç‰‡ã€‚<br><strong><code>Issue type</code></strong>: å¡ç‰‡ç±»å‹ï¼Œå¯ä»¥æ˜¯Epicã€storyã€bugã€taskç­‰ã€‚<br><strong><code>Status</code></strong>: å¡ç‰‡å¯ä»¥é€‰æ‹©çš„çŠ¶æ€ã€‚ä¸€å †statuså’Œtransitionæ„æˆä¸€ä¸ªå…·ä½“çš„å·¥ä½œæµï¼ˆworkflowï¼‰ï¼Œå¡è·Ÿéšå·¥ä½œæµä¸­è®¾å®šçš„çŠ¶æ€è¿›è¡Œæµè½¬ï¼Œå®Œæˆå¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p><p><strong><code>Board</code></strong>: å…·ä½“çš„é¡¹ç›®å®è·µç®¡ç†çš„æ“ä½œç©ºé—´ã€‚ä¸€ä¸ªboardå¯ä»¥å…³è”ä¸€ä¸ªprojectï¼Œä¹Ÿå¯ä»¥å…³è”å¤šä¸ªprojectï¼Œå–å†³ä¸åˆ›å»ºboardæ—¶çš„è®¾ç½®ã€‚ç®€å•ä¸€ç‚¹è¯ï¼Œæˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯è®©ä¸€ä¸ªboardä»…å…³è”ä¸€ä¸ªprojectå³å¯ã€‚<br><strong><code>Backlog</code></strong>: boardä¸­ï¼ŒæœªåŠ å…¥å…·ä½“sprintçš„issuesï¼Œåˆ™ä¼šæ˜¾ç¤ºåœ¨backlogåŒºåŸŸå†…ã€‚<br><strong><code>Sprint</code></strong>: Scrumä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä»£è¡¨ä¸€ä¸ªå›ºå®šçš„æ—¶é—´ç›’å­ï¼ˆtime boxï¼‰ï¼Œå¯ä»¥æ˜¯2å‘¨~4å‘¨ã€‚é¡¹ç›®å›¢é˜Ÿä»¥æ¯ä¸ªsprintå®ç°çŸ­æœŸäº¤ä»˜ç›®æ ‡å’Œå¢é‡å¼è¿­ä»£ã€‚åœ¨JIRAä¸­ï¼Œä¸€ä¸ªSprintä¸­ä¼šåŠ å…¥ä¸€æ‰¹Issuesï¼Œç”¨ä»¥è¯¦ç»†å®šä¹‰æ­¤æ¬¡Sprintçš„ç›®æ ‡å’Œå·¥ä½œå†…å®¹ã€‚<br><strong><code>Active Sprint</code></strong>: å·²ç»ç»„ç»‡å¥½issues listçš„sprintå¯ä»¥é€šè¿‡Sprint plan meeting(æˆ–è€…å«Iteration plan meeting)ä¹‹åï¼Œå°†æ­¤Sprintæ¿€æ´»ã€‚è¿™æ—¶ï¼Œæ­¤Sprintå†…çš„æ‰€æœ‰issuesä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨Active Sprinté¡µé¢ä¸Š â€”â€”â€”â€” å¤§å¤šæ•°JIRA Useræ‰€å…³æ³¨çš„å¯è§†åŒ–ç”µå­å¢™åˆ™æˆåŠŸå‡ºç°ã€‚<br><strong><code>Release / version</code></strong>: JIRAä¸­æ²¡æœ‰Releaseè¿™ä¸ªå®ä½“æ¦‚å¿µã€‚Releaseå¯¹åº”çš„å®ä½“ï¼Œå…¶å®æ˜¯versionã€‚åœ¨Issueçš„å±æ€§ä¸­å…³è”ä¸ŠFix versionï¼Œåˆ™issueå¯ä»¥ä»Release / versionçš„ç»´åº¦è¿›è¡Œæ•°æ®ç»Ÿè®¡å’Œè¿›åº¦trackã€‚</p><h3 id="ç®€å•ä¸Šæ‰‹">ç®€å•ä¸Šæ‰‹</h3><p>å¦‚æœJIRAæ–°æ‰‹ï¼Œå¯ä»¥å…ˆå‚ç…§å®˜æ–¹çš„<a href="https://confluence.atlassian.com/jirasoftwareserver/getting-started-as-a-jira-software-manager-938845036.html">Getting started as a Jira Software manager</a></p><p>è¿™é‡Œï¼Œå‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº†Projectå’Œå·²ç»å®Œæˆäº†User Management â€”â€”â€”â€” ä¸€ä¸ªå·²ç»è¿è¡Œäº†ä¸€æ®µæ—¶é—´çš„å¼€å‘é¡¹ç›®ï¼Œæˆ‘ä»¬å°è¯•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„JIRA Scrum boardã€‚</p><h4 id="1-åˆ›å»ºä¸€ä¸ªæ–°çš„Scrum-boardã€‚">1. åˆ›å»ºä¸€ä¸ªæ–°çš„Scrum boardã€‚</h4><p>åœ¨æ—§çš„boardä¸Šï¼Œç‚¹å‡»å³ä¸Šè§’çš„æŒ‰é’®[Board]ï¼Œåœ¨ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©[Create board]ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-1.png" alt="board dropdown list"></p><p>ç„¶ååœ¨ä¸‹ä¸€æ­¥ä¸­é€‰æ‹©[Create a Scrum board] &gt; [Board from an existing project]ã€‚å¯çœ‹åˆ°ä¸‹å›¾:<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-2.png" alt="create board dialog"></p><p>è¾“å…¥ç›¸åº”ä¿¡æ¯åï¼Œç‚¹å‡»[Create board]ï¼Œè¿™æ—¶æ–°çš„boardå°±ä¼šåˆ›å»ºå‡ºæ¥ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-3.png" alt="new board"></p><p>ç”±äºåˆ›å»ºæ—¶é€‰æ‹©äº†å·²å­˜åœ¨çš„ä¸€ä¸ªprojectï¼Œè¯¥projectä¸­æœ‰æœªåˆ†é…ç»™sprintçš„issuesåˆ™ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨æ–°çš„boardçš„backlogä¸­ã€‚<br>å½“ç„¶å¦‚æœboardä¸­åªéœ€è¦æ˜¾ç¤ºprojectä¸­ä¸€éƒ¨åˆ†çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹board configurationé¡µé¢ä¸­çš„filterè¿›è¡Œè¿‡æ»¤ã€‚</p><h4 id="2-é…ç½®boardçš„Estimationã€‚">2. é…ç½®boardçš„Estimationã€‚</h4><p>ç‚¹å‡»boardé¡µé¢å³ä¸Šè§’çš„[board]æŒ‰é’®ï¼Œé€‰æ‹©[Configure]ã€‚<br>è¿›å…¥board configurationé¡µé¢ï¼Œé€‰æ‹©[Estimation] tagã€‚<br>åœ¨è¯¥é¡µé¢ä¸Šé€‰æ‹©estimationå’ŒtrackingåŸºäºçš„å•ä½ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-4.png" alt="board configration estimation page"></p><h4 id="3-ä½¿ç”¨backlogæ¥ä¸ºsprintåšå‡†å¤‡ã€‚">3. ä½¿ç”¨backlogæ¥ä¸ºsprintåšå‡†å¤‡ã€‚</h4><p>ä»boardé¡µé¢ï¼Œç‚¹å‡»é¡µé¢æœ€ä¸Šæ–¹çš„[create]æŒ‰é’®ï¼Œæ¥åˆ›å»ºissueã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-5.png" alt="create issue popover"></p><p>å½•å…¥issueçš„å¿…è¦ä¿¡æ¯ï¼Œè¿™æ—¶å€™estimationå€¼ä¸€èˆ¬æ˜¯æ²¡æœ‰çš„ï¼Œç•™å¾…IPMä¸­å¡«å……ã€‚<br>ç­‰å‡†å¤‡å¥½æ‰€æœ‰issuesä¹‹åï¼Œbacklogæ˜¾ç¤ºå¦‚ä¸‹ï¼š<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-6.png" alt="Backlog page"></p><h4 id="4-å¼€å¯IPMï¼ˆIteration-plan-meetingï¼‰">4. å¼€å¯IPMï¼ˆIteration plan meetingï¼‰</h4><p>åœ¨ä¼šè®®ä¸Šï¼Œé€šè¿‡å¼€å‘äººå‘˜ä¸€èµ·ç¡®è®¤å„ä¸ªissueçš„ä¼°ç‚¹ï¼Œå¹¶ä¸”â€œåˆ›å»ºâ€Sprintï¼Œæ ¹æ®ä¼°ç‚¹å’Œä¼˜å…ˆçº§ï¼Œå°†issuesæ‹–å…¥Sprintä¸­ã€‚</p><ul><li><p><strong>å½•å…¥ä¼°ç‚¹</strong><br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-7.png" alt="Backlog page"></p></li><li><p><strong>åˆ›å»ºSprint</strong><br>ç‚¹å‡»Backlogå³ä¸Šè§’çš„[Create Sprint]ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„Sprintã€‚ç„¶åæ‹–å…¥æ­¤æ¬¡Sprintçš„issuesã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-8.png" alt="Backlog page"></p></li></ul><h4 id="5-å‡†å¤‡å¼€å¯Sprintã€‚">5. å‡†å¤‡å¼€å¯Sprintã€‚</h4><p>æœ€åæ£€æŸ¥ä¸€éissuesä¸Šçš„å¿…è¦ä¿¡æ¯ï¼Œç‰¹åˆ«æ³¨æ„ä¼°ç‚¹ï¼ˆEstimationï¼‰å·²ç»æˆåŠŸå½•å…¥ã€‚<br>æ£€æŸ¥å®Œåï¼Œç‚¹å‡»sprintå³ä¸Šè§’çš„[Strart Sprint]ã€‚æ¥ç€åœ¨å¼¹å‡ºæ¡†ä¸­é€‰æ‹©å¥½time boxæ—¶é—´å‘¨æœŸï¼Œæœ€åç‚¹å‡»[Start]ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-9.png" alt="Start Sprint dialog"></p><p>è¿™æ—¶ï¼Œè¯¥Sprintä¼šè¿›å…¥ActiveçŠ¶æ€ï¼Œæ‰€å±issuesä¼šæ˜¾ç¤ºåœ¨boardçš„Active board pageä¸­ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-10.png" alt="Active Sprints page"></p><ul><li><strong>ä¸ºä»€ä¹ˆæé†’ä¸€å®šè¦å†æ£€æŸ¥ä¸€éissuesï¼Œç‰¹åˆ«æ˜¯åœ¨ç¡®è®¤ä¼°ç‚¹å½•å…¥ä¹‹åå†start Sprintï¼Ÿ</strong><br>å› ä¸ºæŒ‰è¿™ä¸ªæ­£å¸¸çš„æµç¨‹ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªæ­£å¸¸çš„ç‡ƒå°½å›¾ã€‚è§ä¸‹ï¼š<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-11.png" alt="æ­£å¸¸çš„ç‡ƒå°½å›¾å’Œtrackè¡¨æ ¼"></li></ul><p>å¦‚æœåœ¨start sprintåæ‰å¼€å§‹åŠ å…¥ä¼°ç‚¹è®°å½•ï¼Œåˆ™ä¼šè·å¾—è¿™æ ·çš„ç‡ƒå°½å›¾æŠ¥è¡¨ï¼š<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-12.png" alt="æ— ç”¨çš„ç‡ƒå°½å›¾"></p><p>åˆå§‹ç‚¹yå€¼ä¸º0ï¼Œguidelineå®Œå…¨è´´åœ¨Xè½´ï¼Œæ²¡æœ‰ä»»ä½•sprintåˆå§‹Estimationï¼Œä¹‹åå†å½•å…¥ä»»ä½•ä¸€æ¡issueçš„ä¼°ç‚¹ï¼Œéƒ½è¢«å±•ç¤ºæˆâ€œScope changeâ€ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-13.png" alt="ç‡ƒå°½å›¾ä¸‹é¢çš„trackè¡¨æ ¼"><br>è€ŒçœŸæ­£çš„æ¶‰åŠåˆ°Scope changeçš„issue trackå°±ä¼šå‚»å‚»åœ°æ— æ³•åŒºåˆ†ã€‚</p><h4 id="6-ä¿®æ”¹Active-board-columnã€‚">6. ä¿®æ”¹Active board columnã€‚</h4><p>è¿›å…¥boardé…ç½®é¡µé¢ï¼Œé€‰æ‹©Columns pageã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-14.png" alt="åˆå§‹columns"></p><p>JIRAé»˜è®¤çš„Columnsä¸€èˆ¬åˆ†ä¸º3æ¡ â€”â€” TODOã€In progressã€Doneï¼Œä¸€èˆ¬statuså’Œcolumnsæ˜¯å¯¹ä¸ä¸Šçš„ï¼Œå¯ä»¥è¿›è¡Œæ·»åŠ å’Œä¿®æ”¹ã€‚<br>ç‚¹å‡»[Add column]ï¼Œå¯æ·»åŠ ä¸€åˆ—ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç‚¹å‡»å·²æœ‰çš„Columnå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚<br>ç„¶åï¼Œå°†å¯¹åº”çš„statusåˆ†é…åˆ°Columnä¸­ã€‚<br>åœ¨ä¸åŒçš„columnä¹‹é—´ç§»åŠ¨çš„issueæ—¶ï¼Œissueçš„çŠ¶æ€ä¼šè‡ªåŠ¨æµè½¬åˆ°columnå¯¹åº”çš„statusã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-15.png" alt="é…ç½®å¥½ columns "></p><p>åŒæ—¶Active Sprintä¹Ÿä¼šåŒæ­¥åˆ·æ–°ä¸ºæ–°çš„Columnså¸ƒå±€ã€‚<br>è‡³äºstatusçš„æ·»åŠ å’Œä¿®æ”¹ï¼Œéœ€è¦JIRA Project adminçš„æƒé™å¯ä»¥å¯¹workflowsè¿›è¡Œä¿®æ”¹ã€‚</p><p><strong>ç‰¹åˆ«è¦æ³¨æ„</strong></p><ul><li><strong>æœ€åä¸€ä¸ªDone columnä¸­çš„statusä¸€å®šè¦æ˜ç¡®ã€‚å¦‚æœDone columnä¸­æœ‰ä¸¤ä¸ªåŠä»¥ä¸Šstatusæ—¶ï¼Œè¯·åŠ¡å¿…ç¡®è®¤å…¶ç›¸äº’ä¹‹é—´ä¸æ˜¯ä¸Šä¸‹æ¸¸çŠ¶æ€å…³ç³»ï¼Œè€Œæ˜¯éæ­¤åŠå½¼çš„å¹³çº§å…³ç³»ã€‚</strong><br>å› ä¸ºåŒä¸€ä¸ªcolumnä¸­ï¼Œæ— æ³•å†é€šè¿‡æ‹–åŠ¨issueæ¥å˜æ›´statusã€‚<br>åŒæ—¶å¦‚æœä¸Šä¸‹æ¸¸å…³ç³»çš„statusæ··åœ¨ä¸€ä¸ªcolumné‡Œä¹Ÿä¼šè®©lead timeæ— æ³•å¾ˆå¥½çš„ç»Ÿè®¡ã€‚<br>ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªä¸å¥½çš„ç¤ºä¾‹ â€”â€” Done columnä¸­æ—¢æœ‰<code>QA Done</code>ï¼Œä¹Ÿæœ‰<code>UAT Done</code>ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-16.png" alt="Doneé€‰è¿˜æ˜¯ä¸é€‰"></li></ul><p>å…¶ä¸­QA Done issue countä¸º45ï¼Œ UAT Done issue countä¸º31ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-17.png" alt="åŠåœæ»çš„Done column"></p><ul><li><strong>ä¸€å®šè¦ç¡®è®¤æœ€åä¸€ä¸ªDone columnä¸­çš„statusæ˜¯å¦éœ€è¦transitionæ—¶set resolutionã€‚</strong><br>å¦‚æœè¿˜æœ‰ä¸‹æ¸¸çš„boardéœ€è¦æµè½¬å’Œå¤„ç†åŒä¸€æ‰¹issueçš„æƒ…å†µï¼Œå¯ä»¥æš‚æ—¶ä¸€éƒ¨åˆ†statusä¸éœ€è¦è®¾ç½®set resolutionã€‚<br>å¦åˆ™ï¼Œè¯·å°†æœ€åä¸€ä¸ªDone columnä¸­å¯¹åº”çš„status transitionåœ¨workflowé…ç½®ä¸­ï¼ŒåŠ å…¥set resolution post Functionã€‚</li></ul><h4 id="7-å¦‚ä½•å¯¹æ²¡æœ‰resolutionçš„statusæ·»åŠ Post-functionï¼Ÿ">7. å¦‚ä½•å¯¹æ²¡æœ‰resolutionçš„statusæ·»åŠ Post functionï¼Ÿ</h4><p>ç‚¹å‡»boardé¡µé¢å·¦ä¸‹è§’çš„é½¿è½®æŒ‰é’®[Project setting]ï¼Œåœ¨ç‚¹å‡»[workflows],é€‰æ‹©å¯¹åº”workflowã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-18.png" alt="Workflow edit"></p><p>ç‚¹å‡»[Edit]æŒ‰é’®ï¼Œè¿›å…¥ç¼–è¾‘çŠ¶æ€ã€‚å‡è®¾æƒ³è¦ç»™<code>QA Done</code>æ·»åŠ set resolutionï¼Œç‚¹å‡»å›¾å³è¾¹transitionçš„[post Functions] linkã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-19.png" alt="Post Functions"></p><p>ç‚¹å‡»[Add post function]ï¼Œè¿›å…¥æ·»åŠ post functionçš„å¼•å¯¼æµç¨‹ã€‚<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-20.png" alt="å¼•å¯¼å›¾"></p><p><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-21.png" alt="å¼•å¯¼å›¾"></p><p><strong>ä¸ºä½•å¼ºè°ƒä¸€å®šè¦åŠ å…¥set resolution?</strong><br>åœ¨JIRAä¸­å¹¶ä¸æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªå«Doneçš„statuså°±ä»£è¡¨è¿™å¼ å¡ç‰‡å·²ç»è¾¾åˆ°å®Œæˆæ ‡å‡†ã€èµ°åˆ°äº†ç”Ÿå‘½å‘¨æœŸçš„ç»ˆç‚¹ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨issueä¸Šçš„resolution fieldã€‚<br>å¦‚æœæœ€åä¸æ·»åŠ resolutionä¼šé€ æˆçš„å½±å“ï¼Œä¼šå¯¹ä¸€äº›æŠ¥è¡¨å’Œfilterçš„ä½¿ç”¨é€ æˆå½±å“ã€‚<br>å®˜æ–¹è¯´æ˜è§ä¸‹ï¼š<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-22.png" alt="å®˜æ–¹resolutionè¯´æ˜"></p><p><strong>ç‰¹åˆ«è¯´æ˜ç‡ƒå°½å›¾æŠ¥è¡¨ï¼š</strong><br>ç‡ƒå°½å›¾æŠ¥è¡¨ä¸­çš„issueæ˜¯å¦completeï¼Œæ˜¯å¦burndownï¼Œä¸resolution fieldæ— å…³ â€”â€” ä»…äºboardä¸Šæœ€å³çš„columnæœ‰å…³ã€‚<br>åªè¦issueç§»åŠ¨åˆ°æœ€å³çš„columnï¼Œå³ä¼šæ˜¾ç¤ºburndownã€‚<br>å®˜æ–¹è¯´æ˜è§ä¸‹ï¼š<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-24.png" alt="å®˜æ–¹burndown chartè¯´æ˜"></p><h4 id="8-JIRA-board-usersåœ¨sprintä¸­ï¼Œé¢†å–issueå’Œä¼ é€’issueæ—¶ï¼Œä¸€å®šè¦è®°å¾—åŠæ—¶æŒªå¡ã€‚">8. JIRA board usersåœ¨sprintä¸­ï¼Œé¢†å–issueå’Œä¼ é€’issueæ—¶ï¼Œä¸€å®šè¦è®°å¾—åŠæ—¶æŒªå¡ã€‚</h4><h4 id="9-åœ¨sprintç»“æŸæ—¶ï¼Œä¸€å®šè¦è®°å¾—åŠæ—¶æ‰‹åŠ¨ç‚¹å‡»complete-sprintã€‚">9. åœ¨sprintç»“æŸæ—¶ï¼Œä¸€å®šè¦è®°å¾—åŠæ—¶æ‰‹åŠ¨ç‚¹å‡»complete sprintã€‚</h4><p><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-25.png" alt="complete sprint"><br>ç‚¹å‡»å³ä¸Šè§’link[Complete Sprint]ï¼Œè¿™æ—¶å¯¹äºæœªDoneçš„issueä¼šè¿›è¡Œæç¤ºï¼š<br><img src="/2019/09/12/jian-dan-jira-scrum-board-zi-shi/JIRA-26.png" alt="complete sprint dialog"><br>å¯ä»¥é€‰æ‹©ç§»å…¥backlogï¼Œæˆ–è€…ç§»å…¥æ–°çš„sprintä¸­ã€‚<br>åœ¨è¿™é‡Œä¸è¦å› ä¸ºSprintæ—¶é—´åˆ°äº†ï¼Œä»æœ‰æœªå®Œæˆçš„issueï¼Œè€Œå®³æ€•å°†Sprint completeã€‚<br>æ‰€æœ‰çš„trackè¡Œä¸ºéƒ½åº”è¯¥ä»¥å®é™…æƒ…å†µä¸ºå‡†ï¼Œè¿™æ ·ç”Ÿæˆçš„æ•°æ®æ‰èƒ½çœŸå®è¿›è¡Œåé¦ˆï¼Œä¸ºå°†æ¥çš„æ”¹è¿›æä¾›æœ‰æ•ˆçš„å»ºè®®å’Œæ•°æ®æ”¯æŒã€‚</p><p>Sprint completeäº†ä¹‹åï¼Œå¦‚velocity reportå°±å¯ä»¥è®¡ç®—å’Œæ±‡æ€»è¿™æ¬¡sprint velocityäº†ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æ—¢ç„¶ç”¨äº†æœ‰ç”¨çš„å·¥å…·ï¼Œå°±è¦æœ‰æ•ˆçš„ä½¿ç”¨èµ·æ¥ã€‚<br>è¦é¿å…ä»…å°†JIRAå½“æˆä¸€ä¸ªå¯è§†åŒ–ç”µå­å¢™çš„è¯¯åŒºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•æ·å¼€å‘ç®¡ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•æ·å¼€å‘ç®¡ç† </tag>
            
            <tag> JIRA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†™ä¸šåŠ¡ä»£ç çœŸçš„æœ‰é‚£ä¹ˆæ— èŠå—</title>
      <link href="/2019/07/19/xie-ye-wu-dai-ma-zhen-de-you-na-me-wu-liao-ma/"/>
      <url>/2019/07/19/xie-ye-wu-dai-ma-zhen-de-you-na-me-wu-liao-ma/</url>
      
        <content type="html"><![CDATA[<blockquote><p><em>å‰é¢å…ˆå†™ä¸€ç‚¹åºŸè¯ã€‚</em><br><em>ç”±äºæœ€è¿‘åœ¨æ•´ç†ä¸€äº›DDDã€å¾®æœåŠ¡ã€æ¶æ„ç›¸å…³çš„çŸ¥è¯†æ€»ç»“ï¼Œä¸€è¾¹çœ‹ä¸€è¾¹å›å¿†ä¸€äº›ç»å†ï¼Œåˆç”±äºæœ¬äººçœ‹çš„ä¸œè¥¿æœ‰æ—¶å€™å¾ˆæ‚ï¼Œè®°å¿†åŠ›åˆå¤§ä¸å¦‚å‰ï¼Œæœ¬æ‰“ç®—ä»…ç”¨ç§äººæ‰‹è´¦çš„å½¢å¼è®°å½•ä¸€ä¸‹ã€‚</em><br><em>ä½†å›çœ‹äº†ä¸€ä¸‹2019å¹´å¹´å‰ç«‹çš„flag â€”â€” 50ç¯‡åšå®¢ï¼ˆåº”è¯¥æ˜¯å®Œä¸æˆäº†å§ã€‚ã€‚ï¼‰ï¼Œåˆæƒ³åˆ°æœ€è¿‘ä¸€æ®µæ—¶é—´æ¥è§¦åˆ°çš„å’¨è¯¢åŒäº‹çš„å†™ä½œèƒ½åŠ›ï¼Œå”‰ã€‚</em><br><em>è™½ç„¶å¯¹è‡ªèº«å†™ä½œå’Œè¯­è¨€è¡¨è¿°èƒ½åŠ›æœ‰äº›èé¡ä¸æŒ¯ï¼Œä½†ï¼Œäººä¸èƒ½ä¸ä¸Šè¿›ã€‚</em><br><em>å› æ­¤ï¼Œå‡†å¤‡å¼€å§‹ç®€ä¹¦ã€‚</em></p><p><em>è¿™é‡Œæœ‰äººå¯èƒ½è¦é—®äº†ï¼šä½ ä¸æ˜¯è·‘å»æåŒºå—é“¾äº†å—ï¼Œæ€ä¹ˆåˆè·‘å›æ¥å¾®æœåŠ¡ã€DDDäº†ï¼Ÿ</em><br><em>å—¯ã€‚ã€‚è¿™ä¸ªé—®é¢˜é—®çš„å¥½ã€‚è¿™é‡Œå°±ä¸å¾—ä¸æåˆ°æœ¬äººå»æåŒºå—é“¾ä¹‹å‰çš„ä¸€æ®µè¿‘ä¸¤å¹´çš„é¡¹ç›®ç»å†äº†ã€‚</em><br><em>æ€ä¹ˆè¯´å‘¢ï¼Œè¿™ä¸ªé¡¹ç›®è™½ç„¶åœ¨æˆ‘çš„é¡¹ç›®ç»å†ä¸­å·²ç»å®Œç»“äº†ï¼Œä½†å®ƒé—ç•™åœ¨æˆ‘å¿ƒä¸­çš„é—®é¢˜è¿˜æ²¡æœ‰å®Œç»“ã€‚</em><br><em>å°±æ˜¯è¿™æ ·ã€‚</em></p></blockquote><h4 id="1-æœ‰æ—¶å€™ä½ ä¸å¾—ä¸å»å†™çš„ä¸šåŠ¡ä»£ç ">1. æœ‰æ—¶å€™ä½ ä¸å¾—ä¸å»å†™çš„ä¸šåŠ¡ä»£ç </h4><p>æœ€è¿‘å‡ºå·®å›æ¥ï¼Œé‡åˆ°ä¸€äº›ä¹‹å‰é¡¹ç›®ä¸Šçš„åŒäº‹èŠåˆ°è‡ªå·±å½“å‰çš„æ–°é¡¹ç›®ï¼Œæ— ä¸æ„Ÿå¹â€”â€”ä¸ç”¨å†åƒä»¥å‰ä¸€æ ·ä¸åœåœ°å†™ä¸šåŠ¡ä»£ç äº†ã€‚<br>å—¯ï¼Œå¯ä»¥å¤šç©ä¸€äº›æŠ€æœ¯ã€æˆ–è€…æ–°çš„æŠ€æœ¯ï¼Œæ€»æ˜¯å¯ä»¥è®©ææŠ€æœ¯çš„äººå…´å¥‹å¾ˆä¹…ã€‚<br>ä½†æ˜¯ï¼Œæ¯”è¾ƒå¯æƒœï¼Œæ‰€è°“æŠ€æœ¯è¦ç›ˆåˆ©ï¼Œå°±è¦äº¤ä»˜äº§å“ã€‚è¦äº¤ä»˜äº§å“ï¼Œå¿…ç„¶å°±ä¼šæœ‰ä¸šåŠ¡ã€‚å³ä½¿æ˜¯DevOpså¹³å°è¿™ç§çº¯æŠ€æœ¯å‹çš„äº§å“ï¼ŒæŠ€æœ¯ä¸Šçš„CI/CDå°±æ˜¯å®ƒçš„ä¸šåŠ¡ã€‚<br>å†™ä¸šåŠ¡ä»£ç ï¼Œå¯¹æ¯ä¸ªå¼€å‘æ¥è¯´ï¼ŒåŸºæœ¬ä¸Šéƒ½å¿…ä¸å¯å°‘ã€‚<br>è¿™æ—¶å€™ï¼ŒæŠ€æœ¯éœ€è¦é€šè¿‡å®ç°ä¸šåŠ¡ï¼Œæ¥å±•ç°ä»·å€¼ã€‚</p><h4 id="2-å†™äº†è¿™ä¹ˆå¤šä¸šåŠ¡ä»£ç ï¼Œä½ æ˜¯å¦çœŸçš„ä¼šå†™ä¸šåŠ¡ä»£ç ">2. å†™äº†è¿™ä¹ˆå¤šä¸šåŠ¡ä»£ç ï¼Œä½ æ˜¯å¦çœŸçš„ä¼šå†™ä¸šåŠ¡ä»£ç </h4><p>ä¸€å®šä¼šæœ‰äººè§‰å¾—è¿™ä¸ªé—®é¢˜å¾ˆå¥‡æ€ªï¼Œä¸šåŠ¡ä»£ç ä¸å°±æ˜¯ä¸€ä¸ªä¸æ–­ç´¯åŠ çš„è¿‡ç¨‹ä¹ˆï¼Œæœ‰ä»€ä¹ˆä¼šä¸ä¸ä¼šï¼Ÿ<br>è¯´å®è¯ï¼Œåœ¨æ²¡æœ‰ä¹‹å‰é‚£æ¬¡ä¸¤å¹´ç»éªŒçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæ˜¯è¿™æ ·æƒ³çš„ã€‚ä½†é€šè¿‡é‚£ä¸¤å¹´çš„ç»å†ï¼Œæˆ‘æ„è¯†åˆ° â€”â€” <strong>å¤æ‚ä¸šåŠ¡ç³»ç»Ÿ</strong>ï¼Œä¸šåŠ¡ç»å¯¹ä¸æ˜¯ 1+1=2 è¿™ä¹ˆç®€å•ã€‚<br>ä½†å³ä½¿è¿™æ ·ï¼Œåœ¨æˆ‘ç»å†æœ€è¿‘ä¸€ä¸ªçŸ­æœŸé¡¹ç›®ï¼Œè·Ÿå®¢æˆ·åˆä½œå¼€å‘çš„æ—¶å€™ï¼Œåˆæ„è¯†åˆ° â€”â€” å³ä½¿æ˜¯ <strong>ç®€å•ä¸šåŠ¡ç³»ç»Ÿ</strong>ï¼Œå¦‚æœå¼€å‘äººå‘˜æ²¡æœ‰ å»ºæ¨¡æ„è¯†ã€æˆ–è€…é¢å‘å¯¹è±¡çš„ç»éªŒã€ç”šè‡³è¯´æ˜¯æ²¡æœ‰ä¸šåŠ¡çš„ç†è§£æ¶ˆåŒ–èƒ½åŠ›ï¼Œå†™å‡ºçš„ä»£ç ç”šè‡³è¿ 1+1=2 éƒ½åšä¸åˆ°ã€‚</p><span id="more"></span><p>è¿™ä¸ªäº‹æƒ…æ˜¯è¿™æ ·çš„ã€‚<br><strong>èƒŒæ™¯</strong>ï¼šé¡¹ç›®æ˜¯åšä¸€æ¬¾åŒºå—é“¾çš„æ‰‹æœºé’±åŒ…ï¼ˆå½“ç„¶è¿™é‡Œè¦è¯´çš„ä¸åŒºå—é“¾çŸ¥è¯†æ— å…³ï¼‰ã€‚<br>å¯ä»¥ç®€å•çš„ç†è§£ä¸€ä¸‹ â€”â€” æ¯ä¸€ä¸ªè¯¥APPçš„<strong>User</strong>å¯ä»¥é€šè¿‡â€æ‰‹æœºå·+éªŒè¯ç â€œç™»å½•è¯¥APPï¼Œè€Œæ¯ä¸ªUserä¸‹å¯ä»¥æœ‰ä¸€æ‰¹è´¦æˆ·<strong>Account</strong>ã€‚<br>å¯ä»¥æƒ³è±¡æ¯”å¯¹ä¸ºï¼ŒæŸé“¶è¡Œappçš„ä¸€ç½‘é€šè´¦å· -&gt; Userï¼Œä¸€ç½‘é€šè´¦å·ä¸‹æœ‰å¤šå¼ é“¶è¡Œå¡ã€ä¿¡ç”¨å¡è´¦æˆ· -&gt; Accountã€‚<br><strong>ä¸šåŠ¡éœ€æ±‚</strong>ï¼šè¿›å…¥APPé¦–é¡µçš„æ—¶å€™ï¼Œé¦–é¡µå±•ç¤ºçš„**â€å½“å‰Accountâ€œ**é»˜è®¤ä¸ºæœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„Accountã€‚<br><strong>å®ç°èƒŒæ™¯</strong>ï¼šåå°ä¿å­˜æ•°æ®çŠ¶æ€ï¼Œä½¿ç”¨çš„MySQLæ•°æ®åº“ã€‚ï¼ˆæœ‰ä¸€äº›å…¶ä»–èƒŒæ™¯ï¼Œæˆ‘è¿™é‡Œå°±ä¸å¦æè¿°ä¸ºä½•ä¸é‡‡ç”¨APPå‰ç«¯ä¿å­˜ç­‰æ–¹å¼ï¼‰<br><strong>è¡¨ç»“æ„ç±»ä¼¼</strong>ï¼š<br><img src="/2019/07/19/xie-ye-wu-dai-ma-zhen-de-you-na-me-wu-liao-ma/question.png" alt="ç°æœ‰è¡¨ç»“æ„"></p><p>çœ‹åˆ°è¿™é‡Œï¼Œæ¯ä¸ªäººåº”è¯¥å†…å¿ƒéƒ½æœ‰è‡ªå·±çš„å®ç°æ–¹å¼äº†ã€‚<br>åŸºäºè¿™æ˜¯ä¸€ä¸ªä¸šåŠ¡ç®€å•çš„ç³»ç»Ÿï¼Œå¯ä»¥å°è¯•ç›´æ¥ç”¨æ•°æ®æ¨¡å‹çš„å½¢å¼è¡¨è¿°ä¸€ä¸‹ã€‚<br>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ</p><p>ç›¸ä¿¡è®¸å¤šäººéƒ½ä¼šè§‰å¾—å¾ˆç®€å•ï¼Œå®ƒçš„ç¡®ä¹ŸæŒºç®€å•ã€‚<br>ç”šè‡³ï¼Œå½“æ—¶åœ¨é¡¹ç›®ä¸Šç¬¬ä¸€ç‰ˆä»£ç å®ç°å‡ºæ¥çš„æ—¶å€™ï¼Œå³ä½¿code reviewæ²¡æœ‰é€šè¿‡ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰è§‰å¾—å®ƒæ˜¯ä¸ªé—®é¢˜ï¼Œå³ä½¿å®ç°æ–¹æ˜¯å®¢æˆ·æ–¹çš„Devã€‚ç›´åˆ°æ­£å¼team code reviewï¼Œåœ¨ä¸å®¢æˆ·æ–¹Devçš„æ²Ÿé€šä¸­ï¼Œæˆ‘æ‰å‘ç°ï¼Œå¯¹ä¸€äº›Devæ¥è¯´ï¼Œå®ƒçš„ç¡®æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><p>é‚£ï¼Œçœ‹ä¸€ä¸‹ä½ å®ç°çš„æ•°æ®æ¨¡å‹æ˜¯ä¸‹é¢å“ªä¸€ç§ï¼š<br><img src="/2019/07/19/xie-ye-wu-dai-ma-zhen-de-you-na-me-wu-liao-ma/answers.png" alt="ç°æœ‰è¡¨ç»“æ„"></p><p>å¾ˆä¸å¹¸ï¼Œå½“æ—¶çš„ç¬¬ä¸€ç‰ˆä»£ç å®ç°æ˜¯ <strong>1</strong>ã€‚çŠ¯äº†å°† Account çš„å±æ€§æ³„éœ²åˆ°Userä¸­çš„å¤§åŸåˆ™é—®é¢˜ã€‚<br><strong>(æ’é™¤)</strong></p><p>å†çœ‹ä¸‹ <strong>2</strong>ï¼Œ<strong>â€œé»˜è®¤è´¦æˆ·â€</strong>ï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿä¹Ÿè®¸æœ‰äººä¼šè¯´ï¼Œè¿™åªæ˜¯å­—æ®µèµ·åçš„é—®é¢˜ã€‚æˆ–è€…ä¹Ÿæœ‰äººä¼šè¯´ï¼Œå°±æ˜¯â€é»˜è®¤è¦æ˜¾ç¤ºçš„è´¦æˆ·â€œå•Šã€‚ç›¸æ¯”äº<strong>1</strong>ï¼ŒUser å’Œ Account ä¹‹é—´çš„å…³è”ä½¿ç”¨äº†idï¼Œæ¯” <strong>1</strong> è¦å¥½å¾ˆå¤šã€‚ä½†æ˜¯ï¼ŒUser éœ€è¦å…³å¿ƒæ˜¯å“ªä¸ª Account è¦æ˜¾ç¤ºå—ï¼Ÿè¿™ç§åŒå‘å…³è”çš„è®¾è®¡æ˜¯å¿…è¦çš„å—ï¼Ÿå¥½ï¼Œæˆ‘ä»¬å…ˆæŠŠ <strong>2</strong> æ”¾ä¸€ä¸‹ã€‚</p><p>é‚£çœ‹ä¸‹ <strong>3</strong>ï¼Œæ¯ä¸ª account éƒ½æœ‰ä¸€ä¸ª bool æ ‡è®°ï¼Œç”¨ä»¥æ ‡è®°è‡ªå·±æ˜¯ä¸æ˜¯å½“å‰ User ä¸‹çš„é»˜è®¤è´¦å·ã€‚å¥½å¤„æ˜¯ï¼ŒUser å®Œå…¨ä¸ç”¨å…³å¿ƒæ——ä¸‹çš„ Account è¢«é€‰æ‹©çš„é—®é¢˜ã€‚ä½†ï¼Œå…ˆä¸æ <strong>é»˜è®¤è´¦æˆ·</strong> å…³é”®å­—çš„é—®é¢˜ï¼Œå¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå½“æ¯æ¬¡ User åˆ‡æ¢äº†å½“å‰çš„ Accountï¼Œç³»ç»Ÿå°±éœ€è¦æ•´ä½“æ£€æŸ¥ä¸€éå½“å‰ User ä¸‹æ‰€æœ‰çš„ Account çš„ <code>is_default</code>å€¼ï¼Œå¹¶ä¸”è¿›è¡Œä¿®æ”¹ã€‚è™½ç„¶åœ¨å¹¶å‘ç«äº‰ä½çš„åœºæ™¯ä¸‹ï¼Œè²Œä¼¼ä¹Ÿå‹‰å¼ºå‹‰å¼ºæ¥å—ï¼Œå†æƒ³ä¸€ä¸‹æ˜¯ä¸æ˜¯æœ‰æ›´å¥½çš„åŠæ³•ï¼Ÿ</p><p>æœ€åçœ‹ä¸‹ <strong>4</strong>ï¼Œåœ¨ <strong>3</strong> çš„åŸºç¡€ä¸Šå†æƒ³ä¸€ä¸‹ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆå†³å®šäº†å½“å‰ User æ‰€å±çš„æ‰€æœ‰ Account ä¸­é‚£å”¯ä¸€ä¸€æ¡trueæ ‡è®°ï¼Ÿè¿™ä¸ªæ—¶å€™ â€”â€” <strong>è¯·æŠŠï¼Œéœ€æ±‚æ‹¿å‡ºæ¥å†ä»”ç»†çœ‹ä¸€éã€‚</strong><br><strong>è¿™å¾ˆé‡è¦ã€‚</strong></p><blockquote><p>â€è¿›å…¥APPé¦–é¡µçš„æ—¶å€™ï¼Œé¦–é¡µå±•ç¤ºçš„<strong>å½“å‰Account</strong>é»˜è®¤ä¸º <strong>æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨</strong> çš„ Accountã€‚â€œ</p></blockquote><p><strong>å¦‚æœè§‰å¾—ä¸ç¡®å®šï¼Œç”šè‡³å¯ä»¥æ‹‰ä¸Š team ä¸Šçš„ BA å†è®¤çœŸèŠä¸€ä¸‹</strong>ã€‚<br>DEVï¼šæœ€è¿‘ä¸€æ¬¡ä½¿ç”¨ï¼Œæ„æ€æ˜¯è´¦å·çš„æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´ç‚¹å¾ˆé‡è¦ï¼Ÿ<br>BAï¼šæˆ‘ä¸ç¡®è®¤â€æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´ç‚¹â€œæ˜¯ä¸æ˜¯å¾ˆé‡è¦ã€‚é¦–é¡µè¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘åªå…³å¿ƒæ˜¾ç¤ºçš„æ˜¯æœ€åä¸€æ¬¡ä½¿ç”¨çš„è´¦å·ã€‚ä½†å¯¹äºé¦–é¡µä¸Šæ‰‹åŠ¨ç‚¹å‡»åˆ‡æ¢ Account çš„å¼¹å‡ºå±‚ä¸Šï¼ŒAccount List æˆ‘è§‰å¾—å€’æ˜¯å¯ä»¥é‡‡ç”¨æ ¹æ®å„è‡ªçš„ <strong>æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´ç‚¹</strong> æ¥æ’åºå±•ç¤ºã€‚</p><p>åˆ°è¿™é‡Œï¼Œå¯ä»¥å†æ‹¿å‡ºä¹‹å‰è¿˜æ²¡å®Œå…¨æ’é™¤æ‰çš„<strong>2ã€3ã€4</strong>ï¼Œäº‹æƒ…å°±å¾ˆå¥½è§£å†³äº†ã€‚<br><strong>2</strong> å’Œ <strong>3</strong> è«åå…¶å¦™åœ°çªå‡ºäº†ä¸€ä¸ª<strong>é»˜è®¤è´¦å·</strong>çš„é—®é¢˜ï¼Œå¹¶ä¸”è®©äº‹æƒ…å˜å¾—å¤æ‚ â€”â€” <strong>2</strong> å¤šäº†åŒå‘å…³è”ï¼Œ<strong>3</strong> å¤šäº†æ‰¹é‡æ›´æ–°ï¼ŒåŒæ—¶éƒ½é—æ¼å¯¹äº†æ¯ä¸ªâ€œ<strong>æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´ç‚¹</strong>â€çš„è®°å½•ã€‚<br>è€Œ <strong>4</strong> åœ¨æŠ“åˆ°â€œ<strong>æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´ç‚¹</strong>â€è¿™ä¸ªå…³é”®ä¿¡æ¯ï¼Œå¹¶ä¸”å¾—åˆ°ä¸šåŠ¡è®¤å¯çš„åŒæ—¶ï¼Œè§£å†³äº†é¦–é¡µå±•ç¤ºçš„ä¸šåŠ¡caseï¼Œå¹¶ä¸”èƒ½å¾ˆå¥½çš„æ”¯æŒæ‰©å±•ã€‚</p><h4 id="3-çŸ¥è¯†æ¶ˆåŒ–ã€ç†è§£ä¸šåŠ¡æ„å›¾ã€åˆ†æå»ºæ¨¡ã€æˆ–è€…æ˜¯whatever">3. çŸ¥è¯†æ¶ˆåŒ–ã€ç†è§£ä¸šåŠ¡æ„å›¾ã€åˆ†æå»ºæ¨¡ã€æˆ–è€…æ˜¯whatever</h4><p>ä¸Šé¢çš„ä¾‹å­æœ‰ç‚¹é•¿ï¼Œæœ¬äººä¹Ÿæ¯”è¾ƒæ‹…å¿ƒè‡ªå·±çš„è¡¨è¿°ä¸å¤ªå¥½ï¼Œè®©ä¸¾è¯æ–¹å‘å‘å±•åˆ°æ¯”è¾ƒå¥‡æ€ªçš„åœ°æ–¹ã€‚æˆ–è€…ï¼Œæœ‰æ—¶å€™ä¸åŒçš„äººçš„ç»å†æ€»æ˜¯å¯ä»¥çœ‹å‡ºä¸ä¸€æ ·çš„å‘³é“ã€‚</p><p>å½“ç„¶ï¼Œè¿™ç¯‡åšå®¢çš„ç›®çš„ä¹Ÿå¹¶ä¸æ˜¯ä¸ºäº†ç›´å¥”DDDä¸»é¢˜ã€‚<br>åªæ˜¯æƒ³è¦å¼ºè°ƒä¸€ç‚¹ï¼šå†™ä¸šåŠ¡ä»£ç å…¶å®ä¹Ÿæ²¡é‚£ä¹ˆç®€å•å’Œå•è°ƒã€‚Devåœ¨å¼€å‘ä¹‹å‰ï¼Œæˆ–è€…æ˜¯å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½è¦ç¡®ä¿è‡ªå·±å¯¹ä¸šåŠ¡çŸ¥è¯†è¿›è¡Œäº†æ¶ˆåŒ–ï¼ŒæŒæ¡äº†ä¸šåŠ¡æ„å›¾ï¼Œç„¶åè¿›è¡Œå»ºæ¨¡ã€å®ç°å¼€å‘ã€‚<br>å³ä¾¿æ˜¯åœ¨ä¸éœ€è¦è¿ç”¨DDDçš„ç®€å•ä¸šåŠ¡ç³»ç»Ÿä¸­ã€‚</p><p>æœ€åå¼•ç”¨ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ä¸æ¨¡å¼ã€åŸç†ä¸å®è·µã€‹ä¸­çš„ä¸€å¥è¯ï¼š</p><blockquote><p>ä»£ç è¾“å…¥å¹¶éäº¤ä»˜äº§å“çš„ç“¶é¢ˆï¼›ç¼–ç æ˜¯å¼€å‘è¿‡ç¨‹ä¸­æœ€ç®€å•çš„ä¸€éƒ¨åˆ†ã€‚åœ¨éåŠŸèƒ½æ€§éœ€æ±‚ä¹‹å¤–åˆ›å»ºå¹¶ç»´æŒä¸€ä¸ªèƒ½å¤Ÿæ»¡è¶³ä¸šåŠ¡ç”¨ä¾‹çš„é¢†åŸŸçš„æœ‰ç”¨è½¯ä»¶æ¨¡å‹æ‰æ˜¯éš¾ç‚¹æ‰€åœ¨ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> DDD </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–ç¨‹ä»·å€¼è§‚ã€åŸåˆ™ã€æ¨¡å¼</title>
      <link href="/2018/12/10/bian-cheng-jie-zhi-guan-yuan-ze-mo-shi/"/>
      <url>/2018/12/10/bian-cheng-jie-zhi-guan-yuan-ze-mo-shi/</url>
      
        <content type="html"><![CDATA[<p>è¯»è‡ªã€Šå®ç°æ¨¡å¼ã€‹</p><hr><p><strong>æ¨¡å¼</strong>ï¼Œå³æ˜¯é’ˆå¯¹ç‰¹å®šé—®é¢˜çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚<br>æ¯ä¸ªæ¨¡å¼éƒ½æ‰¿è½½è¿™ä¸€ç‚¹ç‚¹ç†è®ºï¼Œä½†å®é™…ç¼–ç¨‹ä¸­å­˜åœ¨ç€ä¸€äº›æ›´åŠ æ·±è¿œçš„å½±å“åŠ›ï¼Œè¿œä¸æ˜¯å­¤ç«‹çš„æ¨¡å¼æ‰€èƒ½æ¦‚æ‹¬çš„ã€‚</p><p><strong>ä»·å€¼è§‚</strong>æ˜¯ç¼–ç¨‹è¿‡ç¨‹çš„ç»Ÿä¸€æ”¯é…æ€§ä¸»é¢˜ï¼Œå½±å“åœ¨ç¼–ç¨‹ä¸­æ‰€ä½œçš„æ¯ä¸€ä¸ªå†³ç­–ã€‚<br>ä»·å€¼è§‚æœ‰æ™®éçš„æ„ä¹‰ï¼Œä½†å¾€å¾€éš¾ä»¥ç›´æ¥åº”ç”¨ï¼›æ¨¡å¼è™½ç„¶å¯ä»¥ç›´æ¥åº”ç”¨ï¼Œå´é’ˆå¯¹çš„æ˜¯ç‰¹å®šæƒ…å¢ƒï¼›<strong>åŸåˆ™</strong>åœ¨ä»·å€¼è§‚å’Œæ¨¡å¼ä¹‹é—´æ­å»ºäº†æ¡¥æ¢ã€‚</p><p>ä»·å€¼è§‚ -&gt; åŸåˆ™ -&gt; æ¨¡å¼<br>æ¨¡å¼æè¿°äº†è¦åšä»€ä¹ˆï¼Œä»·å€¼è§‚æä¾›äº†åŠ¨æœºï¼ŒåŸåˆ™åˆ™æŠŠåŠ¨æœºè½¬åŒ–æˆäº†å®é™…è¡ŒåŠ¨ã€‚</p><p>åœ¨ä¸ºç”¨å“ªç§æ–¹å¼åšäº‹è€Œäº‰è®ºçš„åŒæ—¶ï¼Œå¦‚æœåœ¨ä»·å€¼è§‚ã€åŸåˆ™ä¸Šå­˜åœ¨æ ¹æœ¬å±‚æ¬¡åˆ†æ­§ï¼Œé‚£ä¹ˆé¦–å…ˆè¦ä»ä»·å€¼è§‚ã€åŸåˆ™ä¸Šè¾¾æˆå…±è¯†ï¼Œä¸ç„¶å°±æ˜¯åœ¨æµªè´¹æ—¶é—´ã€‚</p><h3 id="ä»·å€¼è§‚">ä»·å€¼è§‚</h3><h5 id="1-å¯è¯»æ€§ï¼ˆæ²Ÿé€šï¼‰">1. å¯è¯»æ€§ï¼ˆæ²Ÿé€šï¼‰</h5><p>ç¼–å†™å‡ºè®¡ç®—æœºèƒ½è¿è¡Œçš„ä»£ç å¾ˆç®€å•ï¼Œç¼–å†™å‡ºè®©äººèƒ½å¾ˆå¥½ç†è§£çš„ä»£ç æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚</p><p>åœ¨ç¼–ç¨‹æ—¶ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“ä»è®¡ç®—æœºçš„è§’åº¦è¿›è¡Œæ€è€ƒã€‚ä½†åªæœ‰ä¸€é¢ç¼–ç¨‹ä¸€é¢æ€è€ƒå…¶ä»–äººçš„æ„Ÿå—ï¼Œæ‰èƒ½å†™å‡ºæ›´å¥½çš„ä»£ç ã€‚</p><p>ä»ç»æµå­¦æ¥è¯´ï¼Œè½¯ä»¶çš„ç»å¤§éƒ¨åˆ†æˆæœ¬éƒ½æ˜¯åœ¨ç¬¬ä¸€æ¬¡éƒ¨ç½²ä»¥åæ‰äº§ç”Ÿçš„ã€‚ä»ç»éªŒæ¥çœ‹ï¼ŒèŠ±è´¹åœ¨é˜…è¯»æ—¢æœ‰ä»£ç ä¸Šçš„æ—¶é—´è¦æ¯”ç¼–å†™å…¨æ–°çš„ä»£ç é•¿å¾—å¤šã€‚<br>å› æ­¤ï¼Œä¸ºäº†å‡å°‘é˜…è¯»ä»£ç æ‰€å¸¦æ¥çš„å¼€é”€ï¼Œå°±åº”è¯¥è®©å®ƒå®¹æ˜“è¯»æ‡‚ã€‚</p><h5 id="2-ç®€å•">2. ç®€å•</h5><p>ä»£ç ä¸­çš„å¤æ‚æœ‰ä¸¤ç§ï¼šæœ‰äº›å¤æ‚æ€§æ˜¯å†…åœ¨çš„ï¼Œä»–ä»¬å‡†ç¡®åæ˜ äº†æ‰€è¦è§£å†³çš„é—®é¢˜çš„å¤æ‚æ€§ï¼›å¦ä¸€äº›å¤æ‚æ€§çš„äº§ç”Ÿåˆ™æ˜¯å› ä¸ºæˆ‘ä»¬å¿™ç€è®©ç¨‹åºè¿è¡Œèµ·æ¥ï¼Œæœªè®¤çœŸè€ƒè™‘ï¼Œä»è€Œé€ å‡ºäº†å¤šä½™çš„å¤æ‚ã€‚</p><p>å¤šä½™çš„å¤æ‚æ€§é™ä½äº†è½¯ä»¶çš„ä»·å€¼ï¼šä¸€æ˜¯è®©è½¯ä»¶æ­£ç¡®è¿è¡Œçš„å¯èƒ½æ€§é™ä½ï¼Œå†æ˜¯å°†æ¥ä¹Ÿå¾ˆéš¾è¿›è¡Œæ­£ç¡®çš„æ”¹åŠ¨ã€‚</p><p>è¿½æ±‚ç®€å•æ¨åŠ¨äº†è½¯ä»¶çš„è¿›åŒ–ã€‚<br>ç¼–ç¨‹è¿‡ç¨‹ä¸­å¦‚æœå‘ç°æŸç§ç®€åŒ–ä¼šä½¿ç¨‹åºéš¾ä»¥ç†è§£ï¼Œè¿™æ—¶ä¼˜å…ˆè€ƒè™‘å¯è¯»æ€§ã€‚</p><h5 id="3-çµæ´»">3. çµæ´»</h5><p>åŒæ ·ï¼Œå› ä¸ºç¨‹åºçš„ç»å¤§éƒ¨åˆ†å¼€é”€éƒ½æ˜¯åœ¨ç¬¬ä¸€æ¬¡éƒ¨ç½²ä»¥åæ‰äº§ç”Ÿçš„ï¼Œæ‰€ä»¥ç¨‹åºå¿…é¡»å®¹æ˜“æ”¹åŠ¨ã€‚</p><p>çµæ´»æ˜¯è¡¡é‡é‚£äº›ä½æ•ˆç¼–ç ä¸è®¾è®¡å®è·µçš„ä¸€æŠŠæ ‡å°ºã€‚<br>ä½†åŒæ—¶æƒ³è±¡ä¸­æ˜å¤©æˆ–è®¸ä¼šç”¨å¾—ä¸Šçš„çµæ´»æ€§ï¼Œå¯èƒ½ä¸çœŸæ­£ä¿®æ”¹ä»£ç æ‰€éœ€è¦çš„çµæ´»æ€§ä¸æ˜¯ä¸€å›äº‹ã€‚<br>è¿™æ—¶å€™ï¼Œ<strong>ä¿æŒç®€å•æ€§å’Œå¤§è§„æ¨¡æµ‹è¯•</strong>æ‰€å¸¦æ¥çš„çµæ´»æ€§æ¯”<strong>ä¸“é—¨è®¾è®¡å‡ºæ¥çš„çµæ´»æ€§</strong>æ›´ä¸ºæœ‰æ•ˆã€‚</p><p>çµæ´»æ€§çš„æé«˜å¯èƒ½ä»¥å¤æ‚æ€§çš„æé«˜ä¸ºä»£ä»·ï¼Œå› æ­¤åœ¨è®¾è®¡çš„åº¦ä¸Šéœ€è¦æœ‰ä¸ªæƒè¡¡ã€‚</p><h3 id="åŸåˆ™">åŸåˆ™</h3><p>åŸåˆ™æ˜¯å¦ä¸€ä¸ªçš„é€šç”¨æ€æƒ³ï¼Œæ¯”ä»·å€¼è§‚æ›´è´´è¿‘ä¸ç¼–ç¨‹å®é™…ï¼ŒåŒæ—¶åˆæ˜¯æ¨¡å¼çš„åŸºç¡€ã€‚<br>åŸåˆ™å¯ä»¥è§£é‡Šæ¨¡å¼èƒŒåçš„åŠ¨æœºã€‚</p><h5 id="1-å±€éƒ¨åŒ–å½±å“">1. å±€éƒ¨åŒ–å½±å“</h5><p>å‡å°‘å˜åŒ–æ‰€å¼•èµ·çš„ä»£ä»·ï¼Œå› æ­¤åœ¨ç»„ç»‡ä»£ç ç»“æ„æ—¶ï¼Œè¦ä¿è¯å˜åŒ–åªä¼šäº§ç”Ÿå±€éƒ¨åŒ–å½±å“ï¼Œé¿å…è¿é”ååº”æˆ–è€…è¢«æ‰©æ•£ã€‚</p><h5 id="2-æœ€å°åŒ–é‡å¤">2. æœ€å°åŒ–é‡å¤</h5><p>è¿™é‡Œçš„é‡å¤ï¼Œä»…å…ˆé™åˆ¶åœ¨çœŸæ­£æ„ä¹‰ä¸Šçš„å‰¯æœ¬æ€§é‡å¤ â€”â€” ç¼–ç ä¸­ä»å¯¹åº”çš„é¢†åŸŸåˆ°å®ç°ã€‚<br>é‡å¤çš„æ¥æºä¹‹ä¸€ï¼Œæ˜¯å¤åˆ¶ã€‚å¤åˆ¶çš„è¶Šå¤šï¼Œå˜åŒ–çš„ä»£ä»·ã€éœ€è¦æ”¹åŠ¨çš„ä»£ä»·å°±è¶Šå¤§ã€‚<br>æœ€å°åŒ–é‡å¤ä¹Ÿæœ‰åŠ©äºå±€éƒ¨åŒ–å½±å“ã€‚</p><h5 id="3-å°†é€»è¾‘ä¸æ•°æ®ç»‘å®š">3. å°†é€»è¾‘ä¸æ•°æ®ç»‘å®š</h5><p>å¯ä»¥ç†è§£ä¸ºï¼Œå°†æ•°æ®äºè¡Œä¸ºç»‘å®šã€‚æ¯”å¦‚ç±»çš„å°è£…ã€‚</p><h5 id="4-å¯¹ç§°æ€§">4. å¯¹ç§°æ€§</h5><p>è¯†åˆ«å‡ºä»£ç çš„å¯¹ç§°æ€§ï¼ŒæŠŠå®ƒæ¸…æ™°åœ°è¡¨è¾¾å‡ºæ¥ï¼Œä»£ç å°†æ›´å®¹æ˜“é˜…è¯»ã€‚<br>ä¸€æ—¦é˜…è¯»è€…ç†è§£äº†å¯¹ç§°æ€§æ¶µç›–åœ°æŸä¸€åŠï¼Œå°±èƒ½å¾ˆå¿«ç†è§£å¦ä¸€åŠã€‚</p><h5 id="5-å£°æ˜å¼è¡¨è¾¾">5. å£°æ˜å¼è¡¨è¾¾</h5><p>å¦‚ï¼Œèƒ½å†™æˆä¸€ä¸ªè¯­ä¹‰æ¸…æ™°ã€åŠŸèƒ½ç›¸åŒçš„annotationï¼Œå°±ç»ä¸å°†å…¶æ”¾åœ¨ä¸€ä¸ªé€šç”¨çš„å·¥å…·ç±»æˆ–æ–¹æ³•ä¸­ã€‚</p><h5 id="6-å˜åŒ–ç‡">6. å˜åŒ–ç‡</h5><p>å˜åŒ–ç‡å…·æœ‰æ—¶é—´ä¸Šçš„å¯¹ç§°æ€§ã€‚<br>æŠŠç›¸åŒå˜åŒ–ç‡çš„é€»è¾‘ã€æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼ŒæŠŠä¸åŒå˜åŒ–ç‡çš„é€»è¾‘å’Œæ•°æ®åˆ†ç¦»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç æ¶æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç æ¶æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é›·è¾¾å“”å“”å“” - Ethereum</title>
      <link href="/2018/12/09/lei-da-bi-bi-bi-ethereum/"/>
      <url>/2018/12/09/lei-da-bi-bi-bi-ethereum/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½ç½®">ä½ç½®</h2><p>2017å¹´3æœˆç¬¬16æœŸæŠ€æœ¯é›·è¾¾ï¼Œ<strong>å¹³å°</strong>è±¡é™ï¼Œå»ºè®®<strong>è¯„ä¼°</strong></p><h2 id="ç›®æ ‡å—ä¼—ï¼š">ç›®æ ‡å—ä¼—ï¼š</h2><p>åŒºå—é“¾äº§å“ç»ç†ã€æ¶æ„å¸ˆã€å¼€å‘äººå‘˜</p><h2 id="å…³æ³¨é—®é¢˜ï¼š">å…³æ³¨é—®é¢˜ï¼š</h2><p>åœ¨æ¯”ç‰¹å¸è´§å¸ç½‘ç»œå¯åŠ¨åçš„å‡ å¹´ï¼ŒåŠ å¯†è´§å¸å’ŒåŒºå—é“¾æŠ€æœ¯é€æ¸è¿›å…¥å…¬ä¼—è§†é‡ã€‚è™½ç„¶æ¯”ç‰¹å¸ä¸»è¦ç›®çš„æ˜¯ä¸ºé‡‘èäº¤æ˜“æä¾›ä¿¡ä»»æ”¯æ’‘ï¼Œä½†ä½œä¸ºä»…æœ‰ä¸€ç§å•ä¸€çš„çŠ¶æ€ä¸»ä½“ï¼ˆæ¯”ç‰¹å¸ï¼‰ã€æ— æ³•å›¾çµå®Œå¤‡è¿›è¡Œç¼–ç¨‹çš„åŒºå—é“¾ç½‘ç»œï¼Œå…¶å¯¹äºåŒºå—é“¾æŠ€æœ¯çš„è¿ç”¨åœºæ™¯éå¸¸å—é™ã€‚<br>è€Œä¸ºäº†åœ¨åŒºå—é“¾æŠ€æœ¯ä¸Šï¼Œæˆ–è€…è¯´æ˜¯ä¸ºäº†åœ¨æ¯”ç‰¹å¸å¼•é¢†çš„å¯†ç å­¦è´§å¸çš„åŸºç¡€ä¸Šï¼ˆä»¥å¤ªåŠç™½çš®ä¹¦ä¸­æåˆ°ï¼‰æ„å»ºé«˜çº§åº”ç”¨ï¼Œä»¥å¤ªåŠåšå‡ºäº†æ‰“é€ å¼€æºå¹³å°çš„å°è¯•ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆï¼š">è§£å†³æ–¹æ¡ˆï¼š</h2><p>ä»¥å¤ªåŠåœ¨å€Ÿé‰´äº†æ¯”ç‰¹å¸ï¼ŒåŒæ ·ä½¿ç”¨äº†åº•å±‚å¯†ç å­¦è´§å¸ã€åŒºå—é“¾ã€å»ä¸­å¿ƒåŒ–çš„å…±è¯†æœºåˆ¶å’ŒçŸ¿å·¥æœºåˆ¶åŸºç¡€ä¸Šï¼Œæä¾›äº†ä»¥Solidityä¸ºé¦–é€‰çš„å››ç§ä¸“ç”¨ç¼–ç¨‹è¯­è¨€å’Œè™šæ‹ŸæœºEVMï¼Œæ”¯æŒå›¾çµå®Œå¤‡çš„æ™ºèƒ½åˆçº¦ï¼Œç”¨ä»¥æ”¯æŒåœ¨æ­¤å¹³å°ä¸Šæ„å»ºæ›´ä¸ºå¤æ‚å’Œçµæ´»çš„åŒºå—é“¾åº”ç”¨ã€‚</p><h2 id="è§£è¯»ï¼š">è§£è¯»ï¼š</h2><p>ä¸€ä¸ªä¸€ç›´ä»¥æ¥çš„è¯´æ³•â€”â€”å¦‚æœæŠŠæ¯”ç‰¹å¸ç½‘ç»œçœ‹æˆæ˜¯å…¨çƒè´¦æœ¬çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠä»¥å¤ªåŠçœ‹åšæ˜¯ä¸€å°â€œå…¨çƒè®¡ç®—æœºâ€ã€‚</p><p>æ™ºèƒ½åˆçº¦ï¼Œä½œä¸ºè¿è¡Œåœ¨è¿™å°å…¨çƒè®¡ç®—æœºä¸Šçš„ä¸»ä½“ï¼Œæ˜¯ä»¥å¤ªåŠæœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼Œå³ä»¥è®¡ç®—æœºç¨‹åºçš„æ–¹å¼æ¥ç¼”ç»“å’Œè¿è¡Œå„ç§åˆçº¦ â€”â€” æ»¡è¶³åˆçº¦æ¡ä»¶å³ä¼šå¼ºåˆ¶æ‰§è¡Œï¼Œæ‰§è¡Œç»“æœä¼šå¯¹ä»¥å¤ªåŠç½‘ç»œä¸Šè®°å½•çš„çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚è¿™äº›ä¿®æ”¹ç”±äºç»è¿‡äº†ä»¥å¤ªåŠç½‘ç»œä¸­çš„å…±è¯†ï¼Œä¸€æ—¦ç¡®è®¤åæ— æ³•è¢«ä¼ªé€ å’Œç¯¡æ”¹ã€‚</p><p>åœ¨ä»¥å¤ªåŠè¿™ä¸ªå¹³å°ä¸Šï¼Œå¯¹äºæ™ºèƒ½åˆçº¦çš„ç¼–å†™å’Œå‘å¸ƒï¼ŒåŸºäºä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p><ul><li>è¿è¡Œç¯å¢ƒï¼šEVMè™šæ‹Ÿæœº</li><li>å¼€å‘è¯­è¨€ï¼šSolidityï¼ˆç±»JavaScriptï¼‰ã€solcç¼–è¯‘å™¨</li><li>ç‡ƒæ–™ï¼šGasï¼Œé€šè¿‡ä»¥å¤ªå¸æ¢å–</li><li>è´¦æˆ·ï¼šä»¥å¤ªå¸æ‹¥æœ‰è€…çš„è´¦æˆ·ï¼Œç”±ç§é’¥æ§åˆ¶<br><img src="/2018/12/09/lei-da-bi-bi-bi-ethereum/contract.png" alt="State"><br>ä¸Šå›¾ä¸­ï¼š</li></ul><ol><li>å¼€å‘è€…ä½¿ç”¨Solidityè¯­è¨€ç¼–å†™æ™ºèƒ½åˆçº¦æ–‡ä»¶ï¼Œç”±Solcç¼–è¯‘å·¥å…·å°†åˆçº¦æ–‡ä»¶ç¼–è¯‘æˆå­—èŠ‚ç ã€‚</li><li>ä½¿ç”¨å¯ä»¥ä¸ä»¥å¤ªåŠèŠ‚ç‚¹é€šè®¯çš„JSON RPCå·¥å…·(å¦‚JavaScriptç‰ˆæœ¬çš„Web3.js)ï¼Œå‘ä»¥å¤ªåŠèŠ‚ç‚¹å‘é€ä¸€æ¡â€œåˆ›å»ºåˆçº¦â€çš„äº¤æ˜“ã€‚</li><li>ä»¥å¤ªåŠèŠ‚ç‚¹æ¥æ”¶åˆ°æ­¤äº¤æ˜“åï¼Œå…ˆæ£€æŸ¥è¯¥å¼€å‘è€…è´¦æˆ·ä¸Šæ˜¯å¦æœ‰è¶³å¤Ÿçš„ä»¥å¤ªå¸ä½™é¢ç”¨ä»¥æ”¯ä»˜äº¤æ˜“ä¸­å£°æ˜çš„Gasã€‚å¦‚æœè¶³å¤Ÿï¼ŒèŠ‚ç‚¹å¼€å§‹åˆ›å»ºåˆçº¦ï¼Œå¹¶æ¶ˆè€—Gasã€‚</li></ol><p>ä»¥å¤ªåŠä¸­ï¼ŒGasæ˜¯ä¸ªæœ‰æ„æ€çš„è®¾å®šã€‚ä»¥å¤ªå¸ä¼šè¢«å®šä¹‰ä¸ºç‡ƒæ–™è´§å¸åŸºæœ¬æ¥æºäºæ­¤ã€‚<br>ä¸€æ–¹é¢ï¼Œå®ƒè®©äº¤æ˜“å‘é€æ–¹æ‰¿æ‹…è¿è¡Œäº¤æ˜“çš„æˆæœ¬ï¼›å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥ç”¨æ¥é¢„é˜²è¿‡é‡ã€è¿‡é•¿çš„åˆçº¦æ‰§è¡Œï¼Œä»¥åŠä¿æŠ¤ä»¥å¤ªç½‘ç»œå—åˆ°æ— é™å¾ªç¯çš„è“„æ„æ”»å‡»ã€‚</p><p>åœ¨å‘é€çš„äº¤æ˜“ä¸­ï¼Œä¼šæœ‰ä¸¤ä¸ªå›ºå®šéƒ¨åˆ†ï¼šgasLimitå’ŒgasPriceã€‚</p><ul><li>gasLimit: å‘é€æ–¹æ„¿æ„æ”¯ä»˜çš„æ‰§è¡Œè¿™ä¸€äº¤æ˜“çš„Gasæœ€å¤§æ•°é‡ã€‚è¿™ä¸ªæ•°é¢æ˜¯é¢„å…ˆè®¾å®šå’Œæ”¯ä»˜çš„ã€‚</li><li>gasPriceï¼šå‘é€æ–¹æ„¿æ„æ”¯ä»˜æ¯å•ä½Gasæ‰€éœ€æ‰§è¡Œäº¤æ˜“çš„GWeiæ•°é‡ã€‚</li><li>gasLimit x gasPriceï¼Œå°±æ˜¯å‘é€æ–¹æ„¿æ„ä¸ºæ­¤æ¬¡äº¤æ˜“æ”¯ä»˜çš„ä»¥å¤ªå¸æˆæœ¬ã€‚</li></ul><p>åœ¨æ¯ä¸€æ¬¡äº¤æ˜“ä¸­ï¼ŒgasLimitç”¨æ¥æ§åˆ¶äº¤æ˜“æ‰§è¡ŒæŒ‡ä»¤çš„ä¸Šé™ã€‚å¦‚æœå®é™…æ¶ˆè€—çš„gaså°äºgasLimitï¼Œå‰©ä½™çš„gasä¼šè¢«é€€å›ç»™å‘é€æ–¹ï¼›å¦‚æœä¸€ä¸ªäº¤æ˜“è¿‡äºå¤æ‚åˆ°è¿˜æœªæ‰§è¡Œç»“æŸï¼Œè€Œgaså·²ç»æ¶ˆè€—å®Œæ—¶ï¼Œäº¤æ˜“æ‰§è¡Œç»ˆæ­¢å¹¶ä¸”çŠ¶æ€å›æ»šã€‚<br>gasPriceï¼Œä¸»è¦ç”¨æ¥æå‡äº¤æ˜“çš„â€œæ‰“åŒ…è´¹â€ï¼Œpriceè¶Šé«˜è¶Šå®¹æ˜“è¢«çŸ¿å·¥æå‰æ‰“åŒ…è¿›åŒºå—ã€‚</p><p>å› æ­¤ï¼Œæ™ºèƒ½åˆçº¦çš„ç¼–å†™ï¼Œåº”è¯¥ç§‰æ‰¿å°½é‡ç®€å•çš„åŸåˆ™ï¼Œä¸ç„¶æˆæœ¬å°±ä¼šç›¸å½“æ˜‚è´µã€‚</p><h2 id="ç›¸å…³Blip">ç›¸å…³Blip</h2><ul><li><a href="https://www.thoughtworks.com/radar/languages-and-frameworks/solidity">Solidity | Languages and Frameworks | Technology Radar | ThoughtWorks</a></li><li><a href="https://www.thoughtworks.com/radar/languages-and-frameworks/truffle">Truffle | Languages and Frameworks | Technology Radar | ThoughtWorks</a></li><li><a href="https://www.thoughtworks.com/radar/languages-and-frameworks/openzeppelin">Openzeppelin | Languages and Frameworks | Technology Radar | ThoughtWorks</a></li><li><a href="https://www.thoughtworks.com/radar/platforms/ethereum">Ethereum | Platforms | Technology Radar | ThoughtWorks</a></li><li><a href="https://www.thoughtworks.com/radar/platforms/quorum">Quorum | Platforms | Technology Radar | ThoughtWorks</a></li></ul><h2 id="å»¶å±•é˜…è¯»">å»¶å±•é˜…è¯»</h2><ul><li><a href="https://github.com/ethereum/wiki/wiki/White-Paper">ä»¥å¤ªåŠç™½çš®ä¹¦</a></li><li><a href="https://ethereum.github.io/yellowpaper/paper.pdf">ä»¥å¤ªåŠé»„çš®ä¹¦</a></li><li><a href="https://medium.com/@preethikasireddy/how-does-ethereum-work-anyway-22d1df506369">How does Ethereum work, anyway?</a></li><li><a href="https://blog.qtum.org/diving-into-the-ethereum-vm-6e8d5d2f3c30">Diving Into The Ethereum Virtual Machine</a></li></ul><h2 id="å·¥å…·ï¼š">å·¥å…·ï¼š</h2><ul><li><a href="https://solidity.readthedocs.io/en/v0.4.24/">Solidity</a></li><li><a href="https://github.com/ethereum/wiki/wiki/Ethereum-Virtual-Machine-(EVM)-Awesome-List">EVM</a></li><li><a href="https://github.com/trufflesuite/truffle">Truffle</a></li><li><a href="https://truffleframework.com/ganache">Ganache</a></li><li><a href="https://metamask.io/">MetaMask</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>build.gradleä¸­çš„å¤–éƒ¨å˜é‡</title>
      <link href="/2018/12/05/build.gradle-zhong-de-wai-bu-bian-liang/"/>
      <url>/2018/12/05/build.gradle-zhong-de-wai-bu-bian-liang/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨gradleå‘½ä»¤çš„æ—¶å€™ï¼Œç»å¸¸è¢«Option -P\-Dæå¾—æ··æ·†ã€‚å…¶å®å¾ˆå®¹æ˜“åŒºåˆ†ä¸€ä¸‹ã€‚</p><h3 id="Project-property">Project property</h3><p>åœ¨build.gradleæ–‡ä»¶ä¸­ï¼Œèƒ½ç›´æ¥é€šè¿‡å˜é‡åè®¿é—® æˆ–è€… projectå‰ç¼€è®¿é—®çš„æ˜¯project propertyã€‚</p><h5 id="è®¾ç½®">è®¾ç½®</h5><p>project propertyå¯ä»¥é€šè¿‡5ç§æ–¹å¼è‡ªå®šä¹‰è®¾ç½®(ä¼˜å…ˆçº§ä»ä½åˆ°é«˜)ï¼š</p><ol><li>gradle.propertiesæ–‡ä»¶<br>(user gradle homeä¸‹çš„gradle.propertiesæ–‡ä»¶ä¼˜å…ˆçº§é«˜äºå·¥ç¨‹ç›®å½•ä¸‹çš„gradle.propertiesæ–‡ä»¶)</li></ol><pre class="line-numbers language-none"><code class="language-none">branchName=t1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>ç¯å¢ƒå˜é‡</li></ol><pre class="line-numbers language-none"><code class="language-none">ORG_GRADLE_PROJECT_branchName=t2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>å‘½ä»¤è¡Œ-D</li></ol><pre class="line-numbers language-none"><code class="language-none">./gradlew clean build -Dorg.gradle.project.branchName=t3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>å‘½ä»¤è¡Œ-P</li></ol><pre class="line-numbers language-none"><code class="language-none">./gradlew clean build -PbranchName=t4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>build.gradleè‡ªèº«æ–‡ä»¶å†…, å®šä¹‰æ—¶ä½¿ç”¨å‰ç¼€extã€‚</li></ol><pre class="line-numbers language-none"><code class="language-none">ext {  branchName=t5}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="è®¿é—®">è®¿é—®</h5><p>è¯»å–project propertyæ—¶éœ€è¦æ³¨æ„ï¼Œå¦‚æœå€¼ä¸å­˜åœ¨ï¼Œæ„å»ºå°†ç›´æ¥å¤±è´¥ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰å€¼ä¸å­˜åœ¨çš„æƒ…å†µéœ€è¦åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨æ–¹æ³•<code>Project.hasProperty(java.lang.String) </code>ã€‚</p><h3 id="System-property">System property</h3><p>çœ‹äº†ä¸Šé¢ç¬¬3é¡¹ä¸­ï¼Œæœ‰ä¸ª<strong>å‘½ä»¤è¡Œ-D</strong>ã€‚<br>å…¶å¯ä»¥ä¼ é€’ä¸€ä¸ªsystem propertyç»™gradleè¿è¡Œçš„JVMä¸­ï¼Œè·ŸJava -Dçš„åŠŸç”¨ç›¸åŒã€‚</p><h5 id="è®¾ç½®-2">è®¾ç½®</h5><p>system propertyå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼è‡ªå®šä¹‰ï¼š</p><ol><li>gradle.propertiesæ–‡ä»¶ã€‚ä½¿ç”¨å‰ç¼€systemPropï¼š</li></ol><pre class="line-numbers language-none"><code class="language-none">systemProp.branchName=y1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>éœ€è¦æ³¨æ„ï¼Œåœ¨multi project buildä¸­ï¼Œåªæœ‰root directoryä¸‹çš„gradle.propertiesæ–‡ä»¶ä¸­é…ç½®çš„systemPropæ‰ä¼šç”Ÿæ•ˆã€‚å…¶ä»–å­æ¨¡å—ä¸­çš„ä¼šè¢«å¿½ç•¥ã€‚</p><ol start="2"><li>å‘½ä»¤è¡Œ-D</li></ol><pre class="line-numbers language-none"><code class="language-none">./gradlew clean build -DbranchName=y2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="è®¿é—®-2">è®¿é—®</h5><p>éœ€è¦åœ¨build.gradleæ–‡ä»¶ä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦è°ƒç”¨ï¼š</p><pre class="line-numbers language-none"><code class="language-none">System.properties['system']<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Gradle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring cloud Netflixä¸­çš„è¶…æ—¶é…ç½®</title>
      <link href="/2018/12/04/spring-cloud-netflix-zhong-de-chao-shi-pei-zhi/"/>
      <url>/2018/12/04/spring-cloud-netflix-zhong-de-chao-shi-pei-zhi/</url>
      
        <content type="html"><![CDATA[<p>ä¸€èˆ¬SpringCloudä¸­è¶…æ—¶é…ç½®ï¼Œå«Hystrix/Ribbonä¸¤éƒ¨åˆ†ï¼š</p><pre class="line-numbers language-none"><code class="language-none">ribbon:  ReadTimeout: 120000  ConnectTimeout: 120000  hystrix:  command:    default:      execution:        isolation:          strategy: THREAD          thread:            timeoutInMilliseconds: 120000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hystrix thread timeoutéœ€è¦æ¯”ribbon timeoutè®¾ç½®æ—¶é—´é•¿ã€‚<br>ribbonæœ‰retryæœºåˆ¶ï¼Œå¦‚æœtimeoutè®¾ç½®æ—¶é—´çŸ­ï¼Œåˆ™æ— æ³•retryã€‚</p><p>åœ¨zuulä¸­ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æœåŠ¡å‘ç°ï¼Œribbon timeoutåŒä¸Šã€‚<br>å¦‚æœä½¿ç”¨çš„æŒ‡å®šURLå½¢å¼ï¼Œribbon timeoutéœ€è¦å¦‚ä¸‹é…ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">zuul:  host:    connect-timeout-millis: 120000    socket-timeout-millis: 120000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://cloud.spring.io/spring-cloud-netflix/multi/multi__router_and_filter_zuul.html#_zuul_timeouts">Zuulå®˜æ–¹è¯´æ˜</a></p><blockquote><p>8.13 Zuul Timeouts<br>If you want to configure the socket timeouts and read timeouts for requests proxied through Zuul, you have two options, based on your configuration:<br>If Zuul uses service discovery, you need to configure these timeouts with the ribbon.ReadTimeout and ribbon.SocketTimeout Ribbon properties.<br>If you have configured Zuul routes by specifying URLs, you need to use <strong>zuul.host.connect-timeout-millis</strong> and <strong>zuul.host.socket-timeout-millis</strong>.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°½é‡ä¸è¦åœ¨ Spring Config Server ä¸­ä½¿ç”¨å¤ªé•¿çš„æ•°ç»„</title>
      <link href="/2018/10/07/jin-liang-bu-yao-zai-spring-config-server-zhong-shi-yong-tai-chang-de-shu-zu/"/>
      <url>/2018/10/07/jin-liang-bu-yao-zai-spring-config-server-zhong-shi-yong-tai-chang-de-shu-zu/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šå‘¨second vendoråœ¨ä½¿ç”¨æˆ‘ä»¬æ­å»ºå¥½çš„config serverå‘API-Gatewayä¸­è¿½åŠ é…ç½®é¡¹çš„æ—¶å€™ï¼Œå‘ç”Ÿäº†ä¸€ä¸ªå°æ’æ›²ã€‚</p><p>æœ¬æ¥æœ¬æ„æ˜¯æƒ³<strong>è¿½åŠ </strong>ä¸€æ¡ <em>å¿½ç•¥å»æ ¡éªŒToken</em> çš„API Pattern, ä½†æ˜¯å¤±è¯¯æ“ä½œæˆ<strong>è¦†ç›–</strong>æ•´ä¸ª <em>å¿½ç•¥å»æ ¡éªŒToken</em> çš„API Pattern Array.</p><hr><p>æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„yamlé…ç½®æ–‡ä»¶application-default.ymlä¸­çš„ç»“æ„ï¼š</p><pre class="line-numbers language-none"><code class="language-none">ignoredValidateTokenUrl:  - /api/user/password-reset  - /tablet/js/**  - /integration/**  â€¦â€¦â€¦â€¦<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ•´ä¸ªArrayç”±äºæ—¥ç§¯æœˆç´¯ï¼Œlengthå·²ç»é•¿è¾¾å››äº”åã€‚<br>ä¹‹å‰è¿½åŠ æ–°çš„æ¡ç›®ï¼Œå¤§å®¶ç›¸äº’å¿ƒç…§ä¸å®£åœ°éƒ½æ˜¯åœ¨default yamlä¸­ç¼–å†™ï¼Œäºæ˜¯åœ¨QAã€UATç­‰ç¯å¢ƒä¸­ï¼Œä¹Ÿå°±å¹¶æ²¡æœ‰åœ¨config serveré‡Œå†å¦è¡Œå®šåˆ¶ç»´æŠ¤ã€‚</p><p>è¿™æ¬¡second vendorçš„æƒ³æ³•å¾ˆç®€å•ï¼Œåªæ˜¯æƒ³åœ¨è¿™å››äº”åæ¡çš„åé¢å†è¿½åŠ ä¸€æ¡æ–°çš„APIã€‚äºæ˜¯ä»–åœ¨UATç¯å¢ƒçš„application-uat.ymlä¸­è¿™æ ·åšçš„ï¼š</p><pre class="line-numbers language-none"><code class="language-none">ignoredValidateTokenUrl:  - /api/d2d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åï¼Œé‚£å¤©æˆ‘ä»¬UATç¯å¢ƒä¸€ä¸‹åˆéƒ½æ— æ³•ç™»å½•ã€‚ã€‚</p><p>è¿™å…¶ä¸­ï¼Œèµ·å› å›ºç„¶æ˜¯second vendorçš„å°ä¼™ä¼´å¯¹<strong>Spring config server</strong>æˆ–è€…è¯´æ˜¯å¯¹<strong>Spring Profile-specific properties</strong>çš„ä¸ç†Ÿæ‚‰é€ æˆçš„ã€‚<br>ä½†æ¢ä¸ªè§’åº¦æ¥çœ‹ï¼Œç”±äº<em>Spring config server</em>ã€<em>Spring Profile-specific properties</em>å¯¹é…ç½®è¿›è¡Œè¦†ç›–çš„ä¸»åŸåˆ™å°±æ˜¯æ ¹æ®keyï¼Œå¦‚æœvalueæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„å†…æ‰€æœ‰å…ƒç´ éƒ½å…±ç”¨ä¸€ä¸ªkeyã€‚<br>å› æ­¤ï¼Œè¿™æ—¶å€™çš„è¦†ç›–å°±æ˜¯æ•´ä¸ªæ•°ç»„è¿›è¡Œè¦†ç›–ï¼Œå…¶å†…éƒ¨æ˜¯ä¸èƒ½å†æ¬¡è¿›è¡Œç»†åŒ–æ“ä½œçš„ã€‚</p><p>è€Œå¦‚æœæ•°ç»„å…ƒç´ é…ç½®åœ¨å„ç¯å¢ƒé‡å¤åº¦ç›¸å½“é«˜ï¼Œä¸”åˆåœ¨config serverä¸­ä¸åŒç¯å¢ƒéƒ½ç»´æŠ¤ä¸€å¥—çš„è¯ï¼Œå®¹æ˜“é€ æˆï¼š</p><ol><li>ç»´æŠ¤æˆæœ¬å¢åŠ ã€‚<br>æ¯æ¬¡ä¿®æ”¹çš„æ—¶å€™ï¼Œä¸ä»…æ£€æŸ¥å½“å‰ç¯å¢ƒyamlæ–‡ä»¶ï¼Œè¿˜è¦ä¸defaultæ–‡ä»¶è¿›è¡Œæ¯”å¯¹ï¼Œä»¥å…é—æ¼ã€‚</li><li>å®¹æ˜“å¤±è¯¯å‡ºé”™ï¼Œæ— æ³•æº¯æºã€‚<br>éœ€è¦ç»å¸¸ä¸defaultè¿›è¡Œå¯¹æ¯”ï¼Œä¸€æ—¦é—æ¼ï¼Œå°±ä¼šå‡ºé”™ã€‚åˆè‹¥æ˜¯é—æ¼åé•¿æ—¶é—´æœªå‘ç°ï¼Œå‘ç°æ—¶å·²å¾ˆéš¾åˆ†è¾¨åˆ°åº•æ˜¯å¤±è¯¯è¿˜æ˜¯ç‰¹æ®Šå®šåˆ¶ã€‚</li></ol><p>å› æ­¤å½“ä½¿ç”¨Arrayä½œä¸ºproperty-valueæ—¶ï¼Œåº”è¯¥ä¾å¦‚ä¸‹é¡ºåºè¿›è¡Œä¸€ä¸‹è€ƒè™‘ï¼š</p><ol><li>lengthå¤§æ¦‚åªæœ‰2~5ä¸ªçš„ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ç”¨key-Arrayï¼Œæˆ–è€…key-stringséƒ½è¡Œã€‚å¦‚Zuul sensitiveHeadersï¼Œé•¿åº¦æœ€å¤šåªæœ‰3ã€‚</li><li>å¦‚æœArrayä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ é¡¹å¯ä»¥æ‰¾åˆ°æœ‰å…·ä½“æ¶µä¹‰çš„åç§°ä½œä¸ºkeyçš„è¯ï¼Œå°±å°†key-Arrayçš„å®ç°è§£æ„æˆå¤šä¸ªkey-valueï¼Œå¦‚Zuulçš„routesã€‚</li><li>å¦‚æœæ˜¯æ•°ç»„é•¿åº¦åˆé•¿ï¼ŒåŸºæœ¬ä¸éœ€è¦profile-specialçš„ï¼Œå¯ä»¥è€ƒè™‘ä¸é…ç½®åœ¨<em>Spring config server</em>ã€<em>Spring Profile-specific properties</em>ä¸­ã€‚å¯ä»¥è€ƒè™‘å°†å…¶æŒä¹…åœ¨å…¶ä»–æ–‡ä»¶ä»‹è´¨ä¸­ã€æ•°æ®åº“ä¸­ç­‰ç­‰ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåˆ†å¸ƒå¼å¤ä¹ é¢˜</title>
      <link href="/2018/09/14/java-fu-xi-ti/"/>
      <url>/2018/09/14/java-fu-xi-ti/</url>
      
        <content type="html"><![CDATA[<h4 id="RMI">RMI</h4><h4 id="RPC">RPC</h4><h4 id="CAP-å®šç†">CAP å®šç†</h4><p>CAP å®šç†å¯¹åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨<code>ç³»ç»Ÿ</code>çš„ç‰¹æ€§è¿›è¡Œé«˜åº¦æŠ½è±¡ï¼Œæç‚¼æˆäº†3ä¸ªç»´åº¦ï¼š</p><ul><li><code>Consistency</code> ä¸€è‡´æ€§, æ¯ä¸€æ¬¡è¯»å–æ“ä½œï¼Œè¦ä¹ˆç³»ç»Ÿè¿”å›æœ€æ–°çš„æ•°æ®å†™å…¥å€¼ï¼ˆæ— è®ºè¯»å–åˆ°å“ªä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼‰ï¼Œè¦ä¹ˆè¿”å›ç³»ç»Ÿé”™è¯¯ã€‚</li><li><code>Availability</code> å¯ç”¨æ€§, æ¯ä¸€æ¬¡è¯»å–æ“ä½œéƒ½èƒ½è·å¾—ç³»ç»Ÿçš„è¿”å›ï¼Œä½†ä¸ä¿è¯è¿”å›çš„æ˜¯æœ€æ–°çš„æ•°æ®å†™å…¥å€¼ã€‚</li><li><code>Partition Tolerance</code> åˆ†åŒºå®¹é”™æ€§ï¼Œå½“æ•°æ®èŠ‚ç‚¹ä¹‹é—´å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼ˆåŒ…æ‹¬ç½‘ç»œä¸¢åŒ…ã€è¿æ¥ä¸­æ–­é˜»å¡ç­‰ï¼‰ï¼Œç³»ç»Ÿä»ç„¶è¦ç»§ç»­å·¥ä½œã€‚<br>è¿™å…¶ä¸­çš„åº•å±‚é€»è¾‘æ˜¯ï¼šåˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å„èŠ‚ç‚¹ä¹‹é—´é€šè¿‡ç½‘ç»œè¿æ¥ï¼Œåœ¨è¿è¡ŒæœŸé—´ä¸å¯é¿å…å­˜åœ¨ç½‘ç»œåˆ†åŒºçš„é£é™©ã€‚<br>ä¿è¯åˆ†åŒºå®¹é”™æ€§ï¼Œå°±æ˜¯å½“å‘ç”Ÿç½‘ç»œåˆ†åŒºå¼‚å¸¸æ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿä»ç„¶è¿è¡Œå¹¶ç»§ç»­å·¥ä½œï¼Œè¿™æ—¶å€™æä¾›çš„æœåŠ¡ç»´åº¦åªå¯èƒ½åœ¨ Consistency å’Œ Availability ä¸­ä¿è¯ä¸€é¡¹ã€‚</li><li>ç¡®ä¿ä¸€è‡´æ€§ï¼Œç‰ºç‰²å¯ç”¨æ€§ã€‚<br>ç³»ç»Ÿä¼šé€šè¿‡å†…éƒ¨ç­–ç•¥ï¼Œè‡ªåŠ¨ä¿®å¤é›†ç¾¤ï¼Œæœ€ç»ˆç¡®ä¿ Consistency å£°æ˜çš„å¼ºä¸€è‡´æ€§ã€‚åœ¨è‡ªåŠ¨ä¿®å¤å®Œæˆä¹‹å‰ï¼Œå¤–éƒ¨è¯·æ±‚ä¼šè¿”å›ç³»ç»Ÿå‡ºé”™æˆ–è€…è¶…æ—¶ã€‚</li><li>ç¡®ä¿å¯ç”¨æ€§ï¼Œç‰ºç‰²ä¸€è‡´æ€§ã€‚<br>ç³»ç»Ÿåœ¨è‡ªåŠ¨ä¿®å¤é›†ç¾¤æœŸé—´ï¼Œæ²¡æœ‰è¾¾æˆæ•°æ®ä¸€è‡´æ€§çš„å„èŠ‚ç‚¹ä»ä¼šå¯¹å¤–åŠæ—¶å“åº”ï¼Œç¡®ä¿ Availability å£°æ˜çš„é«˜å¯ç”¨æ€§ã€‚</li></ul><p>ç‹­ä¹‰ä¸Šæ¥è®²ï¼ŒCAP å®šç†ä¸­ Consistency æ˜¯å¿½ç•¥æ•°æ®å¤åˆ¶çš„ç½‘ç»œå»¶è¿Ÿçš„ï¼Œå³ï¼šå‡è®¾æ•°æ®å¤åˆ¶æ˜¯ç¬é—´å®Œæˆï¼Œå¹¶ä¸”ç³»ç»Ÿé©¬ä¸Šå¯¹å¤–æä¾›æ•°æ®è¯»å–ã€‚<br>å¹¿ä¹‰ä¸Šï¼Œè¾¾æˆ Consistency çš„ç½‘ç»œå»¶è¿Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œä¸ç®—ç½‘ç»œåˆ†åŒºï¼Œå³ä½¿å»¶è¿Ÿäº†å‡ åˆ†é’Ÿã€‚<br>å¦‚æœæƒ³è¦å°†<code>ç½‘ç»œå»¶è¿Ÿ</code>çš„å½±å“åŠ å…¥åˆ°æ•°æ®åˆ†å¸ƒå¼çš„æ¶æ„è®¨è®ºä¸­ï¼Œå¯ä»¥å‚ç…§ CAP å®šç†çš„å»¶ä¼¸ <code>PACELC ç†è®º</code>ï¼š<br>PAC å„å­—æ¯åŒ CAP ç†è®ºï¼Œ E (Else) ä»…æ˜¯è¿æ¥è¯ï¼ŒL (latency) ã€C (consistency)ã€‚æ„æ€å°±æ˜¯ï¼Œå½“æ²¡æœ‰å‡ºç°ç½‘ç»œåˆ†åŒºã€ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶ï¼Œä½å»¶æ—¶ï¼ˆä½äºæ•°æ®è¾¾æˆä¸€è‡´æ‰€éœ€çš„å¹³å‡å»¶æ—¶æ°´å¹³ï¼‰ å’Œ æ•°æ®ä¸€è‡´æ€§ï¼ŒäºŒè€…éœ€è¦é€‰æ‹©å…¶ä¸€ï¼Œä¸èƒ½åŒæ—¶ä¿è¯ã€‚<br>æ¯”å¦‚ï¼ŒMongoDB é›†ç¾¤çš„å°±æ˜¯å…¸å‹çš„ PA/EC ç³»ç»Ÿï¼šåœ¨å‡ºç°ç½‘ç»œåˆ†åŒºæ—¶ï¼ŒMongoDB é›†ç¾¤ä¼˜å…ˆä¿è¯å¯ç”¨æ€§ï¼Œæ•°æ®å¯èƒ½ä¸æ˜¯æœ€æ–°ï¼›åœ¨é›†ç¾¤æ­£å¸¸çŠ¶æ€ä¸‹ï¼Œä¼˜å…ˆä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><h4 id="BASE-åŸåˆ™">BASE åŸåˆ™</h4><p>CAP å®šç†åœ¨åº”ç”¨ç³»ç»Ÿå¼€å‘ä¸­çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚<br><code>Basically Available</code> åŸºæœ¬å¯ç”¨<br><code>Soft state</code> è½¯çŠ¶æ€<br><code>Eventually consistent</code> æœ€ç»ˆä¸€è‡´æ€§<br>å½“åº”ç”¨æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§æ—¶ï¼Œæ¯ä¸ªåº”ç”¨å¯ä»¥æ ¹æ®è‡ªèº«çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿å¾—ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h4 id="RAFT-å…±è¯†ç®—æ³•">RAFT å…±è¯†ç®—æ³•</h4><h4 id="SOA">SOA</h4><h4 id="åˆ†å¸ƒå¼ç³»ç»Ÿ">åˆ†å¸ƒå¼ç³»ç»Ÿ</h4><p>ã€Šåˆ†å¸ƒå¼ç³»ç»ŸåŸç†ä¸èŒƒå‹ã€‹é‡Œæ€»ç»“ï¼š</p><blockquote><p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯è‹¥å¹²ç‹¬ç«‹è®¡ç®—æœºçš„é›†åˆï¼Œè¿™äº›è®¡ç®—æœºå¯¹äºç”¨æˆ·æ¥è¯´å°±åƒæ˜¯å•ä¸ªç›¸å…³ç³»ç»Ÿã€‚<br>ä»ç‰©ç†ç»“æ„ä¸Šæ¥çœ‹ï¼Œå¤šå°è®¡ç®—æœºèµ„æºé€šè¿‡è®¡ç®—æœºç½‘ç»œæŠ€æœ¯ç›¸è¿æ¥ï¼Œè¾¾æˆæ„å»ºåŒä¸€ä¸ªç³»ç»Ÿçš„ç›®çš„ï¼Œè¿™ä¸ªè®¡ç®—æœºç½‘ç»œå°±å«åš<code>åˆ†å¸ƒå¼ç³»ç»Ÿ</code>ã€‚<br>ç›¸å¯¹çš„, ä½¿ç”¨å•ä¸€çš„è®¡ç®—æœºæ¥æ„å»ºç³»ç»Ÿçš„ï¼Œè¿™ä¸ªå•å¤„ç†å™¨ç³»ç»Ÿå°±å«åš<code>é›†ä¸­å¼ç³»ç»Ÿ</code>ã€‚</p></blockquote><p>ä»ç³»ç»Ÿæ¶æ„çš„å†å²è¿›ç¨‹æ¥çœ‹ï¼Œä»æœ€æ—©çš„<code>çºµå‘åˆ†å±‚å¼æ¶æ„</code>ï¼Œé€šè¿‡ä½¿ç”¨æ•°æ®åº“æœåŠ¡ã€ä¸­é—´ä»¶æœåŠ¡ç­‰ï¼Œå°†ç³»ç»Ÿæ„å»ºä¸­ä¸€äº›é€šç”¨çš„èŒè´£è¢«ä»£ç†åˆ°ç‹¬ç«‹çš„è®¡ç®—èµ„æºä¸Š â€”â€” å°±å·²ç»æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿäº†ã€‚<br>å†åˆ°<code>æ¨ªå‘é«˜å¯ç”¨æ¶æ„</code>çš„å¤åˆ¶é›†ã€æ•°æ®åˆ†ç‰‡ã€é›†ç¾¤æ¶æ„ç­‰ï¼Œåˆåˆ°ç°åœ¨çš„æ ¹æ®ä¸šåŠ¡ç±»å‹å’ŒèŒè´£åˆ’åˆ†çš„é¢å‘æœåŠ¡åŒ–ã€å¾®æœåŠ¡æ¶æ„ç­‰ï¼Œéƒ½æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŒƒç•´ã€‚<br>åªä¸è¿‡å¯¹äºå½“å‰ Java åº”ç”¨å¼€å‘æ¥ï¼Œæåˆ°<code>åˆ†å¸ƒå¼æ¶æ„</code>ï¼Œä¸»è¦è®¨è®ºçš„ç‚¹å¤šæ˜¯æ¶‰åŠé¢å‘æœåŠ¡åŒ–ã€å¾®æœåŠ¡æ¶æ„è¿™æ–¹é¢ï¼Œå…¶æ¬¡æ˜¯çºµå‘åˆ†å±‚å¼æ¶æ„ã€‚</p><p><strong>Javaåº”ç”¨ åˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥çš„ä¼˜ç¼ºç‚¹</strong><br><strong>ä¼˜ç‚¹</strong></p><ol><li>é€šè¿‡æœåŠ¡æ‹†åˆ†å®ç°äº†å•ä¸€èŒè´£åŸåˆ™ï¼Œå¸¦æ¥äº†æ›´å¥½çš„å°è£…æ€§ã€æ‰©å±•æ€§ã€è¾¹ç•Œéš”ç¦»</li></ol><ul><li><p>ä¸šåŠ¡ä¸Š<br>å•ä¸€ä¸šåŠ¡é«˜å†…èšäºä¸€ä¸ªæœåŠ¡ä¸­ï¼Œå½“æœ‰ä¸šåŠ¡å˜æ›´æ—¶ï¼Œä»…éœ€è¦ä¿®æ”¹ã€æ£€æŸ¥ä¸šåŠ¡å¯¹åº”çš„æœåŠ¡å³å¯ï¼Œä¸ä¼šå¸¦æ¥è¾å°„å¼ä»£ç ä¿®æ”¹çš„æˆæœ¬ï¼Œæˆ–è€…éœ€æ±‚å†²çªé€ æˆéœ€æ±‚å¾ˆéš¾å®ç°çš„é—®é¢˜ï¼›<br>å½“ç³»ç»Ÿé¢ä¸´å¤–éƒ¨ä¸šåŠ¡ç¯å¢ƒçš„é€‚åº”æ€§æŒ‘æˆ˜æ—¶ï¼ŒæœåŠ¡å…·æœ‰çš„é«˜æ‰©å±•æ€§ï¼Œå¯ä»¥æ›´å¥½åœ°æ”¯æŒç³»ç»Ÿå¤–éƒ¨å¼•è¿›çš„ä¸šåŠ¡å˜åŒ–å’Œåˆ›æ–°ï¼›<br>åŒæ—¶ï¼Œç”±äºæœåŠ¡è¾¹ç•Œçš„å­˜åœ¨ï¼Œå½“å‰ç³»ç»Ÿè¿è¡Œä¸­ä¸æ¶‰åŠå˜æ›´çš„å…¶ä»–æœåŠ¡ï¼Œä¾ç„¶ä¿æŒçº¿ä¸Šè¿è¡Œï¼Œé™ä½äº†ç¼ºé™·é£é™©å’ŒéªŒè¯æˆæœ¬ã€‚</p></li><li><p>æ•°æ®ä¸Š<br>ç°åœ¨çš„åº”ç”¨æœåŠ¡ï¼ŒåŸºäºç”¨æˆ·é‡å’Œæ•°æ®é‡çš„å¢é•¿ï¼Œå¾ˆéš¾ä»…ä½¿ç”¨ä¸€å°æ•°æ®åº“æœåŠ¡å™¨å°±å®Œæˆæ‰€æœ‰çš„æ•°æ®å­˜å‚¨ä¸è¯»å†™ï¼Œç›¸æ¯”äºè¿ç§»åˆ°æ–°å‹åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œ<br>æœåŠ¡æ‹†åˆ†å°†å­˜å‚¨äº†ä¸åŒé¢†åŸŸå­—æ®µçš„å¤§è¡¨ï¼Œæ ¹æ®ä¸šåŠ¡åŸŸæ‹†åˆ†æˆå¤šä¸ªå°è¡¨ï¼Œä»æ•°æ®åˆ—çš„ç»´åº¦ä¸Šè§£å†³äº†æ•°æ®åº“çš„è´Ÿè½½å’Œå‹åŠ›é—®é¢˜ã€‚</p></li><li><p>ç®¡ç†ä¸Š<br>æœåŠ¡æ‹†åˆ†ä¸ç»„ç»‡/å›¢é˜Ÿåˆ’åˆ†ç›¸åŒ¹é…ï¼Œå¯ä»¥å‡å°‘ç³»ç»Ÿéœ€æ±‚çš„ä¸ç¡®å®šæ€§ã€çŸ¥è¯†æ¶ˆè€—å’Œæ²Ÿé€šçš„æˆæœ¬ã€é™ä½ç ”å‘æ—¶é•¿ã€å®ç°å¿«é€Ÿå‘å¸ƒç­‰ã€‚</p></li></ul><ol start="2"><li>é€šè¿‡æœåŠ¡åŒ– + äº‘åŸç”Ÿå¹³å°ï¼Œå¸¦æ¥äº†è¿ç®—å®¹é‡çš„å¼¹æ€§</li></ol><ul><li>æ„å»ºåˆæœŸä¸éœ€è¦é¢„ä¼°å’Œé¢„åˆ¶é«˜å®¹é‡èµ„æºï¼Œå¯ä»¥æ ¹æ®çº¿ä¸Šèµ„æºçš„å ç”¨æƒ…å†µï¼Œè¿›è¡Œåç½®èµ„æºæ‰©å®¹ã€‚</li><li>é’ˆå¯¹ä¸åŒæœåŠ¡é—´çš„èµ„æºåˆ©ç”¨ç‡ï¼Œæ›´æœ‰é’ˆå¯¹æ€§åœ°å¯¹å¤„äºèµ„æºç“¶é¢ˆçš„æœåŠ¡è¿›è¡Œæ‰©å®¹ï¼Œé¿å…äº†æ•´ä½“èµ„æºæ‰©å®¹å¸¦æ¥çš„æµªè´¹ã€‚</li></ul><ol start="3"><li><p>åŒæ—¶ç”±äºæœåŠ¡åˆ’åˆ†äº†æ ¸å¿ƒåŸŸã€æ”¯æ’‘åŸŸã€é€šç”¨åŸŸï¼Œä¸åŒçš„æœåŠ¡å¯ä»¥æ ¹æ®ä¸šåŠ¡æƒ…å†µï¼Œé€‰å–ä¸åŒçš„ä¸Šçº¿æ—¶é—´ï¼Œæœ€ç»ˆå¯ä»¥è¾¾æˆä¸šåŠ¡çš„å¿«é€Ÿæ¨å‡ºã€åé¦ˆå’ŒéªŒè¯ã€‚</p></li><li><p>æé«˜äº†åº”ç”¨çš„å¥å£®æ€§å’Œé«˜å¯ç”¨æ€§<br>çºµå‘æ¶æ„ä¸Šï¼Œé€šè¿‡ä½¿ç”¨ä¸“ä¸šçš„åˆ†å¸ƒå¼ç¼“å­˜ã€æ–‡ä»¶æ‰˜ç®¡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®åº“ç­‰å„ç±»å‹ä¸­é—´ä»¶äº§å“æœåŠ¡ï¼Œé™ä½äº†å¼€å‘äººåŠ›æˆæœ¬çš„åŒæ—¶ï¼Œæå‡äº†å¼€å‘è´¨é‡å’Œåº”ç”¨çš„å¥å£®æ€§ã€‚<br>æ¨ªå‘æ¶æ„ä¸Šï¼ŒæœåŠ¡çš„æ‹†åˆ†å’Œç‹¬ç«‹å‘å¸ƒï¼Œä»¥åŠæœåŠ¡å®ä¾‹é›†çš„ä½¿ç”¨ï¼Œä¿éšœäº†åº”ç”¨æ•´ä½“çš„å¯ç”¨æ€§ â€”â€” ä¸ä¼šå› ä¸ºä¸€ä¸ªæœåŠ¡çš„é—®é¢˜ï¼Œé€ æˆæ•´ä¸ªåº”ç”¨çš„ä¸å¯ç”¨ã€‚</p></li></ol><p><strong>ç¼ºç‚¹</strong></p><ol><li>æŠ€æœ¯è¿è¥èƒ½åŠ›çš„æŒ‘æˆ˜</li><li>æœåŠ¡é—´é›†æˆçš„æŒ‘æˆ˜</li><li>æœåŠ¡çŠ¶æ€å’Œæ•°æ®åˆ†ç‰‡çš„é—®é¢˜<br>æ¯”å¦‚ï¼Œåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ã€æ¶ˆæ¯æ¶ˆè´¹ç­‰ç­‰ã€‚</li><li>è¯Šæ–­å’Œå¯è§†åŒ–çš„é—®é¢˜<br>æ¯”å¦‚ï¼ŒåŠ¨æ€è°ƒç”¨é“¾ã€traceIDã€æ—¥å¿—ç­‰ç­‰ã€‚</li><li>æ€§èƒ½é—®é¢˜</li><li>å®‰å…¨é—®é¢˜<br>ç­‰ç­‰</li></ol><p>æ€»çš„æ¥è¯´ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥äº†å¾ˆå¤šå¥½å¤„ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸å°‘çš„æŠ€æœ¯èƒ½åŠ›æŒ‘æˆ˜å’Œæˆæœ¬ã€‚</p><h4 id="åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡">åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡</h4><p>è§£å†³çš„æ•°æ®åˆ†ç‰‡é—®é¢˜<br>quartz<br>elastic-job<br>xxl-job</p><h4 id="session">session</h4><p>æ— çŠ¶æ€<br>cookie id + session ä¸‹æ²‰</p><h4 id="æ•°æ®å…¨å±€å”¯ä¸€ID">æ•°æ®å…¨å±€å”¯ä¸€ID</h4><p>é›ªèŠ±ç®—æ³•</p><h4 id="åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</h4><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</h4><h3 id="Spring-cloud">Spring cloud</h3>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring cloud Feign</title>
      <link href="/2018/07/25/spring-cloud-feign/"/>
      <url>/2018/07/25/spring-cloud-feign/</url>
      
        <content type="html"><![CDATA[<h4 id="1-dependency">1. dependency</h4><pre class="line-numbers language-none"><code class="language-none">dependencies {    compile("org.springframework.cloud:spring-cloud-starter-feign")    â€¦â€¦}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-annotation">2. annotation</h4><pre class="line-numbers language-none"><code class="language-none">@SpringBootApplication@EnableFeignClientspublic class Application {    public static void main(String[] args) {        SpringApplication.run(Application.class, args);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-feign-client">3. feign client</h4><pre class="line-numbers language-none"><code class="language-none">#ä¸ä½¿ç”¨æœåŠ¡å‘ç°ï¼Œç›´æ¥é…ç½®urlï¼›#ä½¿ç”¨æœåŠ¡å‘ç°ï¼Œä¸é…ç½®urlï¼Œnameä¸ºservice_idï¼Œå¦å¤–projectæ³¨æ„åŠ å…¥æœåŠ¡å‘ç°ä¾èµ–ã€æ‰“å¼€æœåŠ¡å‘ç°é…ç½®@FeignClient(name = "invokeClient", url = "localhost:8001")public interface InvokeClient {@GetMapping("/user/{id}/username")    public String name(@PathVariable("id") String id);}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼Œè™½ç„¶æ”¯æŒspring MVCçš„annotationï¼Œä½†@PathVariableã€@RequestParamã€@RequestHeaderç­‰å‚æ•°åçš„æ³¨è§£ï¼Œä¸€å®šè¦è®¾ç½®valueå€¼ï¼Œè¿™ç‚¹ä¸å†™controllerä¸åŒã€‚</p><h4 id="4-æ‰“å¼€feign-log">4. æ‰“å¼€feign log</h4><p>feign clientsé»˜è®¤çš„Logger.Levelå¯¹è±¡å®šä¹‰çš„æ˜¯NONEçº§åˆ«ï¼Œè¦æƒ³æ‰“å¼€ï¼š<br>é¦–å…ˆï¼š</p><pre class="line-numbers language-none"><code class="language-none">@Configurationpublic class GlobalFeignConfiguration {    @Bean    Logger.Level feignLoggerLevel() {        return Logger.Level.FULL;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åï¼Œå¼€å¯å…·ä½“feign client logger:</p><pre class="line-numbers language-none"><code class="language-none">#application.yamllogging:  level:    &lt;packageName&gt;.&lt;FeignInterfaceName&gt;: DEBUG<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…é’ˆå¯¹æ€§å¯¹feignClientè¿›è¡Œé…ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">@FeignClient(name = "invokeClient", configuration = GlobalFeignConfiguration.class, url = "localhost:8001")public interface InvokeClient {}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é™„ï¼š">é™„ï¼š</h4><p>controllerä¸feignClientçš„æ¥å£å®šåˆ¶æ–¹å¼ç›¸åŒï¼Œå®è·µä¸­å¯ä»¥è€ƒè™‘ç”±providerï¼Œä¹Ÿå°±æ˜¯controlleræ–¹æä¾›ç»Ÿä¸€æ¥å£ï¼Œé¿å…é‡å¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring config server</title>
      <link href="/2018/06/13/spring-config-server/"/>
      <url>/2018/06/13/spring-config-server/</url>
      
        <content type="html"><![CDATA[<h3 id="Serverç«¯">Serverç«¯</h3><h4 id="1-æ·»åŠ ä¾èµ–">1. æ·»åŠ ä¾èµ–</h4><pre class="line-numbers language-none"><code class="language-none">dependencies {    compile 'org.springframework.cloud:spring-cloud-config-server'    compile 'org.springframework.cloud:spring-cloud-starter-eureka'    compile 'org.springframework.boot:spring-boot-starter-actuator'}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-æ·»åŠ annotation">2. æ·»åŠ annotation</h4><pre class="line-numbers language-none"><code class="language-none">@SpringBootApplication@EnableConfigServerpublic class ConfigServerApp {    public static void main(String[] args) {        SpringApplication.run(ConfigServerApp.class, args);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-application-yamlé…ç½®æ–‡ä»¶æ·»åŠ config-repo">3. application.yamlé…ç½®æ–‡ä»¶æ·»åŠ config repo</h4><pre class="line-numbers language-none"><code class="language-none">spring:  application:    name: config-server  cloud:    config:      server:        git:          uri: file://${user.home}/space/app-config          search-paths: '{application}/{profile}'server:  port: 7001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢ä½¿ç”¨çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ–¹å¼è¿›è¡Œé…ç½®ä»“åº“çš„å†…å®¹ç®¡ç†ï¼Œè¯¥æ–¹å¼ä»…ç”¨äºå¼€å‘å’Œæµ‹è¯•ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åŠ¡å¿…æ­å»ºè‡ªå·±çš„Gité…ç½®åº“ã€‚</p><h4 id="4-å°†config-serveræ³¨å†Œè¿›æœåŠ¡å‘ç°ï¼Œapplication-yaml">4. å°†config serveræ³¨å†Œè¿›æœåŠ¡å‘ç°ï¼Œapplication.yaml</h4><pre class="line-numbers language-none"><code class="language-none">eureka:  client:    serviceUrl:      defaultZone: http://localhost:11111/eureka    healthcheck:      enabled: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-åŒæ—¶å¯ä»¥è€ƒè™‘å¼€å¯actuator-endpointsã€‚">5. åŒæ—¶å¯ä»¥è€ƒè™‘å¼€å¯actuator endpointsã€‚</h4><p>endpoints.enabledé»˜è®¤trueã€‚å…¶ä¸­/healthåœ¨åé¢Gité…ç½®åº“ä¸­æœ‰æ›´å¤šä½œç”¨ã€‚</p><pre class="line-numbers language-none"><code class="language-none">management:  security:    enabled: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="clientç«¯">clientç«¯</h3><h4 id="1-æ·»åŠ ä¾èµ–-2">1. æ·»åŠ ä¾èµ–</h4><pre class="line-numbers language-none"><code class="language-none">dependencies {    compile 'org.springframework.cloud:spring-cloud-starter-eureka'    compile 'org.springframework.cloud:spring-cloud-starter-config'    compile 'org.springframework.boot:spring-boot-starter-actuator'}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-bootstrap-ymlé…ç½®">2. bootstrap.ymlé…ç½®</h4><pre class="line-numbers language-none"><code class="language-none">spring:  cloud:    config:#      uri: http://localhost:7001      discovery:        enabled: true        service-id: config-server      fail-fast: true  application:    name: hello-cloud  profiles:    active: ${SPRING_PROFILES_ACTIVE:local}eureka:  client:    serviceUrl:      defaultZone: http://localhost:11111/eureka    healthcheck:      enabled: trueserver:  port: 8001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢spring.application.nameå³ä¼šç”¨åœ¨search-pathsçš„{application}ï¼Œspring.profiles.activeå³æ˜¯search-pathsçš„{profile}ã€‚<br>åŒæ—¶ä»æœåŠ¡å‘ç°ä¸­æŸ¥æ‰¾config-serverã€‚å¦‚æœä¸ä½¿ç”¨æœåŠ¡å‘ç°ï¼Œå¯ä½¿ç”¨spring.cloud.config.uriæŒ‡å®šé™æ€çš„urlã€‚<br>spring.cloud.config.fail-fastç”¨äºå¿«é€ŸéªŒè¯config serverçš„è¿æ¥å¯ç”¨çŠ¶æ€ï¼Œé˜²æ­¢containerå‰æœŸloadæ—¶é•¿è¿‡é•¿ï¼Œåˆ°åé¢config serveræ‰å‘ç°ä¸èƒ½ç”¨è€Œå¯åŠ¨å¤±è´¥ã€‚</p><h4 id="3-æ·»åŠ æœåŠ¡å‘ç°çš„annotation">3. æ·»åŠ æœåŠ¡å‘ç°çš„annotation</h4><pre class="line-numbers language-none"><code class="language-none">@EnableDiscoveryClient@SpringBootApplicationpublic class Application {    public static void main(String[] args) {        new SpringApplicationBuilder(Application.class).web(true).run(args);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-å¼€å¯actuator-endpointsã€‚å…¶ä¸­-refreshå¯ä»¥å¯¹é…ç½®è¿›è¡ŒåŠ¨æ€åˆ·æ–°ã€‚">4. å¼€å¯actuator endpointsã€‚å…¶ä¸­/refreshå¯ä»¥å¯¹é…ç½®è¿›è¡ŒåŠ¨æ€åˆ·æ–°ã€‚</h4><pre class="line-numbers language-none"><code class="language-none">management:  context-path: /actuator  security:    enabled: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-å†™ä¸€ä¸ªæ”¯æŒåˆ·æ–°Exampleã€‚">5. å†™ä¸€ä¸ªæ”¯æŒåˆ·æ–°Exampleã€‚</h4><pre class="line-numbers language-none"><code class="language-none">@RefreshScope@RestControllerpublic class HelloController {    private final Logger logger = Logger.getLogger(getClass().getName());    @Value("${from}")    private String from;    @GetMapping("/from")    public String from(){        return this.from;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ·æ–°æ“ä½œ">åˆ·æ–°æ“ä½œ</h3><ol><li>ä¿®æ”¹é…ç½®åº“å†…from valueã€‚</li><li>curl -X POST <a href="http://localhost:8001/actuator/refresh%E3%80%82">http://localhost:8001/actuator/refreshã€‚</a></li><li>å†æ¬¡è®¿é—®<a href="http://localhost:8001/from">http://localhost:8001/from</a></li></ol><h3 id="åœ¨config-serveræ·»åŠ å¤šä¸ªé…ç½®åº“">åœ¨config serveræ·»åŠ å¤šä¸ªé…ç½®åº“</h3><ol><li>application.yaml</li></ol><pre class="line-numbers language-none"><code class="language-none">spring:  application:    name: config-server  cloud:    config:      server:        git:          uri: git@github.com:XXX/app-config.git          search-paths: '{application}/{profile}'          passphrase: ********          force-pull: true          repos:            none_prod:              pattern:                - '*/dev'              uri: git@github.com:XXX/app-config.git              searchPaths: '{application}/{profile}'            prod:              pattern:                - '*/prod'              uri: git@github.com:XXX/prod-app-config.git              searchPaths: '{application}'        health:          repositories:            none_prod:              name: none_prod              profiles: devserver:  port: 7001eureka:  client:    serviceUrl:      defaultZone: http://localhost:11111/eureka    healthcheck:      enabled: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>spring.cloud.config.server.git.uriä¸ºé»˜è®¤é…ç½®åº“ã€‚<br>spring.cloud.config.server.health.repositoriesç”¨æ¥é…ç½®/health endpointä¸­å¥åº·æ£€æŸ¥çš„reposã€‚</p><ol start="2"><li>è¿™é‡Œé‡‡ç”¨ä½¿ç”¨æœ¬åœ°ssh settingçš„æ–¹å¼ã€‚</li></ol><ul><li>é¦–å…ˆï¼Œæœ¬åœ°${user.home}/.sshä¸‹æœ‰ssh keyã€‚</li><li>å†æ¬¡ï¼Œssh keyåŠ å…¥ssh-agentã€‚ä¸»è¦è¦ç¡®å®šconfigå’Œknow_hostæ–‡ä»¶ä¸­è®°å½•ã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">$ eval "$(ssh-agent -s)"# æ·»åŠ configæ–‡ä»¶# Host gitlab.com# HostName gitlab.com# AddKeysToAgent yes# UseKeychain yes# User TTT# IdentityFile ~/.ssh/id_tw_rsa$ ssh-add -K ~/.ssh/id_tw_rsa# æŸ¥çœ‹agent public keys$ ssh-add -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æœ€åï¼Œå¦‚æœkeyä¸­æœ‰è®¾ç½®passphraseï¼Œåœ¨application.yamlä¸€å®šè¦é…ç½®spring.cloud.config.server.git.passphraseã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring boot actuator åŸºæœ¬é…ç½®</title>
      <link href="/2018/06/08/spring-boot-actuator-ji-ben-pei-zhi/"/>
      <url>/2018/06/08/spring-boot-actuator-ji-ben-pei-zhi/</url>
      
        <content type="html"><![CDATA[<p><a href="https://docs.spring.io/spring-boot/docs/1.5.13.RELEASE/reference/htmlsingle/#production-ready">1.5.3ç‰ˆæœ¬å®˜æ–¹doc</a></p><p>spring-boot-actuatoråŒ…è‡ªåŠ¨æä¾›äº†é»˜è®¤çš„management endpointï¼Œç”¨ä»¥ç›‘æ§å®¹å™¨å†…éƒ¨çš„å„ç§çŠ¶æ€å’ŒæŒ‡æ ‡ã€‚</p><h3 id="import">import</h3><pre class="line-numbers language-none"><code class="language-none">dependencies {compile("org.springframework.boot:spring-boot-starter-actuator")}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="æ‰“å¼€endpoints">æ‰“å¼€endpoints</h3><p>endpointsé»˜è®¤çŠ¶æ€å°±æ˜¯æ‰“å¼€çš„ã€‚å¦‚æœæƒ³å…¨éƒ¨å…³æ‰ï¼Œç„¶ååˆ†åˆ«æ‰“å¼€ï¼š</p><pre class="line-numbers language-none"><code class="language-none">management:  context-path: /actuator  security:    enabled: falseendpoints:  enabled: false  health:    enabled: true    time-to-live: 10000  info:    enabled: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…³äºsecurity">å…³äºsecurity</h3><p>å¦‚æœç³»ç»Ÿæ²¡æœ‰@EnableWebSecurityè‡ªè¡Œå®šåˆ¶securityçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨<code>management.security.enabled</code>æ¥æ§åˆ¶management endpointä¸­sensitiveçš„è®¿é—®æƒé™ï¼Œä»¥åŠnot sensitiveçš„æ˜¾ç¤ºå†…å®¹èŒƒå›´ã€‚å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">management:  context-path: /actuator  security:    enabled: truesecurity:  basic:    enabled: true  user:    name: admin    password: secret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“@EnableWebSecurityåï¼Œæ‰€æœ‰è®¿é—®æƒé™éƒ½ç”±WebSecurityConfigurerAdapterçš„å­ç±»full controllã€‚</p><p>spring boot 1.4å¯ä»¥é€šè¿‡<code>management.security.enabled=false</code>æ¥å…³é—­å¯¹management endpointsçš„security checkï¼Œæ˜¯ç”±äºspring bootå®ç°çš„ä¸€ä¸ªbugã€‚<br>spring boot 1.5ä¸­å·²ç»ä¿®å¤ã€‚<br>è€Œåœ¨spring boot 2.0ä¸­å·²ç»å°†<code>management.security.enabled</code>å»æ‰ã€‚<br>å› æ­¤ï¼Œåœ¨custom WebSecurityConfigurerAdapterä¸­ï¼Œè¿˜æ˜¯ä½¿ç”¨æ­£ç¡®çš„å§¿åŠ¿å¯¹management endpointsè¿›è¡Œç‰¹åˆ«è®¾ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">....antMatchers("/info", "/health", "/metrics").permitAll()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å…³äºmanagement-port">å…³äºmanagement.port</h3><p><code>management.port=9999</code>è™½ç„¶å¯ä»¥å°†management endpointå¼€æ”¾åœ¨ç‹¬ç«‹çš„ç«¯å£ä¸Šï¼Œä½†<code>/health</code>checkå¹¶ä¸èƒ½è‡ªåŠ¨æ£€æµ‹ä¸»ç«¯å£æ˜¯å¦å¯ç”¨ã€‚<br>å› æ­¤ï¼Œå¦‚æœä½¿ç”¨<code>management.port</code>æ—¶ï¼Œå¯èƒ½éœ€è¦è‡ªè¡Œå®šåˆ¶ä¸€ä¸ªHealthIndicatoræ¥pingä¸»æœåŠ¡ç«¯å£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ethereum å¼€å‘å·¥å…·</title>
      <link href="/2018/06/05/ethereum-kai-fa-gong-ju/"/>
      <url>/2018/06/05/ethereum-kai-fa-gong-ju/</url>
      
        <content type="html"><![CDATA[<h2 id="Using-Remix">Using Remix</h2><p>æœ‰ä¸ªå«<a href="http://remix.ethereum.org/">Remix</a>çš„åœ¨çº¿IDEï¼Œå¿«é€Ÿåœ°éªŒè¯æ™ºèƒ½åˆçº¦ï¼Œæˆ–è€…ä¸€äº›åŸºæœ¬è°ƒè¯•ï¼Œè¿˜æ˜¯ç‰¹åˆ«æ–¹ä¾¿çš„ã€‚</p><h2 id="Using-truffle">Using truffle</h2><h4 id="å®‰è£…ganache">å®‰è£…ganache</h4><p>å¯ä»¥é€‰æ‹©å®‰è£…æœ‰å›¾å½¢ç•Œé¢çš„<a href="https://github.com/trufflesuite/ganache">ganache</a>ï¼Œæˆ–è€…æ— å›¾å½¢ç•Œé¢çš„å‘½ä»¤è¡Œ<a href="https://github.com/trufflesuite/ganache-cli">ganache-cli</a>ã€‚</p><p>æŒ‰ä¸ªäººå–œå¥½é€‰æ‹©ã€‚<br>æœ¬äººä¸¤ç§éƒ½å®‰è£…äº†ï¼Œä½†ä½¿ç”¨æ—¶æ›´å–œå¥½å‘½ä»¤è¡Œç‰ˆã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ npm install -g ganache-cli$ ganache-cli //å³å¯è¿è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="å®‰è£…truffle">å®‰è£…truffle</h4><pre class="line-numbers language-none"><code class="language-none">$ npm install -g truffle<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="build-project">build project</h4><pre class="line-numbers language-none"><code class="language-none">$ mkdir hello-solidity-truffle$ cd hello-solidity-truffle$ truffle init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="truffleå¸¸ç”¨å‘½ä»¤">truffleå¸¸ç”¨å‘½ä»¤</h4><pre class="line-numbers language-none"><code class="language-none">truffle migratetruffle testtruffle console<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…MetaMask">å®‰è£…MetaMask</h3><p>MetaMaskæ˜¯ä¸€ä¸ªä»¥Chromeæµè§ˆå™¨æ’ä»¶å½¢å¼å®ç°çš„è½»é’±åŒ…ã€‚<br>è¿›å…¥Chrome Web StoreæŸ¥æ‰¾å®‰è£…åå³å¯ã€‚</p><p>ç„¶åè¦è®°å¾—åˆ›å»ºçš„å£ä»¤å’Œå¯†ç ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud Eureka æœåŠ¡æ²»ç†</title>
      <link href="/2018/05/15/spring-cloud-eureka-fu-wu-zhi-li/"/>
      <url>/2018/05/15/spring-cloud-eureka-fu-wu-zhi-li/</url>
      
        <content type="html"><![CDATA[<h3 id="æœåŠ¡æ³¨å†Œä¸­å¿ƒ">æœåŠ¡æ³¨å†Œä¸­å¿ƒ</h3><p>åœ¨æœåŠ¡æ²»ç†æ¡†æ¶ä¸­ï¼Œé€šå¸¸æœ‰ä¸€ä¸ª <code>æœåŠ¡æ³¨å†Œä¸­å¿ƒ</code>ï¼Œæä¾›ï¼š</p><ol><li>æœåŠ¡æ³¨å†Œã€‚<br>æ¯ä¸ªæœåŠ¡å•å…ƒå‘å…¶ç™»è®°è‡ªå·±æä¾›çš„æœåŠ¡ï¼Œå°†ä¸»æœºã€ç«¯å£å·ã€ç‰ˆæœ¬å·ç­‰å‘ŠçŸ¥æ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œä¸­å¿ƒæŒ‰ <code>æœåŠ¡å</code> æ¥ç»„ç»‡æ¸…å•ã€‚</li><li>æœåŠ¡å‘ç°ã€‚<br>æœåŠ¡è°ƒç”¨æ–¹éœ€è¦è°ƒç”¨æŸä¸ªæœåŠ¡åçš„å®ä¾‹æä¾›çš„æœåŠ¡ï¼Œåˆ™å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–æ‰€æœ‰æœåŠ¡å®ä¾‹çš„æ¸…å•ï¼Œä»¥å®ç°å¯¹å…·ä½“æœåŠ¡å®ä¾‹çš„è®¿é—®ã€‚</li></ol><pre class="line-numbers language-none"><code class="language-none"># first build.gradledependencies {    compile 'org.springframework.cloud:spring-cloud-starter-eureka-server'    compile 'org.springframework.boot:spring-boot-starter-web'    â€¦â€¦}# second application.yamlserver:  port: 11111eureka:  instance:    hostname: localhost  lease-renewal-interval-in-seconds: 30  lease-expiration-duration-in-seconds: 90  server:    enable-self-preservation: false  client:    fetch-registry: false    register-with-eureka: false    serviceUrl:      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/# third Application.java@EnableEureKaServer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Netflix Eurekaç”±äºä½¿ç”¨Restful APIåè®®ï¼Œå› æ­¤æ”¯æŒè·¨è¯­è¨€è·¨å¹³å°çš„å¾®æœåŠ¡åº”ç”¨è¿›è¡Œæ³¨å†Œã€‚</p><h3 id="æœåŠ¡æä¾›è€…">æœåŠ¡æä¾›è€…</h3><p>Eurekaå®¢æˆ·ç«¯ï¼š</p><ol><li>å‘æ³¨å†Œä¸­å¿ƒç™»è®°è‡ªèº«æä¾›çš„æœåŠ¡ï¼Œå¹¶ä¸”å‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³æ¥æ›´æ–°å®ƒçš„æœåŠ¡ç§Ÿçº¦ã€‚</li><li>ä»æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢æœåŠ¡æ¸…å•ï¼ŒæŠŠå®ƒä»¬ç¼“å­˜åˆ°æœ¬åœ°ï¼Œå¹¶å‘¨æœŸæ€§åœ°åˆ·æ–°æœåŠ¡çŠ¶æ€ã€‚</li></ol><h3 id="æœåŠ¡ç»­çº¦-renew">æœåŠ¡ç»­çº¦(renew)</h3><p>åœ¨æœåŠ¡æ³¨å†Œå®Œæˆä¹‹åï¼ŒæœåŠ¡æä¾›è€…ç»´æŠ¤ä¸€ä¸ªå¿ƒè·³ç”¨æ¥æŒç»­å‘ŠçŸ¥æœåŠ¡ä¸­å¿ƒï¼Œä»¥é˜²æ­¢è¢«æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤ã€‚<br>ä½¿ç”¨spring boot actuatoræä¾›çš„/healthæ¥ç»´æŠ¤å¿ƒè·³ã€æä¾›å¥åº·æ£€æŸ¥ã€‚</p><pre class="line-numbers language-none"><code class="language-none">#first build.gradledependencies {    compile 'org.springframework.cloud:spring-cloud-starter-eureka'    compile 'org.springframework.boot:spring-boot-starter-actuator'    â€¦â€¦}#second application.yamleureka:  client:        serviceUrl:defaultZone: http://localhost:11111/eureka#third Application.java@EnableDiscoveryClient<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æœåŠ¡ä¸‹çº¿">æœåŠ¡ä¸‹çº¿</h3><p>æœåŠ¡æä¾›è€…æ­£å¸¸å…³é—­æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªæœåŠ¡ä¸‹çº¿çš„Restfulè¯·æ±‚ç»™æ³¨å†Œä¸­å¿ƒã€‚æ³¨å†Œä¸­å¿ƒåœ¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šå°†è¯¥æœåŠ¡ç¼–è¾‘ä¸ºä¸‹çº¿ï¼Œå¹¶å¹¿æ’­æ­¤äº‹ä»¶ã€‚</p><h3 id="æœåŠ¡å‰”é™¤">æœåŠ¡å‰”é™¤</h3><p>æ³¨å†Œä¸­å¿ƒä¼šå®šæ—¶æ¯ä¸ªä¸€æ®µæ—¶é—´ <em>lease-renewal-interval-in-seconds</em> ï¼Œå°†æœåŠ¡æ¸…å•ä¸­è¶…è¿‡æ—¶é—´ <em>lease-expiration-duration-in-seconds</em> ç§’æ²¡æœ‰ç»­çº¦çš„æœåŠ¡å‰”é™¤å‡ºå»ã€‚</p><h3 id="è‡ªæˆ‘ä¿æŠ¤">è‡ªæˆ‘ä¿æŠ¤</h3><p>åŸºäºä¸Šé¢æœåŠ¡å‰”é™¤çš„ï¼Œæ³¨å†Œä¸­å¿ƒåœ¨è¿è¡ŒæœŸé—´ï¼Œä¼šç»Ÿè®¡å¿ƒè·³å¤±è´¥çš„æ¯”ä¾‹åœ¨15åˆ†é’Ÿå†…æ˜¯å¦ä½äº85%ï¼Œå¦‚æœæ˜¯ï¼Œæ³¨å†Œä¸­å¿ƒä¼šå°†å½“å‰æ³¨å†Œä¿¡æ¯ä¿æŠ¤èµ·æ¥ï¼Œè®©å…¶ä¸ä¼šè¿‡æœŸã€‚<br>ç”±äºæœ¬åœ°å¾ˆå®¹æ˜“è§¦å‘ä¿æŠ¤æœºåˆ¶ï¼Œå› æ­¤æœ¬åœ°å¼€å‘æ—¶å…³é—­è‡ªæˆ‘ä¿æŠ¤ã€‚</p><pre class="line-numbers language-none"><code class="language-none"># application.yamlserver:    enable-self-preservation: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Solidity Zombies å­¦ä¹ ç¬”è®°</title>
      <link href="/2018/05/03/solidity-zombies-xue-xi-bi-ji/"/>
      <url>/2018/05/03/solidity-zombies-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<p>ä»¥å¤ªåŠçš„ä¸€ä¸ª<a href="https://cryptozombies.io/">åŠ å¯†åƒµå°¸æ¸¸æˆ</a>ã€‚<br>ä¸ºäº†ä¾¿äºè®°å¿†ï¼Œå°†å…¶ä¸­çš„æ•™ç¨‹äº§å‡ºcodeè´´äº†å‡ºæ¥ã€‚</p><p>ZombieFactory.sol</p><pre class="line-numbers language-none"><code class="language-none">pragma solidity ^0.4.19;import "./ownable.sol";contract ZombieFactory is Ownable {    event NewZombie(uint zombieId, string name, uint dna);    uint dnaDigits = 16;    uint dnaModulus = 10 ** dnaDigits;    uint cooldownTime = 1 days;    struct Zombie {      string name;      uint dna;      uint32 level;      uint32 readyTime;    }    Zombie[] public zombies;    mapping (uint =&gt; address) public zombieToOwner;    mapping (address =&gt; uint) ownerZombieCount;    function _createZombie(string _name, uint _dna) internal {        uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime))) - 1;        zombieToOwner[id] = msg.sender;        ownerZombieCount[msg.sender]++;        NewZombie(id, _name, _dna);    }    function _generateRandomDna(string _str) private view returns (uint) {        uint rand = uint(keccak256(_str));        return rand % dnaModulus;    }    function createRandomZombie(string _name) public {        require(ownerZombieCount[msg.sender] == 0);        uint randDna = _generateRandomDna(_name);        randDna = randDna - randDna % 100;        _createZombie(_name, randDna);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>Ownableæ˜¯æ¥è‡ª OpenZeppelin Solidity åº“çš„ Ownable åˆçº¦ã€‚<br>äº‹ä»¶ æ˜¯åˆçº¦å’ŒåŒºå—é“¾é€šè®¯çš„ä¸€ç§æœºåˆ¶ã€‚ä½ çš„å‰ç«¯åº”ç”¨â€œç›‘å¬â€æŸäº›äº‹ä»¶ï¼Œå¹¶åšå‡ºååº”ã€‚å¦‚ï¼š</p></blockquote><pre class="line-numbers language-none"><code class="language-none">var abi = // abiæ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„  var ZombieFactoryContract = web3.eth.contract(abi)  var contractAddress = /// å‘å¸ƒä¹‹ååœ¨ä»¥å¤ªåŠä¸Šç”Ÿæˆçš„åˆçº¦åœ°å€  var ZombieFactory = ZombieFactoryContract.at(contractAddress)   // ZombieFactoryèƒ½è®¿é—®å…¬å…±çš„å‡½æ•°ä»¥åŠäº‹ä»¶// ç›‘å¬NewZombieäº‹ä»¶, å¹¶ä¸”æ›´æ–°UI  var event = ZombieFactory.NewZombie(function(error, result) {    if (error) return  generateZombie(result.zombieId, result.name, result.dna)})  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ZombieFeeding.sol</p><pre class="line-numbers language-none"><code class="language-none">pragma solidity ^0.4.19;import "./zombiefactory.sol";contract KittyInterface {    function getKitty(uint256 _id) external view returns (      bool isGestating,      bool isReady,      uint256 cooldownIndex,      uint256 nextActionAt,      uint256 siringWithId,      uint256 birthTime,      uint256 matronId,      uint256 sireId,      uint256 generation,      uint256 genes    );  }contract ZombieFeeding is ZombieFactory {  KittyInterface kittyContract;  modifier ownerOf(uint _zombieId) {    require(msg.sender == zombieToOwner[_zombieId]);    _;  }  function setKittyContractAddress(address _address) external onlyOwner {    kittyContract = KittyInterface(_address);  }  function _triggerCooldown(Zombie storage _zombie) internal {    _zombie.readyTime = uint32(now + cooldownTime);  }  function _isReady(Zombie storage _zombie) internal view returns (bool) {      return (_zombie.readyTime &lt;= now);  }  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal ownerOf(_zombieId) {    Zombie storage myZombie = zombies[_zombieId];    require(_isReady(myZombie));    _targetDna = _targetDna % dnaModulus;    uint newDna = (myZombie.dna + _targetDna) / 2;    if (keccak256(_species) == keccak256("kitty")) {      newDna = newDna - newDna % 100 + 99;    }    _createZombie("NoName", newDna);    _triggerCooldown(myZombie);  }  function feedOnKitty(uint _zombieId, uint _kittyId) public {    uint kittyDna;    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);    feedAndMultiply(_zombieId, kittyDna, "kitty");  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åœ¨ Solidity ä¸­ï¼Œæœ‰ä¸€äº›å…¨å±€å˜é‡å¯ä»¥è¢«æ‰€æœ‰å‡½æ•°è°ƒç”¨ã€‚ å…¶ä¸­ä¸€ä¸ªå°±æ˜¯ msg.senderï¼Œå®ƒæŒ‡çš„æ˜¯å½“å‰è°ƒç”¨è€…ï¼ˆæˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„ addressã€‚<br>Solidity ä½¿ç”¨è‡ªå·±çš„æœ¬åœ°æ—¶é—´å•ä½ã€‚<br>å˜é‡ now å°†è¿”å›å½“å‰çš„unixæ—¶é—´æˆ³ï¼ˆè‡ª1970å¹´1æœˆ1æ—¥ä»¥æ¥ç»è¿‡çš„ç§’æ•°ï¼‰ã€‚æˆ‘å†™è¿™å¥è¯æ—¶ unix æ—¶é—´æ˜¯ 1515527488ã€‚</p><p>æ³¨æ„ï¼šUnixæ—¶é—´ä¼ ç»Ÿç”¨ä¸€ä¸ª32ä½çš„æ•´æ•°è¿›è¡Œå­˜å‚¨ã€‚è¿™ä¼šå¯¼è‡´â€œ2038å¹´â€é—®é¢˜ï¼Œå½“è¿™ä¸ª32ä½çš„unixæ—¶é—´æˆ³ä¸å¤Ÿç”¨ï¼Œäº§ç”Ÿæº¢å‡ºï¼Œä½¿ç”¨è¿™ä¸ªæ—¶é—´çš„é—ç•™ç³»ç»Ÿå°±éº»çƒ¦äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„ DApp è·‘å¤Ÿ20å¹´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨64ä½æ•´æ•°è¡¨ç¤ºæ—¶é—´ï¼Œä½†ä¸ºæ­¤æˆ‘ä»¬çš„ç”¨æˆ·åˆå¾—æ”¯ä»˜æ›´å¤šçš„ gasã€‚çœŸæ˜¯ä¸ªä¸¤éš¾çš„è®¾è®¡å•Šï¼</p><p>Solidity è¿˜åŒ…å«ç§’(seconds)ï¼Œåˆ†é’Ÿ(minutes)ï¼Œå°æ—¶(hours)ï¼Œå¤©(days)ï¼Œå‘¨(weeks) å’Œ å¹´(years) ç­‰æ—¶é—´å•ä½ã€‚å®ƒä»¬éƒ½ä¼šè½¬æ¢æˆå¯¹åº”çš„ç§’æ•°æ”¾å…¥ uint ä¸­ã€‚æ‰€ä»¥ 1åˆ†é’Ÿ å°±æ˜¯ 60ï¼Œ1å°æ—¶æ˜¯ 3600ï¼ˆ60ç§’Ã—60åˆ†é’Ÿï¼‰ï¼Œ1å¤©æ˜¯86400ï¼ˆ24å°æ—¶Ã—60åˆ†é’ŸÃ—60ç§’ï¼‰ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></blockquote><p>ZombieHelper.sol</p><pre class="line-numbers language-none"><code class="language-none">pragma solidity ^0.4.19;import "./zombiefeeding.sol";contract ZombieHelper is ZombieFeeding {  uint levelUpFee = 0.001 ether;  modifier aboveLevel(uint _level, uint _zombieId) {    require(zombies[_zombieId].level &gt;= _level);    _;  }  function withdraw() external onlyOwner {    owner.transfer(this.balance);  }  function setLevelUpFee(uint _fee) external onlyOwner {    levelUpFee = _fee;  }  function levelUp(uint _zombieId) external payable {    require(msg.value == levelUpFee);    zombies[_zombieId].level++;  }  function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId) ownerOf(_zombieId) {    zombies[_zombieId].name = _newName;  }  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId) ownerOf(_zombieId) {    zombies[_zombieId].dna = _newDna;  }  function getZombiesByOwner(address _owner) external view returns(uint[]) {    uint[] memory result = new uint[](ownerZombieCount[_owner]);    uint counter = 0;    for (uint i = 0; i &lt; zombies.length; i++) {      if (zombieToOwner[i] == _owner) {        result[counter] = i;        counter++;      }    }    return result;  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>msg.value æ˜¯ä¸€ç§å¯ä»¥æŸ¥çœ‹å‘åˆçº¦å‘é€äº†å¤šå°‘ä»¥å¤ªçš„æ–¹æ³•ï¼Œå¦å¤– ether æ˜¯ä¸€ä¸ªå…§å»ºå•å…ƒã€‚<br>è¿™é‡Œå‘ç”Ÿçš„äº‹æ˜¯ï¼Œä¸€äº›äººä¼šä» web3.js è°ƒç”¨è¿™ä¸ªå‡½æ•° (ä»DAppçš„å‰ç«¯)ï¼Œ åƒè¿™æ · :</p></blockquote><pre class="line-numbers language-none"><code class="language-none">// å‡è®¾ `OnlineStore` åœ¨ä»¥å¤ªåŠä¸ŠæŒ‡å‘ä½ çš„åˆçº¦:    OnlineStore.buySomething().send(from: web3.eth.defaultAccount, value: web3.utils.toWei(0.001))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ZombieBattle.sol</p><pre class="line-numbers language-none"><code class="language-none">pragma solidity ^0.4.19;import "./zombiehelper.sol";contract ZombieBattle is ZombieHelper {  uint randNonce = 0;  uint attackVictoryProbability = 70;  function randMod(uint _modulus) internal returns(uint) {    randNonce++;    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;  }  function attack(uint _zombieId, uint _targetId) external ownerOf(_zombieId) {    Zombie storage myZombie = zombies[_zombieId];    Zombie storage enemyZombie = zombies[_targetId];    uint rand = randMod(100);    if (rand &lt;= attackVictoryProbability) {      myZombie.winCount++;      myZombie.level++;      enemyZombie.lossCount++;      feedAndMultiply(_zombieId, enemyZombie.dna, "zombie");    } else {      myZombie.lossCount++;      enemyZombie.winCount++;      _triggerCooldown(myZombie);    }  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB æŸ¥è¯¢è¯­å¥</title>
      <link href="/2017/02/17/mongodb-cha-xun-yu-ju/"/>
      <url>/2017/02/17/mongodb-cha-xun-yu-ju/</url>
      
        <content type="html"><![CDATA[<p><a href="https://docs.mongodb.com/getting-started/shell/">Get Started</a><br><a href="https://docs.mongodb.com/manual/">Official Manual</a></p><p>å€Ÿç”¨å®˜ç½‘çš„ä¾‹å­æ•°æ®ï¼šdb.inventory</p><pre class="line-numbers language-none"><code class="language-none">{ item: "journal", qty: 25, status: "A", size: { h: 14, w: 21, uom: "cm" }, tags: ["blank", "red"], dim_cm: [ 14, 21 ] }{ item: "notebook", qty: 50, status: "A", size: { h: 8.5, w: 11, uom: "in" }, tags: ["red", "blank"], dim_cm: [ 14, 21 ] }{ item: "paper", qty: 100, status: "D", size: { h: 8.5, w: 11, uom: "in" }, tags: ["red", "blank", "plain"], dim_cm: [ 14, 21 ] }{ item: "planner", qty: 75, status: "D", size: { h: 22.85, w: 30, uom: "cm" }, tags: ["blank", "red"], dim_cm: [ 22.85, 30 ] }{ item: "postcard", qty: 45,  status: "A", size: { h: 10, w: 15.25, uom: "cm" }, tags: ["blue"], dim_cm: [ 10, 15.25 ] }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æŸ¥æ‰¾æ‰€æœ‰ï¼š">æŸ¥æ‰¾æ‰€æœ‰ï¼š</h4><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( {} )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ç®€å•åŒ¹é…æ™®é€šå±æ€§ï¼š">ç®€å•åŒ¹é…æ™®é€šå±æ€§ï¼š</h4><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { status: "D" } )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨æ“ä½œç¬¦åŒ¹é…æ™®é€šå±æ€§ï¼š</p><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { status: { $in: [ "A", "D" ] } } )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¤šä¸ªå±æ€§åŒ¹é…ï¼Œä¹‹é—´æ˜¯ä¸”çš„å…³ç³»ï¼š</p><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { status: "A", qty: { $lt: 30 } } )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–çš„å…³ç³»éœ€è¦å¦åŠ æ“ä½œç¬¦ï¼š</p><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { $or: [ { status: "A" }, { qty: { $lt: 30 } } ] } )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸” å’Œ æˆ– å…±åŒä½¿ç”¨çš„æ—¶ï¼š</p><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( {      status: "A",      $or: [ { qty: { $lt: 30 } }, { item: /^p/ } ]  } )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="æŸ¥æ‰¾ï¼Œæ•°ç»„-å¯¹è±¡å±æ€§ä¸­æœ‰æ»¡è¶³åŒ¹é…çš„å­é¡¹">æŸ¥æ‰¾ï¼Œæ•°ç»„/å¯¹è±¡å±æ€§ä¸­æœ‰æ»¡è¶³åŒ¹é…çš„å­é¡¹</h4><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { tags: "red" } )db.inventory.find( { "size.uom": "in" } )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ•°ç»„/å¯¹è±¡å®Œå…¨åŒ¹é…æŸ¥æ‰¾ï¼ˆå­é¡¹é¡ºåºå¿…é¡»å®Œå…¨ç›¸åŒï¼Œä¸ç„¶åŒ¹é…ä¸åˆ°ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { size: { h: 14, w: 21, uom: "cm" } } )db.inventory.find( { tags: ["red", "blank"] } )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="åŒ¹é…æ•°ç»„æ—¶æ³¨æ„ï¼šé»˜è®¤å¤šå…ƒç´ å­é¡¹å¯åˆ†æ‘ŠåŒ¹é…">åŒ¹é…æ•°ç»„æ—¶æ³¨æ„ï¼šé»˜è®¤å¤šå…ƒç´ å­é¡¹å¯åˆ†æ‘ŠåŒ¹é…</h4><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { dim_cm: { $gt: 15, $lt: 20 } } )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>The following example queries for documents where the dim_cm array contains elements that in some combination satisfy the query conditions; e.g., one element can satisfy the greater than 15 condition and another element can satisfy the less than 20 condition, or a single element can satisfy both.</p></blockquote><h4 id="åŒ¹é…æ•°ç»„ï¼šæœŸæœ›å…ƒç´ å­é¡¹å†…åŒ¹é…">åŒ¹é…æ•°ç»„ï¼šæœŸæœ›å…ƒç´ å­é¡¹å†…åŒ¹é…</h4>  <pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { dim_cm: { $elemMatch: { $gt: 22, $lt: 30 } } } )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>The following example queries for documents where the dim_cm array contains at least one element that is both greater than (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>t</mi><mo stretchy="false">)</mo><mn>22</mn><mi>a</mi><mi>n</mi><mi>d</mi><mi>l</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>t</mi><mi>h</mi><mi>a</mi><mi>n</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">gt) 22 and less than (</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord">22</span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">ess</span><span class="mord mathnormal">t</span><span class="mord mathnormal">han</span><span class="mopen">(</span></span></span></span>lt) 30.</p></blockquote><h4 id="åŒ¹é…æ•°ç»„å¯ä»¥ç”¨ç´¢å¼•ï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰">åŒ¹é…æ•°ç»„å¯ä»¥ç”¨ç´¢å¼•ï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰</h4><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { "dim_cm.1": { $gt: 25 } } )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="åŒ¹é…æ•°ç»„ï¼Œå¯ä»¥å¤šå…ƒç´ æ†ç»‘åŒ¹é…">åŒ¹é…æ•°ç»„ï¼Œå¯ä»¥å¤šå…ƒç´ æ†ç»‘åŒ¹é…</h4><pre class="line-numbers language-none"><code class="language-none">db.inventory.find( { tags: { $all: ["red", "blank"] } } )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒï¼ˆæ—¢åŒ…å«â€™redâ€™, ä¹ŸåŒ…å«â€™blankâ€™çš„ï¼‰ï¼š</p><pre class="line-numbers language-none"><code class="language-none">db.inventory.find({ $and: [ { tags: "red" }, { tags: "blank" } ] })<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> NoSQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MongoDB </tag>
            
            <tag> NoSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå­¦ä¹ ç¬”è®°</title>
      <link href="/2016/11/08/docker-xue-xi-bi-ji/"/>
      <url>/2016/11/08/docker-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<p>æœ¬åœ°ç”¨çš„Docker for Macï¼Œä½¿ç”¨<a href="https://docs.docker.com/docker-for-mac/">official tutorial</a> è¿›è¡Œå‰æœŸå®‰è£…å·¥ä½œã€‚</p><p>å®‰è£…å¥½åï¼Œè¿è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤ <code>docker --version</code></p><blockquote><p>Docker version 1.12.1, build 6f9534c</p></blockquote><p>å®˜æ–¹æ–‡æ¡£ä¸Šé¢ä¸€ç›´æåˆ°ä¸€ä¸ªDocker Toolboxï¼Œæ˜¯é’ˆå¯¹ä¸æ»¡è¶³Docker for Macçš„ç³»ç»Ÿé…ç½®è¦æ±‚"<em>macOS 10.10.3 Yosemite or newer</em>"ï¼Œåˆ™å»ºè®®å®‰è£…Docker Toolboxã€‚</p><h3 id="å¦‚ä½•è¿è¡Œ-container">å¦‚ä½•è¿è¡Œ container</h3><h4 id="1-ç®€å•è¿è¡Œèµ·æ¥ä¸€ä¸ªcontainerã€‚">1. ç®€å•è¿è¡Œèµ·æ¥ä¸€ä¸ªcontainerã€‚</h4><p>ä» Docker hub ä¸Šæœç´¢ä¸€ä¸ª imageã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ docker search hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä» Docker hub ä¸Š pull ä¸€ä¸ª imageã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ docker pull hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŸºäº image è¿è¡Œä¸€ä¸ª containerã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ docker run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-å…¶å®ç”¨ä¸€æ¡å‘½ä»¤å°±ç›´æ¥å®Œæˆä¸Šé¢çš„ä¸‰é¡¹ï¼šdocker-run-hello-world">2. å…¶å®ç”¨ä¸€æ¡å‘½ä»¤å°±ç›´æ¥å®Œæˆä¸Šé¢çš„ä¸‰é¡¹ï¼š<strong>docker run hello-world</strong></h4><p>è¿è¡Œ<strong>docker run</strong>çš„æ—¶å€™ï¼Œdocker engineå…¶å®åšäº†ä¸‰ä¸ªåŠ¨ä½œï¼š</p><ul><li>æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ hello-world çš„ image</li><li>å¦‚æœæœ¬åœ°æ²¡æœ‰ï¼Œä» Docker hub ä¸‹è½½ hello-world çš„ imageï¼ˆä¸åªæ˜¯Docker hubä¸Šï¼‰</li><li>åŠ è½½ image å»è¿è¡Œä¸€ä¸ª container</li></ul><h4 id="3-åˆ—ä¸¾å‡ºæ‰€æœ‰-container-å’Œ-image">3. åˆ—ä¸¾å‡ºæ‰€æœ‰ container å’Œ image</h4><p>æ˜¾ç¤ºæ‰€æœ‰è¿è¡Œä¸­çš„ container</p><pre class="line-numbers language-none"><code class="language-none">$ docker ps<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ˜¾ç¤ºæ‰€æœ‰è¢«åˆ›å»ºçš„ container</p><pre class="line-numbers language-none"><code class="language-none">$ docker ps -a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ˜¾ç¤ºæœ€è¿‘ä¸€ä¸ªè¢«åˆ›å»ºçš„ container</p><pre class="line-numbers language-none"><code class="language-none">$ docker ps -l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ˜¾ç¤ºæœ¬åœ°æ‰€æœ‰ image</p><pre class="line-numbers language-none"><code class="language-none">$ docker images<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4-image-å’Œ-container-çš„å®šä¹‰">4. image å’Œ container çš„å®šä¹‰</h4><blockquote><p>Docker Engine provides the core Docker technology that enables images and containers.<br>An image is a filesystem and parameters to use at runtime. It doesnâ€™t have state and never changes. A container is a running instance of an image.</p></blockquote><h4 id="5-åœ¨-container-å†…è¿è¡Œå‘½ä»¤">5. åœ¨ container å†…è¿è¡Œå‘½ä»¤</h4><pre class="line-numbers language-none"><code class="language-none">$ docker run ubuntu echo "hello word"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šå¸¸å½“å‘½ä»¤æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œcontainer å³ä¼šåœæ­¢ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ docker run -t -i ubuntu /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>host è¿è¡Œä¸€ä¸ª containerï¼Œå¹¶ä¸”æ‰“å¼€ä¸€æ¡äº¤äº’è¿æ¥ã€‚</p><blockquote><p><strong>-t</strong> flag assigns a pseudo-tty or terminal inside the new container.<br><strong>-i</strong> flag allows you to make an interactive connection by grabbing the standard input (STDIN) of the container.</p></blockquote><pre class="line-numbers language-none"><code class="language-none">$ docker run -d ubuntu /bin/sh -c "while true; do echo hello world; sleep 1; done"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”¨åå°è¿›ç¨‹çš„å½¢å¼è¿è¡Œå‘½ä»¤ã€‚</p><blockquote><p>-d flag runs the container in the background (to daemonize it).</p></blockquote><p><strong>æ³¨æ„ï¼šå¦‚æœä¸æŒ‡å®š contrainer nameï¼Œdocker å°†è‡ªåŠ¨ç”Ÿæˆ container nameã€‚</strong></p><h4 id="6-æŸ¥çœ‹æŒ‡å®š-container-çš„æ ‡å‡†è¾“å‡ºä¿¡æ¯">6. æŸ¥çœ‹æŒ‡å®š container çš„æ ‡å‡†è¾“å‡ºä¿¡æ¯</h4><pre class="line-numbers language-none"><code class="language-none">$ docker logs &lt;containerId&gt;[&lt;containerName&gt;]$ docker logs -f &lt;containerId&gt;[&lt;containerName&gt;] //-f æ•ˆæœåŒtail -f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="7-åœæ­¢-å¯åŠ¨-åˆ é™¤container">7. åœæ­¢/å¯åŠ¨/åˆ é™¤container</h4><pre class="line-numbers language-none"><code class="language-none">$ docker stop &lt;containerID&gt;[&lt;containerName&gt;]$ docker start &lt;containerID&gt;[&lt;containerName&gt;]$ docker rm &lt;containerID&gt;[&lt;containerName&gt;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å¦‚ä½•åˆ›å»º-Image">å¦‚ä½•åˆ›å»º Image</h3><blockquote><p>There are two ways you can update and create images.<br>You can update a container created from an image and commit the results to an image.<br>You can use a Dockerfile to specify instructions to create an image.</p></blockquote><h4 id="1-ç¬¬ä¸€ç§ï¼Œæ›´æ–°ä¸€ä¸ª-image-å¹¶ä¸”-commitã€‚">1. ç¬¬ä¸€ç§ï¼Œæ›´æ–°ä¸€ä¸ª image å¹¶ä¸” commitã€‚</h4><pre class="line-numbers language-none"><code class="language-none"># åˆ›å»º&amp;è¿è¡Œä¸€ä¸ªcontainerï¼Œå¹¶å¼€å¯äº¤äº’æ¨¡å¼$ docker run -t -i training/sinatra /bin/bash# è¿›å…¥container terminal bashï¼Œå®‰è£…rubyï¼Œå®‰è£…åŒ…ï¼Œé€€å‡ºroot@0b2616b0e5a8:/# apt-get install -y ruby2.0-dev ruby2.0root@0b2616b0e5a8:/# gem2.0 install jsonroot@0b2616b0e5a8:/# exit# æäº¤å˜æ›´ï¼Œ-m message/ -a authorï¼ŒcontainerIdï¼Œ commitåçš„image name$ docker commit -m "Added json gem" -a "Kate Smith" 0b2616b0e5a8 ouruser/sinatra:v2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>commit ä¹‹ååœ¨æœ¬åœ° images ä¸­å°±å¯ä»¥çœ‹è§ ouruser/sinatra:v2 çš„ image äº†ï¼Œä¹‹åå¯ä»¥é€‰æ‹©ä»è¿™ä¸ª image æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ containerï¼Œæˆ–è€…å°†å…¶ push åˆ° docker bub ä¸Šã€‚</p><h4 id="2-ç¬¬äºŒç§ï¼Œä½¿ç”¨-Dockerfile-æ–‡ä»¶">2. ç¬¬äºŒç§ï¼Œä½¿ç”¨ Dockerfile æ–‡ä»¶</h4><ul><li>åˆ›å»ºä¸€ä¸ª Dockfile æ–‡ä»¶</li></ul><pre class="line-numbers language-none"><code class="language-none">$ mkdir mydockerbuild$ cd mydockerbuild$ touch Dockerfile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ‰“å¼€ Dockerfileï¼Œå¹¶è¿›è¡Œç¼–å†™</li></ul><pre class="line-numbers language-none"><code class="language-none">FROM docker/whalesay:latest  RUN apt-get -y update &amp;&amp; apt-get install -y fortunes# CMD /usr/games/fortune -a | cowsay<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>build image</li></ul><pre class="line-numbers language-none"><code class="language-none">$ docker build -t docker-whale .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>The docker build -t docker-whale . command takes the Dockerfile in the current directory, and builds an image called docker-whale on your local machine.</p></blockquote><h4 id="3-ä¸Šä¼ -image">3. ä¸Šä¼  image</h4><p>é™„ï¼š å¦‚æœéœ€è¦å°†imageå‘å¸ƒåˆ°docker hubä¸Šï¼Œé¦–å…ˆéœ€è¦sign upä¸€ä¸ª <a href="https://hub.docker.com/">docker hub</a> çš„è´¦å·ã€‚<br>ç„¶åæœ¬åœ°å‘½ä»¤è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">$ docker login$ docker push yourhubname/docker-whale<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ·»åŠ ä¸€ä¸ª tag</p><pre class="line-numbers language-none"><code class="language-none">$ docker tag &lt;imageId&gt;[&lt;imageName&gt;] yourhubname/docker-whale:latest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4-åˆ é™¤-image">4. åˆ é™¤ image</h4><pre class="line-numbers language-none"><code class="language-none">$ docker rmi &lt;imageID&gt;[&lt;imageName&gt;]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DevOps </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown ä¹¦å†™æ–¹å¼</title>
      <link href="/2016/07/14/markdown-shu-xie-fang-shi/"/>
      <url>/2016/07/14/markdown-shu-xie-fang-shi/</url>
      
        <content type="html"><![CDATA[<ol><li><p>æ–œä½“<br><code>_content_</code></p></li><li><p>ç²—ä½“<br><code>**content**</code></p></li><li><p>header<br><code>#(number) ä»£è¡¨header number</code></p></li></ol><pre class="line-numbers language-none"><code class="language-none">###This is header 3.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>é“¾æ¥<br><code>[text context](url)</code></li></ol><pre class="line-numbers language-none"><code class="language-none">[Search for it.](www.google.com)[You're *really, really* going to want to see this](www.dailykitten.com).<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="5"><li>å›¾ç‰‡<br><code>![text](url)</code></li></ol><pre class="line-numbers language-none"><code class="language-none">![A Catburn](http://octodex.github.com/images/octdrey-catburn.jpg)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="6"><li>reference</li></ol><blockquote><p>Do you want to [see something fun][a fun place]?<br>Well, do I have [the website for you][another fun place]!<br>[a fun place]: <a href="http://www.zombo.com">www.zombo.com</a><br>[another fun place]: <a href="http://www.stumbleupon.com">www.stumbleupon.com</a></p><p>![The first father][First Father]<br>![The second first father][Second Father]<br>[First Father]: <a href="http://octodex.github.com/images/founding-father.jpg">http://octodex.github.com/images/founding-father.jpg</a><br>[Second Father]: <a href="http://octodex.github.com/images/foundingfather_v2.png">http://octodex.github.com/images/foundingfather_v2.png</a></p></blockquote><ol start="7"><li><p>Blockquotes</p><p><code>&gt; paragraph </code></p></li><li><p>åˆ—è¡¨<br>æ— åºåˆ—è¡¨ <code>* content</code><br>æœ‰åºåˆ—è¡¨ <code>1. content</code><br>åµŒå¥—åˆ—è¡¨ <code>&lt;ç©ºæ ¼&gt;* content</code></p></li><li><p>æ¢è¡Œ<br>hardï¼ˆé—´è·å¤§ï¼‰ ç©ºä¸€è¡Œ<br>softï¼ˆé—´è·å°ï¼‰ ç»“å°¾ç”¨ä¸¤ä¸ªç©ºæ ¼</p></li><li><p>ç”»è¡¨æ ¼</p></li></ol><pre class="line-numbers language-none"><code class="language-none">| Number     | Next number | Previous number || :--------- |:----------- | :-------------- || Five       | Six         | Four            || Ten        | Eleven      | Nine            || Seven      | Eight       | Six             || Two        | Three       | One             |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="11"><li>ä»£ç ä¹¦å†™</li></ol><pre class="line-numbers language-none"><code class="language-none">```code```<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…</p><pre class="line-numbers language-none"><code class="language-none">~~~code~~~<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¯¦æƒ…å¯è§<a href="http://www.markdowntutorial.com/">markdown tutorial</a></p>]]></content>
      
      
      <categories>
          
          <category> è½»é‡å‹æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è½»é‡å‹æ–‡æ¡£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java S3 Example</title>
      <link href="/2016/06/24/java-s3-example/"/>
      <url>/2016/06/24/java-s3-example/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å¬äº†ä¸€æ¬¡äº®å“¥ä»–ä»¬AWSçš„é¦–æ¬¡sessionï¼Œä¸­é—´ç¨å¾®æåˆ°äº†ä¸€ä¸‹IAM accountçš„access keyã€‚æ²¡æƒ³åˆ°åœ¨é¡¹ç›®ä¸­ç»™åˆ«äººcode reviewçš„æ—¶å€™å°±æ¥è§¦åˆ°äº†ï¼Œæ˜¯é’ˆå¯¹AWS S3çš„ã€‚å…·ä½“S3è¯´æ˜ï¼Œè§ <a href="http://aws.amazon.com/s3/">http://aws.amazon.com/s3/</a></p><hr><h2 id="Setting-up-project">Setting up project</h2><p>1. AWS SDK for Java</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.amazonaws<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aws-java-sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2. ä½¿ç”¨ä¸€ä¸ªIAM accountï¼Œå¦‚æœæ²¡æœ‰åˆ›å»ºä¸€ä¸ªï¼Œè·å–åˆ°å®ƒçš„â€œAccess keyâ€å’Œâ€œSecret Access Keyâ€ã€‚</p><h2 id="Authenticate-with-Amazon-S3">Authenticate with Amazon S3</h2><p>1. ä½¿ç”¨Access Keyè¿›è¡ŒéªŒè¯</p><p>1ï¼‰ ç¯å¢ƒå˜é‡Environment Variables â€“ AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY.</p><p>2ï¼‰ Java System Properties â€“ aws.accessKeyId and aws.secretKey.</p><p>3ï¼‰ é»˜è®¤ç”¨æˆ·ä¸‹profilesæ–‡ä»¶ï¼Œ ~/.aws/credentials</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">[default]aws_access_key_id={YOUR_ACCESS_KEY_ID}aws_secret_access_key={YOUR_SECRET_ACCESS_KEY}[profile2]...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4ï¼‰ ä»£ç ä¸­ç›´æ¥å¡«å†™</p><p>å‰ä¸‰ç§ä½¿ç”¨éªŒè¯é“¾ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">AmazonS3</span> s3Client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AmazonS3Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//or</span><span class="token comment">//The following line of code is effectively equivalent to the preceding example:</span><span class="token class-name">AmazonS3</span> s3Client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AmazonS3Client</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultAWSCredentialsProviderChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬å››ç§ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">AWSCredentials</span> credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicAWSCredentials</span><span class="token punctuation">(</span><span class="token string">"YourAccessKeyID"</span><span class="token punctuation">,</span> <span class="token string">"YourSecretAccessKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">AmazonS3</span> s3client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AmazonS3Client</span><span class="token punctuation">(</span>credentials<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>2. ä»AWS Security Token Service (<a href="http://aws.amazon.com/documentation/iam/">AWS STS</a>) è·å–ä¸´æ—¶è¯ä¹¦ï¼Œè§<a href="http://docs.aws.amazon.com/AWSSdkDocsJava/latest/DeveloperGuide/prog-services-sts.html?highlight=awssecuritytokenserviceclient">Document</a></p><h2 id="SDK-Example">SDK Example</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>auth<span class="token punctuation">.</span></span><span class="token class-name">AWSCredentials</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>auth<span class="token punctuation">.</span></span><span class="token class-name">BasicAWSCredentials</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span></span><span class="token class-name">AmazonS3</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span></span><span class="token class-name">AmazonS3Client</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Bucket</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">CannedAccessControlList</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ObjectMetadata</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PutObjectRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">S3ObjectSummary</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AmazonS3Example</span> <span class="token punctuation">{</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SUFFIX</span> <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// credentials object identifying user for authentication</span><span class="token comment">// user must have AWSConnector and AmazonS3FullAccess for </span><span class="token comment">// this example to work</span><span class="token class-name">AWSCredentials</span> credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicAWSCredentials</span><span class="token punctuation">(</span><span class="token string">"YourAccessKeyID"</span><span class="token punctuation">,</span> <span class="token string">"YourSecretAccessKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// create a client connection based on credentials</span><span class="token class-name">AmazonS3</span> s3client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AmazonS3Client</span><span class="token punctuation">(</span>credentials<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// create bucket - name must be unique for all S3 users</span><span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">"javatutorial-net-example-bucket"</span><span class="token punctuation">;</span>s3client<span class="token punctuation">.</span><span class="token function">createBucket</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// list buckets</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Bucket</span> bucket <span class="token operator">:</span> s3client<span class="token punctuation">.</span><span class="token function">listBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" - "</span> <span class="token operator">+</span> bucket<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// create folder into bucket</span><span class="token class-name">String</span> folderName <span class="token operator">=</span> <span class="token string">"testfolder"</span><span class="token punctuation">;</span><span class="token function">createFolder</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> folderName<span class="token punctuation">,</span> s3client<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// upload file to folder and set it to public</span><span class="token class-name">String</span> fileName <span class="token operator">=</span> folderName <span class="token operator">+</span> <span class="token constant">SUFFIX</span> <span class="token operator">+</span> <span class="token string">"testvideo.mp4"</span><span class="token punctuation">;</span>s3client<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PutObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\user\\Desktop\\testvideo.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withCannedAcl</span><span class="token punctuation">(</span><span class="token class-name">CannedAccessControlList<span class="token punctuation">.</span>PublicRead</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">deleteFolder</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> folderName<span class="token punctuation">,</span> s3client<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// deletes bucket</span>s3client<span class="token punctuation">.</span><span class="token function">deleteBucket</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createFolder</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> folderName<span class="token punctuation">,</span> <span class="token class-name">AmazonS3</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// create meta-data for your folder and set content-length to 0</span><span class="token class-name">ObjectMetadata</span> metadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>metadata<span class="token punctuation">.</span><span class="token function">setContentLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// create empty content</span><span class="token class-name">InputStream</span> emptyContent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// create a PutObjectRequest passing the folder name suffixed by /</span><span class="token class-name">PutObjectRequest</span> putObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PutObjectRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span>folderName <span class="token operator">+</span> <span class="token constant">SUFFIX</span><span class="token punctuation">,</span> emptyContent<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// send request to S3 to create folder</span>client<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>putObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/** * This method first deletes all the files in given folder and than the * folder itself */</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deleteFolder</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> folderName<span class="token punctuation">,</span> <span class="token class-name">AmazonS3</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">List</span> fileList <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">listObjects</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> folderName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getObjectSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">S3ObjectSummary</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>client<span class="token punctuation">.</span><span class="token function">deleteObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>client<span class="token punctuation">.</span><span class="token function">deleteObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> folderName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> AWS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Groovy è¯­æ³•å°ç»“</title>
      <link href="/2016/02/22/goovy-yu-fa-xiao-jie/"/>
      <url>/2016/02/22/goovy-yu-fa-xiao-jie/</url>
      
        <content type="html"><![CDATA[<p>1. å®‰å…¨å¯¼èˆªæ“ä½œç¬¦ ?.,åªæœ‰å¯¹è±¡å¼•ç”¨ä¸ä¸ºç©ºæ—¶æ‰ä¼šåˆ†æ´¾è°ƒç”¨ã€‚</p><pre class="line-numbers language-none"><code class="language-none">def&nbsp;aa?.isEmpty()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>2. groovyä¸å¼ºè¿«æ•è·æˆ‘ä»¬ä¸å…³å¿ƒçš„å¼‚å¸¸ã€‚</p><p>æ•è·æ‰€æœ‰Exception</p><pre class="line-numbers language-none"><code class="language-none">try{}catch(ex){}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>3. groovyé»˜è®¤éƒ½æ˜¯publicçš„ã€‚</p><p>4. groovyé»˜è®¤æä¾›æ„é€ å™¨ã€‚</p><pre class="line-numbers language-none"><code class="language-none">class&nbsp;Robot{&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;type,&nbsp;height,&nbsp;width}&nbsp;robot&nbsp;=&nbsp;new&nbsp;Robot(type:&nbsp;'arm',&nbsp;width:&nbsp;10,&nbsp;height:&nbsp;40)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>5. groovyä¼ å‚</p><p>å‡ºç°é”®å€¼å¯¹çš„å½¢å¼ï¼Œgroovyä¼šå°†æ‰€æœ‰é”®å€¼å¯¹ä½œä¸ºç¬¬ä¸€ä¸ªå½¢å‚ï¼ˆMapï¼‰çš„Entryï¼Œå…¶ä½™å‚æ•°æŒ‰é¡ºåºèµ‹ç»™å‰©ä½™å½¢å‚ã€‚</p><pre class="line-numbers language-none"><code class="language-none">class&nbsp;Robot{&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;access(location,&nbsp;weight,&nbsp;fragile){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;"$fragile,&nbsp;$weight,&nbsp;$location"&nbsp;&nbsp;&nbsp;&nbsp;}}robot.access(x:&nbsp;30,&nbsp;y:&nbsp;20,&nbsp;z:10,&nbsp;5,&nbsp;true)//å¯æ”¹å˜é¡ºåºrobot.access(5,&nbsp;true,&nbsp;x:&nbsp;30,&nbsp;y:&nbsp;20,&nbsp;z:10)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼šä½¿ç”¨é”®å€¼å¯¹ä¼ å‚ï¼Œæœ€å¥½æ˜¯å½“å‚æ•°ä»…æœ‰ä¸€ä¸ªMapæ—¶ä½¿ç”¨ï¼›</p><p>å¦‚æœä¸€å®šè¦ä½¿ç”¨ä¸€ä¸ªMap + å¤šä¸ªå‚æ•°ä¼ é€’çš„å½¢å¼ï¼Œè¯·æ˜¾ç¤ºå£°æ˜Mapç±»å‹ã€‚</p><pre class="line-numbers language-none"><code class="language-none">class&nbsp;Robot{&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;access(Map&nbsp;location,&nbsp;weight,&nbsp;fragile){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;"$fragile,&nbsp;$weight,&nbsp;$location"&nbsp;&nbsp;&nbsp;&nbsp;}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“å®å‚åŒ…å«çš„ä¸æ˜¯ä¸¤ä¸ªå¯¹è±¡å’Œä¸€ä¸ªä»»æ„é”®å€¼å¯¹ï¼Œä»£ç å°±ä¼šæŠ¥é”™ã€‚</p><p>6. å¯é€‰å½¢å‚, æ–¹æ³•å¯ä»¥ä¸ç”¨å†å†™é‡è½½</p><pre class="line-numbers language-none"><code class="language-none">def&nbsp;log(x,&nbsp;base&nbsp;=&nbsp;10){&nbsp;&nbsp;&nbsp;&nbsp;Math.log(x)&nbsp;/&nbsp;Math.log(base)}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>6.1 å˜é•¿ä¼ å‚</p><p>æœ€åä¸€ä½å½¢å‚æ˜¯æ•°ç»„å½¢å¼</p><pre class="line-numbers language-none"><code class="language-none">def&nbsp;receiveVarArgs(int&nbsp;a,&nbsp;int...&nbsp;b){}def&nbsp;receiveVarArg(int&nbsp;a,&nbsp;int[]&nbsp;b){}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼šGroovyå°† [2, 3]çœ‹ä½œæ˜¯ArrayListçš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå› æ­¤è°ƒç”¨æ—¶ï¼š</p><pre class="line-numbers language-none"><code class="language-none">receiveVarArgsï¼ˆ1ï¼Œ&nbsp;[2,&nbsp;3,&nbsp;4]&nbsp;as&nbsp;int[]ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯å‚è€ƒGroovyåˆ›å»ºæ•°ç»„ã€åˆ—è¡¨çš„åŒºåˆ«ï¼š</p><pre class="line-numbers language-none"><code class="language-none">int[]&nbsp;arr&nbsp;=&nbsp;[1,&nbsp;2,&nbsp;3]def&nbsp;arr1&nbsp;=&nbsp;[1,&nbsp;2,&nbsp;3]&nbsp;as&nbsp;int[]def&nbsp;arr2&nbsp;=&nbsp;[1,&nbsp;2,&nbsp;3]&nbsp;//ArrayListç±»å‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>7. å¤šèµ‹å€¼ã€‚è¿”å›æ•°ç»„ï¼Œè¢«å¤šèµ‹å€¼ç»™å„ä¸ªå˜é‡ã€‚</p><p>ç­‰å·å·¦è¾¹å˜é‡å¤šçš„ï¼Œå°†è®¾ä¸ºnullï¼ˆä¸èƒ½é»˜è®¤nullçš„ï¼ŒæŠ›å¼‚å¸¸ï¼‰ï¼Œå³è¾¹å€¼å¤šçš„ï¼Œå°†ä¸¢å¼ƒã€‚</p><pre class="line-numbers language-none"><code class="language-none">def&nbsp;splitName(fullName){fullName.split('&nbsp;')}def&nbsp;(firstName,&nbsp;lastName)&nbsp;=&nbsp;splitName('James&nbsp;Bond')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤å¯ä»¥å»¶ä¼¸ä¸ºäº¤æ¢å˜é‡</p><pre class="line-numbers language-none"><code class="language-none">def&nbsp;a&nbsp;=&nbsp;1def&nbsp;b&nbsp;=&nbsp;2(a,&nbsp;b)&nbsp;=&nbsp;[b,&nbsp;a]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>8. å®ç°æ¥å£</p><p>ä¸€æ¥å£ï¼Œå•æ–¹æ³•</p><pre class="line-numbers language-none"><code class="language-none">def&nbsp;diaplyMouseLocation&nbsp;=&nbsp;{positionLabel.setText("$it.x,&nbsp;$it.y")}frame.addMouseListener(diaplyMouseLocation&nbsp;as&nbsp;MouseListener)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸€æ¥å£ï¼Œå¤šæ–¹æ³•</p><pre class="line-numbers language-none"><code class="language-none">def&nbsp;handleFocus&nbsp;=&nbsp;[&nbsp;&nbsp;&nbsp;&nbsp;focusGained&nbsp;:&nbsp;{}&nbsp;&nbsp;&nbsp;&nbsp;focusLost&nbsp;:&nbsp;{}]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åŠ¨æ€å®ç°æ¥å£ï¼Œ asType()ä½œä¸ºä»€ä¹ˆçš„æ¥å£å®ç°</p><pre class="line-numbers language-none"><code class="language-none">events&nbsp;=&nbsp;['WindowListener',&nbsp;'ComponentListener']//å¯ä»¥æ˜¯æ›´åŠ¨æ€çš„ä¸€äº›è¾“å…¥handler&nbsp;=&nbsp;{msgLabel.setText("$it")}for(event&nbsp;in&nbsp;events){&nbsp;&nbsp;&nbsp;&nbsp;handlerImpl&nbsp;=&nbsp;handler.asType(Class.forName("java.awt.event.${event}"))&nbsp;&nbsp;&nbsp;&nbsp;frame."add${event}"(handlerImpl)}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>9. é»˜è®¤å¸ƒå°”å¤„ç†</p><p>groovyåŸºæœ¬éƒ½ä¸ºå¯¹è±¡ï¼Œé™¤å¼•ç”¨å¯¹è±¡ä¸ä¸ºç©ºä¸ºtrueå¤–ï¼Œæœ‰äº›å¯¹è±¡è¿˜æœ‰å¦‚ä¸‹æƒ…å†µä¹Ÿä¸ºtrueã€‚</p><p>| Boolean | å€¼ä¸ºtrue |<br>| Collection | ä¸ä¸ºç©º |<br>| Map | æ˜ å°„ä¸ä¸ºç©º |<br>| Char | ä¸ä¸º0 |<br>| å­—ç¬¦ä¸² | é•¿åº¦å¤§äº0 |<br>| æ•°å­— | ä¸ä¸º0 |<br>| æ•°ç»„ | é•¿åº¦å¤§äº0 |<br>| å…¶ä»–ç±»å‹ | ä¸ä¸ºnull |<br>| è‡ªå®šåˆ¶ | é€šè¿‡asBoolean()æ–¹æ³•æ¥é‡å†™ |</p><p>10. forEach</p><pre class="line-numbers language-none"><code class="language-none">for(String&nbsp;greet&nbsp;:&nbsp;greetings){}for(def&nbsp;greet&nbsp;:&nbsp;greetings){}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸æƒ³æŒ‡å®šç±»å‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">for(greet&nbsp;in&nbsp;greetings){}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€… å†…éƒ¨è¿­ä»£å™¨ each()</p><p>10. é™æ€å¯¼å…¥æ”¯æŒåˆ«å</p><pre class="line-numbers language-none"><code class="language-none">import&nbsp;static&nbsp;Math.random&nbsp;as&nbsp;randdouble&nbsp;value&nbsp;=&nbsp;rand()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>11. javaçš„ç¼–è¯‘æ—¶æ³¨è§£è¢«å¿½ç•¥ï¼Œå¦‚Overrideã€‚</p><p>12. groovyæ—¢æ”¯æŒåŠ¨æ€ç±»å‹ï¼Œåˆæ”¯æŒæ³›å‹ã€‚æ³›å‹åœ¨æ‰§è¡Œæ—¶è¿›è¡Œæ£€æŸ¥ç”Ÿæ•ˆã€‚</p><p>13. Groovyå¯ä»¥é‡è½½æ“ä½œç¬¦ï¼Œå› ä¸ºæ¯ä¸ªæ“ä½œç¬¦éƒ½è¢«æ˜ å°„åˆ°ä¸€ä¸ªæ ‡å‡†çš„æ–¹æ³•ã€‚</p><p>14. ä½¿ç”¨æ³¨è§£ç”Ÿæˆä»£ç </p><p><a href="http://my.oschina.net/u/2345489">@Canonical</a> æ ‡æ³¨äºç±»ä¸Šï¼Œç”¨äºç”ŸæˆtoString():é€—å·åˆ†éš”å„å±æ€§ï¼Œå¯æ’é™¤å±æ€§</p><pre class="line-numbers language-none"><code class="language-none">@Canonical(excludes='lastName,&nbsp;age')class&nbsp;Person{}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="http://my.oschina.net/delegate">@Delegate</a> ç”¨äºå¼•å…¥è¢«å§”æ‰˜ç±»ç›¸åº”çš„æ–¹æ³•åŒ…è£…å™¨ï¼Œç”¨äºå§”æ´¾ä»»åŠ¡ã€‚å¼•å…¥çš„å…·ä½“å®ä¾‹æ–¹æ³•ä¸é¡ºåºæœ‰å…³ã€‚</p><p>æŸ¥æ‰¾è¿˜æœªæœ‰çš„æ–¹æ³•è¿›è¡Œä¸€æ¬¡å¼•å…¥ã€‚</p><pre class="line-numbers language-none"><code class="language-none">class&nbsp;Worker{&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;work(){}&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;analyze(){}}class&nbsp;Expert{&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;analyze(){}}class&nbsp;Manager{&nbsp;&nbsp;&nbsp;&nbsp;@Delegate&nbsp;Expert&nbsp;expert&nbsp;=&nbsp;new&nbsp;Expert()//å¼•å…¥Expertå®ä¾‹çš„analyzeæ–¹æ³•&nbsp;&nbsp;&nbsp;&nbsp;@Delegate&nbsp;Worker&nbsp;worker&nbsp;=&nbsp;new&nbsp;Worker()//å¼•å…¥Workerå®ä¾‹çš„workæ–¹æ³•}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>@Immutable æ ‡æ³¨åœ¨ç±»ä¸Šï¼Œç”¨äºä¾¿æ·ç”Ÿæˆä¸å¯å˜å€¼å¯¹è±¡ï¼Œå³å±æ€§finalã€‚åŒæ—¶æä¾›hashCode()ã€equals()ã€toString()æ–¹æ³•ã€‚</p><pre class="line-numbers language-none"><code class="language-none">@Immutableclass&nbsp;CreditCard{&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cardNumber&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;creditLimit}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="http://my.oschina.net/u/145675">@Lazy</a> æ ‡æ³¨äºå±æ€§ä¸Šï¼Œæ‡’åŠ è½½</p><pre class="line-numbers language-none"><code class="language-none">class&nbsp;Heavy{}class&nbsp;AsNeeded&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;@Lazy&nbsp;Heavy&nbsp;heavy&nbsp;=&nbsp;new&nbsp;Heavy()}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><a href="http://my.oschina.net/u/674">@Singleton</a> æ ‡æ³¨äºç±»ä¸Šï¼Œå®ç°å•ä¾‹æ¨¡å¼</p><pre class="line-numbers language-none"><code class="language-none">@Singleton(lazy&nbsp;=&nbsp;true)class&nbsp;TheUnique{}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>15. ==</p><p>== ç­‰äºè°ƒç”¨javaçš„equals()ï¼Œé™¤éå®ç°Comparableæ¥å£çš„ç±»å‹ï¼Œ== ç­‰äºcompareTo()</p><p>is()ç­‰äºjavaçš„==</p><p>16. groovyåŒ¿åå†…éƒ¨ç±»ä½¿ç”¨å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œä¼šå°†{â€¦â€¦}å®ç°ä½“å½“åšé—­åŒ…ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Groovy </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Groovy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jasmine åŸºç¡€ API</title>
      <link href="/2015/12/16/jasmine-ji-chu-api/"/>
      <url>/2015/12/16/jasmine-ji-chu-api/</url>
      
        <content type="html"><![CDATA[<h4 id="1-Jasmineå®˜ç½‘documenåœ°å€">1.  Jasmineå®˜ç½‘documenåœ°å€</h4><p><a href="http://jasmine.github.io/2.4/introduction.html">http://jasmine.github.io/2.4/introduction.html</a></p><h4 id="2-ä¸‹è½½å‘å¸ƒåŒ…ï¼Œå‚ç…§ç¤ºä¾‹è¿›è¡Œä½¿ç”¨">2.  ä¸‹è½½å‘å¸ƒåŒ…ï¼Œå‚ç…§ç¤ºä¾‹è¿›è¡Œä½¿ç”¨</h4><p>github ä¸Šä¸‹è½½æœ€æ–°çš„ Release çš„ zip åŒ…ï¼Œæœ¬åœ°è§£å‹åæ‰“å¼€ï¼šSpecRunner.html(è¿è¡Œæ–‡ä»¶)ã€srcï¼ˆjsæºæ–‡ä»¶å¤¹ï¼‰ã€specï¼ˆjsæµ‹è¯•æ–‡ä»¶å¤¹ï¼‰ã€libï¼ˆjasmineä¾èµ–çš„jsåº“ï¼‰</p><h4 id="3-æ‰“å¼€SpecRunner-htmlæ–‡ä»¶ï¼Œåœ¨æ³¨é‡Šè¯´æ˜çš„ç›¸åº”ä½ç½®æ·»åŠ æºæ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶ã€‚">3.  æ‰“å¼€SpecRunner.htmlæ–‡ä»¶ï¼Œåœ¨æ³¨é‡Šè¯´æ˜çš„ç›¸åº”ä½ç½®æ·»åŠ æºæ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶ã€‚</h4><pre class="line-numbers language-none"><code class="language-none">&lt;!DOCTYPE&nbsp;html&gt;&lt;html&gt;&lt;head&gt;&nbsp;&nbsp;&lt;meta&nbsp;charset="utf-8"&gt;&nbsp;&nbsp;&lt;title&gt;Jasmine&nbsp;Spec&nbsp;Runner&nbsp;v2.3.4&lt;/title&gt;&nbsp;&nbsp;&lt;link&nbsp;rel="shortcut&nbsp;icon"&nbsp;type="image/png"&nbsp;href="lib/jasmine-2.3.4/jasmine_favicon.png"&gt;&nbsp;&nbsp;&lt;link&nbsp;rel="stylesheet"&nbsp;href="lib/jasmine-2.3.4/jasmine.css"&gt;&nbsp;&nbsp;&lt;script&nbsp;src="lib/jasmine-2.3.4/jasmine.js"&gt;&lt;/script&gt;&nbsp;&nbsp;&lt;script&nbsp;src="lib/jasmine-2.3.4/jasmine-html.js"&gt;&lt;/script&gt;&nbsp;&nbsp;&lt;script&nbsp;src="lib/jasmine-2.3.4/boot.js"&gt;&lt;/script&gt;&nbsp;&nbsp;&lt;!--&nbsp;include&nbsp;source&nbsp;files&nbsp;here...&nbsp;--&gt;&nbsp;&nbsp;&lt;script&nbsp;src="src/Player.js"&gt;&lt;/script&gt;&nbsp;&nbsp;&lt;script&nbsp;src="src/Song.js"&gt;&lt;/script&gt;&nbsp;&nbsp;&lt;!--&nbsp;include&nbsp;spec&nbsp;files&nbsp;here...&nbsp;--&gt;&nbsp;&nbsp;&lt;script&nbsp;src="spec/SpecHelper.js"&gt;&lt;/script&gt;&nbsp;&nbsp;&lt;script&nbsp;src="spec/PlayerSpec.js"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-spec-jsæ–‡ä»¶åŸºæœ¬æ ¼å¼">4.  spec.jsæ–‡ä»¶åŸºæœ¬æ ¼å¼</h4><pre class="line-numbers language-none"><code class="language-none">describe("A&nbsp;suite&nbsp;is&nbsp;just&nbsp;a&nbsp;function",&nbsp;function()&nbsp;{&nbsp;&nbsp;var&nbsp;a;&nbsp;&nbsp;it("and&nbsp;so&nbsp;is&nbsp;a&nbsp;spec",&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;true;&nbsp;&nbsp;&nbsp;&nbsp;expect(a).toBe(true);&nbsp;&nbsp;});});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>describe\itéƒ½æ˜¯functionï¼Œdescribeç”¨æ¥å®šä¹‰spec suiteï¼Œitç”¨æ¥å®šä¹‰specã€‚</p><p>ç¬¬ä¸€ä¸ªå‚æ•°éƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªä¸ºæµ‹è¯•å—ã€‚</p><blockquote><p>describeï¼šâ€œThe string is a name or title for a spec suite â€“ usually what is being tested. The function is a block of code that implements the suite.â€</p><p>itï¼šâ€œThe string is the title of the spec and the function is the spec, or test. A spec contains one or more expectations that test the state of the code. An expectation in Jasmine is an assertion that is either true or false.&nbsp;â€</p></blockquote><h4 id="5-åŸºç¡€APIçš„ä½¿ç”¨">5.  åŸºç¡€APIçš„ä½¿ç”¨</h4><p><strong>Matcher</strong>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">expect().toBe();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//åŒ===expect().not.toBe();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ‰€æœ‰çš„æ–­è¨€éƒ½å¯ç”¨notå–åexpect().toEqual();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//å¯æ¯”è¾ƒå­—é¢é‡æˆ–è€…å˜é‡æŒ‡å‘çš„å¯¹è±¡å†…å®¹expect().toMatch(/bar/);&nbsp;&nbsp;&nbsp;&nbsp;//æ­£åˆ™expect().toBeDefined();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ˜¯å¦è¢«å®šä¹‰ï¼Œæœªå®šä¹‰æ˜¯undefinedexpect().toBeUndefined();&nbsp;&nbsp;&nbsp;//æ˜¯å¦æœªå®šä¹‰expect().toBeNull();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ˜¯å¦æ˜¯nullexpect().toBeTruthy();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ˜¯å¦ä¸ºtruthyexpect().toBeFalsy();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ˜¯å¦æœªfalsyexpect().toContain();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ•°ç»„æ˜¯å¦åŒ…å«æŸå…ƒç´ ,åŸºä¸equalså¯¹æ¯”expect().toBeLessThan();&nbsp;&nbsp;&nbsp;&nbsp;//å°äºæŸå€¼,&nbsp;å¯æ¯”è¾ƒæ•°å­—ã€å­—ç¬¦ä¸²ã€æ—¶é—´expect().toBeGreaterThan();&nbsp;//å¤§äºæŸå€¼expect().toBeCloseTo(,&nbsp;0);&nbsp;&nbsp;//æ ¹æ®ç¬¬äºŒä½å‚æ•°æ‰€ç»™çš„ç²¾åº¦ï¼Œä¿ç•™ç›¸åº”ç²¾åº¦ï¼Œå…¶åâ€œRound_half_downâ€ï¼Œæ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰expect(fn1).toThrow()ï¼›&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ–­è¨€fn1è¿è¡Œä¼šæŠ›å‡ºå¼‚å¸¸//æ–­è¨€fn1è¿è¡Œä¼šæŠ›å‡ºå…·ä½“å¼‚å¸¸expect(fn1).toThrowError("foo&nbsp;bar&nbsp;baz");&nbsp;&nbsp;&nbsp;&nbsp;expect(fn1).toThrowError(/bar/);expect(fn1).toThrowError(TypeError);expect(fn1).toThrowError(TypeError,&nbsp;"foo&nbsp;bar&nbsp;baz");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ‰‹åŠ¨å¤±è´¥</strong>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">fail("Callback&nbsp;has&nbsp;been&nbsp;called");<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Setup and Teardown</strong>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">beforeEach,&nbsp;afterEach,&nbsp;beforeAll,&nbsp;afterAll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨åµŒå¥—describeçš„æƒ…å†µï¼Œåœ¨itä¹‹å‰ä¼šæŒ‰ç…§ç”±å¤–é å†…çš„é¡ºåºæ‰§è¡ŒbeforeEachï¼Œç»“æŸååˆç”±å†…åˆ°å¤–æ‰§è¡ŒafterEachã€‚</p><p><strong>this</strong>ï¼š</p><p>åœ¨ä¸€ä¸ªspecçš„beforeEach/it/afterEachèŒƒå›´å†…æœ‰æ•ˆåˆ†äº«å¯¹è±¡çš„æ–¹å¼ã€‚</p><p>â€œEach specâ€™s<code>beforeEach</code>/<code>it</code>/<code>afterEach</code>&nbsp;has the&nbsp;<code>this</code>&nbsp;as the same empty object that is set back to empty for the next specâ€™s&nbsp;<code>beforeEach</code>/<code>it</code>/<code>afterEach</code>.â€</p><pre class="line-numbers language-none"><code class="language-none">describe("A&nbsp;spec",&nbsp;function()&nbsp;{&nbsp;&nbsp;beforeEach(function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;this.foo&nbsp;=&nbsp;0;&nbsp;&nbsp;});&nbsp;&nbsp;it("can&nbsp;use&nbsp;the&nbsp;`this`&nbsp;to&nbsp;share&nbsp;state",&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;expect(this.foo).toEqual(0);&nbsp;&nbsp;&nbsp;&nbsp;this.bar&nbsp;=&nbsp;"test&nbsp;pollution?";&nbsp;&nbsp;});&nbsp;&nbsp;it("prevents&nbsp;test&nbsp;pollution&nbsp;by&nbsp;having&nbsp;an&nbsp;empty&nbsp;`this`&nbsp;created&nbsp;for&nbsp;the&nbsp;next&nbsp;spec",&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;expect(this.foo).toEqual(0);&nbsp;&nbsp;&nbsp;&nbsp;expect(this.bar).toBe(undefined);&nbsp;&nbsp;});});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Disabling Suites</strong>:</p><pre class="line-numbers language-none"><code class="language-none">xdescribe("A&nbsp;spec",&nbsp;function()&nbsp;{});<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Pending Specs</strong>:</p><p>â€œPending specs do not run, but their names will show up in the results as<code>pending</code>â€ã€‚ä¸”æ–¹æ³•å†…çš„ä¸€åˆ‡æ–­è¨€å°†è¢«å¿½è§†ã€‚</p><pre class="line-numbers language-none"><code class="language-none">//ä¸‰ç§æ–¹å¼xit("can&nbsp;be&nbsp;declared&nbsp;'xit'",&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;expect(true).toBe(false);&nbsp;&nbsp;});&nbsp;&nbsp;it("can&nbsp;be&nbsp;declared&nbsp;with&nbsp;'it'&nbsp;but&nbsp;without&nbsp;a&nbsp;function");//è¯¥æ–¹æ³•å†…éƒ¨è°ƒç”¨äº†pendingï¼Œå°†æ ‡è®°ä¸ºpendingæ–¹æ³•ï¼Œå‚æ•°ä¼ è¾¾pendingåŸå› ã€‚it("can&nbsp;be&nbsp;declared&nbsp;by&nbsp;calling&nbsp;'pending'&nbsp;in&nbsp;the&nbsp;spec&nbsp;body",&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;expect(true).toBe(false);&nbsp;&nbsp;&nbsp;&nbsp;pending('this&nbsp;is&nbsp;why&nbsp;it&nbsp;is&nbsp;pending');&nbsp;&nbsp;});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Spies</strong>:</p><p>â€œ&nbsp;A spy can stub any function and tracks calls to it and all arguments.&nbsp;â€</p><pre class="line-numbers language-none"><code class="language-none">spyOn(foo,&nbsp;'setBar');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//åˆ›å»ºspyï¼Œå¹¶æ‹¦æˆªå¯¹æ–¹æ³•çš„è°ƒç”¨spyOn(foo,&nbsp;'getBar').and.callThrough();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//åˆ›å»ºspyï¼Œå¹¶ä»£ç†çœŸå®æ–¹æ³•çš„è°ƒç”¨//åˆ›å»ºspyï¼Œå¹¶æ‹¦æˆªç»“æœçš„è¿”å›ï¼Œç»™äºˆç»“æœå®šä¹‰ã€‚æ‰€æœ‰çš„è¿”å›ç»“æœè¢«æ›¿æ¢ã€‚spyOn(foo,&nbsp;"getBar").and.returnValue(745);&nbsp;&nbsp;&nbsp;//åˆ›å»ºspyï¼Œå¹¶æ‹¦æˆªç»“æœçš„è¿”å›ï¼ŒæŒ‰ç…§è°ƒç”¨é¡ºåºç»™äºˆç»“æœå®šä¹‰spyOn(foo,&nbsp;"getBar").and.returnValues("fetched&nbsp;first",&nbsp;"fetched&nbsp;second");&nbsp;//fakeä¸€ä¸ªæ–¹æ³•spyOn(foo,&nbsp;"getBar").and.callFake(function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1001;&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spyOn(foo,&nbsp;"setBar").and.throwError("quux");&nbsp;&nbsp;//æ‰€æœ‰çš„è°ƒç”¨å°†æŠ›å‡ºå¼‚å¸¸//and.stub(),fakeä¸€ä¸ªç©ºæ–¹æ³•ä½“spyOn(foo,&nbsp;'setBar');foo.setBar.and.stub();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>jasmine.createSpy</strong></p><pre class="line-numbers language-none"><code class="language-none">whatAmI&nbsp;=&nbsp;jasmine.createSpy('whatAmI');&nbsp;&nbsp;&nbsp;&nbsp;//åˆ›å»ºä¸€ä¸ªæ–¹æ³•ç”¨äºspyï¼Œä¸éœ€è¦è¯¥æ–¹æ³•å·²ç»å®šä¹‰,&nbsp;contextä¸ºå®šä¹‰æ—¶çš„ä¸Šä¸‹æ–‡tape&nbsp;=&nbsp;jasmine.createSpyObj(['play',&nbsp;'pause',&nbsp;'stop',&nbsp;'rewind']);&nbsp;&nbsp;&nbsp;&nbsp;//åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸”å±æ€§ä¹ŸåŒæ—¶è¢«å®šä¹‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>matcherï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">expect(foo.setBar).toHaveBeenCalled();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//å·²ç»è¢«è°ƒç”¨expect(foo.setBar).toHaveBeenCalledWith(123);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//å·²ç»é€šè¿‡å‚æ•°XXè°ƒç”¨//======æœŸæœ›å€¼çš„matcher======expect(foo).toHaveBeenCalledWith(jasmine.any(Number),&nbsp;jasmine.any(Function));&nbsp;&nbsp;&nbsp;&nbsp;//jasmine.any(æ„é€ å‡½æ•°å)ï¼Œæ­¤ç±»å‹çš„ä»»ä½•å¯¹è±¡å³å¯åŒ¹é…expect(foo).toHaveBeenCalledWith(12,&nbsp;jasmine.anything());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//jasmine.anything()ï¼Œéundefined\nullçš„å³å¯åŒ¹é…expect(foo).toEqual(jasmine.objectContaining({bar:&nbsp;"baz"}));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//jasmine.objectContainingï¼ŒåŒ…å«æ­¤å±æ€§çš„å¯¹è±¡å³å¯åŒ¹é…expect(foo).toEqual(jasmine.arrayContaining([3,&nbsp;1]));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//jasmine.arrayContainingï¼ŒåŒ…å«å…¶å…ƒç´ å­é›†çš„æ•°ç»„å³å¯åŒ¹é…expect({foo:&nbsp;'bar'}).toEqual({foo:&nbsp;jasmine.stringMatching(/^bar$/)});&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//jasmine.stringMatchingï¼ŒåŒ…å«æ­¤å­—ç¬¦ä¸²åŒ¹é…æ–¹å¼çš„å³å¯åŒ¹é…ï¼ˆå‚æ•°æ–¹å¼å¯å‚è§toMatchï¼‰//è‡ªå®šä¹‰ä»»ä½•æƒ³è¦çš„æœŸæœ›åŒ¹é…ï¼šasymmetricMatchdescribe("custom&nbsp;asymmetry",&nbsp;function()&nbsp;{&nbsp;&nbsp;var&nbsp;tester&nbsp;=&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;asymmetricMatch:&nbsp;function(actual)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;secondValue&nbsp;=&nbsp;actual.split(',')[1];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;secondValue&nbsp;===&nbsp;'bar';&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;};&nbsp;&nbsp;it("dives&nbsp;in&nbsp;deep",&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;expect("foo,bar,baz,quux").toEqual(tester);&nbsp;&nbsp;});&nbsp;&nbsp;describe("when&nbsp;used&nbsp;with&nbsp;a&nbsp;spy",&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;it("is&nbsp;useful&nbsp;for&nbsp;comparing&nbsp;arguments",&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;callback&nbsp;=&nbsp;jasmine.createSpy('callback');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback('foo,bar,baz');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expect(callback).toHaveBeenCalledWith(tester);&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;&nbsp;});});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>spy.callsï¼š</strong></p><p>â€œEvery call to a spy is tracked and exposed on the&nbsp;<code>calls</code>&nbsp;property.â€ å¯¹spyçš„å®Œæ•´trackä¿¡æ¯ã€‚</p><pre class="line-numbers language-none"><code class="language-none">expect(foo.setBar.calls.any()).toEqual(false);&nbsp;//spyçš„å‡½æ•°è¢«è°ƒç”¨è‡³å°‘ä¸€æ¬¡ï¼Œåˆ™è¿”å›trueexpect(foo.setBar.calls.count()).toEqual(0);&nbsp;&nbsp;&nbsp;//spyçš„å‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°//å‡½æ•°è¢«è°ƒç”¨çš„ç´¢å¼•å¯¹åº”çš„å‚æ•°åˆ—è¡¨ï¼šfoo.setBar.calls.argsForfoo.setBar(123);foo.setBar(456,&nbsp;"baz");expect(foo.setBar.calls.argsFor(0)).toEqual([123]);expect(foo.setBar.calls.argsFor(1)).toEqual([456,&nbsp;"baz"]);//è¢«è°ƒç”¨çš„å†å²å®Œæ•´åˆ—è¡¨ï¼šfoo.setBar.calls.allArgsexpect(foo.setBar.calls.allArgs()).toEqual([[123],[456,&nbsp;"baz"]]);//trackçš„å†å²æ‰€æœ‰å®Œæ•´ä¿¡æ¯ï¼šfoo.setBar.calls.allï¼ˆæ³¨æ„æ˜¯æ•°ç»„ï¼‰expect(foo.setBar.calls.all()).toEqual([{object:&nbsp;foo,&nbsp;args:&nbsp;[123],&nbsp;returnValue:&nbsp;undefined}]);//trackçš„æœ€è¿‘ä¸€æ¬¡çš„å®Œæ•´ä¿¡æ¯ï¼šfoo.setBar.calls.mostRecentexpect(foo.setBar.calls.mostRecent()).toEqual({object:&nbsp;foo,&nbsp;args:&nbsp;[456,&nbsp;"baz"],&nbsp;returnValue:&nbsp;undefined});//trackçš„ç¬¬ä¸€æ¬¡çš„å®Œæ•´ä¿¡æ¯ï¼šfoo.setBar.calls.firstexpect(foo.setBar.calls.first()).toEqual({object:&nbsp;foo,&nbsp;args:&nbsp;[123],&nbsp;returnValue:&nbsp;undefined});expect(spy.calls.first().object).toBe(foo);&nbsp;&nbsp;&nbsp;&nbsp;//objectä¸ºè°ƒç”¨ä¸Šä¸‹æ–‡contextfoo.setBar.calls.reset();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ¸…é™¤trackå†å²è®°å½•ï¼Œé‡ç½®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Jasmine Clock</strong>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">beforeEachä¸­jasmine.clock().install();afterEachä¸­jasmine.clock().uninstall();itä¸­ä½¿ç”¨jasmine.clock().tick(101);&nbsp;è°ƒç”¨æ—¶æ¨¡æ‹Ÿæ—¶é—´å·²ç»èµ°äº†101æ¯«ç§’ï¼Œå¥½ä¼¼æ—¶é—´åŠ é€Ÿå™¨//æ¨¡æ‹Ÿç»å¯¹æ—¶é—´var&nbsp;baseTime&nbsp;=&nbsp;new&nbsp;Date(2013,&nbsp;9,&nbsp;23);jasmine.clock().mockDate(baseTime);jasmine.clock().tick(50);expect(new&nbsp;Date().getTime()).toEqual(baseTime.getTime()&nbsp;+&nbsp;50);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Asynchronous Support</strong>ï¼šdone</p><p>å¯ä½¿ç”¨åœ¨beforeEach/it/afterEachä¸­ï¼Œfunctionæ³¨å…¥doneå³å¯ã€‚æ³¨å…¥doneå£°æ˜æ­¤å¤„æœ‰å¼‚æ­¥è°ƒç”¨ï¼Œæµ‹è¯•éœ€è¦ç­‰å¾…ã€‚</p><p>å¦‚åœ¨â€œjasmine.DEFAULT_TIMEOUT_INTERVALâ€è¶…æ—¶ä¹‹å‰éƒ½æœªæœ‰è°ƒç”¨doneæ–¹æ³•ï¼Œå…¶åå°†å¤±è´¥ã€‚å¯é€šè¿‡beforeEach/afterEachçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œitçš„ç¬¬ä¸‰ä¸ªå‚æ•°å£°æ˜è¶…æ—¶æ—¶é—´ã€‚</p><pre class="line-numbers language-none"><code class="language-none">it("takes&nbsp;a&nbsp;long&nbsp;time",&nbsp;function(done)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;9000);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;10000);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> unit test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ä½¿ç”¨ AngularJS çš„è¿‡ç¨‹ä¸­äº†è§£ Promiseï¼ˆäºŒï¼‰</title>
      <link href="/2015/12/05/zai-shi-yong-angularjs-de-guo-cheng-zhong-liao-jie-promise-er/"/>
      <url>/2015/12/05/zai-shi-yong-angularjs-de-guo-cheng-zhong-liao-jie-promise-er/</url>
      
        <content type="html"><![CDATA[<p>å…¬å¸æœ€è¿‘æœ‰ä¸ªåšå®¢å¤§èµ›ï¼ŒOPç”šè‡³äº²è‡ªåœ¨team stand-upä¸Šè¦æ±‚å¤§å®¶ç§¯ææŠ•ç¨¿ã€‚å¯¹äºæˆ‘è¿™ç§çƒ­çˆ±å†™ä»£ç ã€è®°æµæ°´è´¦ã€æç‚¼å¼æ€»ç»“çš„äººï¼Œæ‹½æ–‡çœŸçš„ä¸æ˜¯å¤ªæƒ³åšï¼Œä½†æ˜¯ï¼Œå¥½å§ï¼Œè¿™æ˜¯æ‰€è°“çš„impactä¸­æœ€å®¹æ˜“åšåˆ°çš„ä¸€ç§ï¼Œé‚£å°±å»åšå§ã€‚</p><hr><p>Promiseï¼Œå¯¹æ“…é•¿å‰ç«¯çš„Devåº”è¯¥ä¼—æ‰€å‘¨çŸ¥ï¼Œå¯¹äºå…¸å‹çš„åç«¯Devæ¥è¯´ï¼ŒåŸºæœ¬å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š<strong>æ¥è‡ªäºPromise/A+ï¼ŒCommonJSæŒ‡å®šè§„èŒƒï¼Œè§£å†³JSä¸­çš„å›è°ƒåœ°ç‹±å’Œå¼‚æ­¥è°ƒç”¨ã€‚</strong></p><p><strong>å¼‚æ­¥è°ƒç”¨</strong>ï¼Œç”±äºåœ¨æµè§ˆå™¨ä¸­JavaScriptå•çº¿ç¨‹è¿è¡Œï¼Œä¸ºäº†å‡å°é‚£äº›å ç”¨æ—¶é—´é•¿çš„æ–¹æ³•è°ƒç”¨çš„çº¿ç¨‹ç­‰å¾…æ—¶é—´ï¼ˆå¦‚å‘æœåŠ¡å™¨è¯·æ±‚èµ„æºï¼‰ï¼Œå®šä¹‰çš„æŸäº›æ–¹æ³•éœ€è¦åœ¨å›ºå®šäº‹ä»¶æˆ–å“åº”åæ‰è°ƒç”¨æ‰§è¡Œã€‚</p><p>è€Œæ‰€è°“<strong>å›è°ƒåœ°ç‹±</strong>ï¼Œå°±æ˜¯æŒ‡ä¸‹é¢è¿™ç§å¯ä»¥æ— é™å»¶ä¼¸ã€å¯è¯»æ€§å·®ã€å¯ç»´æŠ¤æ€§å·®çš„ä»£ç è°ƒç”¨ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$.get('api/xxx/a',&nbsp;function(a)&nbsp;{&nbsp;&nbsp;$.get('api/xxx/b',&nbsp;function(b)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;$.get('api/xxx/c',&nbsp;function(c)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorCallback);&nbsp;&nbsp;},&nbsp;errorCallback);},&nbsp;errorCallback);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆæ¥ç®€å•è¯´ä¸€ä¸‹AngularJSçš„Promiseçš„ä½¿ç”¨ï¼Œå…¶å®ä¸»è¦æ˜¯ä¸¤å¤§å¯¹è±¡deferredå’Œpromiseã€‚ä¹Ÿå¯ä»¥å‡†ç¡®æ¥è¯´ï¼Œpromiseæ˜¯deferredçš„ä¸€ä¸ªå±æ€§å¯¹è±¡ã€‚</p><p>defer - å»¶è¿Ÿï¼Œpromise - æ‰¿è¯ºã€‚</p><p>deferå°±å¥½åƒé¥æ§å™¨ï¼Œpromiseå°±æ˜¯è¢«é¥æ§çš„ç‚¸å¼¹ã€‚è£…é…è¿™ä¸€å¥—è£…ç½®çš„æŠ€æœ¯å‘˜ä»–æ‰¿è¯ºï¼ŒæŒ‰ä¸‹é¥æ§ä¸Šçš„ç»¿è‰²æŒ‰é’®æ—¶ï¼Œå·¦è¾¹çš„ç‚¸å¼¹ä¼šè¢«å¼•çˆ†ï¼ŒæŒ‰ä¸‹çº¢è‰²ï¼Œå³è¾¹çš„ç‚¸å¼¹ä¼šç°é£çƒŸç­ã€‚</p><p>ä»–å®‰è£…å¥½äº†è¿™ä¸€åˆ‡ï¼Œç„¶åæ‹¿ç€é¥æ§å™¨è¿™ä¸ªå¥æŸ„ï¼Œå»å–äº†èŒ¶å»é€›äº†ä¸ªè¡—ï¼Œæœ€ä¸»è¦çš„æ˜¯ä»–æ‰“äº†ä»½æŠ¥å‘Šâ€”â€”å‘ä¸Šçº§ç”³è¯·æ‰§è¡Œå¼•çˆ†ï¼Œä¸Šçº§ç»è¿‡æ·±æ€ç†Ÿè™‘é€šè¿‡äº†å®¡æ‰¹ï¼Œè¿˜é¡ºä¾¿é€‰äº†ä¸ªé»„é“å‰æ—¥ï¼Œäºæ˜¯æŠ€æœ¯å‘˜æŒ‰ä¸‹äº†é¥æ§ä¸Šçš„ä¸€ä¸ªæŒ‰é’®ï¼Œä¸å‡ºæ„å¤–å¯¹åº”çš„ç‚¸å¼¹è¢«å¼•çˆ†ã€‚</p><p>ä»é¥æ§ç‚¸å¼¹å®‰è£…å®Œæˆï¼Œåˆ°æœ€åè¢«å¼•çˆ†ï¼Œè¿™ä¸€æ®µè·¨è¶Šæ—¶é—´çš„æ‰§è¡Œå°±è¾¾åˆ°äº†å»¶è¿Ÿã€‚</p><p>å¥½å§ï¼Œè¿™æ˜¯ä¸ªè¹©è„šçš„æ¯”å–»ï¼Œåœ¨è¿™é‡Œæœ¬äººåªæ˜¯æƒ³å°†defer/promiseè¿™ä¸¤ä¸ªè¯å…·è±¡ä¸€ä¸‹ï¼Œå…¶ä¸èƒ½å®Œå…¨è¯´æ˜PromiseåŒ…å«çš„å®Œæ•´æœºåˆ¶ã€‚å› ä¸ºå¦‚æœè¿™æ˜¯çœ‹ä¸Šé¢è¿™ä¸ªä¸¾ä¾‹ï¼Œæ ¹æœ¬å°±æ˜¯ä¸€ä¸ªå•çº¯çš„Command Patternå°±å¯ä»¥å®ç°ã€‚</p><p>è¿™é‡Œå›å½’æ­£é¢˜ï¼Œdeferredå’Œpromiseï¼š</p><p>promiseæœ‰ä¸€ä¸ªæœ€ä¸»è¦çš„æ–¹æ³•thenï¼Œç”¨äºæ³¨å†Œä¸‰ç±»å›è°ƒå‡½æ•°ï¼šsuccessCallBack/errorCallBack/notificationCallBackï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„nextPromiseå¹¶å°†å…¶è¿”å›ã€‚</p><p>deferredå¯¹è±¡åŒ…å«ä¸‰ä¸ªæ–¹æ³•ï¼Œresolve()/reject()/notify()ï¼Œè¢«è°ƒç”¨æ—¶åˆ†åˆ«å¯¹åº”æ‰§è¡Œæœ¬å®ä¾‹promiseæ³¨å†Œçš„ä¸‰ä¸ªå›è°ƒï¼ˆè§ä¸Šè¡Œï¼ŒæŒ‰é¡ºåºä¸€å¯¹ä¸€ï¼‰ã€‚æ³¨æ„resolveå’Œrejectæ˜¯äºŒé€‰ä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´ç‚¸å¼¹çš„é¥æ§å™¨æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå®ƒåªä»£è¡¨ä¸€æ¬¡å»¶æ—¶ï¼Œç‚¸æ‰ä¸€ä¸ªå°±å·²ç»æˆä¸ºæ—¢å®šäº‹å®ä¸å¯å†æ”¹ã€‚</p><p>æ‰€ä»¥å¯¹äºå¯¹äºpromiseè€Œè¨€æœ‰ä¸‰ç§çŠ¶æ€ï¼Œpendingï¼ˆè¿˜åœ¨å»¶è¿Ÿä¸­ï¼‰ã€resolveã€rejectã€‚resolve\rejectä¹ŸåŒæ—¶å«fullfilledï¼Œå³å®ŒæˆçŠ¶æ€ã€‚</p><p>ä¸€æ®µç®€å•çš„ä½¿ç”¨ä»£ç ï¼š</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;deferred&nbsp;=&nbsp;$q.defer();deferred.promise.then(function&nbsp;success(data)&nbsp;{&nbsp;&nbsp;console.log(data);},function&nbsp;error(reason)&nbsp;{&nbsp;&nbsp;console.error(reason);},function&nbsp;notification(progress)&nbsp;{&nbsp;&nbsp;console.info(progress);});$timeout(function(){&nbsp;&nbsp;&nbsp;&nbsp;deferred.resolve('simple');},&nbsp;3000);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·ã€‚è‡³äºæˆ‘ä¸ºä»€ä¹ˆè¯´ç‚¸å¼¹çš„ä¾‹å­ä¸å¤ªæ°å½“ï¼Œâ€œä¸€â€å°±æ˜¯resolveæ˜¯å¯ä»¥ä¼ é€’å‚æ•°çš„ï¼Œcallbackå‡½æ•°ä¼šå¯¹å…¶è¿›è¡ŒåŠ å·¥ã€‚è€Œç‚¸å¼¹çš„é¥æ§å™¨â€¦è¿™ä¸ªæ— æ³•å†å¡è¿›å»ä»»ä½•ä¸œè¥¿ä¼ é€’ç»™ç‚¸å¼¹ã€‚</p><p>è€ƒè™‘åˆ°è¿™äº›promiseæ›´åƒæ˜¯é¦™è‚ åŠ å·¥æµæ°´çº¿ï¼Œå®šåˆ¶å¥½èŒèƒ½å’Œé¡ºåºï¼Œå¡è¿›å»ä¸€å¤´çŒªï¼Œç»å†å±‚å±‚åŠ å·¥ï¼Œæœ€åå‡ºæ¥çš„æ˜¯é¦™è‚ ã€‚</p><p>è€Œâ€œäºŒâ€æ˜¯æœ€æœ‰æ„æ€çš„åœ°æ–¹ï¼Œpromiseæ”¯æŒé“¾çŠ¶è°ƒç”¨ï¼Œå³promise.then(â€¦).then(â€¦)â€¦â€¦ã€‚åŒæ—¶ï¼Œè¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼Œå½“defer.resolve()/reject()åï¼Œé¦–å…ˆè°ƒç”¨æŒ‰çŠ¶æ€è°ƒç”¨then1çš„callbackï¼Œthen2ä¸­çš„callbackå§‹ç»ˆæ˜¯åœ¨then1çš„callbackè°ƒç”¨æ‰§è¡Œå®Œä»¥åæ‰æ‰§è¡Œï¼Œå³ä¸²è¡Œã€‚</p><p>ä¸ºä»€ä¹ˆè§‰å¾—æœ‰æ„æ€å‘¢ï¼Ÿé“¾çŠ¶ç»“æ„æ— éå°±æ˜¯callbackå‡½æ•°çš„æœ€åä¸€å¥return thisä¸å°±å¾—äº†ä¹ˆï¼Ÿ</p><p>æŸ¥çœ‹ä¸‹angular1.3.15æºç ï¼Œäº‹å®ä¸Šï¼Œå¹¶ä¸æ˜¯ã€‚(é¡¹ç›®ä¸­ç”¨çš„æ˜¯angularJS 1.2.26ï¼Œå› æ­¤æœ¬æ–‡ä¸­angularä¹¦å†™æ–¹å¼è¿˜æ˜¯1.2çš„ï¼Œä½†1.2æºç é‡Šä¹‰æ€§æ²¡æœ‰1.3çš„é«˜ï¼Œå› æ­¤æœ¬äººè´´çš„æºç éƒ½æ˜¯1.3çš„ï¼Œè¯·è°…è§£ã€‚)</p><p>å¦‚æœ¬äººå‰é¢æ‰€å†™çš„â€œpromiseæœ‰ä¸€ä¸ªæœ€ä¸»è¦çš„æ–¹æ³•thenâ€¦â€¦ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„nextPromiseå¹¶å°†å…¶è¿”å›â€ã€‚</p><pre class="line-numbers language-none"><code class="language-none">&nbsp;then:&nbsp;function(onFulfilled,&nbsp;onRejected,&nbsp;progressBack)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;result&nbsp;=&nbsp;new&nbsp;Deferred();&nbsp;&nbsp;&nbsp;&nbsp;this.$$state.pending&nbsp;=&nbsp;this.$$state.pending&nbsp;||&nbsp;[];&nbsp;&nbsp;&nbsp;&nbsp;this.$$state.pending.push([result,&nbsp;onFulfilled,&nbsp;onRejected,&nbsp;progressBack]);&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(this.$$state.status&nbsp;&gt;&nbsp;0)&nbsp;scheduleProcessQueue(this.$$state);&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result.promise;&nbsp;&nbsp;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œå®ƒä¸ºä½•è¦è¿™æ ·åšå‘¢ï¼Ÿå®ƒçš„ç›®çš„å…¶å®æ˜¯ï¼Œå½“ç¬¬ä¸€ç»„ç‚¸å¼¹å¼•çˆ†åçš„æ¨åŠ¨åŠ›å¯ä»¥é¡ºåˆ©è§¦å‘ç¬¬äºŒç»„ç‚¸å¼¹çš„é¥æ§å™¨æŒ‰é’®ã€‚defer2.resolve(promise2callback())ã€‚</p><p>å› æ­¤promiseæœ‰è¿æ¥å‡ ä¸ªthenè¿›è¡Œè°ƒç”¨ï¼Œå³ä½¿ç”Ÿæˆäº†å‡ ä¸ªpromiseï¼Œæ¯ä¸€ä¸ªpromiseå¯¹åº”çš„deferé¥æ§éƒ½åœ¨å‰ä¸€ä¸ªpromiseçš„callbackç»“æŸå¤„ï¼Œå¹¶ä¸”å°†callbackçš„è¿”å›å€¼ä½œä¸ºresolve()çš„å‚æ•°å€¼ã€‚</p><p>å®Œå…¨å¯ä»¥è¿›è¡ŒéªŒè¯ï¼Œè§ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;deferred&nbsp;=&nbsp;$q.defer(),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise&nbsp;=&nbsp;deferred.promise;&nbsp;&nbsp;&nbsp;&nbsp;promise.then(function(val){&nbsp;&nbsp;&nbsp;&nbsp;console.log("A&nbsp;"&nbsp;+&nbsp;val);&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"A";&nbsp;&nbsp;});&nbsp;&nbsp;&nbsp;&nbsp;promise.then(function(val){&nbsp;&nbsp;&nbsp;&nbsp;console.log("B&nbsp;"&nbsp;+&nbsp;val);&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"B";&nbsp;&nbsp;});&nbsp;&nbsp;&nbsp;&nbsp;deferred.resolve("P");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè®¤ä¸ºpromise.thençš„é“¾çŠ¶è°ƒç”¨ï¼Œæ¯æ¬¡éƒ½æ˜¯è¿”å›å½“å‰promiseçš„è¯ï¼Œä¸Šé¢è¿™æ®µä»£ç å°±åº”è¯¥ä¸promise.then().then()å…¶å®æ˜¯åŒä¸€ä¸ªæ„æ€ï¼Œç„¶åå¾ˆå¯æƒœï¼Œæ‰§è¡Œç»“æœæ˜¯</p><ul><li><p>â€œA Pâ€</p></li><li><p>â€œB Pâ€</p></li></ul><p>è¿™é‡Œå¯ä»¥æƒ³ä¸€ä¸‹ä¸ºä½•Promiseé‡‡ç”¨æ­¤ç§é“¾çŠ¶å®ç°æ–¹å¼ã€‚å®ç°Promiseçš„ç›®çš„æ˜¯è§£å†³å›è°ƒåœ°ç‹±å’Œå¼‚æ­¥å›è°ƒï¼Œä¹Ÿå°±æ˜¯è¯´ç—›ç‚¹åŸå‹æ˜¯è¿™æ ·ï¼š</p><pre class="line-numbers language-none"><code class="language-none">asyncTask1('a',&nbsp;function(val1)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;console.log('start&nbsp;task1&nbsp;callback',&nbsp;val1&nbsp;+=&nbsp;'b');&nbsp;&nbsp;&nbsp;&nbsp;asyncTask2(val1,&nbsp;function(val2)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('start&nbsp;task2&nbsp;callback',&nbsp;val2&nbsp;+=&nbsp;'c');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;asyncTask3(val2,&nbsp;function(val3)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('start&nbsp;task3&nbsp;callback',&nbsp;val3&nbsp;+=&nbsp;'d');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('end&nbsp;task3&nbsp;callback');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('end&nbsp;task2&nbsp;callback');&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;&nbsp;&nbsp;&nbsp;console.log('end&nbsp;task1&nbsp;callback');&nbsp;&nbsp;});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢å¦‚æœæŒ‰ç…§æœŸæœ›çš„é“¾çŠ¶è®¾è®¡æƒ³æ³•ï¼Œæ‰§è¡Œä¸‹æ¥æ•ˆæœé¢„æƒ³å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">"start&nbsp;task1&nbsp;callback""ab""end&nbsp;task1&nbsp;callback""start&nbsp;task2&nbsp;callback""abc""end&nbsp;task2&nbsp;callback""start&nbsp;task3&nbsp;callback""abcd""end&nbsp;task3&nbsp;callback"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œäº‹å®ä¸Šï¼ŒæŒ‰ç…§æ–¹æ³•æ ˆåè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œå…¶å®ç»“æœæ˜¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">"start&nbsp;task1&nbsp;callback""ab""start&nbsp;task2&nbsp;callback""abc""start&nbsp;task3&nbsp;callback""abcd""end&nbsp;task3&nbsp;callback""end&nbsp;task2&nbsp;callback""end&nbsp;task1&nbsp;callback"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹æŒ‰ç…§æ–¹æ³•æ ˆçš„åŸåˆ™ï¼Œè¿™æ˜¯ä¸å¯è¿èƒŒçš„äº‹å®ï¼Œä½†æ˜¯JavaScriptå¹¸è¿çš„æœ‰setTimeout\angularJSæœ‰nextTickï¼Œåœ¨æ¯ä¸€ä¸ªasyncTaskè°ƒç”¨å…¶å›è°ƒå‡½æ•°æ—¶ï¼Œä»…éœ€ä½¿ç”¨setTimeout\nextTickæ¥è°ƒç”¨callbackå³å¯ã€‚</p><p>è¿™æ—¶é“¾çŠ¶æ‰§è¡ŒasyncTask1(callback)-&gt;asyncTask2(callback) -&gt;asyncTask3(callback)çš„é¡ºåºå°±å¯å®ç°ï¼Œå›è¿‡å¤´æ¥å†çœ‹ä¸€çœ¼ï¼Œcallback1å¯¹äºasyncTask2çš„è°ƒç”¨åˆ°åº•æä¾›äº†ä»€ä¹ˆï¼Ÿæä¾›æ‰§è¡Œåçš„ç»“æœä½œä¸ºå…¥å‚ + è§¦å‘å…¶è°ƒç”¨è€Œå·²ï¼Œé™¤æ­¤ä¹‹å¤–ä»–ä»¬å¯ä»¥æ˜¯å„è‡ªå®Œæ•´çš„å°è£…ï¼Œä»–ä»¬è¿æ¥æˆé“¾ï¼ˆé“¾çŠ¶æ•°æ®ç»“æ„çš„â€œé“¾â€ï¼‰ã€‚</p><p>å› æ­¤ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œç”±promiseè°ƒç”¨ï¼Œå…¶å®æ˜¯è¿™æ ·çš„ï¼š</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;asyncTask1&nbsp;=&nbsp;function(data,&nbsp;millisecond)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;defer&nbsp;=&nbsp;$q.defer();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$timeout(function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer.resolve(data);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;millisecond);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;defer.promise;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;asyncTask2&nbsp;=&nbsp;asyncTask1,&nbsp;&nbsp;&nbsp;&nbsp;asyncTask3&nbsp;=&nbsp;asyncTask1;&nbsp;&nbsp;asyncTask1('a',&nbsp;5000).then(function(val1)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;val1&nbsp;+=&nbsp;'b';&nbsp;&nbsp;&nbsp;&nbsp;console.log('task1&nbsp;callback',&nbsp;val1);&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;asyncTask2(val1,&nbsp;3000);&nbsp;&nbsp;}).&nbsp;&nbsp;then(function(val2)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;val2&nbsp;+=&nbsp;'c';&nbsp;&nbsp;&nbsp;&nbsp;console.log('task2&nbsp;callback',&nbsp;val2);&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;asyncTask3(val2,&nbsp;1000);&nbsp;&nbsp;}).&nbsp;&nbsp;then(function(val3)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;val3&nbsp;+=&nbsp;'d';&nbsp;&nbsp;&nbsp;&nbsp;console.log('task3&nbsp;callback',&nbsp;val3);&nbsp;&nbsp;});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>angularJS Promiseè¿™å—ä»£ç å®ç°é¢‡ä¸ºæœ‰è¶£ï¼Œå¦å¤–1.3ç‰ˆæœ¬æ¯”ä¹‹1.2ï¼Œè¿™å—æºç å¤§é‡è¢«é‡æ„ï¼Œé‡Šä¹‰æå‡äº†ä¸å°‘ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒPromiseçš„é“¾çŠ¶å®ç°ä¸¤ç‚¹èµ·åˆ°å¾ˆå¤§ä½œç”¨ï¼š</p><p>1ã€setTimeout/nextTickè®©å›è°ƒè·³å‡ºäº†å…ˆè¿›åå‡ºçš„å°´å°¬ï¼›</p><p>2ã€æ¯ä¸€å¯¹Defer/Promiseå¯¹è±¡éƒ½æ˜¯å¤©ç”Ÿâ€œç»â€é…ã€‚é“¾çŠ¶çš„æ‰§è¡Œï¼Œå…¶å®æ˜¯å‰ä¸€ä¸ªpromiseæ³¨å†Œçš„å›è°ƒä¸ä¸‹ä¸€ä¸ªdeferçš„resolve/rejectå°¾é¦–å‘è§¦å‘çš„è¿‡ç¨‹ã€‚</p><p>è¿™é‡Œä¹Ÿåªæ˜¯æ‹¿å¤šä¸ªå¼‚æ­¥ä»»åŠ¡å›è°ƒç²—ç•¥çš„æè¿°äº†ä¸€ä¸‹ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨çš„æœ€å¤šçš„thené“¾å½¢å¼ï¼Œè¿˜æ˜¯ä¸€ä¸ªå¼‚æ­¥è§¦å‘å¤šä¸ªé¡ºåºå›è°ƒå¤„ç†è€Œå·²ï¼Œç”±äºå…¶ä»ç¬¬ä¸€ä¸ªthenå›è°ƒå¼€å§‹å°±ç›´æ¥returnâ€œç¡®å®šå†…å®¹çš„å¯¹è±¡â€ï¼Œåç»­ promise çŠ¶æ€åŠå…¥å‚åˆ¤æ–­ç®€å•ï¼Œè¿™é‡Œå¯¹äºè¿™æ ·æƒ…å†µå°±ä¸å†æè¿°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> AngularJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript å¯ç¤ºå½•æ€»ç»“</title>
      <link href="/2015/11/24/javascript-qi-shi-lu-zong-jie/"/>
      <url>/2015/11/24/javascript-qi-shi-lu-zong-jie/</url>
      
        <content type="html"><![CDATA[<p>JavaScript1.5ç‰ˆæœ¬ï¼Œç›¸å½“äºECMAScriptç¬¬ä¸‰ç‰ˆã€‚</p><hr><p>1. åˆ›å»ºå¤æ‚å¯¹è±¡ï¼ˆéåŸå§‹å¯¹è±¡ï¼‰çš„ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>new Objectï¼ˆé¦–å…ˆåˆ›å»ºå‡ºçš„æ˜¯æ— é¢„å®šä¹‰å±æ€§æˆ–è€…æ–¹æ³•çš„ç©ºå¯¹è±¡ï¼‰</li></ul><pre class="line-numbers language-none"><code class="language-none">var&nbsp;codyA&nbsp;=&nbsp;new&nbsp;Object();codyA.name&nbsp;=&nbsp;'å¼ ä¸‰';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æ„é€ å™¨</li></ul><pre class="line-numbers language-none"><code class="language-none">var&nbsp;Person&nbsp;=&nbsp;function&nbsp;(name)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;name;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;codyB&nbsp;=&nbsp;new&nbsp;Person('å¼ ä¸‰');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å­—é¢é‡</li></ul><pre class="line-numbers language-none"><code class="language-none">var&nbsp;codyC&nbsp;=&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;"å¼ ä¸‰"};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸‰ç§æ–¹å¼ï¼Œæ„é€ å™¨æ–¹å¼ä¸­æ„é€ å‡½æ•°å¯ä»¥å½“æˆä¸€ä¸ªå¼ºå¤§ã€é›†ä¸­å®šä¹‰çš„å¯¹è±¡â€œå·¥å‚â€ï¼Œå¯ç”¨äºå¤ç”¨æ¥åˆ›å»ºæ›´å¤šçš„Personå¯¹è±¡ã€‚</p><p>* ä¸ºè‡ªå®šä¹‰å¯¹è±¡åˆ›å»ºè‡ªå®šä¹‰æ„é€ å‡½æ•°çš„åŒæ—¶ï¼Œä¹Ÿä¸ºPerson()å®ä¾‹åˆ›å»ºäº†åŸå‹ç»§æ‰¿ï¼›ä½¿ç”¨å­—é¢é‡æ¥æ„é€ ï¼Œä¼šé¿å¼€äº†åŸå‹ç»§æ‰¿çš„ä½¿ç”¨ã€‚</p><p>2. new</p><p>æ„é€ å‡½æ•°åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé™¤éä½¿ç”¨å…³é”®å­—newæ¥è°ƒç”¨ã€‚</p><p>JavaScriptç»™äºˆçš„åŠ¨ä½œï¼š</p><ul><li><p>å°†è¯¥å‡½æ•°çš„thiså€¼è®¾ç½®ä¸ºæ­£åœ¨æ„å»ºçš„æ–°å¯¹è±¡</p></li><li><p>é»˜è®¤è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå³è¿”å›thisï¼ˆæ–°å¯¹è±¡è¢«è®¤ä¸ºæ˜¯æ„å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„å®ä¾‹ï¼Œå³Person()çš„å®ä¾‹ï¼‰</p></li></ul><p>æ³¨æ„ï¼š</p><ul><li><p>æ„é€ å‡½æ•°åé¦–å­—æ¯å¤§å†™</p></li><li><p>å¦‚æœä¸ä½¿ç”¨newæ¥è°ƒç”¨æ„é€ å‡½æ•°ï¼Œthiså°†æŒ‡å‘åŒ…è£…è¯¥å‡½æ•°çš„â€œçˆ¶â€å¯¹è±¡ã€‚</p></li></ul><p>3. JavaScriptå†…ç½®ï¼ˆæˆ–è€…å«é¢„åŒ…è£…ï¼‰äº†9ä¸ªåŸç”Ÿå¯¹è±¡æ„é€ å‡½æ•°ï¼šNumber()ã€String()ã€Boolean()ã€Object()ã€Array()ã€Function()ã€Date()ã€RegExp()ã€Error()ã€‚</p><p>JavaScriptåˆå«â€œé¢„åŒ…è£…è‹¥å¹²åŸç”Ÿå¯¹è±¡æ„é€ å‡½æ•°çš„è¯­è¨€â€ â€”â€” JavaScriptä¸»è¦æ˜¯ç”±è¿™9ä¸ªå¯¹è±¡ä»¥åŠ åŸå§‹å€¼ï¼ˆå¸ƒå°”ã€æ•°å­—ã€å­—ç¬¦ä¸²ï¼‰æ¥åˆ›å»ºã€‚</p><p>æ³¨æ„ï¼šMathå¯¹è±¡æ˜¯é™æ€å¯¹è±¡ï¼Œä¸æ˜¯æ„é€ å‡½æ•°ï¼Œåªæ˜¯ä¸€ä¸ªå¯¹è±¡å‘½åç©ºé—´ï¼Œç”¨äºå­˜å‚¨æ•°å­¦å‡½æ•°ã€‚</p><p>4. åŸå§‹å€¼ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”ï¼‰ä¸String()ã€Number()ã€Boolean()ã€‚åŸå§‹å€¼è¿˜æœ‰nullã€undefinedç­‰ã€‚</p><p>åŸå§‹å€¼çš†ä¸ä¸ºå¯¹è±¡ã€‚åŸå§‹å€¼ç‰¹æ®Šä¹‹å¤„åœ¨äºè¡¨ç¤ºç®€å•å€¼ï¼Œå¾ˆå¤šæ—¶å€™ä½œä¸ºä¸å¯å†ç»†åŒ–çš„è¿›è¡Œå¤åˆ¶å’Œæ“ä½œã€‚</p><p>å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”&nbsp;æœ‰å…¶å¯¹åº”çš„åŒ…è£…æ„é€ å‡½æ•°ã€‚åº”<strong>å°½é‡ä½¿ç”¨åŸå§‹å€¼</strong>ï¼š</p><ul><li><p>typeof â€œaâ€ =&gt; â€œstringâ€ï¼Œè€Œtypeof (new String(â€˜bâ€™)) =&gt; â€œobjectâ€</p></li><li><p>åœ¨åŸå§‹å€¼è¢«è§†ä¸ºå¯¹è±¡çš„æƒ…å†µä¸‹æ‰ä¼šåˆ›å»ºå®é™…çš„å¤æ‚å¯¹è±¡ã€‚å¦‚â€œaâ€.lengthåœ¨ä½¿ç”¨æ—¶ï¼ŒJSä¼šåœ¨å¹•åä¸ºå­—é¢é‡åˆ›å»ºä¸€ä¸ªåŒ…è£…å™¨å¯¹è±¡ï¼Œä»¥ä¾¿å°†è¯¥å€¼è¢«è§†ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚è°ƒç”¨æ–¹æ³•ä»¥åï¼ŒJSå³æŠ›å¼ƒåŒ…è£…å¯¹è±¡ï¼Œè¯¥å€¼è¿”å›å­—é¢é‡ç±»å‹ã€‚</p></li><li><p>åŸå§‹å€¼çš„constructorå±æ€§ï¼Œä¼šæ˜¾ç¤ºå…¶åŒ…è£…å¯¹è±¡çš„æ„é€ å‡½æ•°String()ã€Number()ã€Boolean()</p></li><li><p>String(â€˜testâ€™)\Number(â€˜10â€™)\Boolean(â€˜trueâ€™)ä¹Ÿå¯ä»¥è·å–åŸå§‹å€¼ï¼Œæ³¨æ„å‰é¢æ²¡æœ‰newã€‚</p><p>ç”±æ­¤å¯è§ï¼Œ<strong>JavaScriptä¸­æ‰€æœ‰ä¸œè¥¿éƒ½ç”¨æˆå¯¹è±¡</strong>ï¼Œè€Œéé‚£å¥â€œJavaScriptä¸­æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡â€ã€‚</p></li></ul><p>5. å­—é¢é‡æ˜¯JavaScriptæä¾›çš„ä¸€ç§å¿«æ·æ–¹å¼ï¼Œä½¿ç”¨å­—é¢é‡åˆ›å»ºå¯¹è±¡ä¸æ„é€ å‡½æ•°æ–¹å¼åŸºæœ¬ç›¸åŒï¼Œé™¤äº†å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å­—é¢é‡ã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myNumber&nbsp;=&nbsp;123,&nbsp;&nbsp;myString&nbsp;=&nbsp;'hello',&nbsp;&nbsp;myBoolean&nbsp;=&nbsp;true,&nbsp;&nbsp;myObject&nbsp;=&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;'Jack'&nbsp;&nbsp;},&nbsp;&nbsp;myArray&nbsp;=&nbsp;['foo',&nbsp;'bar'],&nbsp;&nbsp;myFunction&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;x&nbsp;+&nbsp;y;&nbsp;&nbsp;},&nbsp;&nbsp;myRegExp&nbsp;=&nbsp;/\b[a-z]+\b/;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>6. åŸå§‹å€¼nullã€undefined</p><p>ä¸¤è€…æ²¡æœ‰åŒ…è£…ç±»å‹æ„é€ å‡½æ•°ã€‚</p><p>å¯ä»¥ç”¨nullæ¥æ˜¾å¼æŒ‡å‡ºå¯¹è±¡å±æ€§ä¸åŒ…å«å€¼ã€‚</p><p>undefinedä¸¤ç§æ–¹å¼ï¼š1ã€å£°æ˜çš„å˜é‡æœªåˆå§‹åŒ–ï¼›2ã€è¯•å›¾è®¿é—®çš„å¯¹è±¡æ²¡æœ‰è¢«å®šä¹‰ï¼ˆå³è¿˜æ²¡è¢«å‘½åï¼‰ï¼Œå¹¶ä¸”ä¸å­˜åœ¨äºåŸå‹é“¾ä¸­ã€‚</p><p>åªå…è®¸JavaScriptä½¿ç”¨undefinedæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•ã€‚æ°¸è¿œä¸è¦å°†ä¸€ä¸ªå€¼è®¾ç½®ä¸ºundefinedã€‚å¦‚æœåˆ¶å®šä¸€ä¸ªå±æ€§æˆ–å˜é‡å€¼ä¸å¯ç”¨ï¼Œåº”è¯¥ä½¿ç”¨nullã€‚</p><p>7. === ä¸ ==</p><p>å°½é‡ä¸è¦éƒ½ä¸è¦ä½¿ç”¨==ï¼Œ== ä¼šè‡ªåŠ¨æ‰§è¡Œç±»å‹è½¬æ¢ã€‚</p><p>=== æ¯”è¾ƒåŸå§‹å€¼æ—¶ï¼Œæ˜¯è¿›è¡Œå€¼æ¯”è¾ƒã€‚å¯¹å¤æ‚å¯¹è±¡è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œæ˜¯è¿›è¡Œå¯¹è±¡å¼•ç”¨æ¯”è¾ƒï¼Œå¯ç†è§£ä¸ºæ¯”è¾ƒçš„æ˜¯å¯¹è±¡å¼•ç”¨åœ°å€çš„å€¼ï¼Œåªæœ‰å½“æ“ä½œç¬¦ä¸¤ç«¯æ˜¯åŒä¸€ä¸ªå¯¹è±¡æ—¶æ‰ä¸ºtrueã€‚</p><p></p><p>8. typeof</p><p>typeofè¿”å›æ­£åœ¨ä½¿ç”¨å€¼çš„ç±»å‹ã€‚</p><pre class="line-numbers language-none"><code class="language-none">console.log(typeof&nbsp;null);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//object&nbsp;&nbsp;&nbsp;&nbsp;!!console.log(typeof&nbsp;undefined);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//undefined&nbsp;!!console.log(typeof&nbsp;123);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//numberconsole.log(typeof&nbsp;'hello');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//stringconsole.log(typeof&nbsp;true);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//booleanconsole.log(typeof&nbsp;(new&nbsp;Number(123)));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//objectconsole.log(typeof&nbsp;(new&nbsp;Boolean(true)));&nbsp;&nbsp;&nbsp;&nbsp;//objectconsole.log(typeof&nbsp;(new&nbsp;String('hello')));&nbsp;&nbsp;//objectconsole.log(typeof&nbsp;(new&nbsp;Object()));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//objectconsole.log(typeof&nbsp;(new&nbsp;Array('foo',&nbsp;'bar')));&nbsp;//objectconsole.log(typeof&nbsp;(new&nbsp;Function("x",&nbsp;"y",&nbsp;"return&nbsp;x&nbsp;+&nbsp;y")));&nbsp;//function&nbsp;&nbsp;!!console.log(typeof&nbsp;(new&nbsp;Date()));&nbsp;//objectconsole.log(typeof&nbsp;(new&nbsp;RegExp('\\b[a-z]+\\b')));&nbsp;//objectconsole.log(typeof&nbsp;(new&nbsp;Error('Crap!')));&nbsp;//object<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>9. æ„é€ å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡å®ä¾‹</p><ul><li>æ‹¥æœ‰æŒ‡å‘å…¶æ„é€ å‡½æ•°çš„constructorå±æ€§</li></ul><pre class="line-numbers language-none"><code class="language-none">function&nbsp;Test(){&nbsp;&nbsp;this.name&nbsp;=&nbsp;"zhangsan";}var&nbsp;a&nbsp;=&nbsp;{},&nbsp;&nbsp;B&nbsp;=&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;"Jack";&nbsp;&nbsp;},&nbsp;&nbsp;d&nbsp;=&nbsp;new&nbsp;B(),&nbsp;&nbsp;&nbsp;&nbsp;e&nbsp;=&nbsp;new&nbsp;Test();console.log(a.constructor&nbsp;===&nbsp;Object);&nbsp;//trueconsole.log(d.constructor&nbsp;===&nbsp;B);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//trueconsole.log(e.constructor&nbsp;===&nbsp;Test);&nbsp;&nbsp;&nbsp;//true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹å±æ€§</li></ul><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myString&nbsp;=&nbsp;new&nbsp;String('hello');myString.prop&nbsp;=&nbsp;'test';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æºäºJavaScriptå¯¹è±¡çš„åŠ¨æ€å±æ€§ç‰¹æ€§ï¼ŒåŸå§‹å€¼æ— åŠ¨æ€å±æ€§æ”¯æŒã€‚</p><p>åŠ¨æ€å±æ€§æ”¯æŒæ˜“å˜å¯¹è±¡ï¼Œå› æ­¤ç”šè‡³å¯ä»¥é€šè¿‡å…¶æ¥è¯¥é™¢JavaScriptæœ¬èº«åŸç”Ÿå¯¹è±¡çš„é¢„é…ç½®ç‰¹æ€§ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšã€‚</p><p>å³ä½¿Functionå¯¹è±¡ä¹Ÿå¯ä»¥æ·»åŠ ç‹¬ç«‹å±æ€§ï¼š</p><pre class="line-numbers language-none"><code class="language-none">function&nbsp;Test(){&nbsp;&nbsp;this.name&nbsp;=&nbsp;"zhangsan";}Test.go&nbsp;=&nbsp;"hello";console.log(Test.go);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>10. å¯å½“åšå®¹å™¨çš„å¤æ‚å¯¹è±¡ï¼šObject()ã€Array()ã€Function(), å¯ä»¥åŒ…å«å…¶ä»–å¤æ‚å¯¹è±¡ã€‚</p><p>æ³¨æ„Functionå¹¶éæŒ‡åŠ¨æ€å±æ€§ï¼ˆæ­¤åŠŸèƒ½åœ¨Object()ä¸­ï¼‰ï¼ŒFunctionè§ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">function&nbsp;Test()&nbsp;{&nbsp;&nbsp;var&nbsp;getTest&nbsp;=&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;get&nbsp;=&nbsp;function(){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//TODO&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>11. è·å–ã€è®¾ç½®ã€æ›´æ–°å¯¹è±¡å±æ€§</p><p>ä¸¤ç§ï¼šç‚¹è¡¨ç¤ºæ³•ã€ä¸­æ‹¬å·è¡¨ç¤ºæ³•ï¼Œå°½é‡ä½¿ç”¨ç‚¹è¡¨ç¤ºæ³•ã€‚</p><p>ä¸­æ‹¬å·è¡¨ç¤ºæ³•ä»…åœ¨ï¼š1ã€éœ€è¦ä¼ é€’è·å–çš„å±æ€§åä¸ºå˜é‡ï¼› 2ã€ä½¿ç”¨å…³é”®å­—ä¸ºå±æ€§åçš„æƒ…å†µã€‚</p><p>åŒæ—¶ï¼Œå­—é¢é‡å£°æ˜å¯¹è±¡æ—¶ï¼Œå±æ€§åæ²¡å¿…è¦ä½¿ç”¨ä¸ºå­—ç¬¦ä¸²ï¼Œé™¤éæ˜¯ä¸‹é¢å‡ ç§æƒ…å†µ: 1ã€æ˜¯ä¿ç•™å…³é”®å­—ï¼›2ã€åŒ…å«ç©ºæ ¼æˆ–è€…ç‰¹æ®Šå­—ç¬¦ï¼›3ã€ä»¥æ•°å­—å¼€å¤´ã€‚</p><p>12. deleteæ“ä½œç¬¦</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;test&nbsp;=&nbsp;{name:&nbsp;'Jack'};delete&nbsp;test.name;console.log(test.name);&nbsp;&nbsp;&nbsp;&nbsp;//undefined<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><p>deleteæ˜¯å°†å±æ€§ä»ä¸€ä¸ªå¯¹è±¡åˆ é™¤çš„å”¯ä¸€æ–¹æ³•ã€‚å°†å±æ€§è®¾ç½®ä¸ºundefinedæˆ–nullåªèƒ½æ”¹å˜å±æ€§çš„å€¼ï¼Œä¸ä¼šå°†å±æ€§ä»å¯¹è±¡åˆ é™¤ã€‚</p></li><li><p>deleteä¸ä¼šåˆ é™¤åœ¨åŸå‹é“¾ä¸Šæ‰¾åˆ°çš„å±æ€§ã€‚</p></li></ul><p>13. å±æ€§ã€æ–¹æ³•çš„è·å–ï¼Œä»¥åŠåŸå‹é“¾</p><p>å¦‚æœè¯•å›¾è®¿é—®å¯¹è±¡ä¸­æ²¡æœ‰çš„å±æ€§ã€æ–¹æ³•ï¼ŒJavaScriptä¼šè¯•å›¾ä½¿ç”¨ åŸå‹é“¾æ¥æŸ¥æ‰¾ã€‚</p><p>æŸ¥æ‰¾myArray.foo, é¦–å…ˆæŸ¥æ‰¾åˆ›å»ºå¯¹è±¡çš„æ„é€ å‡½æ•°(MyArray())ï¼Œå¹¶æ£€æŸ¥å™¨åŸå‹å±æ€§(MyArray.prototype)ï¼Œç„¶åä¼šå¯»æ‰¾å¦å¤–ä¸¤ä¸ªä½ç½®ï¼š(Array.prototypeï¼Œç„¶åæ˜¯Object.prototype)ï¼Œå¯¹è±¡çš„æ„é€ å‡½æ•°prototypeå¯¹è±¡ä¸ŠæŸ¥æ‰¾å®ƒã€‚</p><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myArray&nbsp;=&nbsp;['foo',&nbsp;'bar'];console.log(myArray.hasOwnProperty('join'));&nbsp;//è¾“å‡ºfalse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å½“ JavaScriptåˆ›å»ºArrayæ„é€ å‡½æ•°æ—¶ï¼Œjoin()æ–¹æ³•ç­‰ä½œä¸ºArray()åŸå‹å±æ€§çš„ä¸€ä¸ªå±æ€§è¢«æ·»åŠ ã€‚</p><ul><li>prototypeå±æ€§æ˜¯JavaScriptä¸ºæ¯ä¸€ä¸ªFunction()å®ä¾‹åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ã€‚å®ƒå°†é€šè¿‡newå…³é”®å­—åˆ›å»ºçš„å¯¹è±¡å®ä¾‹é“¾æ¥å›åˆ›å»ºä»–ä»¬çš„æ„é€ å‡½æ•°ã€‚å®ä¾‹æ‰å¯ä»¥å…±äº«æˆ–ç»§æ‰¿é€šç”¨æ–¹æ³•å’Œå±æ€§ã€‚å…±äº«å‘ç”Ÿåœ¨<strong>å±æ€§æŸ¥æ‰¾</strong>æ—¶ã€‚</li></ul><p>JavaScriptä¼šä¸ºæ¯ä¸ªå‡½æ•°åˆ›å»ºåŸå‹å¯¹è±¡ï¼Œä¸è®ºæ˜¯å¦æ˜¯æ„é€ å‡½æ•°ã€‚</p><ul><li>æ‰€æœ‰å‡½æ•°éƒ½æ˜¯ç”±Function()æ„é€ å‡½æ•°åˆ›å»ºçš„ã€‚å½“åˆ›å»ºå‡½æ•°å®ä¾‹æ—¶ï¼Œå®ƒæ€»æœ‰ä¸€ä¸ªprototypeå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>ç©ºå¯¹è±¡</strong>ã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myFunction&nbsp;=&nbsp;function(){};console.log(myFunction.prototype);&nbsp;//åŒ{}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å½“å‡½æ•°ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå®ƒéƒ½ä¼šåœ¨<strong>åˆ›å»ºçš„å®ä¾‹å¯¹è±¡</strong>å’Œ<strong>åˆ›å»ºå®ä¾‹å¯¹è±¡çš„æ„é€ å‡½æ•°çš„prototypeå±æ€§</strong>ä¹‹é—´æ·»åŠ ä¸€ä¸ªéšæ€§é“¾æ¥__proto__ã€‚è¿™æ ·å°±å½¢æˆäº†åŸå‹é“¾ï¼ŒåŸå‹é“¾å°†æ¯ä¸ªå®ä¾‹éƒ½é“¾æ¥è‡³å…¶æ„é€ å‡½æ•°çš„prototypeå±æ€§ã€‚</li></ul><p>å¦‚æœéœ€è¦ä½¿ç”¨__proto__å±æ€§ï¼Œæ­£ç¡®çš„å†™æ³•æ˜¯ï¼šmyObject.constructor.prototype</p><p>åŸå‹é“¾æœ€åçš„æ˜¯Object.prototype</p><ul><li>ç”¨æ–°å¯¹è±¡æ›¿æ¢prototypeå±æ€§ä¼šåˆ é™¤é»˜è®¤çš„æ„é€ å‡½æ•°å±æ€§ã€‚ä½†æ˜¯å¯ä»¥æ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">var&nbsp;Foo&nbsp;=&nbsp;function(){console.log('good');};Foo.prototype&nbsp;=&nbsp;{constructor:&nbsp;Foo};var&nbsp;fooInstance&nbsp;=&nbsp;new&nbsp;Foo();console.log(fooInstance.constructor&nbsp;===&nbsp;Foo);console.log(fooInstance.constructor);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å°ï¼š</p><p>â€œgoodâ€ &nbsp; true &nbsp;function(){console.log(â€˜goodâ€™);}</p><ul><li><p>prototypeå¼•ç”¨çš„å¯¹è±¡æ˜¯åŠ¨æ€çš„ï¼ŒåŸå‹é“¾æŸ¥æ‰¾å‡ºçš„å†…å®¹ä¹Ÿä¼šæ˜¯åŠ¨æ€çš„ã€‚</p></li><li><p>ç”¨æ–°å¯¹è±¡æ›¿æ¢prototypeå±æ€§ä¸ä¼šæ›´æ–°ä»¥å‰å·²åˆ›å»ºçš„å®ä¾‹ï¼Œå› æ­¤ä¸€æ—¦å¼€å§‹åˆ›å»ºå®ä¾‹ï¼Œå°±ä¸åº”è¯¥åœ¨æ›¿æ¢æ„é€ å‡½æ•°çš„åŸå‹å±æ€§ã€‚</p></li></ul><p>14. hasOwnProperty å’Œ inæ“ä½œç¬¦</p><p>inæ“ä½œç¬¦å¯ä»¥æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼ŒåŒ…æ‹¬æ¥è‡ªåŸå‹é“¾çš„å±æ€§ï¼›</p><p>hasOwnPropertyæ–¹æ³•å¯ä»¥æ£€æŸ¥æ¥è‡ªéåŸå‹é“¾å±æ€§çš„å¯¹è±¡ã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myObject&nbsp;=&nbsp;{foo:&nbsp;'value'};console.log(myObject.hasOwnProperty('foo'));console.log(myObject.hasOwnProperty('toString'));console.log('toString'&nbsp;in&nbsp;myObject);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>forâ€¦inå¾ªç¯éå†å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸”åªéå†å¯æšä¸¾çš„å±æ€§ï¼ˆå³å¯ç”¨å±æ€§ï¼‰ï¼Œä¾‹å¦‚æ„é€ å‡½æ•°å±æ€§å°±ä¸ä¼šæ˜¾ç¤ºã€‚å¯ä»¥ä½¿ç”¨obj.propertyIsEnumerable(prop)æ¥æ£€æŸ¥å¯æšä¸¾å±æ€§ã€‚</p><p>æ³¨æ„ï¼šè®¿é—®å±æ€§çš„é¡ºåºå¹¶ä¸ä¸€å®šæ˜¯å®šä¹‰çš„é¡ºåºã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;cody&nbsp;=&nbsp;{&nbsp;&nbsp;age:&nbsp;23,&nbsp;&nbsp;gender:&nbsp;'male'};for&nbsp;(var&nbsp;key&nbsp;in&nbsp;cody)&nbsp;{&nbsp;&nbsp;//é¿å…æ¥è‡ªåŸå‹é“¾çš„å±æ€§&nbsp;&nbsp;if&nbsp;(cody.hasOwnProperty(key))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;console.log(key);&nbsp;&nbsp;}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>15. å¯¹è±¡å’Œå‡½æ•°</p><ul><li><p>Objectï¼ˆï¼‰åˆ›å»ºå‡ºçš„å®ä¾‹ï¼Œä¹Ÿå¯å«Object()å¯¹è±¡å®ä¾‹ï¼Œæ‹¥æœ‰çš„å±æ€§ï¼šconstructorä»¥åŠéšè—å±æ€§__proto__ï¼›å®ä¾‹æ–¹æ³•ï¼šhasOwnProperty()ç­‰ç­‰ã€‚</p></li><li><p>Function() å‡½æ•°å±æ€§ï¼šprototype, Function.prototype;&nbsp;Objectï¼ˆï¼‰è¿™ä¸ªå‡½æ•°å…·æœ‰å±æ€§ï¼šprototype, å³Object.prototypeã€‚</p><p>Function()å¯¹è±¡å®ä¾‹å±æ€§ï¼šargumentsã€constructor(å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡)ã€lengthï¼›å®ä¾‹æ–¹æ³•ï¼šcall()ã€apply()ç­‰ã€‚</p></li></ul><p>æ‰€æœ‰çš„å®ä¾‹(new Object())éƒ½æ‹¥æœ‰constructorå’Œ__proto__å±æ€§ã€‚æ‰€æœ‰çš„å‡½æ•°(new Function())éƒ½æœ‰prototypeå±æ€§ã€‚</p><p>16. å‡½æ•°</p><p>å‡½æ•°æ˜¯å¯æ‰§è¡Œè¯­å¥çš„å”¯ä¸€ä½œç”¨åŸŸã€‚å‡½æ•°æ€»æœ‰è¿”å›å€¼ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¿”å›å€¼ï¼Œé»˜ç„¶è¿”å›undefinedã€‚</p><p>å‡½æ•°åˆ›å»ºçš„ä¸‰ç§æ–¹å¼ï¼š1. new Function(argâ€¦, functionBody); 2. å‡½æ•°è¡¨è¾¾å¼ var name = function(){}ï¼›3. å‡½æ•°è¯­å¥ï¼Œå­—é¢é‡å½¢å¼ function name(){};</p><p>newæ–¹å¼å°‘ç”¨ï¼ŒåŸå› åŒeval()ã€‚</p><p>å‡½æ•°çš„ä½¿ç”¨ï¼šæ‰€æœ‰å‡½æ•°ä½“ä¸­ï¼Œthiså’Œargumentséƒ½æ˜¯å¯ç”¨çš„ã€‚</p><p><strong>arguments</strong>ï¼šå³ä½¿åœ¨å‡½æ•°å®šä¹‰ä¸­ä¸æŒ‡å®šå‚æ•°ï¼Œå¦‚æœåœ¨è°ƒç”¨æ—¶å‘é€äº†å‚æ•°ï¼Œè¿˜æ˜¯å¯ä»¥ä¾é argumentsæ¥è®¿é—®å‚æ•°ã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;add&nbsp;=&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;arguments[0]&nbsp;+&nbsp;arguments[1];}console.log(add(3,&nbsp;4));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>argumentså¯¹è±¡æ‹¥æœ‰åä¸ºcalleeçš„å±æ€§ï¼Œæ˜¯å¯¹å½“å‰æ‰§è¡Œå‡½æ•°çš„å¼•ç”¨ã€‚å½“å‡½æ•°éœ€è¦é€’å½’è°ƒç”¨æ—¶ï¼Œéå¸¸æœ‰ç”¨ã€‚</p><p><strong>this</strong>: æ˜¯å¯¹åŒ…å«å‡½æ•°çš„å¯¹è±¡çš„å¼•ç”¨ã€‚å¦‚æœä¸åœ¨å¯¹è±¡ä¸­ï¼Œthisæ˜¯å…¨å±€å¯¹è±¡ï¼Œæµè§ˆå™¨æ˜¯windowã€‚</p><p><strong>length</strong>: å®šä¹‰çš„å‚æ•°æ•°é‡ï¼ˆå´ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼‰ï¼Œç”¨æ³•arguments.callee.lengthã€‚argmentsä¹Ÿæœ‰ä¸€ä¸ªlengthå±æ€§, Javascript1.4å¼€å§‹åºŸå¼ƒï¼Œä¸åŒå¤„æ˜¯ è°ƒç”¨æ—¶å±æ€§çš„é•¿åº¦ã€‚</p><p>ä½¿ç”¨4ä¸­ä¸åŒçš„åœºæ™¯æˆ–æ¨¡å¼è°ƒç”¨å‡½æ•°ï¼š</p><ul><li><p>ä½œä¸ºå‡½æ•°(ä»…ä½œä¸ºå‡½æ•°è°ƒç”¨ï¼Œthisä¼šè¢«æŒ‡å‘headå¯¹è±¡)</p></li><li><p>ä½œä¸ºæ–¹æ³•ï¼ˆåœ¨å¯¹è±¡ä¸­ï¼‰</p></li><li><p>ä½œä¸ºæ„é€ å‡½æ•°</p></li><li><p>ä½¿ç”¨applyï¼ˆï¼‰æˆ–è€…callï¼ˆï¼‰</p></li></ul><p>applyä¸callçš„åŒºåˆ«æ˜¯å‚æ•°ä¼ é€’çš„ä¸åŒ:</p><pre class="line-numbers language-none"><code class="language-none">function&nbsp;print(text,&nbsp;extra)&nbsp;{&nbsp;&nbsp;console.log(this.name&nbsp;+&nbsp;text&nbsp;+&nbsp;extra);}var&nbsp;zhang&nbsp;=&nbsp;{&nbsp;&nbsp;name:&nbsp;'zhang'};print.apply(zhang,&nbsp;['&nbsp;good',&nbsp;'&nbsp;morning']);print.call(zhang,&nbsp;'&nbsp;nice',&nbsp;'&nbsp;day');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡ªè°ƒç”¨çš„åŒ¿åå‡½æ•°ï¼Œéœ€è¦ä½¿ç”¨æ‹¬å·ï¼Œæˆ–è€…ä»»ä½•å°†å‡½æ•°è½¬åŒ–æˆè¡¨è¾¾å¼çš„ç¬¦å·ã€‚</p><pre class="line-numbers language-none"><code class="language-none">(function&nbsp;(msg){&nbsp;&nbsp;console.log(msg);}('Hello'));var&nbsp;a&nbsp;=&nbsp;function&nbsp;(msg){&nbsp;&nbsp;console.log(msg);&nbsp;&nbsp;return&nbsp;'ok';}('Hello');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‡½æ•°å¯ä»¥åµŒå¥—ï¼Œå¹¶ä¸”åµŒå¥—çš„æ·±åº¦æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚ä½†<strong>åµŒå¥—å‡½æ•°çš„thiså€¼æ˜¯headå¯¹è±¡</strong>ã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;test&nbsp;=&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;'Jack',&nbsp;&nbsp;&nbsp;&nbsp;say:&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;name&nbsp;=&nbsp;function(){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this.name;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('hello&nbsp;'&nbsp;+&nbsp;name());&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;},&nbsp;&nbsp;name&nbsp;=&nbsp;'head';test.say();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>**è‡ªåŠ¨æå‡ï¼š**åœ¨çœŸæ­£å®šä¹‰å‡½æ•°è¯­å¥ä¹‹å‰ï¼Œå¯ä»¥åœ¨æ‰§è¡Œæ—¶è°ƒç”¨è¯¥è¯­å¥ã€‚å› ä¸ºåœ¨è¿è¡Œä»£ç ä¹‹å‰ï¼Œå‡½æ•°è¯­å¥å·²ç»è¢«ç¼–è¯‘å™¨è§£é‡Šï¼Œå¹¶æ·»åŠ è‡³æ‰§è¡Œå †æ ˆã€ä¸Šä¸‹æ–‡ä¸­ã€‚</p><p>æ³¨æ„ï¼šåªæœ‰â€œå‡½æ•°è¯­å¥â€å½¢å¼çš„è¢«æå‡ï¼Œâ€œå‡½æ•°è¡¨è¾¾å¼â€çš„å‡½æ•°ä¸ä¼šæå‡ã€‚</p><p>17. head/å…¨å±€å¯¹è±¡</p><p>JavaScriptä»£ç æœ¬èº«å¿…é¡»åŒ…å«åœ¨å¯¹è±¡å†…éƒ¨ï¼Œå¦‚Webæµè§ˆå™¨ç¯å¢ƒä¸­ï¼ŒJavaScriptè¢«åŒ…å«åœ¨windowå¯¹è±¡å†…ï¼Œå¹¶ä¸”åœ¨å…¶å†…éƒ¨æ‰§è¡Œï¼Œè¿™ä¸ªwindowå¯¹è±¡è¢«è®¤ä¸ºæ˜¯â€œheadå¯¹è±¡â€ã€‚</p><p><strong>headå¯¹è±¡</strong>æ˜¯JavaScriptç¯å¢ƒä¸­å¯ç”¨çš„æœ€é«˜ä½œç”¨åŸŸ/ä¸Šä¸‹æ–‡ã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myStringVar&nbsp;=&nbsp;'myString';console.log('myStringVar'&nbsp;in&nbsp;window);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>**â€œå…¨å±€å¯¹è±¡â€**æ˜¯æŒ‡ç›´æ¥åŒ…å«åœ¨headå¯¹è±¡å†…éƒ¨çš„å€¼ã€‚å¦‚ä¸ŠmyStringVarå°±æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæ˜¯headå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚</p><p>headå¯¹è±¡å†…çš„<strong>å…¨å±€å‡½æ•°</strong>ï¼ˆJavaScripté™„å¸¦çš„ä¸€äº›é¢„å®šä¹‰å‡½æ•°ï¼‰ï¼šparseInt()\parseFloat()\decodeURI()\decodeURIComponent()\encodeURI()\encodeURIComponent()\eval()\isFinite()\isNaN()</p><p><strong>å¼•ç”¨headå¯¹è±¡</strong>ï¼š1ã€ä½¿ç”¨headå¯¹è±¡çš„åç§°ï¼ˆå¦‚æµè§ˆå™¨ä¸­ï¼Œæ˜¯windowï¼‰ï¼› 2ã€åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä½¿ç”¨thiså…³é”®å­—ï¼›</p><p>ä½†ä¸€èˆ¬headå¯¹è±¡æ˜¯éšå¼çš„ï¼Œé€šå¸¸ä¸æ˜¾ç¤ºå¼•ç”¨(é™¤éå‘½åå¤ªç®€å•æ˜“è¢«é®ç›–ä½)ã€‚åŒæ—¶ï¼Œæ€§èƒ½æ–¹é¢alert()æ¯”window.alert()ä»£ä»·è¦ä½ã€‚ï¼ˆå³ä½¿æˆ‘ä»¬çŸ¥é“æƒ³è¦çš„å±æ€§åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ï¼Œä½†å¦‚æœåªä¾é ä½œç”¨åŸŸç¦»é“¾ï¼Œå¹¶é¿å…æ˜¾å¼åœ°å¼•ç”¨headå¯¹è±¡ï¼Œä¼šæ›´å¿«ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;foo&nbsp;=&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;method:&nbsp;function(text)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('nice&nbsp;'&nbsp;+&nbsp;text);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.alert('good&nbsp;'&nbsp;+&nbsp;window.text);&nbsp;//æƒ³è®¿é—®texté®ç›–ä¸­çš„å…¨å±€textå˜é‡&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;},&nbsp;&nbsp;text&nbsp;=&nbsp;'zhang';foo.method('li');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>18. this</p><p>åˆ›å»ºå‡½æ•°æ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªåä¸ºthisçš„å…³é”®å­—ï¼Œå®ƒé“¾æ¥åˆ°è¿è¡Œè¯¥å‡½æ•°çš„å¯¹è±¡ã€‚æˆ–è€…è¯´æ˜¯é“¾æ¥åˆ°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ã€‚</p><p>é™¤äº†newå…³é”®å­—å’Œcall()\apply()çš„æƒ…å†µä¾‹å¤–ï¼š</p><ul><li><p>newè°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œthiså¼•ç”¨â€œå³å°†è°ƒç”¨çš„å¯¹è±¡â€ï¼›</p></li><li><p>call\applyä¼šä½¿ç”¨contextå¯¹è±¡æ”¹å†™thiså€¼ã€‚say.call(context, argsâ€¦)</p></li></ul><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myObject&nbsp;=&nbsp;{name:&nbsp;'zhang'},&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;'li',&nbsp;&nbsp;&nbsp;&nbsp;sayHello&nbsp;=&nbsp;function(){&nbsp;&nbsp;console.log('hello&nbsp;'&nbsp;+&nbsp;this.name);};myObject.sayHello&nbsp;=&nbsp;sayHello;myObject.sayHello();sayHello();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å°ï¼šâ€œhello zhangâ€ â€œhello liâ€</p><p>**&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ä¼ é€’å‡½æ•°æˆ–è€…æœ‰å¤šä¸ªå‡½æ•°çš„å¼•ç”¨<strong>æ—¶ï¼Œè¦æ„è¯†åˆ°thiså€¼ä¼šæ ¹æ®è°ƒç”¨å‡½æ•°æ‰€åœ¨çš„ä¸Šä¸‹æ–‡è€Œæ”¹å˜ã€‚é™¤äº†</strong>this<strong>å’Œ</strong>arguments**ä¹‹å¤–æ‰€æœ‰å˜é‡éƒ½éµå®ˆâ€œè¯æ³•ä½œç”¨åŸŸâ€è§„åˆ™ã€‚</p><p>åœ¨åµŒå¥—å‡½æ•°ä¸­thiså…³é”®å­—å¼•ç”¨headå¯¹è±¡ï¼ŒES5ä¸­å¼€å§‹å›ºå®šè§„å®šã€‚å³å½“thiså€¼çš„å¯„ä¸»å‡½æ•°è¢«å°è£…åœ¨å¦ä¸€ä¸ªå‡½æ•°çš„å†…éƒ¨æˆ–è€…åœ¨å¦ä¸€ä¸ªå‡½æ•°çš„ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨æ—¶ï¼Œthiså°†æ°¸è¿œæŒ‡å‘headå¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>å¯ä»¥å……åˆ†åˆ©ç”¨ä½œç”¨åŸŸé“¾æ¥é¿å…thisè¢«æ”¹å†™ã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myObject&nbsp;=&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;'zhang',&nbsp;&nbsp;&nbsp;&nbsp;say:&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;that&nbsp;=&nbsp;this;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(function&nbsp;helper()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(that.name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this.name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})();&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;},&nbsp;&nbsp;name&nbsp;=&nbsp;'win';myObject.say();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å°: â€œzhangâ€ â€œwinâ€</p><p>åŸå‹æ–¹æ³•å†…çš„thiså…³é”®å­—å¼•ç”¨æ„é€ å‡½æ•°å®ä¾‹ã€‚å½“åœ¨prototypeå¯¹è±¡ä¸­çš„æ–¹æ³•å†…éƒ¨ä½¿ç”¨thiså…³é”®å­—æ—¶ï¼Œthiså¯ç”¨äºå¼•ç”¨å®ä¾‹ã€‚å¦‚æœå®ä¾‹ä¸­ä¸åŒ…å«è¦æŸ¥æ‰¾çš„å±æ€§ï¼Œåˆ™ä½¿ç”¨åŸå‹é“¾æŸ¥æ‰¾ã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;Person&nbsp;=&nbsp;function(name){&nbsp;&nbsp;if(name){&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;name;&nbsp;&nbsp;&nbsp;}};Person.prototype.sayHello&nbsp;=&nbsp;function(){&nbsp;&nbsp;console.log('hello&nbsp;'&nbsp;+&nbsp;this.name);};var&nbsp;zhang&nbsp;=&nbsp;new&nbsp;Person('zhang');zhang.sayHello();Object.prototype.name&nbsp;=&nbsp;'default';var&nbsp;d&nbsp;=&nbsp;new&nbsp;Person();d.sayHello();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>19. ä½œç”¨åŸŸ</p><p>JavaScriptä½œç”¨åŸŸæœ‰ä¸‰ç§ï¼šå…¨å±€ä½œç”¨åŸŸã€å±€éƒ¨ä½œç”¨åŸŸï¼ˆå‡½æ•°ä½œç”¨åŸŸï¼‰å’Œevalä½œç”¨åŸŸã€‚</p><ul><li><p>å…¨å±€ä½œç”¨åŸŸæ˜¯ä½œç”¨åŸŸé“¾ä¸­çš„æœ€é«˜å±‚/æœ€åä¸€ä¸ª</p></li><li><p>åŒ…å«å‡½æ•°çš„å‡½æ•°ï¼Œä¼šåˆ›å»ºå †æ ˆæ‰§è¡Œä½œç”¨åŸŸã€‚åˆå«ä½œç”¨åŸŸæ ˆã€‚</p></li><li><p>JavaScriptæ²¡æœ‰å—çº§ä½œç”¨åŸŸã€‚</p></li></ul><p><strong>ä½œç”¨åŸŸé“¾ï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰</strong></p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;x&nbsp;=&nbsp;10,&nbsp;&nbsp;foo&nbsp;=&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;y&nbsp;=&nbsp;20;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;function()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;z&nbsp;=&nbsp;30;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(x&nbsp;+&nbsp;y&nbsp;+&nbsp;z);&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;};var&nbsp;y&nbsp;=&nbsp;500;foo()();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å°ï¼š60</p><p>yåœ¨è§£é‡Šæ—¶å°±å·²ç»ç»‘å®šã€‚å³<strong>å‡½æ•°å®šä¹‰æ—¶ç¡®å®šä½œç”¨åŸŸï¼Œè€Œéè°ƒç”¨æ—¶ç¡®å®šï¼Œä½œç”¨åŸŸé“¾æ˜¯æ ¹æ®å‡½æ•°å®šä¹‰æ—¶çš„ä½ç½®ç¡®å®šçš„ï¼Œä¹Ÿå«â€œè¯æ³•ä½œç”¨åŸŸâ€</strong>ã€‚ä¸thisã€argumentsåŒºåˆ†å¼€ã€‚</p><p>ä½œç”¨åŸŸé“¾å¼åŸºäºä»£ç çš„ç¼–å†™æ–¹å¼åˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯åŸºäºè°ƒç”¨å‡½æ•°æ‰€åœ¨çš„ä¸Šä¸‹æ–‡ã€‚è¿™ä½¿å¾—å‡½æ•°å³ä½¿ä»ä¸€ä¸ªä¸åŒçš„ä¸Šä¸‹æ–‡è°ƒç”¨å‡½æ•°ï¼Œä¹Ÿèƒ½å¤Ÿè®¿é—®æœ€åˆç¼–å†™ä»£ç æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼Œè¿™è¢«ç§°ä¸ºâ€œ<strong>é—­åŒ…</strong>â€ã€‚</p><p>20. Array()</p><p>åˆ›å»ºæ•°ç»„çš„ä¸¤ç§å½¢å¼ï¼š1ã€new Array(length) 2ã€[element1, element2,â€¦]</p><p>ç¬¬ä¸€ç§é¢„å®šä¹‰æ•°ç»„çš„é•¿åº¦ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ éƒ½æ˜¯undefinedã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;myArray&nbsp;=&nbsp;[];myArray[50]&nbsp;=&nbsp;'blue';console.log(myArray.length);&nbsp;&nbsp;&nbsp;&nbsp;//51,50ä¹‹å‰çš„å…ƒç´ éƒ½æ˜¯undefinedå¡«å……<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥é€šè¿‡è®¾ç½®æ•°ç»„é•¿åº¦æ¥æ¥æ·»åŠ æˆ–åˆ é™¤å€¼ã€‚</p><p>21. 0ã€-0ã€nullã€falseã€ NaNã€undefinedå’Œç©ºå­—ç¬¦ä¸²ï¼ˆâ€œâ€ï¼‰å¤–çš„ä»»ä½•æœ‰æ•ˆJavaScriptå€¼éƒ½å°†è¢«è½¬æ¢ä¸ºtrueã€‚</p><pre class="line-numbers language-none"><code class="language-none">var&nbsp;falseBoolean&nbsp;=&nbsp;new&nbsp;Boolean(false);console.log(falseBoolean);if(falseBoolean){&nbsp;&nbsp;&nbsp;&nbsp;//å³ä½¿æ˜¯falseçš„å¸ƒå°”å¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯trueå¯¹è±¡&nbsp;&nbsp;console.log('falseBoolean&nbsp;is&nbsp;truthy');}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ä½¿ç”¨AngularJSçš„è¿‡ç¨‹ä¸­äº†è§£Promiseï¼ˆä¸€ï¼‰</title>
      <link href="/2015/11/16/zai-shi-yong-angularjs-de-guo-cheng-zhong-liao-jie-promise/"/>
      <url>/2015/11/16/zai-shi-yong-angularjs-de-guo-cheng-zhong-liao-jie-promise/</url>
      
        <content type="html"><![CDATA[<p>å¥½å§ï¼Œæˆ‘æ‰¿è®¤æœ€è¿‘çš„ç¡®åœ¨é‡æ–°å­¦æµè§ˆå™¨ç«¯çš„æŠ€æœ¯ã€‚OMGï¼Œåˆšå…¥è¡Œçš„æ—¶å€™æˆ‘å°±è§‰å¾—æœ€ç³Ÿå¿ƒçš„æµè§ˆå™¨ç«¯è¯­è¨€ â€”â€” å¿ƒä¸­ä¸€ç›´æƒ³è¦å›é¿çš„åŒºåŸŸï¼Œå¹¶ä¸”NBå‰ç«¯å·¥ç¨‹å¸ˆéœ€è¦å…‹æœç§ç§ä¸åç«¯å·¥ç¨‹å¸ˆå±æ€§ä¸å’Œçš„åŒºåŸŸï¼ˆè·¨æµè§ˆå™¨è·¨è®¾å¤‡ã€æ ‡å‡†ä¸ç»Ÿä¸€ã€JSå•çº¿ç¨‹ä¸‹çš„æ•ˆç‡ä¸å·¥ä½œæµç¨‹ã€UIé£æ ¼ç¾ä¸ç¾ä½ç½®å‡†ä¸å‡†ç¡®ç­‰ç­‰ç­‰ç­‰ï¼‰ï¼Œå¯¹äºæˆ‘è¿™ç§ä¸å…³å¿ƒå®¡ç¾ä¹Ÿæ²¡å¤šå°‘è€å¿ƒåŒæ¶æ— æ ‡å‡†çš„æ­»æ¿åå°å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œå¿ƒä¸­ä¸€ç›´åªæƒ³è¯´ï¼šè¯·æ”¾è¿‡æˆ‘ã€‚</p><p>æœ€è¿‘åœ¨åšä¸€ä¸ªAngularJSçš„é¡¹ç›®ï¼Œå…¶è‡´åŠ›äºå‰åç«¯åˆ†ç¦»ã€æä¾›å‰ç«¯æ¨¡æ¿ã€æ ‡å‡†webé¡µé¢ç»„ä»¶ç­‰ç­‰ï¼Œåœ¨å…¶ä¸­é‡è§äº†ä¸€ä¸ªPromiseï¼Œæ‰å‘ç°è„±ç¦»å‰ç«¯å…³æ³¨å·²ç»å¾ˆä¹…äº†ï¼Œä¸çŸ¥ä¸è§‰ä¸­å‰ç«¯ä¹Ÿåœ¨ä¸æ–­å¾€å‰å‘å±•ã€‚åºŸè¯å°±ä¸å¤šè¯´äº†ï¼Œåé¢æ˜¯è‡ªå·±ä½¿ç”¨éƒ¨åˆ†çš„ä¸€ç‚¹æ€»ç»“ã€‚</p><hr><p>Promiseæ¥è‡ªäºPromise/A+ï¼ŒCommonJSæŒ‡å®šè§„èŒƒã€‚è§£å†³JSä¸­çš„å›è°ƒåœ°ç‹±å’Œå¼‚æ­¥è°ƒç”¨ã€‚</p><h3 id="Promiseç®€å•ä½¿ç”¨">Promiseç®€å•ä½¿ç”¨</h3><p>æŠ›å¼€AngularJSå®ç°çš„æºç ä¸è¯´çš„è¯ï¼Œä½¿ç”¨Promiseå…¶å®ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šdeferredå’Œpromise ä¸¤ä¸ªå¯¹è±¡ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> deferred <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>deferred<span class="token punctuation">.</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>"defer"è‹±æ–‡å•è¯â€œå»¶è¿Ÿâ€ï¼Œ"promise"ç»™äºˆâ€œæ‰¿è¯ºâ€ã€‚</p><p>promiseæ˜¯defferedçš„ä¸€ä¸ªå±æ€§ï¼Œå¸¦æœ‰æœ€ä¸»è¦çš„thenæ–¹æ³•ï¼Œç”¨äºæ³¨å†Œä¸‰ç±»å›è°ƒå‡½æ•°ï¼šsuccessCallBack/errorCallBack/notificationCallBackï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªæ–°çš„promiseã€‚</p><p>è€Œdeferredçš„ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«é’ˆå¯¹äºå‡ºå‘è¿™ä¸‰ç±»å›è°ƒçš„å‘ç”Ÿï¼šresolve()/reject()/notify().</p><p>è€Œä¸€ä¸ªå»¶è¿Ÿä»»åŠ¡ï¼Œresolve()/reject()åªèƒ½äºŒé€‰ä¸€è¿›è¡Œè§¦å‘ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> deferred <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> promise <span class="token operator">=</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token function">notification</span><span class="token punctuation">(</span><span class="token parameter">progress</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> progress <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">var</span> interval <span class="token operator">=</span> <span class="token function">$interval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">progress <span class="token operator">&gt;=</span> <span class="token number">100</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    $interval<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>    deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'All done!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  progress <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span>  deferred<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>progress <span class="token operator">+</span> <span class="token string">'%...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æˆ‘çœ‹æ¥deferredå°±åƒç”±å®ƒç”Ÿå‡ºçš„promiseè¿™é¢—ç‚¸å¼¹çš„é¥æ§å™¨ï¼ŒdeferredæŒ‰ä¸‹resolve()æŒ‰é’®ï¼ŒsuccessCallBackè¢«è°ƒç”¨ï¼›æˆ–è€…æŒ‰ä¸‹reject()æŒ‰é’®ï¼ŒerrorCallBackè¢«è°ƒç”¨ï¼›å»¶è¿ŸåŠ è½½ä¸­ï¼Œnotify()è§¦å‘notificationCallBackã€‚</p><p>è¿™ä¸ªæ¯”å–»è™½ç„¶å½¢è±¡ï¼Œä½†æ˜¯å…¶å®å¹¶ä¸èƒ½å¾ˆå¥½çš„æ¦‚æ‹¬promiseçš„æ‰€æœ‰åŠŸèƒ½ã€‚æ¯”å¦‚ï¼šå‚æ•°çš„ä¼ é€’ã€‚</p><p>resolve(result) -&gt; function successCallBack(result){}</p><p>reject(reason) -&gt; function&nbsp;errorCallBack(reason){}</p><p>notify(progress) -&gt; function&nbsp;notificationCallBack(progress){}</p><p>å‚æ•°å¯¹è±¡å¯ä»¥ä¸ºæ™®é€šå¯¹è±¡ä¹Ÿå¯ä»¥ä¸ºpromiseå¯¹è±¡ï¼Œå¦‚æœä¸ºpromiseï¼Œæ•ˆæœåŒé“¾å¼å‘ä¸‹ä¼ é€’ã€‚</p><h3 id="Promiseé“¾å¼ä½¿ç”¨">Promiseé“¾å¼ä½¿ç”¨</h3><p>promiseå¯¹è±¡æ˜¯å¯ä»¥ä½¿ç”¨å¤šä¸ªthenæ–¹æ³•è¿ç»­è°ƒç”¨çš„ï¼Œå³é“¾å¼ä¹¦å†™è°ƒç”¨ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> deferred <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> promise <span class="token operator">=</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">'B+'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">'B-'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I only want to see who will execute here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'A+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//deferred.reject('A-');</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>resolve(â€˜A+â€™)æ—¶ï¼Œå°†æ‰“å°ï¼šA+ï¼ŒB+</p><p>reject(â€˜A-â€™)æ—¶ï¼Œå°†æ‰“å°ï¼šA-ï¼ŒB-</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯reject(),reject()ä»…è´Ÿè´£ç¬¬ä¸€å±‚thençš„è§¦å‘ã€‚ç¬¬ä¸€å±‚thençš„successCallBack\errorCallBackæˆåŠŸæ‰§è¡Œåï¼ˆæ— errorå‘ç”Ÿï¼‰ï¼Œåˆ™è‡ªåŠ¨è§¦å‘ä¸‹ä¸€å±‚promise.thenå¯¹åº”çš„resolve()æ–¹æ³•ã€‚</p><p>æ‰€ä»¥ä¸Šä¾‹ä¸­éœ€è¦reject(â€˜A-â€™)æ—¶ï¼Œæƒ³è¦æ‰“å°å‡ºï¼šA-ï¼ŒI only want to see who will execute hereã€‚åˆ™éœ€è¦</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> deferred <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> promise <span class="token operator">=</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">'B+'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">throw</span> <span class="token string">"this is error"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I only want to see who will execute here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'A-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å°ç»“æœï¼š</p><pre class="line-numbers language-none"><code class="language-none">Athis&nbsp;is&nbsp;errorI&nbsp;only&nbsp;want&nbsp;to&nbsp;see&nbsp;who&nbsp;will&nbsp;execute&nbsp;herethis&nbsp;is&nbsp;error<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>errorè¢«æ‰“å°ï¼Œä½†ä»»åŠ¡æœªä¸­æ–­ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">  <span class="token keyword">var</span> defer1 <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    defer2 <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    promise1 <span class="token operator">=</span> defer1<span class="token punctuation">.</span>promise<span class="token punctuation">,</span>    promise2 <span class="token operator">=</span> defer2<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>  promise1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"I'm promise1 success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"I'm promise1 error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> promise3 <span class="token operator">=</span> promise2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"I'm promise2 success"</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">'2'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"I'm promise2 success"</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">'3'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"I'm promise2 success"</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">'4'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    defer1<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promise3<span class="token punctuation">)</span><span class="token punctuation">;</span>  defer2<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å°ï¼š</p><pre class="line-numbers language-none"><code class="language-none">I'm&nbsp;promise2&nbsp;success1I'm&nbsp;promise2&nbsp;success2I'm&nbsp;promise2&nbsp;success3I'm&nbsp;promise1&nbsp;success4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œrefer.resolveå‚æ•°å³ä¸ºä¸€ä¸ªpromiseï¼Œæ‰€ä»¥defer1.promiseä¸Šæ³¨å†Œçš„å›è°ƒä¼šåœ¨promise3å·²çŸ¥çš„å›è°ƒæ‰§è¡Œå®Œä»¥ååœ¨è¿›è¡Œè°ƒç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> AngularJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
